import{d as B,cJ as C,a as j,v as D,U as S,b as U,g as E,aE as z,w as o,e as t,p as F,aB as I,j as s,k as L,cv as M,i as g,t as u,E as N,V as $,aC as q,aD as J,B as K,f,a4 as O,cK as R,s as r,a5 as X}from"./index-DXU74lGt.js";import{u as G,D as H}from"./useAuditLogUtils-BqNOieoY.js";import{_ as Q}from"./DateTimeCell.vue_vue_type_script_setup_true_lang-BMnBYvTq.js";import{V as W}from"./VDataTableServer-CMLVDy59.js";const Y={class:"text-truncate",style:{"max-width":"200px",display:"inline-block"}},Z=["colspan"],b=10,se=B({__name:"AuditLogDialog",props:R({appLabel:{},model:{},objectPk:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:["update:modelValue"],setup(v){const d=v,c=C(v,"modelValue"),{t:l}=j(),_=D(),{actionLabel:P,actionColor:T}=G(),p=r(!1),A=[b,25,50],m=r(b),x=r(0),y=r(1),V=r([]),k=r([]),w=[{title:"",key:"data-table-expand",width:50},{title:l("AuditLogTable.headers.timestamp"),key:"timestamp",sortable:!0},{title:l("AuditLogTable.headers.user"),key:"actor",sortable:!1},{title:l("AuditLogTable.headers.action"),key:"action",sortable:!1,width:100},{title:l("AuditLogTable.headers.object"),key:"object_repr",sortable:!1}];async function h(i){p.value=!0;try{const a={app_label:d.appLabel,model:d.model,limit:i.itemsPerPage,offset:(i.page-1)*i.itemsPerPage};if(d.objectPk!==void 0&&(a.object_pk=String(d.objectPk)),i.sortBy.length>0){const n=i.sortBy[0];n&&(a.ordering=n.order==="desc"?`-${n.key}`:n.key)}const e=await X({query:a});V.value=e.data?.results??[],x.value=e.data?.count??0}catch(a){_.error(l("AuditLogTable.loadFailure")),console.error(a)}finally{p.value=!1}}return S(c,i=>{i&&(y.value=1,h({page:1,itemsPerPage:m.value??b,sortBy:[{key:"timestamp",order:"desc"}]}))}),(i,a)=>(U(),E(z,{modelValue:c.value,"onUpdate:modelValue":a[3]||(a[3]=e=>c.value=e),"max-width":"900",scrollable:""},{default:o(()=>[t(F,null,{default:o(()=>[t(I,{class:"d-flex align-center"},{default:o(()=>[t(s(L),{icon:s(M),class:"mr-2"},null,8,["icon"]),g(" "+u(s(l)("AuditLogTable.title"))+" ",1),t(N),t($,{icon:"",variant:"text",onClick:a[0]||(a[0]=e=>c.value=!1)},{default:o(()=>[t(s(L),{icon:s(q)},null,8,["icon"])]),_:1})]),_:1}),t(J),t(K,{class:"pa-0"},{default:o(()=>[t(W,{"items-per-page":m.value,"onUpdate:itemsPerPage":a[1]||(a[1]=e=>m.value=e),expanded:k.value,"onUpdate:expanded":a[2]||(a[2]=e=>k.value=e),class:"elevation-0","item-value":"id",density:"compact",headers:w,items:V.value,"items-length":x.value,loading:p.value,page:y.value,"items-per-page-options":A,"no-data-text":s(l)("AuditLogTable.noEntriesFound"),"loading-text":s(l)("AuditLogTable.loadingEntries"),"show-expand":"","onUpdate:options":h},{"item.timestamp":o(({item:e})=>[t(Q,{value:e.timestamp},null,8,["value"])]),"item.actor":o(({item:e})=>[g(u(e.actor?.username??s(l)("AuditLogTable.system")),1)]),"item.action":o(({item:e})=>[t(O,{color:s(T)(e.action),size:"small",variant:"tonal"},{default:o(()=>[g(u(s(P)(e.action)),1)]),_:2},1032,["color"])]),"item.object_repr":o(({item:e})=>[f("span",Y,u(e.object_repr),1)]),"expanded-row":o(({columns:e,item:n})=>[f("tr",null,[f("td",{colspan:e.length,class:"pa-4 bg-grey-lighten-4"},[t(H,{changes:n.changes},null,8,["changes"])],8,Z)])]),_:1},8,["items-per-page","expanded","items","items-length","loading","page","no-data-text","loading-text"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});export{se as _};
//# sourceMappingURL=AuditLogDialog.vue_vue_type_script_setup_true_lang-WkXOSlqa.js.map
