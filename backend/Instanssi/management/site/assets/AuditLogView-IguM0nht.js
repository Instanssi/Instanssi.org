import{d as F,a as T,v as z,b as I,g as N,w as o,e as i,a3 as O,j as r,f as c,t as d,i as g,a4 as $,s as n,a5 as M}from"./index-DXU74lGt.js";import{u as q,D as R}from"./useAuditLogUtils-BqNOieoY.js";import{V as L,_ as G}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D4jd1chv.js";import{_ as H}from"./DateTimeCell.vue_vue_type_script_setup_true_lang-BMnBYvTq.js";import{d as J}from"./debounce-CQ84CrOG.js";import{V as _}from"./VRow-B94Tto0H.js";import{V as K}from"./VDataTableServer-CMLVDy59.js";import"./VContainer-BfWqa_tJ.js";import"./datetime-Dz9fjSvq.js";import"./VDataTable-Jd7io3gq.js";const Q={class:"text-truncate",style:{"max-width":"300px",display:"inline-block"}},W=["colspan"],A=25,re=F({__name:"AuditLogView",setup(X){const{t:e}=T(),h=z(),{actionLabel:x,actionColor:k}=q(),P=[{title:e("AuditLogView.title"),disabled:!0}];function C(l){return x(l,"AuditLogView")}const B=[{label:e("AuditLogView.models.user"),value:"users.user"},{label:e("AuditLogView.models.event"),value:"kompomaatti.event"},{label:e("AuditLogView.models.blogEntry"),value:"ext_blog.blogentry"},{label:e("AuditLogView.models.programmeEvent"),value:"ext_programme.programmeevent"},{label:e("AuditLogView.models.compo"),value:"kompomaatti.compo"},{label:e("AuditLogView.models.entry"),value:"kompomaatti.entry"},{label:e("AuditLogView.models.competition"),value:"kompomaatti.competition"},{label:e("AuditLogView.models.competitionParticipation"),value:"kompomaatti.competitionparticipation"},{label:e("AuditLogView.models.storeItem"),value:"store.storeitem"},{label:e("AuditLogView.models.storeTransaction"),value:"store.storetransaction"},{label:e("AuditLogView.models.uploadedFile"),value:"admin_upload.uploadedfile"},{label:e("AuditLogView.models.otherVideo"),value:"arkisto.othervideo"},{label:e("AuditLogView.models.otherVideoCategory"),value:"arkisto.othervideocategory"}],m=n(!1),U=[A,50,100],v=n(A),b=n(0),V=n(1),f=n([]),w=n([]),u=n(null),p=n(null),j=[{title:"",key:"data-table-expand",width:50},{title:e("AuditLogView.headers.timestamp"),key:"timestamp",sortable:!0},{title:e("AuditLogView.headers.user"),key:"actor",sortable:!1},{title:e("AuditLogView.headers.action"),key:"action",sortable:!1,width:100},{title:e("AuditLogView.headers.model"),key:"content_type",sortable:!1},{title:e("AuditLogView.headers.object"),key:"object_repr",sortable:!1}];function S(){V.value=1,p.value&&y({...p.value,page:1})}async function y(l){m.value=!0,p.value=l;try{const a={limit:l.itemsPerPage,offset:(l.page-1)*l.itemsPerPage};if(u.value){const[s,E]=u.value.split(".");a.app_label=s,a.model=E}if(l.sortBy.length>0){const s=l.sortBy[0];s&&(a.ordering=s.order==="desc"?`-${s.key}`:s.key)}const t=await M({query:a});f.value=t.data?.results??[],b.value=t.data?.count??0}catch(a){h.error(e("AuditLogView.loadFailure")),console.error(a)}finally{m.value=!1}}const D=J(y,250);return(l,a)=>(I(),N(G,{breadcrumbs:P},{default:o(()=>[i(L,null,{default:o(()=>[i(_,{class:"align-center"},{default:o(()=>[i(O,{modelValue:u.value,"onUpdate:modelValue":[a[0]||(a[0]=t=>u.value=t),S],variant:"outlined",density:"compact",label:r(e)("AuditLogView.filterByModel"),items:B,"item-title":"label","item-value":"value",style:{"max-width":"300px"},class:"ma-0 pa-0",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),i(L,null,{default:o(()=>[i(_,null,{default:o(()=>[i(K,{"items-per-page":v.value,"onUpdate:itemsPerPage":a[1]||(a[1]=t=>v.value=t),expanded:w.value,"onUpdate:expanded":a[2]||(a[2]=t=>w.value=t),class:"elevation-1 primary","item-value":"id",density:"compact",headers:j,items:f.value,"items-length":b.value,loading:m.value,page:V.value,"items-per-page-options":U,"no-data-text":r(e)("AuditLogView.noEntriesFound"),"loading-text":r(e)("AuditLogView.loadingEntries"),"show-expand":"","onUpdate:options":r(D)},{"item.timestamp":o(({item:t})=>[i(H,{value:t.timestamp},null,8,["value"])]),"item.actor":o(({item:t})=>[g(d(t.actor?.username??r(e)("AuditLogView.system")),1)]),"item.action":o(({item:t})=>[i($,{color:r(k)(t.action),size:"small",variant:"tonal"},{default:o(()=>[g(d(C(t.action)),1)]),_:2},1032,["color"])]),"item.content_type":o(({item:t})=>[g(d(t.content_type?.app_label)+"."+d(t.content_type?.model),1)]),"item.object_repr":o(({item:t})=>[c("span",Q,d(t.object_repr),1)]),"expanded-row":o(({columns:t,item:s})=>[c("tr",null,[c("td",{colspan:t.length,class:"pa-4 bg-grey-lighten-4"},[i(R,{changes:s.changes},null,8,["changes"])],8,W)])]),_:1},8,["items-per-page","expanded","items","items-length","loading","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1}))}});export{re as default};
//# sourceMappingURL=AuditLogView-IguM0nht.js.map
