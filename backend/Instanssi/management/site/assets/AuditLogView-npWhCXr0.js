import{d as j,a as F,v as O,b as D,g as E,w as l,e as n,N as I,j as i,f as g,t as d,i as v,a5 as N,s as u,I as $,a6 as z}from"./index-CQkWvXOv.js";import{u as M,D as q}from"./useAuditLogUtils-BdjF9k7b.js";import{V as w,_ as K}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D5aCeQDf.js";import{_ as R}from"./DateTimeCell.vue_vue_type_script_setup_true_lang-DaLynL44.js";import{u as G,d as H}from"./useTableState-CutuDm2i.js";import{V as L}from"./VRow-CXIXhuhq.js";import{V as J}from"./VDataTableServer-C6tuZDKn.js";import"./VContainer-DqJ8gu3P.js";import"./datetime-Dz9fjSvq.js";import"./VDataTable-f5_9vewM.js";const Q={class:"text-truncate",style:{"max-width":"300px",display:"inline-block"}},W=["colspan"],re=j({__name:"AuditLogView",setup(X){const{t:e}=F(),_=O(),{actionLabel:A,actionColor:h}=M(),x=[{title:e("AuditLogView.title"),disabled:!0}];function k(a){return A(a,"AuditLogView")}const P=[{label:e("AuditLogView.models.user"),value:"users.user"},{label:e("AuditLogView.models.event"),value:"kompomaatti.event"},{label:e("AuditLogView.models.blogEntry"),value:"ext_blog.blogentry"},{label:e("AuditLogView.models.programmeEvent"),value:"ext_programme.programmeevent"},{label:e("AuditLogView.models.compo"),value:"kompomaatti.compo"},{label:e("AuditLogView.models.entry"),value:"kompomaatti.entry"},{label:e("AuditLogView.models.competition"),value:"kompomaatti.competition"},{label:e("AuditLogView.models.competitionParticipation"),value:"kompomaatti.competitionparticipation"},{label:e("AuditLogView.models.storeItem"),value:"store.storeitem"},{label:e("AuditLogView.models.storeTransaction"),value:"store.storetransaction"},{label:e("AuditLogView.models.uploadedFile"),value:"admin_upload.uploadedfile"},{label:e("AuditLogView.models.otherVideo"),value:"arkisto.othervideo"},{label:e("AuditLogView.models.otherVideoCategory"),value:"arkisto.othervideocategory"}],p=u(!1),s=G({filterKeys:["model"]}),b=u(0),f=u([]),V=u([]),c=u(null),m=$({get:()=>s.filters.value.model??null,set:a=>{s.setFilter("model",a)}}),B=[{title:"",key:"data-table-expand",width:50},{title:e("AuditLogView.headers.timestamp"),key:"timestamp",sortable:!0},{title:e("AuditLogView.headers.user"),key:"actor",sortable:!1},{title:e("AuditLogView.headers.action"),key:"action",sortable:!1,width:100},{title:e("AuditLogView.headers.model"),key:"content_type",sortable:!1},{title:e("AuditLogView.headers.object"),key:"object_repr",sortable:!1}];function C(){s.page.value=1,c.value&&y({...c.value,page:1})}function U(a){s.onOptionsUpdate({...a,groupBy:[],search:""}),S(a)}async function y(a){p.value=!0,c.value=a;try{const o={limit:a.itemsPerPage,offset:(a.page-1)*a.itemsPerPage};if(m.value){const[r,T]=m.value.split(".");o.app_label=r,o.model=T}if(a.sortBy.length>0){const r=a.sortBy[0];r&&(o.ordering=r.order==="desc"?`-${r.key}`:r.key)}const t=await z({query:o});f.value=t.data?.results??[],b.value=t.data?.count??0}catch(o){_.error(e("AuditLogView.loadFailure")),console.error(o)}finally{p.value=!1}}const S=H(y,250);return(a,o)=>(D(),E(K,{breadcrumbs:x},{default:l(()=>[n(w,null,{default:l(()=>[n(L,{class:"align-center"},{default:l(()=>[n(I,{modelValue:m.value,"onUpdate:modelValue":[o[0]||(o[0]=t=>m.value=t),C],variant:"outlined",density:"compact",label:i(e)("AuditLogView.filterByModel"),items:P,"item-title":"label","item-value":"value",style:{"max-width":"300px"},class:"ma-0 pa-0",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),n(w,null,{default:l(()=>[n(L,null,{default:l(()=>[n(J,{"items-per-page":i(s).perPage.value,"onUpdate:itemsPerPage":o[1]||(o[1]=t=>i(s).perPage.value=t),expanded:V.value,"onUpdate:expanded":o[2]||(o[2]=t=>V.value=t),"sort-by":i(s).sortByArray.value,class:"elevation-1 primary","item-value":"id",density:"compact",headers:B,items:f.value,"items-length":b.value,loading:p.value,page:i(s).page.value,"items-per-page-options":i(s).pageSizeOptions,"no-data-text":i(e)("AuditLogView.noEntriesFound"),"loading-text":i(e)("AuditLogView.loadingEntries"),"show-expand":"","onUpdate:options":U},{"item.timestamp":l(({item:t})=>[n(R,{value:t.timestamp},null,8,["value"])]),"item.actor":l(({item:t})=>[v(d(t.actor?.username??i(e)("AuditLogView.system")),1)]),"item.action":l(({item:t})=>[n(N,{color:i(h)(t.action),size:"small",variant:"tonal"},{default:l(()=>[v(d(k(t.action)),1)]),_:2},1032,["color"])]),"item.content_type":l(({item:t})=>[v(d(t.content_type?.app_label)+"."+d(t.content_type?.model),1)]),"item.object_repr":l(({item:t})=>[g("span",Q,d(t.object_repr),1)]),"expanded-row":l(({columns:t,item:r})=>[g("tr",null,[g("td",{colspan:t.length,class:"pa-4 bg-grey-lighten-4"},[n(q,{changes:r.changes},null,8,["changes"])],8,W)])]),_:1},8,["items-per-page","expanded","sort-by","items","items-length","loading","page","items-per-page-options","no-data-text","loading-text"])]),_:1})]),_:1})]),_:1}))}});export{re as default};
//# sourceMappingURL=AuditLogView-npWhCXr0.js.map
