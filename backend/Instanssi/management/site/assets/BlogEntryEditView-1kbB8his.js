import{d as W,a as X,u as Y,v as H,T as J,U as O,o as Q,W as Z,X as ee,b as c,g as B,w as o,e as s,A as te,p as ae,B as le,l as se,j as e,m as oe,f as ie,t as m,c as re,K as ne,Y as ue,C as de,V as E,i as D,k as ce,D as me,s as I,G as p,E as pe}from"./index-qrfwdmHz.js";import{c as ve,d as be,a as F,u as fe,b as _,V as ge}from"./index.esm-BpR9m2gH.js";import{V as M,_ as Ve}from"./LayoutBase.vue_vue_type_script_setup_true_lang-Cgp8Musd.js";import{h as S}from"./http-Cqy_sGiB.js";import{p as v}from"./parseInt-CGa1F4cm.js";import{V as ye}from"./VSwitch-eDN7lqDz.js";import"./VContainer-e74dHNZG.js";const xe={class:"text-subtitle-2 mb-1"},Be={key:0,class:"text-error text-caption"},Ee=W({__name:"BlogEntryEditView",props:{eventId:{},id:{}},setup(T){const w={title:"title",text:"text",public:"public"},i=T,{t:l}=X(),A=Y(),r=H(),{getEventById:N}=pe(),b=I(!1),f=I(!1),C=I(""),U=p(()=>v(i.eventId,10)),g=p(()=>i.id!==void 0),G=p(()=>{const a=[{title:N(U.value)?.name??"...",to:{name:"dashboard",params:{eventId:i.eventId}}},{title:l("BlogEditorView.title"),to:{name:"blog",params:{eventId:i.eventId}}}];return g.value?a.push({title:C.value||"...",disabled:!0}):a.push({title:l("Breadcrumbs.newPost"),disabled:!0}),a}),$=p(()=>n.value.value?l("BlogPostDialog.labels.postIsVisible"):l("BlogPostDialog.labels.postNotVisible")),j=ve({title:F().required().min(1).max(128),text:F().required().min(1),public:be()}),{handleSubmit:q,setValues:z,setErrors:P,meta:L}=fe({validationSchema:j,initialValues:{title:"",text:"",public:!1}}),V=_("title"),d=_("text"),n=_("public"),h=q(async a=>{f.value=!0;let t;g.value?t=await K(v(i.id,10),a):t=await R(a),f.value=!1,t&&y()});function k(a){return{title:a.title,text:a.text,public:a.public}}async function R(a){try{return await J({body:{event:v(i.eventId,10),...k(a)}}),r.success(l("BlogPostDialog.createSuccess")),!0}catch(t){S(t,P,r,l("BlogPostDialog.createFailure"),w)}return!1}async function K(a,t){try{return await O({path:{id:a},body:k(t)}),r.success(l("BlogPostDialog.editSuccess")),!0}catch(x){S(x,P,r,l("BlogPostDialog.editFailure"),w)}return!1}function y(){A.push({name:"blog",params:{eventId:i.eventId}})}return Q(async()=>{if(g.value){b.value=!0;try{const t=(await Z({path:{id:v(i.id,10)}})).data;C.value=t.title,z({title:t.title,text:t.text,public:t.public??!1})}catch(a){r.error(l("BlogEntryEditView.loadFailure")),console.error(a),y()}finally{b.value=!1}}}),(a,t)=>{const x=ee("VuetifyTiptap");return c(),B(Ve,{breadcrumbs:G.value},{default:o(()=>[b.value?(c(),B(M,{key:0,class:"d-flex justify-center my-8"},{default:o(()=>[s(te,{indeterminate:"",size:"64"})]),_:1})):(c(),B(M,{key:1},{default:o(()=>[s(ae,null,{default:o(()=>[s(le,null,{default:o(()=>[s(ge,{onSubmit:se(e(h),["prevent"])},{default:o(()=>[s(oe,{modelValue:e(V).value.value,"onUpdate:modelValue":t[0]||(t[0]=u=>e(V).value.value=u),"error-messages":e(V).errorMessage.value,variant:"outlined",label:e(l)("BlogPostDialog.labels.title")+" *"},null,8,["modelValue","error-messages","label"]),ie("div",xe,m(e(l)("BlogPostDialog.labels.text"))+" * ",1),s(x,{modelValue:e(d).value.value,"onUpdate:modelValue":t[1]||(t[1]=u=>e(d).value.value=u)},null,8,["modelValue"]),e(d).errorMessage.value?(c(),re("div",Be,m(e(d).errorMessage.value),1)):ne("",!0),s(ye,{modelValue:e(n).value.value,"onUpdate:modelValue":t[2]||(t[2]=u=>e(n).value.value=u),"error-messages":e(n).errorMessage.value,label:$.value,class:ue({"text-green-darken-3":e(n).value.value})},null,8,["modelValue","error-messages","label","class"])]),_:1},8,["onSubmit"])]),_:1}),s(de,{class:"justify-end"},{default:o(()=>[s(E,{variant:"text",onClick:y},{default:o(()=>[D(m(e(l)("General.cancel")),1)]),_:1}),s(E,{variant:"elevated",color:"primary",loading:f.value,disabled:!e(L).valid,onClick:e(h)},{prepend:o(()=>[s(e(ce),{icon:e(me)},null,8,["icon"])]),default:o(()=>[D(" "+m(e(l)("General.save")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1}))]),_:1},8,["breadcrumbs"])}}});export{Ee as default};
//# sourceMappingURL=BlogEntryEditView-1kbB8his.js.map
