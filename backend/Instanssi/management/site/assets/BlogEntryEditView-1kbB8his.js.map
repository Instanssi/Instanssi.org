{"version":3,"file":"BlogEntryEditView-1kbB8his.js","sources":["../../../../../admin/src/views/blog/BlogEntryEditView.vue"],"sourcesContent":["<template>\n    <LayoutBase :breadcrumbs=\"breadcrumbs\">\n        <v-col v-if=\"loading\" class=\"d-flex justify-center my-8\">\n            <v-progress-circular indeterminate size=\"64\" />\n        </v-col>\n        <v-col v-else>\n            <v-card>\n                <v-card-text>\n                    <v-form @submit.prevent=\"submit\">\n                        <v-text-field\n                            v-model=\"title.value.value\"\n                            :error-messages=\"title.errorMessage.value\"\n                            variant=\"outlined\"\n                            :label=\"t('BlogPostDialog.labels.title') + ' *'\"\n                        />\n                        <div class=\"text-subtitle-2 mb-1\">\n                            {{ t(\"BlogPostDialog.labels.text\") }} *\n                        </div>\n                        <VuetifyTiptap v-model=\"text.value.value\" />\n                        <div v-if=\"text.errorMessage.value\" class=\"text-error text-caption\">\n                            {{ text.errorMessage.value }}\n                        </div>\n                        <v-switch\n                            v-model=\"isPublic.value.value\"\n                            :error-messages=\"isPublic.errorMessage.value\"\n                            :label=\"switchLabel\"\n                            :class=\"{ 'text-green-darken-3': isPublic.value.value }\"\n                        />\n                    </v-form>\n                </v-card-text>\n                <v-card-actions class=\"justify-end\">\n                    <v-btn variant=\"text\" @click=\"goBack\">\n                        {{ t(\"General.cancel\") }}\n                    </v-btn>\n                    <v-btn\n                        variant=\"elevated\"\n                        color=\"primary\"\n                        :loading=\"saving\"\n                        :disabled=\"!meta.valid\"\n                        @click=\"submit\"\n                    >\n                        <template #prepend>\n                            <FontAwesomeIcon :icon=\"faSave\" />\n                        </template>\n                        {{ t(\"General.save\") }}\n                    </v-btn>\n                </v-card-actions>\n            </v-card>\n        </v-col>\n    </LayoutBase>\n</template>\n\n<script setup lang=\"ts\">\nimport { faFloppyDisk as faSave } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/vue-fontawesome\";\nimport { parseInt } from \"lodash-es\";\nimport { type GenericObject, useField, useForm } from \"vee-validate\";\nimport { computed, onMounted, ref } from \"vue\";\nimport { useI18n } from \"vue-i18n\";\nimport { useRouter } from \"vue-router\";\nimport { useToast } from \"vue-toastification\";\nimport { boolean as yupBoolean, object as yupObject, string as yupString } from \"yup\";\n\nimport * as api from \"@/api\";\nimport LayoutBase, { type BreadcrumbItem } from \"@/components/layout/LayoutBase.vue\";\nimport { useEvents } from \"@/services/events\";\nimport { handleApiError, type FieldMapping } from \"@/utils/http\";\n\n/** Maps API field names (snake_case) to form field names (camelCase) */\nconst API_FIELD_MAPPING: FieldMapping = {\n    title: \"title\",\n    text: \"text\",\n    public: \"public\",\n};\n\nconst props = defineProps<{\n    eventId: string;\n    id?: string;\n}>();\n\nconst { t } = useI18n();\nconst router = useRouter();\nconst toast = useToast();\nconst { getEventById } = useEvents();\n\nconst loading = ref(false);\nconst saving = ref(false);\nconst entryTitle = ref<string>(\"\");\nconst eventId = computed(() => parseInt(props.eventId, 10));\nconst isEditMode = computed(() => props.id !== undefined);\n\nconst breadcrumbs = computed<BreadcrumbItem[]>(() => {\n    const items: BreadcrumbItem[] = [\n        {\n            title: getEventById(eventId.value)?.name ?? \"...\",\n            to: { name: \"dashboard\", params: { eventId: props.eventId } },\n        },\n        {\n            title: t(\"BlogEditorView.title\"),\n            to: { name: \"blog\", params: { eventId: props.eventId } },\n        },\n    ];\n    if (isEditMode.value) {\n        items.push({ title: entryTitle.value || \"...\", disabled: true });\n    } else {\n        items.push({ title: t(\"Breadcrumbs.newPost\"), disabled: true });\n    }\n    return items;\n});\nconst switchLabel = computed(() =>\n    isPublic.value.value\n        ? t(\"BlogPostDialog.labels.postIsVisible\")\n        : t(\"BlogPostDialog.labels.postNotVisible\")\n);\n\n// Form validation\nconst validationSchema = yupObject({\n    title: yupString().required().min(1).max(128),\n    text: yupString().required().min(1),\n    public: yupBoolean(),\n});\nconst { handleSubmit, setValues, setErrors, meta } = useForm({\n    validationSchema,\n    initialValues: {\n        title: \"\",\n        text: \"\",\n        public: false,\n    },\n});\nconst title = useField<string>(\"title\");\nconst text = useField<string>(\"text\");\nconst isPublic = useField<boolean>(\"public\");\n\nconst submit = handleSubmit(async (values) => {\n    saving.value = true;\n    let ok: boolean;\n    if (isEditMode.value) {\n        ok = await editItem(parseInt(props.id!, 10), values);\n    } else {\n        ok = await createItem(values);\n    }\n    saving.value = false;\n    if (ok) {\n        goBack();\n    }\n});\n\nfunction buildBody(values: GenericObject) {\n    return {\n        title: values.title,\n        text: values.text,\n        public: values.public,\n    };\n}\n\nasync function createItem(values: GenericObject) {\n    try {\n        await api.adminBlogCreate({\n            body: {\n                event: parseInt(props.eventId, 10),\n                ...buildBody(values),\n            },\n        });\n        toast.success(t(\"BlogPostDialog.createSuccess\"));\n        return true;\n    } catch (e) {\n        handleApiError(e, setErrors, toast, t(\"BlogPostDialog.createFailure\"), API_FIELD_MAPPING);\n    }\n    return false;\n}\n\nasync function editItem(itemId: number, values: GenericObject) {\n    try {\n        await api.adminBlogPartialUpdate({\n            path: { id: itemId },\n            body: buildBody(values),\n        });\n        toast.success(t(\"BlogPostDialog.editSuccess\"));\n        return true;\n    } catch (e) {\n        handleApiError(e, setErrors, toast, t(\"BlogPostDialog.editFailure\"), API_FIELD_MAPPING);\n    }\n    return false;\n}\n\nfunction goBack() {\n    router.push({ name: \"blog\", params: { eventId: props.eventId } });\n}\n\nonMounted(async () => {\n    // Fetch blog entry if editing\n    if (isEditMode.value) {\n        loading.value = true;\n        try {\n            const response = await api.adminBlogRetrieve({ path: { id: parseInt(props.id!, 10) } });\n            const item = response.data!;\n            entryTitle.value = item.title;\n            setValues({\n                title: item.title,\n                text: item.text,\n                public: item.public ?? false,\n            });\n        } catch (e) {\n            toast.error(t(\"BlogEntryEditView.loadFailure\"));\n            console.error(e);\n            goBack();\n        } finally {\n            loading.value = false;\n        }\n    }\n});\n</script>\n"],"names":["API_FIELD_MAPPING","props","__props","t","useI18n","router","useRouter","toast","useToast","getEventById","useEvents","loading","ref","saving","entryTitle","eventId","computed","parseInt","isEditMode","breadcrumbs","items","switchLabel","isPublic","validationSchema","yupObject","yupString","yupBoolean","handleSubmit","setValues","setErrors","meta","useForm","title","useField","text","submit","values","ok","editItem","createItem","goBack","buildBody","api.adminBlogCreate","e","handleApiError","itemId","api.adminBlogPartialUpdate","onMounted","item","api.adminBlogRetrieve","_createBlock","LayoutBase","_component_v_col","_createVNode","_component_v_progress_circular","_component_v_card","_component_v_card_text","_component_v_form","_unref","_component_v_text_field","$event","_createElementVNode","_hoisted_1","_toDisplayString","_component_VuetifyTiptap","_openBlock","_createElementBlock","_hoisted_2","_component_v_switch","_normalizeClass","_component_v_card_actions","_component_v_btn","FontAwesomeIcon","faSave","_createTextVNode"],"mappings":"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"}