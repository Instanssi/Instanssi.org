import{d as K,a as O,u as Q,v as W,a6 as X,a7 as Y,o as Z,a8 as ee,a9 as te,b as d,g as p,w as o,e as s,A as ae,p as le,B as se,l as oe,j as e,m as ie,f as re,t as v,c as ne,D,aa as ue,C as de,E as ce,V as F,i as S,k as me,G as pe,s as _,I as b,H as ve}from"./index-DXU74lGt.js";import{c as be,d as fe,a as M,u as ge,b as I}from"./index.esm-DWTrtXO7.js";import{_ as Ve}from"./AuditLogButton.vue_vue_type_script_setup_true_lang-5kFykphF.js";import{V as T,_ as ye}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D4jd1chv.js";import{h as A}from"./http-BTZWMaMN.js";import{p as f}from"./parseInt-Bzw_2rWL.js";import{V as xe}from"./VForm-C430u1Uz.js";import{V as Be}from"./VSwitch-DB1fJMny.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-WkXOSlqa.js";import"./useAuditLogUtils-BqNOieoY.js";import"./DateTimeCell.vue_vue_type_script_setup_true_lang-BMnBYvTq.js";import"./datetime-Dz9fjSvq.js";import"./VDataTableServer-CMLVDy59.js";import"./VDataTable-Jd7io3gq.js";import"./VContainer-BfWqa_tJ.js";const _e={class:"text-subtitle-2 mb-1"},Ie={key:0,class:"text-error text-caption"},Ge=K({__name:"BlogEntryEditView",props:{eventId:{},id:{}},setup(k){const w={title:"title",text:"text",public:"public"},i=k,{t:l}=O(),N=Q(),r=W(),{getEventById:$}=ve(),g=_(!1),V=_(!1),C=_(""),j=b(()=>f(i.eventId,10)),c=b(()=>i.id!==void 0),G=b(()=>{const a=[{title:$(j.value)?.name??"...",to:{name:"dashboard",params:{eventId:i.eventId}}},{title:l("BlogEditorView.title"),to:{name:"blog",params:{eventId:i.eventId}}}];return c.value?a.push({title:C.value||"...",disabled:!0}):a.push({title:l("Breadcrumbs.newPost"),disabled:!0}),a}),U=b(()=>n.value.value?l("BlogPostDialog.labels.postIsVisible"):l("BlogPostDialog.labels.postNotVisible")),q=be({title:M().required().min(1).max(128),text:M().required().min(1),public:fe()}),{handleSubmit:z,setValues:L,setErrors:P,meta:R}=ge({validationSchema:q,initialValues:{title:"",text:"",public:!1}}),y=I("title"),m=I("text"),n=I("public"),h=z(async a=>{V.value=!0;let t;c.value?t=await J(f(i.id,10),a):t=await H(a),V.value=!1,t&&x()});function E(a){return{title:a.title,text:a.text,public:a.public}}async function H(a){try{return await X({body:{event:f(i.eventId,10),...E(a)}}),r.success(l("BlogPostDialog.createSuccess")),!0}catch(t){A(t,P,r,l("BlogPostDialog.createFailure"),w)}return!1}async function J(a,t){try{return await Y({path:{id:a},body:E(t)}),r.success(l("BlogPostDialog.editSuccess")),!0}catch(B){A(B,P,r,l("BlogPostDialog.editFailure"),w)}return!1}function x(){N.push({name:"blog",params:{eventId:i.eventId}})}return Z(async()=>{if(c.value){g.value=!0;try{const t=(await ee({path:{id:f(i.id,10)}})).data;C.value=t.title,L({title:t.title,text:t.text,public:t.public??!1})}catch(a){r.error(l("BlogEntryEditView.loadFailure")),console.error(a),x()}finally{g.value=!1}}}),(a,t)=>{const B=te("VuetifyTiptap");return d(),p(ye,{breadcrumbs:G.value},{default:o(()=>[g.value?(d(),p(T,{key:0,class:"d-flex justify-center my-8"},{default:o(()=>[s(ae,{indeterminate:"",size:"64"})]),_:1})):(d(),p(T,{key:1},{default:o(()=>[s(le,null,{default:o(()=>[s(se,null,{default:o(()=>[s(xe,{onSubmit:oe(e(h),["prevent"])},{default:o(()=>[s(ie,{modelValue:e(y).value.value,"onUpdate:modelValue":t[0]||(t[0]=u=>e(y).value.value=u),"error-messages":e(y).errorMessage.value,variant:"outlined",label:e(l)("BlogPostDialog.labels.title")+" *"},null,8,["modelValue","error-messages","label"]),re("div",_e,v(e(l)("BlogPostDialog.labels.text"))+" * ",1),s(B,{modelValue:e(m).value.value,"onUpdate:modelValue":t[1]||(t[1]=u=>e(m).value.value=u)},null,8,["modelValue"]),e(m).errorMessage.value?(d(),ne("div",Ie,v(e(m).errorMessage.value),1)):D("",!0),s(Be,{modelValue:e(n).value.value,"onUpdate:modelValue":t[2]||(t[2]=u=>e(n).value.value=u),"error-messages":e(n).errorMessage.value,label:U.value,class:ue({"text-green-darken-3":e(n).value.value})},null,8,["modelValue","error-messages","label","class"])]),_:1},8,["onSubmit"])]),_:1}),s(de,null,{default:o(()=>[c.value?(d(),p(Ve,{key:0,"app-label":"ext_blog",model:"blogentry","object-pk":k.id},null,8,["object-pk"])):D("",!0),s(ce),s(F,{variant:"text",onClick:x},{default:o(()=>[S(v(e(l)("General.cancel")),1)]),_:1}),s(F,{variant:"elevated",color:"primary",loading:V.value,disabled:!e(R).valid,onClick:e(h)},{prepend:o(()=>[s(e(me),{icon:e(pe)},null,8,["icon"])]),default:o(()=>[S(" "+v(e(l)("General.save")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1}))]),_:1},8,["breadcrumbs"])}}});export{Ge as default};
//# sourceMappingURL=BlogEntryEditView-C_Wqx3rw.js.map
