import{d as R,a as U,u as G,J as j,K as Y,v as q,L as K,b as h,g as w,w as r,e as i,j as e,P as f,V as M,i as z,t as H,k as J,M as Q,D as W,m as X,q as Z,I as _,s as d,ac as ee,ad as te,H as ae}from"./index-CQkWvXOv.js";import{_ as oe}from"./BooleanIcon.vue_vue_type_script_setup_true_lang-BUZkEwsX.js";import{_ as se}from"./DateTimeCell.vue_vue_type_script_setup_true_lang-DaLynL44.js";import{V as E,_ as le}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D5aCeQDf.js";import{_ as re}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-DepTf6Bi.js";import{u as ie,d as ne}from"./useTableState-CutuDm2i.js";import{g as de}from"./query_tools-BInV9OzK.js";import{g as ue}from"./http-CET7UDul.js";import{V as P}from"./VRow-CXIXhuhq.js";import{V as ce}from"./VDataTableServer-C6tuZDKn.js";import{p as I}from"./parseInt-BJ5A4_3y.js";import"./datetime-Dz9fjSvq.js";import"./VContainer-DqJ8gu3P.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-1MnYozFL.js";import"./useAuditLogUtils-BdjF9k7b.js";import"./VDataTable-f5_9vewM.js";const xe=R({__name:"BlogView",props:{eventId:{}},setup(k){const u=k,{t}=U(),v=G(),x=j(Y),c=q(),m=Z(),{getEventById:D}=ae(),n=_(()=>I(u.eventId,10)),p=d(!1),T=_(()=>[{title:D(n.value)?.name??"...",to:{name:"dashboard",params:{eventId:u.eventId}}},{title:t("BlogEditorView.title"),disabled:!0}]),o=ie(),b=d(0),y=d([]),g=d(null),L=[{title:t("BlogEditorView.headers.id"),sortable:!0,key:"id"},{title:t("BlogEditorView.headers.title"),sortable:!1,key:"title"},{title:t("BlogEditorView.headers.createdAt"),sortable:!0,key:"date"},{title:t("BlogEditorView.headers.createdBy"),sortable:!1,key:"created_by"},{title:t("BlogEditorView.headers.isPublic"),sortable:!0,key:"public"},{title:t("BlogEditorView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function A(){g.value&&B(g.value)}async function B(s){p.value=!0,g.value=s;try{const l=await te({query:{event:I(u.eventId,10),...de(s)}});y.value=l.data.results,b.value=l.data.count}catch(l){c.error(t("BlogEditorView.loadFailure")),console.error(l)}finally{p.value=!1}}const V=ne(B,250);function C(s){o.onOptionsUpdate(s),V(s)}function $(){o.search.value="",o.page.value=1,V({page:1,itemsPerPage:o.perPage.value??25,sortBy:[],groupBy:[],search:""})}K(n,$);async function N(s){const l=t("BlogEditorView.confirmDelete",s);await x.value.ifConfirmed(l,async()=>{try{await ee({path:{id:s.id}}),c.success(t("BlogEditorView.deleteSuccess")),A()}catch(a){c.error(ue(a,t("BlogEditorView.deleteFailure"))),console.error(a)}})}function O(s){v.push({name:"blog-edit",params:{eventId:n.value,id:s}})}function S(){v.push({name:"blog-new",params:{eventId:n.value}})}return(s,l)=>(h(),w(le,{key:`blog-${n.value}`,breadcrumbs:T.value},{default:r(()=>[i(E,null,{default:r(()=>[i(P,null,{default:r(()=>[e(m).canAdd(e(f).BLOG_ENTRY)?(h(),w(M,{key:0,color:"primary",onClick:S},{prepend:r(()=>[i(e(J),{icon:e(Q)},null,8,["icon"])]),default:r(()=>[z(" "+H(e(t)("BlogEditorView.newBlogPost")),1)]),_:1})):W("",!0),i(X,{modelValue:e(o).search.value,"onUpdate:modelValue":l[0]||(l[0]=a=>e(o).search.value=a),variant:"outlined",density:"compact",label:e(t)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),i(E,null,{default:r(()=>[i(P,null,{default:r(()=>[i(ce,{"items-per-page":e(o).perPage.value,"onUpdate:itemsPerPage":l[1]||(l[1]=a=>e(o).perPage.value=a),"sort-by":e(o).sortByArray.value,class:"elevation-1 primary","item-value":"id",density:"compact",headers:L,items:y.value,"items-length":b.value,loading:p.value,search:e(o).search.value,page:e(o).page.value,"items-per-page-options":e(o).pageSizeOptions,"no-data-text":e(t)("BlogEditorView.noBlogPostsFound"),"loading-text":e(t)("BlogEditorView.loadingBlogPosts"),"onUpdate:options":C},{"item.public":r(({item:a})=>[i(oe,{value:a.public},null,8,["value"])]),"item.date":r(({item:a})=>[i(se,{value:a.date},null,8,["value"])]),"item.actions":r(({item:a})=>[i(re,{"can-edit":e(m).canChange(e(f).BLOG_ENTRY),"can-delete":e(m).canDelete(e(f).BLOG_ENTRY),"audit-log":{appLabel:"ext_blog",model:"blogentry",objectPk:a.id},onEdit:F=>O(a.id),onDelete:F=>N(a)},null,8,["can-edit","can-delete","audit-log","onEdit","onDelete"])]),_:1},8,["items-per-page","sort-by","items","items-length","loading","search","page","items-per-page-options","no-data-text","loading-text"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{xe as default};
//# sourceMappingURL=BlogView-B2jPtzCF.js.map
