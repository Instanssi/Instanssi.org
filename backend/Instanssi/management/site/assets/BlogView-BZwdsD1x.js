import{d as z,a as K,p as M,Q as J,R as Z,S as ee,b as c,g as p,w as o,e as r,k as Q,j as e,n as u,v as W,x as te,y as ae,c as le,P as $,V as U,h as I,t as A,z as P,A as oe,B as L,C as G,D as se,E as ie,F as ne,m as re,T as ue,U as de,W as ce}from"./index-Bw0yMgdj.js";import{c as me,d as ge,a as q,u as pe,b as N}from"./index.esm-T7wGarnX.js";import{_ as ve,d as fe,V as be,g as ye}from"./query_tools-CXLLEqHw.js";import{s as X}from"./sleep-mAKpSMLY.js";import{V as Ve}from"./VSwitch-LnAsj0K6.js";import{V as O,_ as Be}from"./LayoutBase.vue_vue_type_script_setup_true_lang-CTqqdACI.js";import{a as Y}from"./VRow-urfWNQ1b.js";import{p as j}from"./parseInt-Bwet6NUD.js";const we=z({__name:"BlogPostDialog",setup(R,{expose:_}){const a=u(),{t:d}=K(),m=M(),V=u(!1),g=u(void 0),f=u(0),B=W(()=>v.value.value?d("BlogPostDialog.labels.postIsVisible"):d("BlogPostDialog.labels.postNotVisible")),w=me({title:q().required().min(1).max(128),text:q().required().min(1),isPublic:ge()}),{handleSubmit:h,setTouched:E,resetForm:D,setValues:C}=pe({validationSchema:w}),b=N("title"),y=N("text"),v=N("isPublic"),S=h(async i=>{let t;V.value=!0,g.value!==void 0?t=await T(g.value,i):t=await k(i),await X(250),V.value=!1,t&&a.value?.setResult(!0)});async function k(i){try{return await J({body:{event:f.value,title:i.title,text:i.text,public:i.isPublic}}),m.success(d("BlogPostDialog.createSuccess")),!0}catch(t){m.error(d("BlogPostDialog.createFailure")),console.error(t)}return!1}async function T(i,t){try{return await Z({path:{id:i},body:{title:t.title,text:t.text,public:t.isPublic}}),m.success(d("BlogPostDialog.editSuccess")),!0}catch(x){m.error(d("BlogPostDialog.editFailure")),console.error(x)}return!1}async function F(i,t=void 0){return f.value=i,t!==void 0?(g.value=t.id,C({title:t.title,isPublic:t.public??!1,text:t.text})):(g.value=void 0,D(),E(!1)),await a.value?.modal()??!1}return _({modal:F}),(i,t)=>{const x=ee("VuetifyTiptap");return c(),p(ve,{ref_key:"dialog",ref:a,title:e(d)("BlogPostDialog.title"),"ok-text":e(d)("General.save"),"ok-icon":"fas fa-floppy-disk",width:1e3,loading:V.value,onSubmit:e(S)},{default:o(()=>[r(Q,{modelValue:e(b).value.value,"onUpdate:modelValue":t[0]||(t[0]=s=>e(b).value.value=s),"error-messages":e(b).errorMessage.value,variant:"outlined",label:e(d)("BlogPostDialog.labels.title")},null,8,["modelValue","error-messages","label"]),r(x,{modelValue:e(y).value.value,"onUpdate:modelValue":t[1]||(t[1]=s=>e(y).value.value=s)},null,8,["modelValue"]),r(Ve,{modelValue:e(v).value.value,"onUpdate:modelValue":t[2]||(t[2]=s=>e(v).value.value=s),"error-messages":e(v).errorMessage.value,label:B.value},null,8,["modelValue","error-messages","label"])]),_:1},8,["title","ok-text","loading","onSubmit"])}}}),Ie=z({__name:"BlogView",props:{eventId:{}},setup(R){const _=R,{t:a,d}=K(),m=u(void 0),V=te(ae),g=M(),f=re(),B=W(()=>j(_.eventId,10)),w=u(!1),h=[25,50,100],E=u(h[0]),D=u(0),C=u(1),b=u([]),y=u(""),v=u(0),S=[{title:a("BlogEditorView.headers.id"),sortable:!0,key:"id"},{title:a("BlogEditorView.headers.title"),sortable:!1,key:"title"},{title:a("BlogEditorView.headers.createdAt"),sortable:!0,key:"date"},{title:a("BlogEditorView.headers.createdBy"),sortable:!0,key:"created_by"},{title:a("BlogEditorView.headers.isPublic"),sortable:!1,key:"public"},{title:a("BlogEditorView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function k(){v.value+=1}async function T(s){w.value=!0;try{const l=await ce({query:{event:j(_.eventId,10),...ye(s)}});b.value=l.data.results,D.value=l.data.count}catch(l){g.error(a("BlogEditorView.loadFailure")),console.error(l)}finally{w.value=!1}}const F=fe(T,250);async function i(s){const l=a("BlogEditorView.confirmDelete",s);await V.value.ifConfirmed(l,async()=>{try{await X(250),await ue({path:{id:s.id}}),g.success(a("BlogEditorView.deleteSuccess")),k()}catch(n){g.error(a("BlogEditorView.deleteFailure")),console.error(n)}})}async function t(s){const l=await de({path:{id:s}});await m.value.modal(B.value,l.data)&&k()}async function x(){await m.value.modal(B.value)&&(C.value=1,k())}return(s,l)=>(c(),le(ne,null,[(c(),p(Be,{key:`blog-${B.value}`,title:e(a)("BlogEditorView.title")},{default:o(()=>[r(O,null,{default:o(()=>[r(Y,null,{default:o(()=>[e(f).canAdd(e($).BLOG_ENTRY)?(c(),p(U,{key:0,onClick:x},{prepend:o(()=>[r(e(P),{icon:e(oe)},null,8,["icon"])]),default:o(()=>[I(" "+A(e(a)("BlogEditorView.newBlogPost")),1)]),_:1})):L("",!0),r(Q,{modelValue:y.value,"onUpdate:modelValue":l[0]||(l[0]=n=>y.value=n),variant:"outlined",density:"compact",label:e(a)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),r(O,null,{default:o(()=>[r(Y,null,{default:o(()=>[(c(),p(be,{key:`blog-table-${v.value}`,"items-per-page":E.value,"onUpdate:itemsPerPage":l[1]||(l[1]=n=>E.value=n),class:"elevation-1 primary","item-value":"id",density:"compact",headers:S,items:b.value,"items-length":D.value,loading:w.value,search:y.value,page:C.value,"items-per-page-options":h,"no-data-text":e(a)("BlogEditorView.noBlogPostsFound"),"loading-text":e(a)("BlogEditorView.loadingBlogPosts"),"onUpdate:options":e(F)},{"item.public":o(({item:n})=>[n.public?(c(),p(e(P),{key:0,icon:e(ie),class:"text-green"},null,8,["icon"])):(c(),p(e(P),{key:1,icon:e(G),class:"text-red"},null,8,["icon"]))]),"item.date":o(({item:n})=>[I(A(e(d)(n.date,"long")),1)]),"item.actions":o(({item:n})=>[e(f).canDelete(e($).BLOG_ENTRY)?(c(),p(U,{key:0,density:"compact",variant:"text",color:"red",onClick:H=>i(n)},{prepend:o(()=>[r(e(P),{icon:e(G)},null,8,["icon"])]),default:o(()=>[l[2]||(l[2]=I(" Delete ",-1))]),_:1},8,["onClick"])):L("",!0),e(f).canChange(e($).BLOG_ENTRY)?(c(),p(U,{key:1,density:"compact",variant:"text",onClick:H=>t(n.id)},{prepend:o(()=>[r(e(P),{icon:e(se)},null,8,["icon"])]),default:o(()=>[l[3]||(l[3]=I(" Edit ",-1))]),_:1},8,["onClick"])):L("",!0)]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"]))]),_:1})]),_:1})]),_:1},8,["title"])),r(we,{ref_key:"dialog",ref:m},null,512)],64))}});export{Ie as default};
//# sourceMappingURL=BlogView-BZwdsD1x.js.map
