import{d as U,a as Y,u as j,H as q,I as K,v as z,Z as H,b as _,g as E,w as s,e as l,j as a,P as f,V as J,i as M,t as Z,k as Q,J as W,K as X,m as ee,q as te,G as P,s as i,$ as ae,a0 as oe,E as se}from"./index-qrfwdmHz.js";import{_ as le}from"./BooleanIcon.vue_vue_type_script_setup_true_lang-BztPFn-1.js";import{_ as ne}from"./DateTimeCell.vue_vue_type_script_setup_true_lang-DEE2ektI.js";import{V as I,_ as ie}from"./LayoutBase.vue_vue_type_script_setup_true_lang-Cgp8Musd.js";import{_ as re}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-B6FHDr2a.js";import{d as de,V as ue,g as ce}from"./query_tools-Ch1hnqwl.js";import{g as me}from"./http-Cqy_sGiB.js";import{V as k}from"./VRow-EkiCBxID.js";import{p as x}from"./parseInt-CGa1F4cm.js";import"./datetime-DsxOZgAd.js";import"./classApi-bnmGQydb.js";import"./VContainer-e74dHNZG.js";import"./VDataTable-BIkGv4dg.js";import"./filter-50Rnsb7m.js";const ke=U({__name:"BlogView",props:{eventId:{}},setup(D){const u=D,{t:e}=Y(),b=j(),T=q(K),c=z(),m=te(),{getEventById:$}=se(),r=P(()=>x(u.eventId,10)),p=i(!1),A=P(()=>[{title:$(r.value)?.name??"...",to:{name:"dashboard",params:{eventId:u.eventId}}},{title:e("BlogEditorView.title"),disabled:!0}]),B=[25,50,100],g=i(B[0]),V=i(0),C=i(1),y=i([]),d=i(""),v=i(null),L=[{title:e("BlogEditorView.headers.id"),sortable:!0,key:"id"},{title:e("BlogEditorView.headers.title"),sortable:!1,key:"title"},{title:e("BlogEditorView.headers.createdAt"),sortable:!0,key:"date"},{title:e("BlogEditorView.headers.createdBy"),sortable:!0,key:"created_by"},{title:e("BlogEditorView.headers.isPublic"),sortable:!1,key:"public"},{title:e("BlogEditorView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function N(){v.value&&w(v.value)}async function w(n){p.value=!0,v.value=n;try{const o=await oe({query:{event:x(u.eventId,10),...ce(n)}});y.value=o.data.results,V.value=o.data.count}catch(o){c.error(e("BlogEditorView.loadFailure")),console.error(o)}finally{p.value=!1}}const h=de(w,250);function F(){d.value="",h({page:1,itemsPerPage:g.value??25,sortBy:[],groupBy:[],search:""})}H(r,F);async function G(n){const o=e("BlogEditorView.confirmDelete",n);await T.value.ifConfirmed(o,async()=>{try{await ae({path:{id:n.id}}),c.success(e("BlogEditorView.deleteSuccess")),N()}catch(t){c.error(me(t,e("BlogEditorView.deleteFailure"))),console.error(t)}})}function R(n){b.push({name:"blog-edit",params:{eventId:r.value,id:n}})}function O(){b.push({name:"blog-new",params:{eventId:r.value}})}return(n,o)=>(_(),E(ie,{key:`blog-${r.value}`,breadcrumbs:A.value},{default:s(()=>[l(I,null,{default:s(()=>[l(k,null,{default:s(()=>[a(m).canAdd(a(f).BLOG_ENTRY)?(_(),E(J,{key:0,onClick:O},{prepend:s(()=>[l(a(Q),{icon:a(W)},null,8,["icon"])]),default:s(()=>[M(" "+Z(a(e)("BlogEditorView.newBlogPost")),1)]),_:1})):X("",!0),l(ee,{modelValue:d.value,"onUpdate:modelValue":o[0]||(o[0]=t=>d.value=t),variant:"outlined",density:"compact",label:a(e)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),l(I,null,{default:s(()=>[l(k,null,{default:s(()=>[l(ue,{"items-per-page":g.value,"onUpdate:itemsPerPage":o[1]||(o[1]=t=>g.value=t),class:"elevation-1 primary","item-value":"id",density:"compact",headers:L,items:y.value,"items-length":V.value,loading:p.value,search:d.value,page:C.value,"items-per-page-options":B,"no-data-text":a(e)("BlogEditorView.noBlogPostsFound"),"loading-text":a(e)("BlogEditorView.loadingBlogPosts"),"onUpdate:options":a(h)},{"item.public":s(({item:t})=>[l(le,{value:t.public},null,8,["value"])]),"item.date":s(({item:t})=>[l(ne,{value:t.date},null,8,["value"])]),"item.actions":s(({item:t})=>[l(re,{"can-edit":a(m).canChange(a(f).BLOG_ENTRY),"can-delete":a(m).canDelete(a(f).BLOG_ENTRY),onEdit:S=>R(t.id),onDelete:S=>G(t)},null,8,["can-edit","can-delete","onEdit","onDelete"])]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{ke as default};
//# sourceMappingURL=BlogView-C45Uj0Yg.js.map
