import{d as S,a as j,u as Y,J as q,K,v as z,U as H,b as h,g as E,w as s,e as l,j as a,P as v,V as J,i as M,t as Q,k as W,L as X,D as Z,m as ee,q as te,I as P,s as r,ab as ae,ac as oe,H as se}from"./index-DXU74lGt.js";import{_ as le}from"./BooleanIcon.vue_vue_type_script_setup_true_lang-CqjGGkAi.js";import{_ as ie}from"./DateTimeCell.vue_vue_type_script_setup_true_lang-BMnBYvTq.js";import{V as I,_ as re}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D4jd1chv.js";import{_ as ne}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-CUVfxWfg.js";import{g as de}from"./query_tools-BInV9OzK.js";import{g as ue}from"./http-BTZWMaMN.js";import{d as ce}from"./debounce-CQ84CrOG.js";import{V as k}from"./VRow-B94Tto0H.js";import{V as me}from"./VDataTableServer-CMLVDy59.js";import{p as x}from"./parseInt-Bzw_2rWL.js";import"./datetime-Dz9fjSvq.js";import"./VContainer-BfWqa_tJ.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-WkXOSlqa.js";import"./useAuditLogUtils-BqNOieoY.js";import"./VDataTable-Jd7io3gq.js";const De=S({__name:"BlogView",props:{eventId:{}},setup(D){const u=D,{t:e}=j(),b=Y(),L=q(K),c=z(),m=te(),{getEventById:T}=se(),n=P(()=>x(u.eventId,10)),p=r(!1),A=P(()=>[{title:T(n.value)?.name??"...",to:{name:"dashboard",params:{eventId:u.eventId}}},{title:e("BlogEditorView.title"),disabled:!0}]),B=[25,50,100],g=r(B[0]),V=r(0),C=r(1),y=r([]),d=r(""),f=r(null),$=[{title:e("BlogEditorView.headers.id"),sortable:!0,key:"id"},{title:e("BlogEditorView.headers.title"),sortable:!1,key:"title"},{title:e("BlogEditorView.headers.createdAt"),sortable:!0,key:"date"},{title:e("BlogEditorView.headers.createdBy"),sortable:!0,key:"created_by"},{title:e("BlogEditorView.headers.isPublic"),sortable:!1,key:"public"},{title:e("BlogEditorView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function N(){f.value&&w(f.value)}async function w(i){p.value=!0,f.value=i;try{const o=await oe({query:{event:x(u.eventId,10),...de(i)}});y.value=o.data.results,V.value=o.data.count}catch(o){c.error(e("BlogEditorView.loadFailure")),console.error(o)}finally{p.value=!1}}const _=ce(w,250);function F(){d.value="",_({page:1,itemsPerPage:g.value??25,sortBy:[],groupBy:[],search:""})}H(n,F);async function R(i){const o=e("BlogEditorView.confirmDelete",i);await L.value.ifConfirmed(o,async()=>{try{await ae({path:{id:i.id}}),c.success(e("BlogEditorView.deleteSuccess")),N()}catch(t){c.error(ue(t,e("BlogEditorView.deleteFailure"))),console.error(t)}})}function U(i){b.push({name:"blog-edit",params:{eventId:n.value,id:i}})}function G(){b.push({name:"blog-new",params:{eventId:n.value}})}return(i,o)=>(h(),E(re,{key:`blog-${n.value}`,breadcrumbs:A.value},{default:s(()=>[l(I,null,{default:s(()=>[l(k,null,{default:s(()=>[a(m).canAdd(a(v).BLOG_ENTRY)?(h(),E(J,{key:0,color:"primary",onClick:G},{prepend:s(()=>[l(a(W),{icon:a(X)},null,8,["icon"])]),default:s(()=>[M(" "+Q(a(e)("BlogEditorView.newBlogPost")),1)]),_:1})):Z("",!0),l(ee,{modelValue:d.value,"onUpdate:modelValue":o[0]||(o[0]=t=>d.value=t),variant:"outlined",density:"compact",label:a(e)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),l(I,null,{default:s(()=>[l(k,null,{default:s(()=>[l(me,{"items-per-page":g.value,"onUpdate:itemsPerPage":o[1]||(o[1]=t=>g.value=t),class:"elevation-1 primary","item-value":"id",density:"compact",headers:$,items:y.value,"items-length":V.value,loading:p.value,search:d.value,page:C.value,"items-per-page-options":B,"no-data-text":a(e)("BlogEditorView.noBlogPostsFound"),"loading-text":a(e)("BlogEditorView.loadingBlogPosts"),"onUpdate:options":a(_)},{"item.public":s(({item:t})=>[l(le,{value:t.public},null,8,["value"])]),"item.date":s(({item:t})=>[l(ie,{value:t.date},null,8,["value"])]),"item.actions":s(({item:t})=>[l(ne,{"can-edit":a(m).canChange(a(v).BLOG_ENTRY),"can-delete":a(m).canDelete(a(v).BLOG_ENTRY),"audit-log":{appLabel:"ext_blog",model:"blogentry",objectPk:t.id},onEdit:O=>U(t.id),onDelete:O=>R(t)},null,8,["can-edit","can-delete","audit-log","onEdit","onDelete"])]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{De as default};
//# sourceMappingURL=BlogView-C6DEChP9.js.map
