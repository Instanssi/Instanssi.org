import{d as S,a as U,u as Y,H as j,I as q,v as K,b as _,g as E,w as s,e as l,j as a,P as v,V as z,i as H,t as J,k as M,J as Z,K as Q,m as W,q as X,G as h,s as i,Z as ee,$ as te,E as ae}from"./index-BSHMv_df.js";import{_ as oe}from"./BooleanIcon.vue_vue_type_script_setup_true_lang-COcceYO8.js";import{_ as se}from"./DateTimeCell.vue_vue_type_script_setup_true_lang-CG8AjqQo.js";import{V as P,_ as le}from"./LayoutBase.vue_vue_type_script_setup_true_lang-C8aKWyeJ.js";import{_ as ne}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-DouyropJ.js";import{d as ie,V as re,g as de}from"./query_tools-Co6bP9h2.js";import{g as ue}from"./http-BZkoYM_m.js";import{V as I}from"./VRow-BUBfmFS3.js";import{p as k}from"./parseInt-3OpbdfxQ.js";import"./datetime-DsxOZgAd.js";import"./classApi-bnmGQydb.js";import"./VContainer--EpXOfw5.js";import"./VDataTable-CpUosGjF.js";import"./filter-C6Uu0LOB.js";const Pe=S({__name:"BlogView",props:{eventId:{}},setup(x){const d=x,{t:e}=U(),f=Y(),D=j(q),u=K(),c=X(),{getEventById:T}=ae(),r=h(()=>k(d.eventId,10)),m=i(!1),$=h(()=>[{title:T(r.value)?.name??"...",to:{name:"dashboard",params:{eventId:d.eventId}}},{title:e("BlogEditorView.title"),disabled:!0}]),b=[25,50,100],V=i(b[0]),B=i(0),A=i(1),w=i([]),p=i(""),g=i(null),C=[{title:e("BlogEditorView.headers.id"),sortable:!0,key:"id"},{title:e("BlogEditorView.headers.title"),sortable:!1,key:"title"},{title:e("BlogEditorView.headers.createdAt"),sortable:!0,key:"date"},{title:e("BlogEditorView.headers.createdBy"),sortable:!0,key:"created_by"},{title:e("BlogEditorView.headers.isPublic"),sortable:!1,key:"public"},{title:e("BlogEditorView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function L(){g.value&&y(g.value)}async function y(n){m.value=!0,g.value=n;try{const o=await te({query:{event:k(d.eventId,10),...de(n)}});w.value=o.data.results,B.value=o.data.count}catch(o){u.error(e("BlogEditorView.loadFailure")),console.error(o)}finally{m.value=!1}}const N=ie(y,250);async function F(n){const o=e("BlogEditorView.confirmDelete",n);await D.value.ifConfirmed(o,async()=>{try{await ee({path:{id:n.id}}),u.success(e("BlogEditorView.deleteSuccess")),L()}catch(t){u.error(ue(t,e("BlogEditorView.deleteFailure"))),console.error(t)}})}function G(n){f.push({name:"blog-edit",params:{eventId:r.value,id:n}})}function R(){f.push({name:"blog-new",params:{eventId:r.value}})}return(n,o)=>(_(),E(le,{key:`blog-${r.value}`,breadcrumbs:$.value},{default:s(()=>[l(P,null,{default:s(()=>[l(I,null,{default:s(()=>[a(c).canAdd(a(v).BLOG_ENTRY)?(_(),E(z,{key:0,onClick:R},{prepend:s(()=>[l(a(M),{icon:a(Z)},null,8,["icon"])]),default:s(()=>[H(" "+J(a(e)("BlogEditorView.newBlogPost")),1)]),_:1})):Q("",!0),l(W,{modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=t=>p.value=t),variant:"outlined",density:"compact",label:a(e)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),l(P,null,{default:s(()=>[l(I,null,{default:s(()=>[l(re,{"items-per-page":V.value,"onUpdate:itemsPerPage":o[1]||(o[1]=t=>V.value=t),class:"elevation-1 primary","item-value":"id",density:"compact",headers:C,items:w.value,"items-length":B.value,loading:m.value,search:p.value,page:A.value,"items-per-page-options":b,"no-data-text":a(e)("BlogEditorView.noBlogPostsFound"),"loading-text":a(e)("BlogEditorView.loadingBlogPosts"),"onUpdate:options":a(N)},{"item.public":s(({item:t})=>[l(oe,{value:t.public},null,8,["value"])]),"item.date":s(({item:t})=>[l(se,{value:t.date},null,8,["value"])]),"item.actions":s(({item:t})=>[l(ne,{"can-edit":a(c).canChange(a(v).BLOG_ENTRY),"can-delete":a(c).canDelete(a(v).BLOG_ENTRY),onEdit:O=>G(t.id),onDelete:O=>F(t)},null,8,["can-edit","can-delete","onEdit","onDelete"])]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Pe as default};
//# sourceMappingURL=BlogView-xYHTO6Ji.js.map
