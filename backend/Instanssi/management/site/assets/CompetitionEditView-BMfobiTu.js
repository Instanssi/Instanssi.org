import{d as de,a as me,u as ue,v as pe,aS as ce,aT as ve,o as fe,aU as Ve,aa as be,b as c,g as h,w as s,e as o,A as he,p as we,B as Ce,l as Ee,j as e,m as w,c as ge,t as m,D as z,i as v,N as _e,C as ye,E as Fe,V as J,k as Se,G as ke,s as x,I as C,H as Ie}from"./index-CQkWvXOv.js";import{c as Ae,d as U,g as Me,a as u,u as Oe,b as r}from"./index.esm-aFENq7CA.js";import{_ as Te}from"./AuditLogButton.vue_vue_type_script_setup_true_lang-DHg2h5we.js";import{F as B}from"./FormSection-Drw9hFWe.js";import{V as d,_ as Re}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D5aCeQDf.js";import{_ as H}from"./ToggleSwitch.vue_vue_type_script_setup_true_lang-C_s5Zpn8.js";import{t as $,a as D}from"./datetime-Dz9fjSvq.js";import{h as Q}from"./http-CET7UDul.js";import{p as N}from"./parseInt-BJ5A4_3y.js";import{V as xe}from"./VForm-VvaADaOh.js";import{V as W}from"./VRow-CXIXhuhq.js";import{V as Ue}from"./VCombobox-DcsTuhvs.js";import"./_commonjsHelpers-CqkleIqs.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-1MnYozFL.js";import"./useAuditLogUtils-BdjF9k7b.js";import"./DateTimeCell.vue_vue_type_script_setup_true_lang-DaLynL44.js";import"./VDataTableServer-C6tuZDKn.js";import"./VDataTable-f5_9vewM.js";import"./VContainer-DqJ8gu3P.js";import"./VSwitch-JF6EcneO.js";const Be={key:0,class:"text-error text-caption mb-4"},ot=de({__name:"CompetitionEditView",props:{eventId:{},id:{}},setup(X){const j={name:"name",description:"description",participation_end:"participationEnd",start:"start",end:"end",score_type:"scoreType",score_sort:"scoreSort",active:"active",show_results:"showResults",hide_from_archive:"hideFromArchive"},n=X,{t:a}=me(),Y=ue(),p=pe(),{getEventById:Z}=Ie(),E=x(!1),g=x(!1),P=x(""),f=C(()=>N(n.eventId,10)),V=C(()=>n.id!==void 0),ee=C(()=>{const i=[{title:Z(f.value)?.name??"...",to:{name:"dashboard",params:{eventId:n.eventId}}},{title:a("CompetitionsView.title"),to:{name:"competitions",params:{eventId:n.eventId}}}];return V.value?i.push({title:P.value||"...",disabled:!0}):i.push({title:a("Breadcrumbs.newCompetition"),disabled:!0}),i}),te=[{title:a("CompetitionEditView.scoreSortOptions.highestFirst"),value:0},{title:a("CompetitionEditView.scoreSortOptions.lowestFirst"),value:1}],ae=["pts","sec","min","m","km","kg","pcs"],oe=Ae({name:u().required().min(1).max(32),description:u(),participationEnd:u().required(),start:u().required(),end:u().nullable(),scoreType:u().required().max(8),scoreSort:Me(),active:U(),showResults:U(),hideFromArchive:U()}),{handleSubmit:ie,setValues:se,setErrors:q,meta:le}=Oe({validationSchema:oe,initialValues:{name:"",description:"",participationEnd:"",start:"",end:"",scoreType:"",scoreSort:0,active:!0,showResults:!1,hideFromArchive:!1}}),_=r("name"),b=r("description"),y=r("participationEnd"),F=r("start"),S=r("end"),k=r("scoreType"),I=r("scoreSort"),A=r("active"),M=r("showResults"),O=r("hideFromArchive"),G=C({get:()=>!O.value.value,set:i=>{O.value.value=!i}}),K=ie(async i=>{g.value=!0;let t;V.value?t=await ne(N(n.id,10),i):t=await re(i),g.value=!1,t&&T()});function L(i){return{name:i.name,description:i.description||"",participation_end:D(i.participationEnd),start:D(i.start),end:D(i.end),score_type:i.scoreType,score_sort:i.scoreSort,active:i.active,show_results:i.showResults,hide_from_archive:i.hideFromArchive}}async function re(i){try{return await ce({path:{event_pk:f.value},body:L(i)}),p.success(a("CompetitionEditView.createSuccess")),!0}catch(t){Q(t,q,p,a("CompetitionEditView.createFailure"),j)}return!1}async function ne(i,t){try{return await ve({path:{event_pk:f.value,id:i},body:L(t)}),p.success(a("CompetitionEditView.editSuccess")),!0}catch(R){Q(R,q,p,a("CompetitionEditView.editFailure"),j)}return!1}function T(){Y.push({name:"competitions",params:{eventId:n.eventId}})}return fe(async()=>{if(V.value){E.value=!0;try{const t=(await Ve({path:{event_pk:f.value,id:N(n.id,10)}})).data;P.value=t.name,se({name:t.name,description:t.description??"",participationEnd:$(t.participation_end),start:$(t.start),end:$(t.end),scoreType:t.score_type??"",scoreSort:t.score_sort??0,active:t.active??!0,showResults:t.show_results??!1,hideFromArchive:t.hide_from_archive??!1})}catch(i){p.error(a("CompetitionEditView.loadFailure")),console.error(i),T()}finally{E.value=!1}}}),(i,t)=>{const R=be("VuetifyTiptap");return c(),h(Re,{breadcrumbs:ee.value},{default:s(()=>[E.value?(c(),h(d,{key:0,class:"d-flex justify-center my-8"},{default:s(()=>[o(he,{indeterminate:"",size:"64"})]),_:1})):(c(),h(d,{key:1},{default:s(()=>[o(we,null,{default:s(()=>[o(Ce,null,{default:s(()=>[o(xe,{onSubmit:Ee(e(K),["prevent"])},{default:s(()=>[o(w,{modelValue:e(_).value.value,"onUpdate:modelValue":t[0]||(t[0]=l=>e(_).value.value=l),"error-messages":e(_).errorMessage.value,variant:"outlined",label:e(a)("CompetitionEditView.labels.name")+" *"},null,8,["modelValue","error-messages","label"]),o(R,{modelValue:e(b).value.value,"onUpdate:modelValue":t[1]||(t[1]=l=>e(b).value.value=l)},null,8,["modelValue"]),e(b).errorMessage.value?(c(),ge("div",Be,m(e(b).errorMessage.value),1)):z("",!0),o(B,null,{default:s(()=>[v(m(e(a)("CompetitionEditView.sections.schedule")),1)]),_:1}),o(W,null,{default:s(()=>[o(d,{cols:"12",md:"4"},{default:s(()=>[o(w,{modelValue:e(y).value.value,"onUpdate:modelValue":t[2]||(t[2]=l=>e(y).value.value=l),type:"datetime-local","error-messages":e(y).errorMessage.value,variant:"outlined",label:e(a)("CompetitionEditView.labels.participationEnd")+" *"},null,8,["modelValue","error-messages","label"])]),_:1}),o(d,{cols:"12",md:"4"},{default:s(()=>[o(w,{modelValue:e(F).value.value,"onUpdate:modelValue":t[3]||(t[3]=l=>e(F).value.value=l),type:"datetime-local","error-messages":e(F).errorMessage.value,variant:"outlined",label:e(a)("CompetitionEditView.labels.start")+" *"},null,8,["modelValue","error-messages","label"])]),_:1}),o(d,{cols:"12",md:"4"},{default:s(()=>[o(w,{modelValue:e(S).value.value,"onUpdate:modelValue":t[4]||(t[4]=l=>e(S).value.value=l),type:"datetime-local","error-messages":e(S).errorMessage.value,variant:"outlined",label:e(a)("CompetitionEditView.labels.end")},null,8,["modelValue","error-messages","label"])]),_:1})]),_:1}),o(B,null,{default:s(()=>[v(m(e(a)("CompetitionEditView.sections.scoring")),1)]),_:1}),o(W,null,{default:s(()=>[o(d,{cols:"12",md:"6"},{default:s(()=>[o(Ue,{modelValue:e(k).value.value,"onUpdate:modelValue":t[5]||(t[5]=l=>e(k).value.value=l),items:ae,"error-messages":e(k).errorMessage.value,variant:"outlined",label:e(a)("CompetitionEditView.labels.scoreType")+" *"},null,8,["modelValue","error-messages","label"])]),_:1}),o(d,{cols:"12",md:"6"},{default:s(()=>[o(_e,{modelValue:e(I).value.value,"onUpdate:modelValue":t[6]||(t[6]=l=>e(I).value.value=l),modelModifiers:{number:!0},items:te,"error-messages":e(I).errorMessage.value,variant:"outlined",label:e(a)("CompetitionEditView.labels.scoreSort")},null,8,["modelValue","error-messages","label"])]),_:1})]),_:1}),o(B,null,{default:s(()=>[v(m(e(a)("CompetitionEditView.sections.settings")),1)]),_:1}),o(H,{modelValue:e(A).value.value,"onUpdate:modelValue":t[7]||(t[7]=l=>e(A).value.value=l),"error-message":e(A).errorMessage.value,"label-on":e(a)("CompetitionEditView.labels.activeOn"),"label-off":e(a)("CompetitionEditView.labels.activeOff"),"hint-on":e(a)("CompetitionEditView.labels.activeHintOn"),"hint-off":e(a)("CompetitionEditView.labels.activeHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"]),o(H,{modelValue:e(M).value.value,"onUpdate:modelValue":t[8]||(t[8]=l=>e(M).value.value=l),"error-message":e(M).errorMessage.value,"label-on":e(a)("CompetitionEditView.labels.showResultsOn"),"label-off":e(a)("CompetitionEditView.labels.showResultsOff"),"hint-on":e(a)("CompetitionEditView.labels.showResultsHintOn"),"hint-off":e(a)("CompetitionEditView.labels.showResultsHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"]),o(H,{modelValue:G.value,"onUpdate:modelValue":t[9]||(t[9]=l=>G.value=l),"error-message":e(O).errorMessage.value,"label-on":e(a)("CompetitionEditView.labels.hideFromArchiveOff"),"label-off":e(a)("CompetitionEditView.labels.hideFromArchiveOn"),"hint-on":e(a)("CompetitionEditView.labels.hideFromArchiveHintOn"),"hint-off":e(a)("CompetitionEditView.labels.hideFromArchiveHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"])]),_:1},8,["onSubmit"])]),_:1}),o(ye,{class:"justify-end"},{default:s(()=>[V.value?(c(),h(Te,{key:0,"app-label":"kompomaatti",model:"competition","object-pk":n.id},null,8,["object-pk"])):z("",!0),o(Fe),o(J,{variant:"text",onClick:T},{default:s(()=>[v(m(e(a)("General.cancel")),1)]),_:1}),o(J,{variant:"elevated",color:"primary",loading:g.value,disabled:!e(le).valid,onClick:e(K)},{prepend:s(()=>[o(e(Se),{icon:e(ke)},null,8,["icon"])]),default:s(()=>[v(" "+m(e(a)("General.save")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1}))]),_:1},8,["breadcrumbs"])}}});export{ot as default};
//# sourceMappingURL=CompetitionEditView-BMfobiTu.js.map
