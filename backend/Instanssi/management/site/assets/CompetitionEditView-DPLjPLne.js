import{d as re,a as ne,u as de,v as ue,aG as me,aH as ce,o as pe,aI as ve,b as M,g as R,w as l,e as o,A as fe,p as Ve,B as be,l as we,j as e,m as f,i as c,t as p,a2 as he,C as Ce,V as L,k as Ee,D as ge,s as T,G as V,E as ye}from"./index-qrfwdmHz.js";import{c as _e,d as x,g as Fe,a as u,u as Se,b as r,V as Ie}from"./index.esm-BpR9m2gH.js";import{F as U}from"./FormSection-GyinszpZ.js";import{V as d,_ as Ae}from"./LayoutBase.vue_vue_type_script_setup_true_lang-Cgp8Musd.js";import{_ as B}from"./ToggleSwitch.vue_vue_type_script_setup_true_lang-BaRBjAD0.js";import{t as H,a as D}from"./datetime-DsxOZgAd.js";import{h as z}from"./http-Cqy_sGiB.js";import{p as $}from"./parseInt-CGa1F4cm.js";import{V as ke}from"./VTextarea-CedNBKzo.js";import{V as J}from"./VRow-EkiCBxID.js";import{V as Oe}from"./VCombobox-BLmMDLZj.js";import"./VContainer-e74dHNZG.js";import"./VSwitch-eDN7lqDz.js";import"./classApi-bnmGQydb.js";import"./filter-50Rnsb7m.js";const Le=re({__name:"CompetitionEditView",props:{eventId:{},id:{}},setup(Q){const G={name:"name",description:"description",participation_end:"participationEnd",start:"start",end:"end",score_type:"scoreType",score_sort:"scoreSort",active:"active",show_results:"showResults",hide_from_archive:"hideFromArchive"},n=Q,{t:a}=ne(),W=de(),m=ue(),{getEventById:X}=ye(),b=T(!1),w=T(!1),P=T(""),v=V(()=>$(n.eventId,10)),h=V(()=>n.id!==void 0),Y=V(()=>{const i=[{title:X(v.value)?.name??"...",to:{name:"dashboard",params:{eventId:n.eventId}}},{title:a("CompetitionsView.title"),to:{name:"competitions",params:{eventId:n.eventId}}}];return h.value?i.push({title:P.value||"...",disabled:!0}):i.push({title:a("Breadcrumbs.newCompetition"),disabled:!0}),i}),Z=[{title:a("CompetitionEditView.scoreSortOptions.highestFirst"),value:0},{title:a("CompetitionEditView.scoreSortOptions.lowestFirst"),value:1}],ee=["pts","sec","min","m","km","kg","pcs"],te=_e({name:u().required().min(1).max(32),description:u(),participationEnd:u().required(),start:u().required(),end:u().nullable(),scoreType:u().required().max(8),scoreSort:Fe(),active:x(),showResults:x(),hideFromArchive:x()}),{handleSubmit:ae,setValues:oe,setErrors:q,meta:ie}=Se({validationSchema:te,initialValues:{name:"",description:"",participationEnd:"",start:"",end:"",scoreType:"",scoreSort:0,active:!0,showResults:!1,hideFromArchive:!1}}),C=r("name"),E=r("description"),g=r("participationEnd"),y=r("start"),_=r("end"),F=r("scoreType"),S=r("scoreSort"),I=r("active"),A=r("showResults"),k=r("hideFromArchive"),N=V({get:()=>!k.value.value,set:i=>{k.value.value=!i}}),j=ae(async i=>{w.value=!0;let t;h.value?t=await le($(n.id,10),i):t=await se(i),w.value=!1,t&&O()});function K(i){return{name:i.name,description:i.description||"",participation_end:D(i.participationEnd),start:D(i.start),end:D(i.end),score_type:i.scoreType,score_sort:i.scoreSort,active:i.active,show_results:i.showResults,hide_from_archive:i.hideFromArchive}}async function se(i){try{return await me({path:{event_pk:v.value},body:K(i)}),m.success(a("CompetitionEditView.createSuccess")),!0}catch(t){z(t,q,m,a("CompetitionEditView.createFailure"),G)}return!1}async function le(i,t){try{return await ce({path:{event_pk:v.value,id:i},body:K(t)}),m.success(a("CompetitionEditView.editSuccess")),!0}catch(s){z(s,q,m,a("CompetitionEditView.editFailure"),G)}return!1}function O(){W.push({name:"competitions",params:{eventId:n.eventId}})}return pe(async()=>{if(h.value){b.value=!0;try{const t=(await ve({path:{event_pk:v.value,id:$(n.id,10)}})).data;P.value=t.name,oe({name:t.name,description:t.description??"",participationEnd:H(t.participation_end),start:H(t.start),end:H(t.end),scoreType:t.score_type??"",scoreSort:t.score_sort??0,active:t.active??!0,showResults:t.show_results??!1,hideFromArchive:t.hide_from_archive??!1})}catch(i){m.error(a("CompetitionEditView.loadFailure")),console.error(i),O()}finally{b.value=!1}}}),(i,t)=>(M(),R(Ae,{breadcrumbs:Y.value},{default:l(()=>[b.value?(M(),R(d,{key:0,class:"d-flex justify-center my-8"},{default:l(()=>[o(fe,{indeterminate:"",size:"64"})]),_:1})):(M(),R(d,{key:1},{default:l(()=>[o(Ve,null,{default:l(()=>[o(be,null,{default:l(()=>[o(Ie,{onSubmit:we(e(j),["prevent"])},{default:l(()=>[o(f,{modelValue:e(C).value.value,"onUpdate:modelValue":t[0]||(t[0]=s=>e(C).value.value=s),"error-messages":e(C).errorMessage.value,variant:"outlined",label:e(a)("CompetitionEditView.labels.name")+" *"},null,8,["modelValue","error-messages","label"]),o(ke,{modelValue:e(E).value.value,"onUpdate:modelValue":t[1]||(t[1]=s=>e(E).value.value=s),"error-messages":e(E).errorMessage.value,variant:"outlined",label:e(a)("CompetitionEditView.labels.description"),rows:"3"},null,8,["modelValue","error-messages","label"]),o(U,null,{default:l(()=>[c(p(e(a)("CompetitionEditView.sections.schedule")),1)]),_:1}),o(J,null,{default:l(()=>[o(d,{cols:"12",md:"4"},{default:l(()=>[o(f,{modelValue:e(g).value.value,"onUpdate:modelValue":t[2]||(t[2]=s=>e(g).value.value=s),type:"datetime-local","error-messages":e(g).errorMessage.value,variant:"outlined",label:e(a)("CompetitionEditView.labels.participationEnd")+" *"},null,8,["modelValue","error-messages","label"])]),_:1}),o(d,{cols:"12",md:"4"},{default:l(()=>[o(f,{modelValue:e(y).value.value,"onUpdate:modelValue":t[3]||(t[3]=s=>e(y).value.value=s),type:"datetime-local","error-messages":e(y).errorMessage.value,variant:"outlined",label:e(a)("CompetitionEditView.labels.start")+" *"},null,8,["modelValue","error-messages","label"])]),_:1}),o(d,{cols:"12",md:"4"},{default:l(()=>[o(f,{modelValue:e(_).value.value,"onUpdate:modelValue":t[4]||(t[4]=s=>e(_).value.value=s),type:"datetime-local","error-messages":e(_).errorMessage.value,variant:"outlined",label:e(a)("CompetitionEditView.labels.end")},null,8,["modelValue","error-messages","label"])]),_:1})]),_:1}),o(U,null,{default:l(()=>[c(p(e(a)("CompetitionEditView.sections.scoring")),1)]),_:1}),o(J,null,{default:l(()=>[o(d,{cols:"12",md:"6"},{default:l(()=>[o(Oe,{modelValue:e(F).value.value,"onUpdate:modelValue":t[5]||(t[5]=s=>e(F).value.value=s),items:ee,"error-messages":e(F).errorMessage.value,variant:"outlined",label:e(a)("CompetitionEditView.labels.scoreType")+" *"},null,8,["modelValue","error-messages","label"])]),_:1}),o(d,{cols:"12",md:"6"},{default:l(()=>[o(he,{modelValue:e(S).value.value,"onUpdate:modelValue":t[6]||(t[6]=s=>e(S).value.value=s),modelModifiers:{number:!0},items:Z,"error-messages":e(S).errorMessage.value,variant:"outlined",label:e(a)("CompetitionEditView.labels.scoreSort")},null,8,["modelValue","error-messages","label"])]),_:1})]),_:1}),o(U,null,{default:l(()=>[c(p(e(a)("CompetitionEditView.sections.settings")),1)]),_:1}),o(B,{modelValue:e(I).value.value,"onUpdate:modelValue":t[7]||(t[7]=s=>e(I).value.value=s),"error-message":e(I).errorMessage.value,"label-on":e(a)("CompetitionEditView.labels.activeOn"),"label-off":e(a)("CompetitionEditView.labels.activeOff"),"hint-on":e(a)("CompetitionEditView.labels.activeHintOn"),"hint-off":e(a)("CompetitionEditView.labels.activeHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"]),o(B,{modelValue:e(A).value.value,"onUpdate:modelValue":t[8]||(t[8]=s=>e(A).value.value=s),"error-message":e(A).errorMessage.value,"label-on":e(a)("CompetitionEditView.labels.showResultsOn"),"label-off":e(a)("CompetitionEditView.labels.showResultsOff"),"hint-on":e(a)("CompetitionEditView.labels.showResultsHintOn"),"hint-off":e(a)("CompetitionEditView.labels.showResultsHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"]),o(B,{modelValue:N.value,"onUpdate:modelValue":t[9]||(t[9]=s=>N.value=s),"error-message":e(k).errorMessage.value,"label-on":e(a)("CompetitionEditView.labels.hideFromArchiveOff"),"label-off":e(a)("CompetitionEditView.labels.hideFromArchiveOn"),"hint-on":e(a)("CompetitionEditView.labels.hideFromArchiveHintOn"),"hint-off":e(a)("CompetitionEditView.labels.hideFromArchiveHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"])]),_:1},8,["onSubmit"])]),_:1}),o(Ce,{class:"justify-end"},{default:l(()=>[o(L,{variant:"text",onClick:O},{default:l(()=>[c(p(e(a)("General.cancel")),1)]),_:1}),o(L,{variant:"elevated",color:"primary",loading:w.value,disabled:!e(ie).valid,onClick:e(j)},{prepend:l(()=>[o(e(Ee),{icon:e(ge)},null,8,["icon"])]),default:l(()=>[c(" "+p(e(a)("General.save")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1}))]),_:1},8,["breadcrumbs"]))}});export{Le as default};
//# sourceMappingURL=CompetitionEditView-DPLjPLne.js.map
