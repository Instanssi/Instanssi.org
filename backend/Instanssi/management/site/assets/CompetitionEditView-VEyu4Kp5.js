import{d as re,a as ne,u as de,v as me,aQ as ue,aR as pe,o as ce,aS as ve,b as V,g as b,w as l,e as o,A as fe,p as Ve,B as be,l as we,j as e,m as w,i as p,t as c,a3 as he,C as Ce,D as Ee,E as ge,V as L,k as _e,G as ye,s as T,I as h,H as Fe}from"./index-DXU74lGt.js";import{c as Se,d as x,g as Ie,a as m,u as ke,b as r}from"./index.esm-DWTrtXO7.js";import{_ as Ae}from"./AuditLogButton.vue_vue_type_script_setup_true_lang-5kFykphF.js";import{F as U}from"./FormSection-ByskKXOp.js";import{V as d,_ as Oe}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D4jd1chv.js";import{_ as B}from"./ToggleSwitch.vue_vue_type_script_setup_true_lang-p7genbiO.js";import{t as H,a as $}from"./datetime-Dz9fjSvq.js";import{h as z}from"./http-BTZWMaMN.js";import{p as D}from"./parseInt-Bzw_2rWL.js";import{V as Me}from"./VForm-C430u1Uz.js";import{V as Re}from"./VTextarea-DeKWRVbT.js";import{V as Q}from"./VRow-B94Tto0H.js";import{V as Te}from"./VCombobox-C95X2kta.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-WkXOSlqa.js";import"./useAuditLogUtils-BqNOieoY.js";import"./DateTimeCell.vue_vue_type_script_setup_true_lang-BMnBYvTq.js";import"./VDataTableServer-CMLVDy59.js";import"./VDataTable-Jd7io3gq.js";import"./VContainer-BfWqa_tJ.js";import"./VSwitch-DB1fJMny.js";const et=re({__name:"CompetitionEditView",props:{eventId:{},id:{}},setup(J){const j={name:"name",description:"description",participation_end:"participationEnd",start:"start",end:"end",score_type:"scoreType",score_sort:"scoreSort",active:"active",show_results:"showResults",hide_from_archive:"hideFromArchive"},n=J,{t:a}=ne(),W=de(),u=me(),{getEventById:X}=Fe(),C=T(!1),E=T(!1),N=T(""),v=h(()=>D(n.eventId,10)),f=h(()=>n.id!==void 0),Y=h(()=>{const i=[{title:X(v.value)?.name??"...",to:{name:"dashboard",params:{eventId:n.eventId}}},{title:a("CompetitionsView.title"),to:{name:"competitions",params:{eventId:n.eventId}}}];return f.value?i.push({title:N.value||"...",disabled:!0}):i.push({title:a("Breadcrumbs.newCompetition"),disabled:!0}),i}),Z=[{title:a("CompetitionEditView.scoreSortOptions.highestFirst"),value:0},{title:a("CompetitionEditView.scoreSortOptions.lowestFirst"),value:1}],ee=["pts","sec","min","m","km","kg","pcs"],te=Se({name:m().required().min(1).max(32),description:m(),participationEnd:m().required(),start:m().required(),end:m().nullable(),scoreType:m().required().max(8),scoreSort:Ie(),active:x(),showResults:x(),hideFromArchive:x()}),{handleSubmit:ae,setValues:oe,setErrors:P,meta:ie}=ke({validationSchema:te,initialValues:{name:"",description:"",participationEnd:"",start:"",end:"",scoreType:"",scoreSort:0,active:!0,showResults:!1,hideFromArchive:!1}}),g=r("name"),_=r("description"),y=r("participationEnd"),F=r("start"),S=r("end"),I=r("scoreType"),k=r("scoreSort"),A=r("active"),O=r("showResults"),M=r("hideFromArchive"),q=h({get:()=>!M.value.value,set:i=>{M.value.value=!i}}),G=ae(async i=>{E.value=!0;let t;f.value?t=await le(D(n.id,10),i):t=await se(i),E.value=!1,t&&R()});function K(i){return{name:i.name,description:i.description||"",participation_end:$(i.participationEnd),start:$(i.start),end:$(i.end),score_type:i.scoreType,score_sort:i.scoreSort,active:i.active,show_results:i.showResults,hide_from_archive:i.hideFromArchive}}async function se(i){try{return await ue({path:{event_pk:v.value},body:K(i)}),u.success(a("CompetitionEditView.createSuccess")),!0}catch(t){z(t,P,u,a("CompetitionEditView.createFailure"),j)}return!1}async function le(i,t){try{return await pe({path:{event_pk:v.value,id:i},body:K(t)}),u.success(a("CompetitionEditView.editSuccess")),!0}catch(s){z(s,P,u,a("CompetitionEditView.editFailure"),j)}return!1}function R(){W.push({name:"competitions",params:{eventId:n.eventId}})}return ce(async()=>{if(f.value){C.value=!0;try{const t=(await ve({path:{event_pk:v.value,id:D(n.id,10)}})).data;N.value=t.name,oe({name:t.name,description:t.description??"",participationEnd:H(t.participation_end),start:H(t.start),end:H(t.end),scoreType:t.score_type??"",scoreSort:t.score_sort??0,active:t.active??!0,showResults:t.show_results??!1,hideFromArchive:t.hide_from_archive??!1})}catch(i){u.error(a("CompetitionEditView.loadFailure")),console.error(i),R()}finally{C.value=!1}}}),(i,t)=>(V(),b(Oe,{breadcrumbs:Y.value},{default:l(()=>[C.value?(V(),b(d,{key:0,class:"d-flex justify-center my-8"},{default:l(()=>[o(fe,{indeterminate:"",size:"64"})]),_:1})):(V(),b(d,{key:1},{default:l(()=>[o(Ve,null,{default:l(()=>[o(be,null,{default:l(()=>[o(Me,{onSubmit:we(e(G),["prevent"])},{default:l(()=>[o(w,{modelValue:e(g).value.value,"onUpdate:modelValue":t[0]||(t[0]=s=>e(g).value.value=s),"error-messages":e(g).errorMessage.value,variant:"outlined",label:e(a)("CompetitionEditView.labels.name")+" *"},null,8,["modelValue","error-messages","label"]),o(Re,{modelValue:e(_).value.value,"onUpdate:modelValue":t[1]||(t[1]=s=>e(_).value.value=s),"error-messages":e(_).errorMessage.value,variant:"outlined",label:e(a)("CompetitionEditView.labels.description"),rows:"3"},null,8,["modelValue","error-messages","label"]),o(U,null,{default:l(()=>[p(c(e(a)("CompetitionEditView.sections.schedule")),1)]),_:1}),o(Q,null,{default:l(()=>[o(d,{cols:"12",md:"4"},{default:l(()=>[o(w,{modelValue:e(y).value.value,"onUpdate:modelValue":t[2]||(t[2]=s=>e(y).value.value=s),type:"datetime-local","error-messages":e(y).errorMessage.value,variant:"outlined",label:e(a)("CompetitionEditView.labels.participationEnd")+" *"},null,8,["modelValue","error-messages","label"])]),_:1}),o(d,{cols:"12",md:"4"},{default:l(()=>[o(w,{modelValue:e(F).value.value,"onUpdate:modelValue":t[3]||(t[3]=s=>e(F).value.value=s),type:"datetime-local","error-messages":e(F).errorMessage.value,variant:"outlined",label:e(a)("CompetitionEditView.labels.start")+" *"},null,8,["modelValue","error-messages","label"])]),_:1}),o(d,{cols:"12",md:"4"},{default:l(()=>[o(w,{modelValue:e(S).value.value,"onUpdate:modelValue":t[4]||(t[4]=s=>e(S).value.value=s),type:"datetime-local","error-messages":e(S).errorMessage.value,variant:"outlined",label:e(a)("CompetitionEditView.labels.end")},null,8,["modelValue","error-messages","label"])]),_:1})]),_:1}),o(U,null,{default:l(()=>[p(c(e(a)("CompetitionEditView.sections.scoring")),1)]),_:1}),o(Q,null,{default:l(()=>[o(d,{cols:"12",md:"6"},{default:l(()=>[o(Te,{modelValue:e(I).value.value,"onUpdate:modelValue":t[5]||(t[5]=s=>e(I).value.value=s),items:ee,"error-messages":e(I).errorMessage.value,variant:"outlined",label:e(a)("CompetitionEditView.labels.scoreType")+" *"},null,8,["modelValue","error-messages","label"])]),_:1}),o(d,{cols:"12",md:"6"},{default:l(()=>[o(he,{modelValue:e(k).value.value,"onUpdate:modelValue":t[6]||(t[6]=s=>e(k).value.value=s),modelModifiers:{number:!0},items:Z,"error-messages":e(k).errorMessage.value,variant:"outlined",label:e(a)("CompetitionEditView.labels.scoreSort")},null,8,["modelValue","error-messages","label"])]),_:1})]),_:1}),o(U,null,{default:l(()=>[p(c(e(a)("CompetitionEditView.sections.settings")),1)]),_:1}),o(B,{modelValue:e(A).value.value,"onUpdate:modelValue":t[7]||(t[7]=s=>e(A).value.value=s),"error-message":e(A).errorMessage.value,"label-on":e(a)("CompetitionEditView.labels.activeOn"),"label-off":e(a)("CompetitionEditView.labels.activeOff"),"hint-on":e(a)("CompetitionEditView.labels.activeHintOn"),"hint-off":e(a)("CompetitionEditView.labels.activeHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"]),o(B,{modelValue:e(O).value.value,"onUpdate:modelValue":t[8]||(t[8]=s=>e(O).value.value=s),"error-message":e(O).errorMessage.value,"label-on":e(a)("CompetitionEditView.labels.showResultsOn"),"label-off":e(a)("CompetitionEditView.labels.showResultsOff"),"hint-on":e(a)("CompetitionEditView.labels.showResultsHintOn"),"hint-off":e(a)("CompetitionEditView.labels.showResultsHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"]),o(B,{modelValue:q.value,"onUpdate:modelValue":t[9]||(t[9]=s=>q.value=s),"error-message":e(M).errorMessage.value,"label-on":e(a)("CompetitionEditView.labels.hideFromArchiveOff"),"label-off":e(a)("CompetitionEditView.labels.hideFromArchiveOn"),"hint-on":e(a)("CompetitionEditView.labels.hideFromArchiveHintOn"),"hint-off":e(a)("CompetitionEditView.labels.hideFromArchiveHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"])]),_:1},8,["onSubmit"])]),_:1}),o(Ce,{class:"justify-end"},{default:l(()=>[f.value?(V(),b(Ae,{key:0,"app-label":"kompomaatti",model:"competition","object-pk":n.id},null,8,["object-pk"])):Ee("",!0),o(ge),o(L,{variant:"text",onClick:R},{default:l(()=>[p(c(e(a)("General.cancel")),1)]),_:1}),o(L,{variant:"elevated",color:"primary",loading:E.value,disabled:!e(ie).valid,onClick:e(G)},{prepend:l(()=>[o(e(_e),{icon:e(ye)},null,8,["icon"])]),default:l(()=>[p(" "+c(e(a)("General.save")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1}))]),_:1},8,["breadcrumbs"]))}});export{et as default};
//# sourceMappingURL=CompetitionEditView-VEyu4Kp5.js.map
