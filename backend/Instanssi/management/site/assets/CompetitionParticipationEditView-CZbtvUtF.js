import{d as oe,a as se,u as le,v as ne,bm as re,bn as ue,o as de,bo as me,b as f,g as b,w as s,e as t,A as pe,p as ce,B as ve,l as fe,j as a,a2 as be,m as F,i as V,t as C,K as Ve,C as Ce,V as D,k as we,D as ge,s as u,G as v,aF as ye,S as _e,E as qe}from"./index-BSHMv_df.js";import{c as Ee,a as K,d as Pe,g as M,u as ke,b as d,V as Ie}from"./index.esm-71TeWLhH.js";import{V as Fe,_ as Me}from"./DisqualificationField.vue_vue_type_script_setup_true_lang-BBN2Bs-E.js";import{F as G}from"./FormSection-Dax0lJeU.js";import{V as m,_ as Ne}from"./LayoutBase.vue_vue_type_script_setup_true_lang-C8aKWyeJ.js";import{h as O}from"./http-BZkoYM_m.js";import{p as N}from"./parseInt-3OpbdfxQ.js";import{V as T}from"./VRow-BUBfmFS3.js";import"./filter-C6Uu0LOB.js";import"./VSwitch-DkiL1OKS.js";import"./VContainer--EpXOfw5.js";const Oe=oe({__name:"CompetitionParticipationEditView",props:{eventId:{},id:{}},setup(j){const R={competition:"competition",user:"user",participant_name:"participantName",score:"score",disqualified:"disqualified",disqualified_reason:"disqualifiedReason"},n=j,{t:o}=se(),L=le(),p=ne(),{getEventById:z}=qe(),w=u(!1),g=u(!1),S=u(""),c=v(()=>N(n.eventId,10)),r=v(()=>n.id!==void 0),x=u([]),U=u([]),h=u("-"),H=v(()=>{const e=[{title:z(c.value)?.name??"...",to:{name:"dashboard",params:{eventId:n.eventId}}},{title:o("CompetitionParticipationsView.title"),to:{name:"competition-participations",params:{eventId:n.eventId}}}];return r.value?e.push({title:S.value||"...",disabled:!0}):e.push({title:o("Breadcrumbs.newParticipation"),disabled:!0}),e}),J=v(()=>x.value.map(e=>({title:e.name,value:e.id}))),Q=v(()=>U.value.map(e=>({title:e.username,value:e.id}))),W=Ee({competition:M().required(),user:M().required(),participantName:K().max(64),score:M().nullable(),disqualified:Pe(),disqualifiedReason:K()}),{handleSubmit:X,setValues:Y,setErrors:B,meta:Z}=ke({validationSchema:W,initialValues:{competition:null,user:null,participantName:"",score:null,disqualified:!1,disqualifiedReason:""}}),y=d("competition"),_=d("user"),q=d("participantName"),E=d("score"),P=d("disqualified"),k=d("disqualifiedReason"),A=X(async e=>{g.value=!0;let i;r.value?i=await ae(N(n.id,10),e):i=await ee(e),g.value=!1,i&&I()});function $(e,i){return{competition:i?e.competition:void 0,user:i?e.user:void 0,participant_name:e.participantName||"",score:e.score,disqualified:e.disqualified,disqualified_reason:e.disqualifiedReason||""}}async function ee(e){try{return await re({path:{event_pk:c.value},body:$(e,!0)}),p.success(o("CompetitionParticipationEditView.createSuccess")),!0}catch(i){O(i,B,p,o("CompetitionParticipationEditView.createFailure"),R)}return!1}async function ae(e,i){try{return await ue({path:{event_pk:c.value,id:e},body:$(i,!1)}),p.success(o("CompetitionParticipationEditView.editSuccess")),!0}catch(l){O(l,B,p,o("CompetitionParticipationEditView.editFailure"),R)}return!1}function I(){L.push({name:"competition-participations",params:{eventId:n.eventId}})}async function ie(){try{const e=await ye({path:{event_pk:c.value},query:{limit:100}});x.value=e.data.results}catch(e){console.error("Failed to load competitions:",e)}}async function te(){try{const e=await _e({query:{limit:1e3}});U.value=e.data.results}catch(e){console.error("Failed to load users:",e)}}return de(async()=>{if(await Promise.all([ie(),te()]),r.value){w.value=!0;try{const i=(await me({path:{event_pk:c.value,id:N(n.id,10)}})).data;S.value=i.participant_name||`#${i.id}`,h.value=i.rank?.toString()??"-",Y({competition:i.competition,user:i.user,participantName:i.participant_name??"",score:i.score??null,disqualified:i.disqualified??!1,disqualifiedReason:i.disqualified_reason??""})}catch(e){p.error(o("CompetitionParticipationEditView.loadFailure")),console.error(e),I()}finally{w.value=!1}}}),(e,i)=>(f(),b(Ne,{breadcrumbs:H.value},{default:s(()=>[w.value?(f(),b(m,{key:0,class:"d-flex justify-center my-8"},{default:s(()=>[t(pe,{indeterminate:"",size:"64"})]),_:1})):(f(),b(m,{key:1},{default:s(()=>[t(ce,null,{default:s(()=>[t(ve,null,{default:s(()=>[t(Ie,{onSubmit:fe(a(A),["prevent"])},{default:s(()=>[t(T,null,{default:s(()=>[t(m,{cols:"12",md:"6"},{default:s(()=>[t(be,{modelValue:a(y).value.value,"onUpdate:modelValue":i[0]||(i[0]=l=>a(y).value.value=l),modelModifiers:{number:!0},items:J.value,"error-messages":a(y).errorMessage.value,variant:"outlined",label:a(o)("CompetitionParticipationEditView.labels.competition")+" *",disabled:r.value},null,8,["modelValue","items","error-messages","label","disabled"])]),_:1}),t(m,{cols:"12",md:"6"},{default:s(()=>[t(Fe,{modelValue:a(_).value.value,"onUpdate:modelValue":i[1]||(i[1]=l=>a(_).value.value=l),modelModifiers:{number:!0},items:Q.value,"error-messages":a(_).errorMessage.value,variant:"outlined",label:a(o)("CompetitionParticipationEditView.labels.user")+" *",disabled:r.value},null,8,["modelValue","items","error-messages","label","disabled"])]),_:1})]),_:1}),t(F,{modelValue:a(q).value.value,"onUpdate:modelValue":i[2]||(i[2]=l=>a(q).value.value=l),"error-messages":a(q).errorMessage.value,variant:"outlined",label:a(o)("CompetitionParticipationEditView.labels.participantName")},null,8,["modelValue","error-messages","label"]),t(G,null,{default:s(()=>[V(C(a(o)("CompetitionParticipationEditView.sections.scoring")),1)]),_:1}),t(T,null,{default:s(()=>[t(m,{cols:"12",md:"6"},{default:s(()=>[t(F,{modelValue:a(E).value.value,"onUpdate:modelValue":i[3]||(i[3]=l=>a(E).value.value=l),modelModifiers:{number:!0},type:"number","error-messages":a(E).errorMessage.value,variant:"outlined",label:a(o)("CompetitionParticipationEditView.labels.score")},null,8,["modelValue","error-messages","label"])]),_:1}),r.value?(f(),b(m,{key:0,cols:"12",md:"6"},{default:s(()=>[t(F,{"model-value":h.value,variant:"outlined",label:a(o)("CompetitionParticipationEditView.labels.rank"),readonly:""},null,8,["model-value","label"])]),_:1})):Ve("",!0)]),_:1}),t(G,null,{default:s(()=>[V(C(a(o)("CompetitionParticipationEditView.sections.disqualification")),1)]),_:1}),t(Me,{modelValue:a(P).value.value,"onUpdate:modelValue":i[4]||(i[4]=l=>a(P).value.value=l),reason:a(k).value.value,"onUpdate:reason":i[5]||(i[5]=l=>a(k).value.value=l),"error-message":a(P).errorMessage.value,"reason-error-message":a(k).errorMessage.value,"label-on":a(o)("CompetitionParticipationEditView.labels.disqualifiedOn"),"label-off":a(o)("CompetitionParticipationEditView.labels.disqualifiedOff"),"reason-label":a(o)("CompetitionParticipationEditView.labels.disqualifiedReason")},null,8,["modelValue","reason","error-message","reason-error-message","label-on","label-off","reason-label"])]),_:1},8,["onSubmit"])]),_:1}),t(Ce,{class:"justify-end"},{default:s(()=>[t(D,{variant:"text",onClick:I},{default:s(()=>[V(C(a(o)("General.cancel")),1)]),_:1}),t(D,{variant:"elevated",color:"primary",loading:g.value,disabled:!a(Z).valid,onClick:a(A)},{prepend:s(()=>[t(a(we),{icon:a(ge)},null,8,["icon"])]),default:s(()=>[V(" "+C(a(o)("General.save")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1}))]),_:1},8,["breadcrumbs"]))}});export{Oe as default};
//# sourceMappingURL=CompetitionParticipationEditView-CZbtvUtF.js.map
