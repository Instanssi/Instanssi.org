import{d as Z,a as ee,u as te,H as ae,I as ie,v as oe,a1 as ne,o as se,b as c,g as p,w as o,e as s,j as t,P as k,V as w,i as u,t as m,k as f,J as re,K as b,a2 as le,as as q,bi as ce,bj as pe,q as ue,G as I,s as r,aF as me,S as de,bk as ve,bl as fe,E as Ce}from"./index-BSHMv_df.js";import{V as D,_ as Pe}from"./LayoutBase.vue_vue_type_script_setup_true_lang-C8aKWyeJ.js";import{d as ye,V as ge,g as Ve}from"./query_tools-Co6bP9h2.js";import{g as ke}from"./http-BZkoYM_m.js";import{V as F}from"./VRow-BUBfmFS3.js";import{p as S}from"./parseInt-3OpbdfxQ.js";import"./VContainer--EpXOfw5.js";import"./VDataTable-CpUosGjF.js";import"./filter-C6Uu0LOB.js";const Oe=Z({__name:"CompetitionParticipationsView",props:{eventId:{}},setup(U){const C=U,{t:i}=ee(),h=te(),$=ae(ie),P=oe(),y=ue(),{getEventById:L}=Ce(),l=I(()=>S(C.eventId,10)),g=r(!1),B=I(()=>[{title:L(l.value)?.name??"...",to:{name:"dashboard",params:{eventId:C.eventId}}},{title:i("CompetitionParticipationsView.title"),disabled:!0}]),_=[25,50,100],T=r(_[0]),x=r(0),K=r(1),A=r([]),V=r([]),N=r([]),d=r(null),v=r(null),M=[{title:i("CompetitionParticipationsView.headers.id"),sortable:!0,key:"id"},{title:i("CompetitionParticipationsView.headers.participantName"),sortable:!0,key:"participant_name"},{title:i("CompetitionParticipationsView.headers.user"),sortable:!1,key:"user"},{title:i("CompetitionParticipationsView.headers.competition"),sortable:!1,key:"competition"},{title:i("CompetitionParticipationsView.headers.score"),sortable:!0,key:"score"},{title:i("CompetitionParticipationsView.headers.disqualified"),sortable:!1,key:"disqualified"},{title:i("CompetitionParticipationsView.headers.rank"),sortable:!0,key:"rank"},{title:i("CompetitionParticipationsView.headers.actions"),sortable:!1,key:"actions",align:"end"}],R=I(()=>[{title:i("CompetitionParticipationsView.allCompetitions"),value:null},...V.value.map(e=>({title:e.name,value:e.id}))]);function j(e){return V.value.find(a=>a.id===e)?.name??`#${e}`}function G(e){return N.value.find(a=>a.id===e)?.username??`#${e}`}function z(){v.value&&O(v.value)}async function H(){try{const e=await me({path:{event_pk:l.value},query:{limit:100}});V.value=e.data.results}catch(e){console.error("Failed to load competitions:",e)}}async function J(){try{const e=await de({query:{limit:1e3}});N.value=e.data.results}catch(e){console.error("Failed to load users:",e)}}async function O(e){g.value=!0,v.value=e;try{const n=await fe({path:{event_pk:S(C.eventId,10)},query:{...Ve(e),...d.value?{competition:d.value}:{}}});A.value=n.data.results,x.value=n.data.count}catch(n){P.error(i("CompetitionParticipationsView.loadFailure")),console.error(n)}finally{g.value=!1}}const E=ye(O,250);ne(d,()=>{v.value&&E(v.value)});async function X(e){const n=i("CompetitionParticipationsView.confirmDelete",{name:e.participant_name||`#${e.id}`});await $.value.ifConfirmed(n,async()=>{try{await ve({path:{event_pk:l.value,id:e.id}}),P.success(i("CompetitionParticipationsView.deleteSuccess")),z()}catch(a){P.error(ke(a,i("CompetitionParticipationsView.deleteFailure"))),console.error(a)}})}function Q(e){h.push({name:"competition-participations-edit",params:{eventId:l.value,id:e}})}function W(){h.push({name:"competition-participations-new",params:{eventId:l.value}})}return se(()=>{H(),J()}),(e,n)=>(c(),p(Pe,{key:`participations-${l.value}`,breadcrumbs:B.value},{default:o(()=>[s(D,null,{default:o(()=>[s(F,null,{default:o(()=>[t(y).canAdd(t(k).COMPETITION_PARTICIPATION)?(c(),p(w,{key:0,onClick:W},{prepend:o(()=>[s(t(f),{icon:t(re)},null,8,["icon"])]),default:o(()=>[u(" "+m(t(i)("CompetitionParticipationsView.newParticipation")),1)]),_:1})):b("",!0),s(le,{modelValue:d.value,"onUpdate:modelValue":n[0]||(n[0]=a=>d.value=a),items:R.value,variant:"outlined",density:"compact",label:t(i)("CompetitionParticipationsView.filterByCompetition"),style:{"max-width":"300px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","items","label"])]),_:1})]),_:1}),s(D,null,{default:o(()=>[s(F,null,{default:o(()=>[s(ge,{"items-per-page":T.value,"onUpdate:itemsPerPage":n[1]||(n[1]=a=>T.value=a),class:"elevation-1 primary","item-value":"id",density:"compact",headers:M,items:A.value,"items-length":x.value,loading:g.value,page:K.value,"items-per-page-options":_,"no-data-text":t(i)("CompetitionParticipationsView.noParticipationsFound"),"loading-text":t(i)("CompetitionParticipationsView.loadingParticipations"),"onUpdate:options":t(E)},{"item.competition":o(({item:a})=>[u(m(j(a.competition)),1)]),"item.user":o(({item:a})=>[u(m(G(a.user)),1)]),"item.disqualified":o(({item:a})=>[a.disqualified?(c(),p(t(f),{key:0,icon:t(pe),class:"text-red"},null,8,["icon"])):(c(),p(t(f),{key:1,icon:t(q),class:"text-green"},null,8,["icon"]))]),"item.rank":o(({item:a})=>[u(m(a.rank??"-"),1)]),"item.actions":o(({item:a})=>[t(y).canDelete(t(k).COMPETITION_PARTICIPATION)?(c(),p(w,{key:0,density:"compact",variant:"text",color:"red",onClick:Y=>X(a)},{prepend:o(()=>[s(t(f),{icon:t(q)},null,8,["icon"])]),default:o(()=>[u(" "+m(t(i)("General.delete")),1)]),_:1},8,["onClick"])):b("",!0),t(y).canChange(t(k).COMPETITION_PARTICIPATION)?(c(),p(w,{key:1,density:"compact",variant:"text",onClick:Y=>Q(a.id)},{prepend:o(()=>[s(t(f),{icon:t(ce)},null,8,["icon"])]),default:o(()=>[u(" "+m(t(i)("General.edit")),1)]),_:1},8,["onClick"])):b("",!0)]),_:1},8,["items-per-page","items","items-length","loading","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Oe as default};
//# sourceMappingURL=CompetitionParticipationsView-B5yF2aJ9.js.map
