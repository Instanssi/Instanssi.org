import{d as te,a as ae,u as ie,H as oe,I as ne,v as se,Z as D,o as re,b as p,g as u,w as o,e as s,j as t,P as h,V as b,i as m,t as d,k as f,J as le,K as I,a2 as ce,as as B,bi as pe,bj as ue,q as me,G as _,s as r,aF as de,S as ve,bk as fe,bl as Pe,E as Ce}from"./index-qrfwdmHz.js";import{V as F,_ as ye}from"./LayoutBase.vue_vue_type_script_setup_true_lang-Cgp8Musd.js";import{d as ge,V as Ve,g as ke}from"./query_tools-Ch1hnqwl.js";import{g as we}from"./http-Cqy_sGiB.js";import{V as S}from"./VRow-EkiCBxID.js";import{p as U}from"./parseInt-CGa1F4cm.js";import"./VContainer-e74dHNZG.js";import"./VDataTable-BIkGv4dg.js";import"./filter-50Rnsb7m.js";const Ee=te({__name:"CompetitionParticipationsView",props:{eventId:{}},setup($){const P=$,{t:i}=ae(),T=ie(),L=oe(ne),C=se(),y=me(),{getEventById:K}=Ce(),l=_(()=>U(P.eventId,10)),g=r(!1),M=_(()=>[{title:K(l.value)?.name??"...",to:{name:"dashboard",params:{eventId:P.eventId}}},{title:i("CompetitionParticipationsView.title"),disabled:!0}]),x=[25,50,100],V=r(x[0]),A=r(0),R=r(1),N=r([]),k=r([]),O=r([]),c=r(null),v=r(null),j=[{title:i("CompetitionParticipationsView.headers.id"),sortable:!0,key:"id"},{title:i("CompetitionParticipationsView.headers.participantName"),sortable:!0,key:"participant_name"},{title:i("CompetitionParticipationsView.headers.user"),sortable:!1,key:"user"},{title:i("CompetitionParticipationsView.headers.competition"),sortable:!1,key:"competition"},{title:i("CompetitionParticipationsView.headers.score"),sortable:!0,key:"score"},{title:i("CompetitionParticipationsView.headers.disqualified"),sortable:!1,key:"disqualified"},{title:i("CompetitionParticipationsView.headers.rank"),sortable:!1,key:"rank"},{title:i("CompetitionParticipationsView.headers.actions"),sortable:!1,key:"actions",align:"end"}],G=_(()=>[{title:i("CompetitionParticipationsView.allCompetitions"),value:null},...k.value.map(e=>({title:e.name,value:e.id}))]);function z(e){return k.value.find(a=>a.id===e)?.name??`#${e}`}function H(e){return O.value.find(a=>a.id===e)?.username??`#${e}`}function J(){v.value&&q(v.value)}async function E(){try{const e=await de({path:{event_pk:l.value},query:{limit:100}});k.value=e.data.results}catch(e){console.error("Failed to load competitions:",e)}}async function X(){try{const e=await ve({query:{limit:1e3}});O.value=e.data.results}catch(e){console.error("Failed to load users:",e)}}async function q(e){g.value=!0,v.value=e;try{const n=await Pe({path:{event_pk:U(P.eventId,10)},query:{...ke(e),...c.value?{competition:c.value}:{}}});N.value=n.data.results,A.value=n.data.count}catch(n){C.error(i("CompetitionParticipationsView.loadFailure")),console.error(n)}finally{g.value=!1}}const w=ge(q,250);D(c,()=>{v.value&&w(v.value)});function Z(){c.value=null,E(),w({page:1,itemsPerPage:V.value??25,sortBy:[],groupBy:[],search:""})}D(l,Z);async function Q(e){const n=i("CompetitionParticipationsView.confirmDelete",{name:e.participant_name||`#${e.id}`});await L.value.ifConfirmed(n,async()=>{try{await fe({path:{event_pk:l.value,id:e.id}}),C.success(i("CompetitionParticipationsView.deleteSuccess")),J()}catch(a){C.error(we(a,i("CompetitionParticipationsView.deleteFailure"))),console.error(a)}})}function W(e){T.push({name:"competition-participations-edit",params:{eventId:l.value,id:e}})}function Y(){T.push({name:"competition-participations-new",params:{eventId:l.value}})}return re(()=>{E(),X()}),(e,n)=>(p(),u(ye,{key:`participations-${l.value}`,breadcrumbs:M.value},{default:o(()=>[s(F,null,{default:o(()=>[s(S,null,{default:o(()=>[t(y).canAdd(t(h).COMPETITION_PARTICIPATION)?(p(),u(b,{key:0,onClick:Y},{prepend:o(()=>[s(t(f),{icon:t(le)},null,8,["icon"])]),default:o(()=>[m(" "+d(t(i)("CompetitionParticipationsView.newParticipation")),1)]),_:1})):I("",!0),s(ce,{modelValue:c.value,"onUpdate:modelValue":n[0]||(n[0]=a=>c.value=a),items:G.value,variant:"outlined",density:"compact",label:t(i)("CompetitionParticipationsView.filterByCompetition"),style:{"max-width":"300px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","items","label"])]),_:1})]),_:1}),s(F,null,{default:o(()=>[s(S,null,{default:o(()=>[s(Ve,{"items-per-page":V.value,"onUpdate:itemsPerPage":n[1]||(n[1]=a=>V.value=a),class:"elevation-1 primary","item-value":"id",density:"compact",headers:j,items:N.value,"items-length":A.value,loading:g.value,page:R.value,"items-per-page-options":x,"no-data-text":t(i)("CompetitionParticipationsView.noParticipationsFound"),"loading-text":t(i)("CompetitionParticipationsView.loadingParticipations"),"onUpdate:options":t(w)},{"item.competition":o(({item:a})=>[m(d(z(a.competition)),1)]),"item.user":o(({item:a})=>[m(d(H(a.user)),1)]),"item.disqualified":o(({item:a})=>[a.disqualified?(p(),u(t(f),{key:0,icon:t(ue),class:"text-red"},null,8,["icon"])):(p(),u(t(f),{key:1,icon:t(B),class:"text-green"},null,8,["icon"]))]),"item.rank":o(({item:a})=>[m(d(a.rank??"-"),1)]),"item.actions":o(({item:a})=>[t(y).canDelete(t(h).COMPETITION_PARTICIPATION)?(p(),u(b,{key:0,density:"compact",variant:"text",color:"red",onClick:ee=>Q(a)},{prepend:o(()=>[s(t(f),{icon:t(B)},null,8,["icon"])]),default:o(()=>[m(" "+d(t(i)("General.delete")),1)]),_:1},8,["onClick"])):I("",!0),t(y).canChange(t(h).COMPETITION_PARTICIPATION)?(p(),u(b,{key:1,density:"compact",variant:"text",onClick:ee=>W(a.id)},{prepend:o(()=>[s(t(f),{icon:t(pe)},null,8,["icon"])]),default:o(()=>[m(" "+d(t(i)("General.edit")),1)]),_:1},8,["onClick"])):I("",!0)]),_:1},8,["items-per-page","items","items-length","loading","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Ee as default};
//# sourceMappingURL=CompetitionParticipationsView-BrVAxFvP.js.map
