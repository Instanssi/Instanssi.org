import{d as W,a as Y,u as ee,J as te,K as ae,v as ie,U as E,o as oe,b as m,g as u,w as n,e as r,j as i,P as h,V as ne,i as d,t as v,k as b,L as se,D as re,a3 as le,Z as pe,aC as ce,q as me,I as k,s,aP as ue,T as de,br as ve,bs as fe,H as Pe}from"./index-DXU74lGt.js";import{V as O,_ as Ce}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D4jd1chv.js";import{_ as ge}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-CUVfxWfg.js";import{g as ye}from"./query_tools-BInV9OzK.js";import{g as Ve}from"./http-BTZWMaMN.js";import{d as we}from"./debounce-CQ84CrOG.js";import{V as q}from"./VRow-B94Tto0H.js";import{V as he}from"./VDataTableServer-CMLVDy59.js";import{p as L}from"./parseInt-Bzw_2rWL.js";import"./VContainer-BfWqa_tJ.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-WkXOSlqa.js";import"./useAuditLogUtils-BqNOieoY.js";import"./DateTimeCell.vue_vue_type_script_setup_true_lang-BMnBYvTq.js";import"./datetime-Dz9fjSvq.js";import"./VDataTable-Jd7io3gq.js";const Be=W({__name:"CompetitionParticipationsView",props:{eventId:{}},setup(U){const f=U,{t:a}=Y(),I=ee(),$=te(ae),P=ie(),C=me(),{getEventById:B}=Pe(),l=k(()=>L(f.eventId,10)),g=s(!1),F=k(()=>[{title:B(l.value)?.name??"...",to:{name:"dashboard",params:{eventId:f.eventId}}},{title:a("CompetitionParticipationsView.title"),disabled:!0}]),_=[25,50,100],y=s(_[0]),T=s(0),K=s(1),x=s([]),V=s([]),A=s([]),p=s(null),c=s(null),M=[{title:a("CompetitionParticipationsView.headers.id"),sortable:!0,key:"id"},{title:a("CompetitionParticipationsView.headers.participantName"),sortable:!0,key:"participant_name"},{title:a("CompetitionParticipationsView.headers.user"),sortable:!1,key:"user"},{title:a("CompetitionParticipationsView.headers.competition"),sortable:!1,key:"competition"},{title:a("CompetitionParticipationsView.headers.score"),sortable:!0,key:"score"},{title:a("CompetitionParticipationsView.headers.disqualified"),sortable:!1,key:"disqualified"},{title:a("CompetitionParticipationsView.headers.rank"),sortable:!1,key:"rank"},{title:a("CompetitionParticipationsView.headers.actions"),sortable:!1,key:"actions",align:"end"}],R=k(()=>[{title:a("CompetitionParticipationsView.allCompetitions"),value:null},...V.value.map(e=>({title:e.name,value:e.id}))]);function S(e){return V.value.find(t=>t.id===e)?.name??`#${e}`}function j(e){return A.value.find(t=>t.id===e)?.username??`#${e}`}function z(){c.value&&D(c.value)}async function N(){try{const e=await ue({path:{event_pk:l.value},query:{limit:100}});V.value=e.data.results}catch(e){console.error("Failed to load competitions:",e)}}async function H(){try{const e=await de({query:{limit:1e3}});A.value=e.data.results}catch(e){console.error("Failed to load users:",e)}}async function D(e){g.value=!0,c.value=e;try{const o=await fe({path:{event_pk:L(f.eventId,10)},query:{...ye(e),...p.value?{competition:p.value}:{}}});x.value=o.data.results,T.value=o.data.count}catch(o){P.error(a("CompetitionParticipationsView.loadFailure")),console.error(o)}finally{g.value=!1}}const w=we(D,250);E(p,()=>{c.value&&w(c.value)});function J(){p.value=null,N(),w({page:1,itemsPerPage:y.value??25,sortBy:[],groupBy:[],search:""})}E(l,J);async function X(e){const o=a("CompetitionParticipationsView.confirmDelete",{name:e.participant_name||`#${e.id}`});await $.value.ifConfirmed(o,async()=>{try{await ve({path:{event_pk:l.value,id:e.id}}),P.success(a("CompetitionParticipationsView.deleteSuccess")),z()}catch(t){P.error(Ve(t,a("CompetitionParticipationsView.deleteFailure"))),console.error(t)}})}function Z(e){I.push({name:"competition-participations-edit",params:{eventId:l.value,id:e}})}function G(){I.push({name:"competition-participations-new",params:{eventId:l.value}})}return oe(()=>{N(),H()}),(e,o)=>(m(),u(Ce,{key:`participations-${l.value}`,breadcrumbs:F.value},{default:n(()=>[r(O,null,{default:n(()=>[r(q,null,{default:n(()=>[i(C).canAdd(i(h).COMPETITION_PARTICIPATION)?(m(),u(ne,{key:0,color:"primary",onClick:G},{prepend:n(()=>[r(i(b),{icon:i(se)},null,8,["icon"])]),default:n(()=>[d(" "+v(i(a)("CompetitionParticipationsView.newParticipation")),1)]),_:1})):re("",!0),r(le,{modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=t=>p.value=t),items:R.value,variant:"outlined",density:"compact",label:i(a)("CompetitionParticipationsView.filterByCompetition"),style:{"max-width":"300px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","items","label"])]),_:1})]),_:1}),r(O,null,{default:n(()=>[r(q,null,{default:n(()=>[r(he,{"items-per-page":y.value,"onUpdate:itemsPerPage":o[1]||(o[1]=t=>y.value=t),class:"elevation-1 primary","item-value":"id",density:"compact",headers:M,items:x.value,"items-length":T.value,loading:g.value,page:K.value,"items-per-page-options":_,"no-data-text":i(a)("CompetitionParticipationsView.noParticipationsFound"),"loading-text":i(a)("CompetitionParticipationsView.loadingParticipations"),"onUpdate:options":i(w)},{"item.competition":n(({item:t})=>[d(v(S(t.competition)),1)]),"item.user":n(({item:t})=>[d(v(j(t.user)),1)]),"item.disqualified":n(({item:t})=>[t.disqualified?(m(),u(i(b),{key:0,icon:i(pe),class:"text-red"},null,8,["icon"])):(m(),u(i(b),{key:1,icon:i(ce),class:"text-green"},null,8,["icon"]))]),"item.rank":n(({item:t})=>[d(v(t.rank??"-"),1)]),"item.actions":n(({item:t})=>[r(ge,{"can-edit":i(C).canChange(i(h).COMPETITION_PARTICIPATION),"can-delete":i(C).canDelete(i(h).COMPETITION_PARTICIPATION),"audit-log":{appLabel:"kompomaatti",model:"competitionparticipation",objectPk:t.id},onEdit:Q=>Z(t.id),onDelete:Q=>X(t)},null,8,["can-edit","can-delete","audit-log","onEdit","onDelete"])]),_:1},8,["items-per-page","items","items-length","loading","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Be as default};
//# sourceMappingURL=CompetitionParticipationsView-Dni-x-5v.js.map
