import{d as j,a as q,u as R,J as z,K as G,v as H,U as J,b as I,g as k,w as o,e as i,j as a,P as g,V as Q,i as W,t as X,k as Y,L as Z,D as ee,m as te,q as ae,I as P,s as l,aO as oe,aP as ie,H as ne}from"./index-DXU74lGt.js";import{_ as se}from"./BooleanIcon.vue_vue_type_script_setup_true_lang-CqjGGkAi.js";import{_ as C}from"./DateTimeCell.vue_vue_type_script_setup_true_lang-BMnBYvTq.js";import{V as x,_ as le}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D4jd1chv.js";import{_ as re}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-CUVfxWfg.js";import{g as me}from"./query_tools-BInV9OzK.js";import{g as pe}from"./http-BTZWMaMN.js";import{d as ue}from"./debounce-CQ84CrOG.js";import{V as D}from"./VRow-B94Tto0H.js";import{V as de}from"./VDataTableServer-CMLVDy59.js";import{p as E}from"./parseInt-Bzw_2rWL.js";import"./datetime-Dz9fjSvq.js";import"./VContainer-BfWqa_tJ.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-WkXOSlqa.js";import"./useAuditLogUtils-BqNOieoY.js";import"./VDataTable-Jd7io3gq.js";const Ee=j({__name:"CompetitionsView",props:{eventId:{}},setup(T){const p=T,{t}=q(),V=R(),O=z(G),u=H(),d=ae(),{getEventById:$}=ne(),r=P(()=>E(p.eventId,10)),c=l(!1),A=P(()=>[{title:$(r.value)?.name??"...",to:{name:"dashboard",params:{eventId:p.eventId}}},{title:t("CompetitionsView.title"),disabled:!0}]),h=[25,50,100],v=l(h[0]),w=l(0),B=l(1),y=l([]),m=l(""),f=l(null),L=[{title:t("CompetitionsView.headers.id"),sortable:!0,key:"id"},{title:t("CompetitionsView.headers.name"),sortable:!0,key:"name"},{title:t("CompetitionsView.headers.participationEnd"),sortable:!0,key:"participation_end"},{title:t("CompetitionsView.headers.start"),sortable:!0,key:"start"},{title:t("CompetitionsView.headers.end"),sortable:!0,key:"end"},{title:t("CompetitionsView.headers.active"),sortable:!1,key:"active"},{title:t("CompetitionsView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function N(){f.value&&_(f.value)}async function _(s){c.value=!0,f.value=s;try{const n=await ie({path:{event_pk:E(p.eventId,10)},query:{...me(s)}});y.value=n.data.results,w.value=n.data.count}catch(n){u.error(t("CompetitionsView.loadFailure")),console.error(n)}finally{c.value=!1}}const b=ue(_,250);function F(){m.value="",b({page:1,itemsPerPage:v.value??25,sortBy:[],groupBy:[],search:""})}J(r,F);async function U(s){const n=t("CompetitionsView.confirmDelete",s);await O.value.ifConfirmed(n,async()=>{try{await oe({path:{event_pk:r.value,id:s.id}}),u.success(t("CompetitionsView.deleteSuccess")),N()}catch(e){u.error(pe(e,t("CompetitionsView.deleteFailure"))),console.error(e)}})}function K(s){V.push({name:"competitions-edit",params:{eventId:r.value,id:s}})}function M(){V.push({name:"competitions-new",params:{eventId:r.value}})}return(s,n)=>(I(),k(le,{key:`competitions-${r.value}`,breadcrumbs:A.value},{default:o(()=>[i(x,null,{default:o(()=>[i(D,null,{default:o(()=>[a(d).canAdd(a(g).COMPETITION)?(I(),k(Q,{key:0,color:"primary",onClick:M},{prepend:o(()=>[i(a(Y),{icon:a(Z)},null,8,["icon"])]),default:o(()=>[W(" "+X(a(t)("CompetitionsView.newCompetition")),1)]),_:1})):ee("",!0),i(te,{modelValue:m.value,"onUpdate:modelValue":n[0]||(n[0]=e=>m.value=e),variant:"outlined",density:"compact",label:a(t)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),i(x,null,{default:o(()=>[i(D,null,{default:o(()=>[i(de,{"items-per-page":v.value,"onUpdate:itemsPerPage":n[1]||(n[1]=e=>v.value=e),class:"elevation-1 primary","item-value":"id",density:"compact",headers:L,items:y.value,"items-length":w.value,loading:c.value,search:m.value,page:B.value,"items-per-page-options":h,"no-data-text":a(t)("CompetitionsView.noCompetitionsFound"),"loading-text":a(t)("CompetitionsView.loadingCompetitions"),"onUpdate:options":a(b)},{"item.active":o(({item:e})=>[i(se,{value:e.active},null,8,["value"])]),"item.participation_end":o(({item:e})=>[i(C,{value:e.participation_end},null,8,["value"])]),"item.start":o(({item:e})=>[i(C,{value:e.start},null,8,["value"])]),"item.end":o(({item:e})=>[i(C,{value:e.end},null,8,["value"])]),"item.actions":o(({item:e})=>[i(re,{"can-edit":a(d).canChange(a(g).COMPETITION),"can-delete":a(d).canDelete(a(g).COMPETITION),"audit-log":{appLabel:"kompomaatti",model:"competition",objectPk:e.id},onEdit:S=>K(e.id),onDelete:S=>U(e)},null,8,["can-edit","can-delete","audit-log","onEdit","onDelete"])]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Ee as default};
//# sourceMappingURL=CompetitionsView-B77jt7ZR.js.map
