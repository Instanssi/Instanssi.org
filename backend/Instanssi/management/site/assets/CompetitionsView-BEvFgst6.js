import{d as j,a as q,u as G,H as R,I as z,v as H,Z as J,b as I,g as k,w as o,e as i,j as a,P as g,V as Z,i as Q,t as W,k as X,J as Y,K as ee,m as te,q as ae,G as E,s as l,aE as oe,aF as ie,E as ne}from"./index-qrfwdmHz.js";import{_ as se}from"./BooleanIcon.vue_vue_type_script_setup_true_lang-BztPFn-1.js";import{_ as C}from"./DateTimeCell.vue_vue_type_script_setup_true_lang-DEE2ektI.js";import{V as x,_ as le}from"./LayoutBase.vue_vue_type_script_setup_true_lang-Cgp8Musd.js";import{_ as re}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-B6FHDr2a.js";import{d as me,V as ue,g as pe}from"./query_tools-Ch1hnqwl.js";import{g as de}from"./http-Cqy_sGiB.js";import{V as P}from"./VRow-EkiCBxID.js";import{p as T}from"./parseInt-CGa1F4cm.js";import"./datetime-DsxOZgAd.js";import"./classApi-bnmGQydb.js";import"./VContainer-e74dHNZG.js";import"./VDataTable-BIkGv4dg.js";import"./filter-50Rnsb7m.js";const xe=j({__name:"CompetitionsView",props:{eventId:{}},setup(D){const u=D,{t}=q(),V=G(),O=R(z),p=H(),d=ae(),{getEventById:$}=ne(),r=E(()=>T(u.eventId,10)),c=l(!1),A=E(()=>[{title:$(r.value)?.name??"...",to:{name:"dashboard",params:{eventId:u.eventId}}},{title:t("CompetitionsView.title"),disabled:!0}]),h=[25,50,100],v=l(h[0]),w=l(0),B=l(1),y=l([]),m=l(""),f=l(null),F=[{title:t("CompetitionsView.headers.id"),sortable:!0,key:"id"},{title:t("CompetitionsView.headers.name"),sortable:!0,key:"name"},{title:t("CompetitionsView.headers.participationEnd"),sortable:!0,key:"participation_end"},{title:t("CompetitionsView.headers.start"),sortable:!0,key:"start"},{title:t("CompetitionsView.headers.end"),sortable:!0,key:"end"},{title:t("CompetitionsView.headers.active"),sortable:!1,key:"active"},{title:t("CompetitionsView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function N(){f.value&&_(f.value)}async function _(s){c.value=!0,f.value=s;try{const n=await ie({path:{event_pk:T(u.eventId,10)},query:{...pe(s)}});y.value=n.data.results,w.value=n.data.count}catch(n){p.error(t("CompetitionsView.loadFailure")),console.error(n)}finally{c.value=!1}}const b=me(_,250);function K(){m.value="",b({page:1,itemsPerPage:v.value??25,sortBy:[],groupBy:[],search:""})}J(r,K);async function L(s){const n=t("CompetitionsView.confirmDelete",s);await O.value.ifConfirmed(n,async()=>{try{await oe({path:{event_pk:r.value,id:s.id}}),p.success(t("CompetitionsView.deleteSuccess")),N()}catch(e){p.error(de(e,t("CompetitionsView.deleteFailure"))),console.error(e)}})}function M(s){V.push({name:"competitions-edit",params:{eventId:r.value,id:s}})}function S(){V.push({name:"competitions-new",params:{eventId:r.value}})}return(s,n)=>(I(),k(le,{key:`competitions-${r.value}`,breadcrumbs:A.value},{default:o(()=>[i(x,null,{default:o(()=>[i(P,null,{default:o(()=>[a(d).canAdd(a(g).COMPETITION)?(I(),k(Z,{key:0,onClick:S},{prepend:o(()=>[i(a(X),{icon:a(Y)},null,8,["icon"])]),default:o(()=>[Q(" "+W(a(t)("CompetitionsView.newCompetition")),1)]),_:1})):ee("",!0),i(te,{modelValue:m.value,"onUpdate:modelValue":n[0]||(n[0]=e=>m.value=e),variant:"outlined",density:"compact",label:a(t)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),i(x,null,{default:o(()=>[i(P,null,{default:o(()=>[i(ue,{"items-per-page":v.value,"onUpdate:itemsPerPage":n[1]||(n[1]=e=>v.value=e),class:"elevation-1 primary","item-value":"id",density:"compact",headers:F,items:y.value,"items-length":w.value,loading:c.value,search:m.value,page:B.value,"items-per-page-options":h,"no-data-text":a(t)("CompetitionsView.noCompetitionsFound"),"loading-text":a(t)("CompetitionsView.loadingCompetitions"),"onUpdate:options":a(b)},{"item.active":o(({item:e})=>[i(se,{value:e.active},null,8,["value"])]),"item.participation_end":o(({item:e})=>[i(C,{value:e.participation_end},null,8,["value"])]),"item.start":o(({item:e})=>[i(C,{value:e.start},null,8,["value"])]),"item.end":o(({item:e})=>[i(C,{value:e.end},null,8,["value"])]),"item.actions":o(({item:e})=>[i(re,{"can-edit":a(d).canChange(a(g).COMPETITION),"can-delete":a(d).canDelete(a(g).COMPETITION),onEdit:U=>M(e.id),onDelete:U=>L(e)},null,8,["can-edit","can-delete","onEdit","onDelete"])]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{xe as default};
//# sourceMappingURL=CompetitionsView-BEvFgst6.js.map
