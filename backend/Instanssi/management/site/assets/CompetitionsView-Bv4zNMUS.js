import{d as U,a as j,u as q,H as G,I as R,v as z,b,g as I,w as o,e as i,j as a,P as f,V as H,i as J,t as Q,k as W,J as X,K as Y,m as Z,q as ee,G as k,s as l,aE as te,aF as ae,E as oe}from"./index-BSHMv_df.js";import{_ as ie}from"./BooleanIcon.vue_vue_type_script_setup_true_lang-COcceYO8.js";import{_ as C}from"./DateTimeCell.vue_vue_type_script_setup_true_lang-CG8AjqQo.js";import{V as E,_ as ne}from"./LayoutBase.vue_vue_type_script_setup_true_lang-C8aKWyeJ.js";import{_ as se}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-DouyropJ.js";import{d as le,V as re,g as me}from"./query_tools-Co6bP9h2.js";import{g as de}from"./http-BZkoYM_m.js";import{V as x}from"./VRow-BUBfmFS3.js";import{p as T}from"./parseInt-3OpbdfxQ.js";import"./datetime-DsxOZgAd.js";import"./classApi-bnmGQydb.js";import"./VContainer--EpXOfw5.js";import"./VDataTable-CpUosGjF.js";import"./filter-C6Uu0LOB.js";const ke=U({__name:"CompetitionsView",props:{eventId:{}},setup(D){const m=D,{t}=j(),g=q(),P=G(R),d=z(),u=ee(),{getEventById:O}=oe(),r=k(()=>T(m.eventId,10)),p=l(!1),$=k(()=>[{title:O(r.value)?.name??"...",to:{name:"dashboard",params:{eventId:m.eventId}}},{title:t("CompetitionsView.title"),disabled:!0}]),V=[25,50,100],w=l(V[0]),_=l(0),A=l(1),h=l([]),c=l(""),v=l(null),F=[{title:t("CompetitionsView.headers.id"),sortable:!0,key:"id"},{title:t("CompetitionsView.headers.name"),sortable:!0,key:"name"},{title:t("CompetitionsView.headers.participationEnd"),sortable:!0,key:"participation_end"},{title:t("CompetitionsView.headers.start"),sortable:!0,key:"start"},{title:t("CompetitionsView.headers.end"),sortable:!0,key:"end"},{title:t("CompetitionsView.headers.active"),sortable:!1,key:"active"},{title:t("CompetitionsView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function N(){v.value&&y(v.value)}async function y(s){p.value=!0,v.value=s;try{const n=await ae({path:{event_pk:T(m.eventId,10)},query:{...me(s)}});h.value=n.data.results,_.value=n.data.count}catch(n){d.error(t("CompetitionsView.loadFailure")),console.error(n)}finally{p.value=!1}}const B=le(y,250);async function K(s){const n=t("CompetitionsView.confirmDelete",s);await P.value.ifConfirmed(n,async()=>{try{await te({path:{event_pk:r.value,id:s.id}}),d.success(t("CompetitionsView.deleteSuccess")),N()}catch(e){d.error(de(e,t("CompetitionsView.deleteFailure"))),console.error(e)}})}function L(s){g.push({name:"competitions-edit",params:{eventId:r.value,id:s}})}function M(){g.push({name:"competitions-new",params:{eventId:r.value}})}return(s,n)=>(b(),I(ne,{key:`competitions-${r.value}`,breadcrumbs:$.value},{default:o(()=>[i(E,null,{default:o(()=>[i(x,null,{default:o(()=>[a(u).canAdd(a(f).COMPETITION)?(b(),I(H,{key:0,onClick:M},{prepend:o(()=>[i(a(W),{icon:a(X)},null,8,["icon"])]),default:o(()=>[J(" "+Q(a(t)("CompetitionsView.newCompetition")),1)]),_:1})):Y("",!0),i(Z,{modelValue:c.value,"onUpdate:modelValue":n[0]||(n[0]=e=>c.value=e),variant:"outlined",density:"compact",label:a(t)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),i(E,null,{default:o(()=>[i(x,null,{default:o(()=>[i(re,{"items-per-page":w.value,"onUpdate:itemsPerPage":n[1]||(n[1]=e=>w.value=e),class:"elevation-1 primary","item-value":"id",density:"compact",headers:F,items:h.value,"items-length":_.value,loading:p.value,search:c.value,page:A.value,"items-per-page-options":V,"no-data-text":a(t)("CompetitionsView.noCompetitionsFound"),"loading-text":a(t)("CompetitionsView.loadingCompetitions"),"onUpdate:options":a(B)},{"item.active":o(({item:e})=>[i(ie,{value:e.active},null,8,["value"])]),"item.participation_end":o(({item:e})=>[i(C,{value:e.participation_end},null,8,["value"])]),"item.start":o(({item:e})=>[i(C,{value:e.start},null,8,["value"])]),"item.end":o(({item:e})=>[i(C,{value:e.end},null,8,["value"])]),"item.actions":o(({item:e})=>[i(se,{"can-edit":a(u).canChange(a(f).COMPETITION),"can-delete":a(u).canDelete(a(f).COMPETITION),onEdit:S=>L(e.id),onDelete:S=>K(e)},null,8,["can-edit","can-delete","onEdit","onDelete"])]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{ke as default};
//# sourceMappingURL=CompetitionsView-Bv4zNMUS.js.map
