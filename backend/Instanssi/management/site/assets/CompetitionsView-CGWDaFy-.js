import{d as R,a as j,u as q,J as z,K as G,v as H,L as _,b as I,g as k,w as n,e as s,j as e,P as V,V as J,i as Q,t as W,k as X,M as Y,D as Z,m as ee,N as te,O as ae,q as ie,I as x,s as p,aQ as oe,aR as se,H as ne}from"./index-CQkWvXOv.js";import{_ as le}from"./BooleanIcon.vue_vue_type_script_setup_true_lang-BUZkEwsX.js";import{_ as C}from"./DateTimeCell.vue_vue_type_script_setup_true_lang-DaLynL44.js";import{V as P,_ as re}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D5aCeQDf.js";import{_ as ue}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-DepTf6Bi.js";import{u as me,d as pe}from"./useTableState-CutuDm2i.js";import{g as de}from"./query_tools-BInV9OzK.js";import{g as ce}from"./http-CET7UDul.js";import{V as T}from"./VRow-CXIXhuhq.js";import{V as ve}from"./VDataTableServer-C6tuZDKn.js";import{p as O}from"./parseInt-BJ5A4_3y.js";import"./datetime-Dz9fjSvq.js";import"./VContainer-DqJ8gu3P.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-1MnYozFL.js";import"./useAuditLogUtils-BdjF9k7b.js";import"./VDataTable-f5_9vewM.js";const Ee=R({__name:"CompetitionsView",props:{eventId:{}},setup(D){const d=D,{t}=j(),y=q(),E=z(G),c=H(),v=ie(),{getEventById:B}=ne(),r=x(()=>O(d.eventId,10)),f=p(!1),S=x(()=>[{title:B(r.value)?.name??"...",to:{name:"dashboard",params:{eventId:d.eventId}}},{title:t("CompetitionsView.title"),disabled:!0}]),i=me({filterKeys:["active"]}),w=p(0),b=p([]),m=p(null),u=i.useBooleanFilter("active"),A=[{title:t("CompetitionsView.headers.id"),sortable:!0,key:"id"},{title:t("CompetitionsView.headers.name"),sortable:!0,key:"name"},{title:t("CompetitionsView.headers.participationEnd"),sortable:!0,key:"participation_end"},{title:t("CompetitionsView.headers.start"),sortable:!0,key:"start"},{title:t("CompetitionsView.headers.end"),sortable:!0,key:"end"},{title:t("CompetitionsView.headers.active"),sortable:!0,key:"active"},{title:t("CompetitionsView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function F(){m.value&&h(m.value)}async function h(l){f.value=!0,m.value=l;try{const o=await se({path:{event_pk:O(d.eventId,10)},query:{...de(l),...u.value!==null?{active:u.value}:{}}});b.value=o.data.results,w.value=o.data.count}catch(o){c.error(t("CompetitionsView.loadFailure")),console.error(o)}finally{f.value=!1}}const g=pe(h,250);_(u,()=>{m.value&&g({...m.value,page:1})});function N(l){i.onOptionsUpdate(l),g(l)}function $(){i.setFilter("active",null),i.search.value="",i.page.value=1,g({page:1,itemsPerPage:i.perPage.value??25,sortBy:[],groupBy:[],search:""})}_(r,$);async function L(l){const o=t("CompetitionsView.confirmDelete",l);await E.value.ifConfirmed(o,async()=>{try{await oe({path:{event_pk:r.value,id:l.id}}),c.success(t("CompetitionsView.deleteSuccess")),F()}catch(a){c.error(ce(a,t("CompetitionsView.deleteFailure"))),console.error(a)}})}function U(l){y.push({name:"competitions-edit",params:{eventId:r.value,id:l}})}function K(){y.push({name:"competitions-new",params:{eventId:r.value}})}return(l,o)=>(I(),k(re,{key:`competitions-${r.value}`,breadcrumbs:S.value},{default:n(()=>[s(P,null,{default:n(()=>[s(T,null,{default:n(()=>[e(v).canAdd(e(V).COMPETITION)?(I(),k(J,{key:0,color:"primary",onClick:K},{prepend:n(()=>[s(e(X),{icon:e(Y)},null,8,["icon"])]),default:n(()=>[Q(" "+W(e(t)("CompetitionsView.newCompetition")),1)]),_:1})):Z("",!0),s(ee,{modelValue:e(i).search.value,"onUpdate:modelValue":o[0]||(o[0]=a=>e(i).search.value=a),variant:"outlined",density:"compact",label:e(t)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"]),s(te,{modelValue:e(u),"onUpdate:modelValue":o[1]||(o[1]=a=>ae(u)?u.value=a:null),items:[{title:e(t)("CompetitionsView.allStatuses"),value:null},{title:e(t)("CompetitionsView.activeOnly"),value:!0},{title:e(t)("CompetitionsView.inactiveOnly"),value:!1}],variant:"outlined",density:"compact",label:e(t)("CompetitionsView.filterByStatus"),style:{"max-width":"200px"},class:"ma-0 pa-0 ml-4"},null,8,["modelValue","items","label"])]),_:1})]),_:1}),s(P,null,{default:n(()=>[s(T,null,{default:n(()=>[s(ve,{"items-per-page":e(i).perPage.value,"onUpdate:itemsPerPage":o[2]||(o[2]=a=>e(i).perPage.value=a),"sort-by":e(i).sortByArray.value,class:"elevation-1 primary","item-value":"id",density:"compact",headers:A,items:b.value,"items-length":w.value,loading:f.value,search:e(i).search.value,page:e(i).page.value,"items-per-page-options":e(i).pageSizeOptions,"no-data-text":e(t)("CompetitionsView.noCompetitionsFound"),"loading-text":e(t)("CompetitionsView.loadingCompetitions"),"onUpdate:options":N},{"item.active":n(({item:a})=>[s(le,{value:a.active},null,8,["value"])]),"item.participation_end":n(({item:a})=>[s(C,{value:a.participation_end},null,8,["value"])]),"item.start":n(({item:a})=>[s(C,{value:a.start},null,8,["value"])]),"item.end":n(({item:a})=>[s(C,{value:a.end},null,8,["value"])]),"item.actions":n(({item:a})=>[s(ue,{"can-edit":e(v).canChange(e(V).COMPETITION),"can-delete":e(v).canDelete(e(V).COMPETITION),"audit-log":{appLabel:"kompomaatti",model:"competition",objectPk:a.id},onEdit:M=>U(a.id),onDelete:M=>L(a)},null,8,["can-edit","can-delete","audit-log","onEdit","onDelete"])]),_:1},8,["items-per-page","sort-by","items","items-length","loading","search","page","items-per-page-options","no-data-text","loading-text"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Ee as default};
//# sourceMappingURL=CompetitionsView-CGWDaFy-.js.map
