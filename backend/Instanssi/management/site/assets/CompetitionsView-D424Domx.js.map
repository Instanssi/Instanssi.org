{"version":3,"file":"CompetitionsView-D424Domx.js","sources":["../../../../../admin/src/views/kompomaatti/CompetitionsView.vue"],"sourcesContent":["<template>\n    <LayoutBase :key=\"`competitions-${eventId}`\" :breadcrumbs=\"breadcrumbs\">\n        <v-col>\n            <v-row>\n                <v-btn v-if=\"auth.canAdd(PermissionTarget.COMPETITION)\" @click=\"createCompetition\">\n                    <template #prepend>\n                        <FontAwesomeIcon :icon=\"faPlus\" />\n                    </template>\n                    {{ t(\"CompetitionsView.newCompetition\") }}\n                </v-btn>\n                <v-text-field\n                    v-model=\"search\"\n                    variant=\"outlined\"\n                    density=\"compact\"\n                    :label=\"t('General.search')\"\n                    style=\"max-width: 400px\"\n                    class=\"ma-0 pa-0 ml-4\"\n                    clearable\n                />\n            </v-row>\n        </v-col>\n        <v-col>\n            <v-row>\n                <v-data-table-server\n                    v-model:items-per-page=\"perPage\"\n                    class=\"elevation-1 primary\"\n                    item-value=\"id\"\n                    density=\"compact\"\n                    :headers=\"headers\"\n                    :items=\"competitions\"\n                    :items-length=\"totalItems\"\n                    :loading=\"loading\"\n                    :search=\"search\"\n                    :page=\"currentPage\"\n                    :items-per-page-options=\"pageSizeOptions\"\n                    :no-data-text=\"t('CompetitionsView.noCompetitionsFound')\"\n                    :loading-text=\"t('CompetitionsView.loadingCompetitions')\"\n                    @update:options=\"debouncedLoad\"\n                >\n                    <template #item.active=\"{ item }\">\n                        <BooleanIcon :value=\"item.active\" />\n                    </template>\n                    <template #item.participation_end=\"{ item }\">\n                        <DateTimeCell :value=\"item.participation_end\" />\n                    </template>\n                    <template #item.start=\"{ item }\">\n                        <DateTimeCell :value=\"item.start\" />\n                    </template>\n                    <template #item.end=\"{ item }\">\n                        <DateTimeCell :value=\"item.end\" />\n                    </template>\n                    <template #item.actions=\"{ item }\">\n                        <TableActionButtons\n                            :can-edit=\"auth.canChange(PermissionTarget.COMPETITION)\"\n                            :can-delete=\"auth.canDelete(PermissionTarget.COMPETITION)\"\n                            @edit=\"editCompetition(item.id)\"\n                            @delete=\"deleteCompetition(item)\"\n                        />\n                    </template>\n                </v-data-table-server>\n            </v-row>\n        </v-col>\n    </LayoutBase>\n</template>\n\n<script setup lang=\"ts\">\nimport { faPlus } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/vue-fontawesome\";\nimport { debounce, parseInt } from \"lodash-es\";\nimport { type Ref, computed, inject, ref, watch } from \"vue\";\nimport { useI18n } from \"vue-i18n\";\nimport { useRouter } from \"vue-router\";\nimport { useToast } from \"vue-toastification\";\nimport type { VDataTableServer, VDataTable } from \"vuetify/components\";\n\nimport * as api from \"@/api\";\nimport type { Competition } from \"@/api\";\nimport BooleanIcon from \"@/components/table/BooleanIcon.vue\";\nimport DateTimeCell from \"@/components/table/DateTimeCell.vue\";\nimport LayoutBase, { type BreadcrumbItem } from \"@/components/layout/LayoutBase.vue\";\nimport TableActionButtons from \"@/components/table/TableActionButtons.vue\";\nimport { PermissionTarget, useAuth } from \"@/services/auth\";\nimport { useEvents } from \"@/services/events\";\nimport { type LoadArgs, getLoadArgs } from \"@/services/utils/query_tools\";\nimport { confirmDialogKey } from \"@/symbols\";\nimport type { ConfirmDialogType } from \"@/symbols\";\nimport { getApiErrorMessage } from \"@/utils/http\";\n\ntype ReadonlyHeaders = VDataTable[\"$props\"][\"headers\"];\n\nconst props = defineProps<{ eventId: string }>();\nconst { t } = useI18n();\nconst router = useRouter();\nconst confirmDialog: ConfirmDialogType = inject(confirmDialogKey)!;\nconst toast = useToast();\nconst auth = useAuth();\nconst { getEventById } = useEvents();\nconst eventId = computed(() => parseInt(props.eventId, 10));\nconst loading = ref(false);\n\nconst breadcrumbs = computed<BreadcrumbItem[]>(() => [\n    {\n        title: getEventById(eventId.value)?.name ?? \"...\",\n        to: { name: \"dashboard\", params: { eventId: props.eventId } },\n    },\n    { title: t(\"CompetitionsView.title\"), disabled: true },\n]);\nconst pageSizeOptions = [25, 50, 100];\nconst perPage = ref(pageSizeOptions[0]);\nconst totalItems = ref(0);\nconst currentPage = ref(1);\nconst competitions: Ref<Competition[]> = ref([]);\nconst search = ref(\"\");\nconst lastLoadArgs: Ref<LoadArgs | null> = ref(null);\nconst headers: ReadonlyHeaders = [\n    {\n        title: t(\"CompetitionsView.headers.id\"),\n        sortable: true,\n        key: \"id\",\n    },\n    {\n        title: t(\"CompetitionsView.headers.name\"),\n        sortable: true,\n        key: \"name\",\n    },\n    {\n        title: t(\"CompetitionsView.headers.participationEnd\"),\n        sortable: true,\n        key: \"participation_end\",\n    },\n    {\n        title: t(\"CompetitionsView.headers.start\"),\n        sortable: true,\n        key: \"start\",\n    },\n    {\n        title: t(\"CompetitionsView.headers.end\"),\n        sortable: true,\n        key: \"end\",\n    },\n    {\n        title: t(\"CompetitionsView.headers.active\"),\n        sortable: false,\n        key: \"active\",\n    },\n    {\n        title: t(\"CompetitionsView.headers.actions\"),\n        sortable: false,\n        key: \"actions\",\n        align: \"end\",\n    },\n];\n\nfunction flushData() {\n    if (lastLoadArgs.value) {\n        load(lastLoadArgs.value);\n    }\n}\n\nasync function load(args: LoadArgs) {\n    loading.value = true;\n    lastLoadArgs.value = args;\n    try {\n        const response = await api.adminEventKompomaattiCompetitionsList({\n            path: { event_pk: parseInt(props.eventId, 10) },\n            query: {\n                ...getLoadArgs(args),\n            },\n        });\n        competitions.value = response.data!.results;\n        totalItems.value = response.data!.count;\n    } catch (e) {\n        toast.error(t(\"CompetitionsView.loadFailure\"));\n        console.error(e);\n    } finally {\n        loading.value = false;\n    }\n}\n\nconst debouncedLoad = debounce(load, 250);\n\nfunction refresh() {\n    search.value = \"\";\n    debouncedLoad({\n        page: 1,\n        itemsPerPage: perPage.value ?? 25,\n        sortBy: [],\n        groupBy: [] as never,\n        search: \"\",\n    });\n}\n\n// Reload when event changes\nwatch(eventId, refresh);\n\nasync function deleteCompetition(item: Competition): Promise<void> {\n    const text = t(\"CompetitionsView.confirmDelete\", item);\n    await confirmDialog.value!.ifConfirmed(text, async () => {\n        try {\n            await api.adminEventKompomaattiCompetitionsDestroy({\n                path: { event_pk: eventId.value, id: item.id },\n            });\n            toast.success(t(\"CompetitionsView.deleteSuccess\"));\n            flushData();\n        } catch (e) {\n            toast.error(getApiErrorMessage(e, t(\"CompetitionsView.deleteFailure\")));\n            console.error(e);\n        }\n    });\n}\n\nfunction editCompetition(id: number): void {\n    router.push({ name: \"competitions-edit\", params: { eventId: eventId.value, id } });\n}\n\nfunction createCompetition(): void {\n    router.push({ name: \"competitions-new\", params: { eventId: eventId.value } });\n}\n</script>\n"],"names":["props","__props","useI18n","router","useRouter","confirmDialog","inject","confirmDialogKey","toast","useToast","auth","useAuth","getEventById","useEvents","eventId","computed","parseInt","loading","ref","breadcrumbs","pageSizeOptions","perPage","totalItems","currentPage","competitions","search","lastLoadArgs","headers","flushData","load","args","response","api.adminEventKompomaattiCompetitionsList","getLoadArgs","e","debouncedLoad","debounce","refresh","watch","deleteCompetition","item","text","api.adminEventKompomaattiCompetitionsDestroy","getApiErrorMessage","editCompetition","id","createCompetition","_createBlock","LayoutBase","_createVNode","_component_v_col","_component_v_row","_unref","PermissionTarget","_component_v_btn","FontAwesomeIcon","faPlus","_createTextVNode","_component_v_text_field","$event","_component_v_data_table_server","_withCtx","BooleanIcon","DateTimeCell","TableActionButtons"],"mappings":"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"}