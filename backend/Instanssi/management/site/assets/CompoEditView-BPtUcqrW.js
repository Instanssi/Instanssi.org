import{d as Ne,a as $e,u as qe,v as De,ar as Le,as as Je,o as Qe,at as We,aa as Xe,b as w,g as I,w as r,e as l,A as Ye,p as Ze,B as et,l as tt,j as e,m as v,c as ot,t as d,D as Ee,i as f,f as he,N as P,au as ye,av as _e,aw as Ce,ax as Fe,C as at,E as lt,V as Se,k as it,G as rt,s as E,I as m,H as st}from"./index-CQkWvXOv.js";import{c as nt,d as h,g as T,a as u,u as mt,b as s}from"./index.esm-aFENq7CA.js";import{_ as ut}from"./AuditLogButton.vue_vue_type_script_setup_true_lang-DHg2h5we.js";import{F as x}from"./FormSection-Drw9hFWe.js";import{V as n,_ as dt}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D5aCeQDf.js";import{_ as y}from"./ToggleSwitch.vue_vue_type_script_setup_true_lang-C_s5Zpn8.js";import{t as _,a as C}from"./datetime-Dz9fjSvq.js";import{h as ze}from"./http-CET7UDul.js";import{p as oe}from"./parseInt-BJ5A4_3y.js";import{V as pt}from"./VForm-VvaADaOh.js";import{V as F}from"./VRow-CXIXhuhq.js";import{V as ae}from"./VCombobox-DcsTuhvs.js";import"./_commonjsHelpers-CqkleIqs.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-1MnYozFL.js";import"./useAuditLogUtils-BdjF9k7b.js";import"./DateTimeCell.vue_vue_type_script_setup_true_lang-DaLynL44.js";import"./VDataTableServer-C6tuZDKn.js";import"./VDataTable-f5_9vewM.js";import"./VContainer-DqJ8gu3P.js";import"./VSwitch-JF6EcneO.js";const vt={key:0,class:"text-error text-caption mb-4"},ft={class:"d-flex ga-2"},ct={class:"d-flex ga-2"},At=Ne({__name:"CompoEditView",props:{eventId:{},id:{}},setup(Me){const le={name:"name",description:"description",adding_end:"addingEnd",editing_end:"editingEnd",compo_start:"compoStart",voting_start:"votingStart",voting_end:"votingEnd",entry_sizelimit:"entrySizelimit",source_sizelimit:"sourceSizelimit",formats:"formats",source_formats:"sourceFormats",image_formats:"imageFormats",active:"active",show_voting_results:"showVotingResults",is_votable:"isVotable",entry_view_type:"entryViewType",thumbnail_pref:"thumbnailPref",hide_from_archive:"hideFromArchive",hide_from_frontpage:"hideFromFrontpage"},p=Me,{t:a}=$e(),Be=qe(),c=De(),{getEventById:Ue}=st(),A=E(!1),k=E(!1),ie=E(""),S=m(()=>oe(p.eventId,10)),z=m(()=>p.id!==void 0),Oe=m(()=>{const o=[{title:Ue(S.value)?.name??"...",to:{name:"dashboard",params:{eventId:p.eventId}}},{title:a("ComposView.title"),to:{name:"compos",params:{eventId:p.eventId}}}];return z.value?o.push({title:ie.value||"...",disabled:!0}):o.push({title:a("Breadcrumbs.newCompo"),disabled:!0}),o}),Ie=[{title:a("CompoEditView.entryViewTypes.0.title"),description:a("CompoEditView.entryViewTypes.0.description"),value:0},{title:a("CompoEditView.entryViewTypes.1.title"),description:a("CompoEditView.entryViewTypes.1.description"),value:1},{title:a("CompoEditView.entryViewTypes.2.title"),description:a("CompoEditView.entryViewTypes.2.description"),value:2}],Pe=[{title:a("CompoEditView.thumbnailPrefs.0.title"),description:a("CompoEditView.thumbnailPrefs.0.description"),value:0},{title:a("CompoEditView.thumbnailPrefs.1.title"),description:a("CompoEditView.thumbnailPrefs.1.description"),value:1},{title:a("CompoEditView.thumbnailPrefs.2.title"),description:a("CompoEditView.thumbnailPrefs.2.description"),value:2},{title:a("CompoEditView.thumbnailPrefs.3.title"),description:a("CompoEditView.thumbnailPrefs.3.description"),value:3}],re=["B","KB","MB","GB"],V={B:1,KB:1024,MB:1024*1024,GB:1024*1024*1024},g=E("MB"),b=E("MB");function se(o,t){return o==null?null:Math.round(o/V[t]*100)/100}function ne(o,t){return o==null?null:Math.round(o*V[t])}function me(o){return o==null||o===0?"MB":o>=V.GB?"GB":o>=V.MB?"MB":o>=V.KB?"KB":"B"}const ue=m({get:()=>se($.value.value,g.value),set:o=>{$.value.value=ne(o,g.value)}}),de=m({get:()=>se(q.value.value,b.value),set:o=>{q.value.value=ne(o,b.value)}}),Te=["zip","7z","rar","tar.gz","exe","com","prg","d64","sid"],xe=["zip","7z","rar","tar.gz"],Ae=["png","jpg","jpeg","gif","webp","bmp"],pe=m({get:()=>B.value.value?B.value.value.split("|").filter(Boolean):[],set:o=>{B.value.value=o.join("|")}}),ve=m({get:()=>U.value.value?U.value.value.split("|").filter(Boolean):[],set:o=>{U.value.value=o.join("|")}}),fe=m({get:()=>O.value.value?O.value.value.split("|").filter(Boolean):[],set:o=>{O.value.value=o.join("|")}}),ke=nt({name:u().required().min(1).max(32),description:u(),addingEnd:u().required(),editingEnd:u().required(),compoStart:u().required(),votingStart:u().required(),votingEnd:u().required(),entrySizelimit:T().nullable(),sourceSizelimit:T().nullable(),formats:u(),sourceFormats:u(),imageFormats:u(),active:h(),showVotingResults:h(),isVotable:h(),entryViewType:T(),thumbnailPref:T(),hideFromArchive:h(),hideFromFrontpage:h()}),{handleSubmit:Re,setValues:He,setErrors:ce,meta:je}=mt({validationSchema:ke,initialValues:{name:"",description:"",addingEnd:"",editingEnd:"",compoStart:"",votingStart:"",votingEnd:"",entrySizelimit:null,sourceSizelimit:null,formats:"",sourceFormats:"",imageFormats:"",active:!0,showVotingResults:!1,isVotable:!0,entryViewType:0,thumbnailPref:0,hideFromArchive:!1,hideFromFrontpage:!1}}),R=s("name"),M=s("description"),H=s("addingEnd"),j=s("editingEnd"),G=s("compoStart"),K=s("votingStart"),N=s("votingEnd"),$=s("entrySizelimit"),q=s("sourceSizelimit"),B=s("formats"),U=s("sourceFormats"),O=s("imageFormats"),D=s("active"),L=s("showVotingResults"),J=s("isVotable"),Q=s("entryViewType"),W=s("thumbnailPref"),X=s("hideFromArchive"),Y=s("hideFromFrontpage"),Ve=m({get:()=>!X.value.value,set:o=>{X.value.value=!o}}),ge=m({get:()=>!Y.value.value,set:o=>{Y.value.value=!o}}),be=Re(async o=>{k.value=!0;let t;z.value?t=await Ke(oe(p.id,10),o):t=await Ge(o),k.value=!1,t&&Z()});function we(o){return{name:o.name,description:o.description||"",adding_end:C(o.addingEnd),editing_end:C(o.editingEnd),compo_start:C(o.compoStart),voting_start:C(o.votingStart),voting_end:C(o.votingEnd),entry_sizelimit:o.entrySizelimit,source_sizelimit:o.sourceSizelimit,formats:o.formats||"",source_formats:o.sourceFormats||"",image_formats:o.imageFormats||"",active:o.active,show_voting_results:o.showVotingResults,is_votable:o.isVotable,entry_view_type:o.entryViewType,thumbnail_pref:o.thumbnailPref,hide_from_archive:o.hideFromArchive,hide_from_frontpage:o.hideFromFrontpage}}async function Ge(o){try{return await Le({path:{event_pk:S.value},body:we(o)}),c.success(a("CompoEditView.createSuccess")),!0}catch(t){ze(t,ce,c,a("CompoEditView.createFailure"),le)}return!1}async function Ke(o,t){try{return await Je({path:{event_pk:S.value,id:o},body:we(t)}),c.success(a("CompoEditView.editSuccess")),!0}catch(ee){ze(ee,ce,c,a("CompoEditView.editFailure"),le)}return!1}function Z(){Be.push({name:"compos",params:{eventId:p.eventId}})}return Qe(async()=>{if(z.value){A.value=!0;try{const t=(await We({path:{event_pk:S.value,id:oe(p.id,10)}})).data;ie.value=t.name,g.value=me(t.entry_sizelimit??null),b.value=me(t.source_sizelimit??null),He({name:t.name,description:t.description??"",addingEnd:_(t.adding_end),editingEnd:_(t.editing_end),compoStart:_(t.compo_start),votingStart:_(t.voting_start),votingEnd:_(t.voting_end),entrySizelimit:t.entry_sizelimit??null,sourceSizelimit:t.source_sizelimit??null,formats:t.formats??"",sourceFormats:t.source_formats??"",imageFormats:t.image_formats??"",active:t.active??!0,showVotingResults:t.show_voting_results??!1,isVotable:t.is_votable??!0,entryViewType:t.entry_view_type??0,thumbnailPref:t.thumbnail_pref??0,hideFromArchive:t.hide_from_archive??!1,hideFromFrontpage:t.hide_from_frontpage??!1})}catch(o){c.error(a("CompoEditView.loadFailure")),console.error(o),Z()}finally{A.value=!1}}}),(o,t)=>{const ee=Xe("VuetifyTiptap");return w(),I(dt,{breadcrumbs:Oe.value},{default:r(()=>[A.value?(w(),I(n,{key:0,class:"d-flex justify-center my-8"},{default:r(()=>[l(Ye,{indeterminate:"",size:"64"})]),_:1})):(w(),I(n,{key:1},{default:r(()=>[l(Ze,null,{default:r(()=>[l(et,null,{default:r(()=>[l(pt,{onSubmit:tt(e(be),["prevent"])},{default:r(()=>[l(v,{modelValue:e(R).value.value,"onUpdate:modelValue":t[0]||(t[0]=i=>e(R).value.value=i),"error-messages":e(R).errorMessage.value,variant:"outlined",label:e(a)("CompoEditView.labels.name")+" *"},null,8,["modelValue","error-messages","label"]),l(ee,{modelValue:e(M).value.value,"onUpdate:modelValue":t[1]||(t[1]=i=>e(M).value.value=i)},null,8,["modelValue"]),e(M).errorMessage.value?(w(),ot("div",vt,d(e(M).errorMessage.value),1)):Ee("",!0),l(x,null,{default:r(()=>[f(d(e(a)("CompoEditView.sections.schedule")),1)]),_:1}),l(F,null,{default:r(()=>[l(n,{cols:"12",md:"6"},{default:r(()=>[l(v,{modelValue:e(H).value.value,"onUpdate:modelValue":t[2]||(t[2]=i=>e(H).value.value=i),type:"datetime-local","error-messages":e(H).errorMessage.value,variant:"outlined",label:e(a)("CompoEditView.labels.addingEnd")+" *"},null,8,["modelValue","error-messages","label"])]),_:1}),l(n,{cols:"12",md:"6"},{default:r(()=>[l(v,{modelValue:e(j).value.value,"onUpdate:modelValue":t[3]||(t[3]=i=>e(j).value.value=i),type:"datetime-local","error-messages":e(j).errorMessage.value,variant:"outlined",label:e(a)("CompoEditView.labels.editingEnd")+" *"},null,8,["modelValue","error-messages","label"])]),_:1})]),_:1}),l(F,null,{default:r(()=>[l(n,{cols:"12",md:"4"},{default:r(()=>[l(v,{modelValue:e(G).value.value,"onUpdate:modelValue":t[4]||(t[4]=i=>e(G).value.value=i),type:"datetime-local","error-messages":e(G).errorMessage.value,variant:"outlined",label:e(a)("CompoEditView.labels.compoStart")+" *"},null,8,["modelValue","error-messages","label"])]),_:1}),l(n,{cols:"12",md:"4"},{default:r(()=>[l(v,{modelValue:e(K).value.value,"onUpdate:modelValue":t[5]||(t[5]=i=>e(K).value.value=i),type:"datetime-local","error-messages":e(K).errorMessage.value,variant:"outlined",label:e(a)("CompoEditView.labels.votingStart")+" *"},null,8,["modelValue","error-messages","label"])]),_:1}),l(n,{cols:"12",md:"4"},{default:r(()=>[l(v,{modelValue:e(N).value.value,"onUpdate:modelValue":t[6]||(t[6]=i=>e(N).value.value=i),type:"datetime-local","error-messages":e(N).errorMessage.value,variant:"outlined",label:e(a)("CompoEditView.labels.votingEnd")+" *"},null,8,["modelValue","error-messages","label"])]),_:1})]),_:1}),l(x,null,{default:r(()=>[f(d(e(a)("CompoEditView.sections.fileSettings")),1)]),_:1}),l(F,null,{default:r(()=>[l(n,{cols:"12",md:"6"},{default:r(()=>[he("div",ft,[l(v,{modelValue:ue.value,"onUpdate:modelValue":t[7]||(t[7]=i=>ue.value=i),modelModifiers:{number:!0},type:"number",min:"0","error-messages":e($).errorMessage.value,variant:"outlined",label:e(a)("CompoEditView.labels.entrySizelimit"),class:"flex-grow-1"},null,8,["modelValue","error-messages","label"]),l(P,{modelValue:g.value,"onUpdate:modelValue":t[8]||(t[8]=i=>g.value=i),items:re,variant:"outlined",style:{"max-width":"100px"}},null,8,["modelValue"])])]),_:1}),l(n,{cols:"12",md:"6"},{default:r(()=>[he("div",ct,[l(v,{modelValue:de.value,"onUpdate:modelValue":t[9]||(t[9]=i=>de.value=i),modelModifiers:{number:!0},type:"number",min:"0","error-messages":e(q).errorMessage.value,variant:"outlined",label:e(a)("CompoEditView.labels.sourceSizelimit"),class:"flex-grow-1"},null,8,["modelValue","error-messages","label"]),l(P,{modelValue:b.value,"onUpdate:modelValue":t[10]||(t[10]=i=>b.value=i),items:re,variant:"outlined",style:{"max-width":"100px"}},null,8,["modelValue"])])]),_:1})]),_:1}),l(F,null,{default:r(()=>[l(n,{cols:"12",md:"4"},{default:r(()=>[l(ae,{modelValue:pe.value,"onUpdate:modelValue":t[11]||(t[11]=i=>pe.value=i),items:Te,"error-messages":e(B).errorMessage.value,variant:"outlined",label:e(a)("CompoEditView.labels.formats"),multiple:"",chips:"","closable-chips":""},null,8,["modelValue","error-messages","label"])]),_:1}),l(n,{cols:"12",md:"4"},{default:r(()=>[l(ae,{modelValue:ve.value,"onUpdate:modelValue":t[12]||(t[12]=i=>ve.value=i),items:xe,"error-messages":e(U).errorMessage.value,variant:"outlined",label:e(a)("CompoEditView.labels.sourceFormats"),multiple:"",chips:"","closable-chips":""},null,8,["modelValue","error-messages","label"])]),_:1}),l(n,{cols:"12",md:"4"},{default:r(()=>[l(ae,{modelValue:fe.value,"onUpdate:modelValue":t[13]||(t[13]=i=>fe.value=i),items:Ae,"error-messages":e(O).errorMessage.value,variant:"outlined",label:e(a)("CompoEditView.labels.imageFormats"),multiple:"",chips:"","closable-chips":""},null,8,["modelValue","error-messages","label"])]),_:1})]),_:1}),l(x,null,{default:r(()=>[f(d(e(a)("CompoEditView.sections.displaySettings")),1)]),_:1}),l(F,null,{default:r(()=>[l(n,{cols:"12",md:"6"},{default:r(()=>[l(P,{modelValue:e(Q).value.value,"onUpdate:modelValue":t[14]||(t[14]=i=>e(Q).value.value=i),modelModifiers:{number:!0},items:Ie,"error-messages":e(Q).errorMessage.value,variant:"outlined",label:e(a)("CompoEditView.labels.entryViewType")},{item:r(({props:i,item:te})=>[l(ye,_e(Ce(i)),{default:r(()=>[l(Fe,null,{default:r(()=>[f(d(te.raw.description),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","error-messages","label"])]),_:1}),l(n,{cols:"12",md:"6"},{default:r(()=>[l(P,{modelValue:e(W).value.value,"onUpdate:modelValue":t[15]||(t[15]=i=>e(W).value.value=i),modelModifiers:{number:!0},items:Pe,"error-messages":e(W).errorMessage.value,variant:"outlined",label:e(a)("CompoEditView.labels.thumbnailPref")},{item:r(({props:i,item:te})=>[l(ye,_e(Ce(i)),{default:r(()=>[l(Fe,null,{default:r(()=>[f(d(te.raw.description),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","error-messages","label"])]),_:1})]),_:1}),l(x,null,{default:r(()=>[f(d(e(a)("CompoEditView.sections.visibility")),1)]),_:1}),l(y,{modelValue:e(D).value.value,"onUpdate:modelValue":t[16]||(t[16]=i=>e(D).value.value=i),"error-message":e(D).errorMessage.value,"label-on":e(a)("CompoEditView.labels.activeOn"),"label-off":e(a)("CompoEditView.labels.activeOff"),"hint-on":e(a)("CompoEditView.labels.activeHintOn"),"hint-off":e(a)("CompoEditView.labels.activeHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"]),l(y,{modelValue:e(J).value.value,"onUpdate:modelValue":t[17]||(t[17]=i=>e(J).value.value=i),"error-message":e(J).errorMessage.value,"label-on":e(a)("CompoEditView.labels.isVotableOn"),"label-off":e(a)("CompoEditView.labels.isVotableOff"),"hint-on":e(a)("CompoEditView.labels.isVotableHintOn"),"hint-off":e(a)("CompoEditView.labels.isVotableHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"]),l(y,{modelValue:e(L).value.value,"onUpdate:modelValue":t[18]||(t[18]=i=>e(L).value.value=i),"error-message":e(L).errorMessage.value,"label-on":e(a)("CompoEditView.labels.showVotingResultsOn"),"label-off":e(a)("CompoEditView.labels.showVotingResultsOff"),"hint-on":e(a)("CompoEditView.labels.showVotingResultsHintOn"),"hint-off":e(a)("CompoEditView.labels.showVotingResultsHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"]),l(y,{modelValue:Ve.value,"onUpdate:modelValue":t[19]||(t[19]=i=>Ve.value=i),"error-message":e(X).errorMessage.value,"label-on":e(a)("CompoEditView.labels.hideFromArchiveOff"),"label-off":e(a)("CompoEditView.labels.hideFromArchiveOn"),"hint-on":e(a)("CompoEditView.labels.hideFromArchiveHintOn"),"hint-off":e(a)("CompoEditView.labels.hideFromArchiveHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"]),l(y,{modelValue:ge.value,"onUpdate:modelValue":t[20]||(t[20]=i=>ge.value=i),"error-message":e(Y).errorMessage.value,"label-on":e(a)("CompoEditView.labels.hideFromFrontpageOff"),"label-off":e(a)("CompoEditView.labels.hideFromFrontpageOn"),"hint-on":e(a)("CompoEditView.labels.hideFromFrontpageHintOn"),"hint-off":e(a)("CompoEditView.labels.hideFromFrontpageHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"])]),_:1},8,["onSubmit"])]),_:1}),l(at,{class:"justify-end"},{default:r(()=>[z.value?(w(),I(ut,{key:0,"app-label":"kompomaatti",model:"compo","object-pk":p.id},null,8,["object-pk"])):Ee("",!0),l(lt),l(Se,{variant:"text",onClick:Z},{default:r(()=>[f(d(e(a)("General.cancel")),1)]),_:1}),l(Se,{variant:"elevated",color:"primary",loading:k.value,disabled:!e(je).valid,onClick:e(be)},{prepend:r(()=>[l(e(it),{icon:e(rt)},null,8,["icon"])]),default:r(()=>[f(" "+d(e(a)("General.save")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1}))]),_:1},8,["breadcrumbs"])}}});export{At as default};
//# sourceMappingURL=CompoEditView-BPtUcqrW.js.map
