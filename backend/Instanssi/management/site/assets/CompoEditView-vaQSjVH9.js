import{d as Ke,a as qe,u as De,v as Ne,ag as $e,ah as Le,o as Xe,ai as Je,X as Qe,b as U,g as te,w as r,e as a,A as We,p as Ye,B as Ze,l as et,j as e,m as p,c as tt,t as d,K as ot,i as v,f as Ee,a2 as O,aj as he,ak as ye,al as _e,am as Ce,C as lt,V as Fe,k as at,D as it,s as w,G as u,E as rt}from"./index-BSHMv_df.js";import{c as st,d as E,g as P,a as m,u as nt,b as s,V as ut}from"./index.esm-71TeWLhH.js";import{F as I}from"./FormSection-Dax0lJeU.js";import{V as n,_ as mt}from"./LayoutBase.vue_vue_type_script_setup_true_lang-C8aKWyeJ.js";import{_ as h}from"./ToggleSwitch.vue_vue_type_script_setup_true_lang-BB5P-ncd.js";import{t as y,a as _}from"./datetime-DsxOZgAd.js";import{h as Se}from"./http-BZkoYM_m.js";import{p as oe}from"./parseInt-3OpbdfxQ.js";import{V as C}from"./VRow-BUBfmFS3.js";import{V as le}from"./VCombobox-HnSVRBVx.js";import"./VContainer--EpXOfw5.js";import"./VSwitch-DkiL1OKS.js";import"./classApi-bnmGQydb.js";import"./filter-C6Uu0LOB.js";const dt={key:0,class:"text-error text-caption mb-4"},pt={class:"d-flex ga-2"},vt={class:"d-flex ga-2"},Mt=Ke({__name:"CompoEditView",props:{eventId:{},id:{}},setup(ze){const ae={name:"name",description:"description",adding_end:"addingEnd",editing_end:"editingEnd",compo_start:"compoStart",voting_start:"votingStart",voting_end:"votingEnd",entry_sizelimit:"entrySizelimit",source_sizelimit:"sourceSizelimit",formats:"formats",source_formats:"sourceFormats",image_formats:"imageFormats",active:"active",show_voting_results:"showVotingResults",is_votable:"isVotable",entry_view_type:"entryViewType",thumbnail_pref:"thumbnailPref",hide_from_archive:"hideFromArchive",hide_from_frontpage:"hideFromFrontpage"},f=ze,{t:l}=qe(),Me=De(),c=Ne(),{getEventById:Be}=rt(),T=w(!1),x=w(!1),ie=w(""),F=u(()=>oe(f.eventId,10)),A=u(()=>f.id!==void 0),Ue=u(()=>{const o=[{title:Be(F.value)?.name??"...",to:{name:"dashboard",params:{eventId:f.eventId}}},{title:l("ComposView.title"),to:{name:"compos",params:{eventId:f.eventId}}}];return A.value?o.push({title:ie.value||"...",disabled:!0}):o.push({title:l("Breadcrumbs.newCompo"),disabled:!0}),o}),Oe=[{title:l("CompoEditView.entryViewTypes.0.title"),description:l("CompoEditView.entryViewTypes.0.description"),value:0},{title:l("CompoEditView.entryViewTypes.1.title"),description:l("CompoEditView.entryViewTypes.1.description"),value:1},{title:l("CompoEditView.entryViewTypes.2.title"),description:l("CompoEditView.entryViewTypes.2.description"),value:2}],Pe=[{title:l("CompoEditView.thumbnailPrefs.0.title"),description:l("CompoEditView.thumbnailPrefs.0.description"),value:0},{title:l("CompoEditView.thumbnailPrefs.1.title"),description:l("CompoEditView.thumbnailPrefs.1.description"),value:1},{title:l("CompoEditView.thumbnailPrefs.2.title"),description:l("CompoEditView.thumbnailPrefs.2.description"),value:2},{title:l("CompoEditView.thumbnailPrefs.3.title"),description:l("CompoEditView.thumbnailPrefs.3.description"),value:3}],re=["B","KB","MB","GB"],V={B:1,KB:1024,MB:1024*1024,GB:1024*1024*1024},g=w("MB"),b=w("MB");function se(o,t){return o==null?null:Math.round(o/V[t]*100)/100}function ne(o,t){return o==null?null:Math.round(o*V[t])}function ue(o){return o==null||o===0?"MB":o>=V.GB?"GB":o>=V.MB?"MB":o>=V.KB?"KB":"B"}const me=u({get:()=>se(q.value.value,g.value),set:o=>{q.value.value=ne(o,g.value)}}),de=u({get:()=>se(D.value.value,b.value),set:o=>{D.value.value=ne(o,b.value)}}),Ie=["zip","7z","rar","tar.gz","exe","com","prg","d64","sid"],Te=["zip","7z","rar","tar.gz"],xe=["png","jpg","jpeg","gif","webp","bmp"],pe=u({get:()=>z.value.value?z.value.value.split("|").filter(Boolean):[],set:o=>{z.value.value=o.join("|")}}),ve=u({get:()=>M.value.value?M.value.value.split("|").filter(Boolean):[],set:o=>{M.value.value=o.join("|")}}),fe=u({get:()=>B.value.value?B.value.value.split("|").filter(Boolean):[],set:o=>{B.value.value=o.join("|")}}),Ae=st({name:m().required().min(1).max(32),description:m(),addingEnd:m().required(),editingEnd:m().required(),compoStart:m().required(),votingStart:m().required(),votingEnd:m().required(),entrySizelimit:P().nullable(),sourceSizelimit:P().nullable(),formats:m(),sourceFormats:m(),imageFormats:m(),active:E(),showVotingResults:E(),isVotable:E(),entryViewType:P(),thumbnailPref:P(),hideFromArchive:E(),hideFromFrontpage:E()}),{handleSubmit:ke,setValues:Re,setErrors:ce,meta:He}=nt({validationSchema:Ae,initialValues:{name:"",description:"",addingEnd:"",editingEnd:"",compoStart:"",votingStart:"",votingEnd:"",entrySizelimit:null,sourceSizelimit:null,formats:"",sourceFormats:"",imageFormats:"",active:!0,showVotingResults:!1,isVotable:!0,entryViewType:0,thumbnailPref:0,hideFromArchive:!1,hideFromFrontpage:!1}}),k=s("name"),S=s("description"),R=s("addingEnd"),H=s("editingEnd"),j=s("compoStart"),G=s("votingStart"),K=s("votingEnd"),q=s("entrySizelimit"),D=s("sourceSizelimit"),z=s("formats"),M=s("sourceFormats"),B=s("imageFormats"),N=s("active"),$=s("showVotingResults"),L=s("isVotable"),X=s("entryViewType"),J=s("thumbnailPref"),Q=s("hideFromArchive"),W=s("hideFromFrontpage"),Ve=u({get:()=>!Q.value.value,set:o=>{Q.value.value=!o}}),ge=u({get:()=>!W.value.value,set:o=>{W.value.value=!o}}),be=ke(async o=>{x.value=!0;let t;A.value?t=await Ge(oe(f.id,10),o):t=await je(o),x.value=!1,t&&Y()});function we(o){return{name:o.name,description:o.description||"",adding_end:_(o.addingEnd),editing_end:_(o.editingEnd),compo_start:_(o.compoStart),voting_start:_(o.votingStart),voting_end:_(o.votingEnd),entry_sizelimit:o.entrySizelimit,source_sizelimit:o.sourceSizelimit,formats:o.formats||"",source_formats:o.sourceFormats||"",image_formats:o.imageFormats||"",active:o.active,show_voting_results:o.showVotingResults,is_votable:o.isVotable,entry_view_type:o.entryViewType,thumbnail_pref:o.thumbnailPref,hide_from_archive:o.hideFromArchive,hide_from_frontpage:o.hideFromFrontpage}}async function je(o){try{return await $e({path:{event_pk:F.value},body:we(o)}),c.success(l("CompoEditView.createSuccess")),!0}catch(t){Se(t,ce,c,l("CompoEditView.createFailure"),ae)}return!1}async function Ge(o,t){try{return await Le({path:{event_pk:F.value,id:o},body:we(t)}),c.success(l("CompoEditView.editSuccess")),!0}catch(Z){Se(Z,ce,c,l("CompoEditView.editFailure"),ae)}return!1}function Y(){Me.push({name:"compos",params:{eventId:f.eventId}})}return Xe(async()=>{if(A.value){T.value=!0;try{const t=(await Je({path:{event_pk:F.value,id:oe(f.id,10)}})).data;ie.value=t.name,g.value=ue(t.entry_sizelimit??null),b.value=ue(t.source_sizelimit??null),Re({name:t.name,description:t.description??"",addingEnd:y(t.adding_end),editingEnd:y(t.editing_end),compoStart:y(t.compo_start),votingStart:y(t.voting_start),votingEnd:y(t.voting_end),entrySizelimit:t.entry_sizelimit??null,sourceSizelimit:t.source_sizelimit??null,formats:t.formats??"",sourceFormats:t.source_formats??"",imageFormats:t.image_formats??"",active:t.active??!0,showVotingResults:t.show_voting_results??!1,isVotable:t.is_votable??!0,entryViewType:t.entry_view_type??0,thumbnailPref:t.thumbnail_pref??0,hideFromArchive:t.hide_from_archive??!1,hideFromFrontpage:t.hide_from_frontpage??!1})}catch(o){c.error(l("CompoEditView.loadFailure")),console.error(o),Y()}finally{T.value=!1}}}),(o,t)=>{const Z=Qe("VuetifyTiptap");return U(),te(mt,{breadcrumbs:Ue.value},{default:r(()=>[T.value?(U(),te(n,{key:0,class:"d-flex justify-center my-8"},{default:r(()=>[a(We,{indeterminate:"",size:"64"})]),_:1})):(U(),te(n,{key:1},{default:r(()=>[a(Ye,null,{default:r(()=>[a(Ze,null,{default:r(()=>[a(ut,{onSubmit:et(e(be),["prevent"])},{default:r(()=>[a(p,{modelValue:e(k).value.value,"onUpdate:modelValue":t[0]||(t[0]=i=>e(k).value.value=i),"error-messages":e(k).errorMessage.value,variant:"outlined",label:e(l)("CompoEditView.labels.name")+" *"},null,8,["modelValue","error-messages","label"]),a(Z,{modelValue:e(S).value.value,"onUpdate:modelValue":t[1]||(t[1]=i=>e(S).value.value=i)},null,8,["modelValue"]),e(S).errorMessage.value?(U(),tt("div",dt,d(e(S).errorMessage.value),1)):ot("",!0),a(I,null,{default:r(()=>[v(d(e(l)("CompoEditView.sections.schedule")),1)]),_:1}),a(C,null,{default:r(()=>[a(n,{cols:"12",md:"6"},{default:r(()=>[a(p,{modelValue:e(R).value.value,"onUpdate:modelValue":t[2]||(t[2]=i=>e(R).value.value=i),type:"datetime-local","error-messages":e(R).errorMessage.value,variant:"outlined",label:e(l)("CompoEditView.labels.addingEnd")+" *"},null,8,["modelValue","error-messages","label"])]),_:1}),a(n,{cols:"12",md:"6"},{default:r(()=>[a(p,{modelValue:e(H).value.value,"onUpdate:modelValue":t[3]||(t[3]=i=>e(H).value.value=i),type:"datetime-local","error-messages":e(H).errorMessage.value,variant:"outlined",label:e(l)("CompoEditView.labels.editingEnd")+" *"},null,8,["modelValue","error-messages","label"])]),_:1})]),_:1}),a(C,null,{default:r(()=>[a(n,{cols:"12",md:"4"},{default:r(()=>[a(p,{modelValue:e(j).value.value,"onUpdate:modelValue":t[4]||(t[4]=i=>e(j).value.value=i),type:"datetime-local","error-messages":e(j).errorMessage.value,variant:"outlined",label:e(l)("CompoEditView.labels.compoStart")+" *"},null,8,["modelValue","error-messages","label"])]),_:1}),a(n,{cols:"12",md:"4"},{default:r(()=>[a(p,{modelValue:e(G).value.value,"onUpdate:modelValue":t[5]||(t[5]=i=>e(G).value.value=i),type:"datetime-local","error-messages":e(G).errorMessage.value,variant:"outlined",label:e(l)("CompoEditView.labels.votingStart")+" *"},null,8,["modelValue","error-messages","label"])]),_:1}),a(n,{cols:"12",md:"4"},{default:r(()=>[a(p,{modelValue:e(K).value.value,"onUpdate:modelValue":t[6]||(t[6]=i=>e(K).value.value=i),type:"datetime-local","error-messages":e(K).errorMessage.value,variant:"outlined",label:e(l)("CompoEditView.labels.votingEnd")+" *"},null,8,["modelValue","error-messages","label"])]),_:1})]),_:1}),a(I,null,{default:r(()=>[v(d(e(l)("CompoEditView.sections.fileSettings")),1)]),_:1}),a(C,null,{default:r(()=>[a(n,{cols:"12",md:"6"},{default:r(()=>[Ee("div",pt,[a(p,{modelValue:me.value,"onUpdate:modelValue":t[7]||(t[7]=i=>me.value=i),modelModifiers:{number:!0},type:"number",min:"0","error-messages":e(q).errorMessage.value,variant:"outlined",label:e(l)("CompoEditView.labels.entrySizelimit"),class:"flex-grow-1"},null,8,["modelValue","error-messages","label"]),a(O,{modelValue:g.value,"onUpdate:modelValue":t[8]||(t[8]=i=>g.value=i),items:re,variant:"outlined",style:{"max-width":"100px"}},null,8,["modelValue"])])]),_:1}),a(n,{cols:"12",md:"6"},{default:r(()=>[Ee("div",vt,[a(p,{modelValue:de.value,"onUpdate:modelValue":t[9]||(t[9]=i=>de.value=i),modelModifiers:{number:!0},type:"number",min:"0","error-messages":e(D).errorMessage.value,variant:"outlined",label:e(l)("CompoEditView.labels.sourceSizelimit"),class:"flex-grow-1"},null,8,["modelValue","error-messages","label"]),a(O,{modelValue:b.value,"onUpdate:modelValue":t[10]||(t[10]=i=>b.value=i),items:re,variant:"outlined",style:{"max-width":"100px"}},null,8,["modelValue"])])]),_:1})]),_:1}),a(C,null,{default:r(()=>[a(n,{cols:"12",md:"4"},{default:r(()=>[a(le,{modelValue:pe.value,"onUpdate:modelValue":t[11]||(t[11]=i=>pe.value=i),items:Ie,"error-messages":e(z).errorMessage.value,variant:"outlined",label:e(l)("CompoEditView.labels.formats"),multiple:"",chips:"","closable-chips":""},null,8,["modelValue","error-messages","label"])]),_:1}),a(n,{cols:"12",md:"4"},{default:r(()=>[a(le,{modelValue:ve.value,"onUpdate:modelValue":t[12]||(t[12]=i=>ve.value=i),items:Te,"error-messages":e(M).errorMessage.value,variant:"outlined",label:e(l)("CompoEditView.labels.sourceFormats"),multiple:"",chips:"","closable-chips":""},null,8,["modelValue","error-messages","label"])]),_:1}),a(n,{cols:"12",md:"4"},{default:r(()=>[a(le,{modelValue:fe.value,"onUpdate:modelValue":t[13]||(t[13]=i=>fe.value=i),items:xe,"error-messages":e(B).errorMessage.value,variant:"outlined",label:e(l)("CompoEditView.labels.imageFormats"),multiple:"",chips:"","closable-chips":""},null,8,["modelValue","error-messages","label"])]),_:1})]),_:1}),a(I,null,{default:r(()=>[v(d(e(l)("CompoEditView.sections.displaySettings")),1)]),_:1}),a(C,null,{default:r(()=>[a(n,{cols:"12",md:"6"},{default:r(()=>[a(O,{modelValue:e(X).value.value,"onUpdate:modelValue":t[14]||(t[14]=i=>e(X).value.value=i),modelModifiers:{number:!0},items:Oe,"error-messages":e(X).errorMessage.value,variant:"outlined",label:e(l)("CompoEditView.labels.entryViewType")},{item:r(({props:i,item:ee})=>[a(he,ye(_e(i)),{default:r(()=>[a(Ce,null,{default:r(()=>[v(d(ee.raw.description),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","error-messages","label"])]),_:1}),a(n,{cols:"12",md:"6"},{default:r(()=>[a(O,{modelValue:e(J).value.value,"onUpdate:modelValue":t[15]||(t[15]=i=>e(J).value.value=i),modelModifiers:{number:!0},items:Pe,"error-messages":e(J).errorMessage.value,variant:"outlined",label:e(l)("CompoEditView.labels.thumbnailPref")},{item:r(({props:i,item:ee})=>[a(he,ye(_e(i)),{default:r(()=>[a(Ce,null,{default:r(()=>[v(d(ee.raw.description),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","error-messages","label"])]),_:1})]),_:1}),a(I,null,{default:r(()=>[v(d(e(l)("CompoEditView.sections.visibility")),1)]),_:1}),a(h,{modelValue:e(N).value.value,"onUpdate:modelValue":t[16]||(t[16]=i=>e(N).value.value=i),"error-message":e(N).errorMessage.value,"label-on":e(l)("CompoEditView.labels.activeOn"),"label-off":e(l)("CompoEditView.labels.activeOff"),"hint-on":e(l)("CompoEditView.labels.activeHintOn"),"hint-off":e(l)("CompoEditView.labels.activeHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"]),a(h,{modelValue:e(L).value.value,"onUpdate:modelValue":t[17]||(t[17]=i=>e(L).value.value=i),"error-message":e(L).errorMessage.value,"label-on":e(l)("CompoEditView.labels.isVotableOn"),"label-off":e(l)("CompoEditView.labels.isVotableOff"),"hint-on":e(l)("CompoEditView.labels.isVotableHintOn"),"hint-off":e(l)("CompoEditView.labels.isVotableHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"]),a(h,{modelValue:e($).value.value,"onUpdate:modelValue":t[18]||(t[18]=i=>e($).value.value=i),"error-message":e($).errorMessage.value,"label-on":e(l)("CompoEditView.labels.showVotingResultsOn"),"label-off":e(l)("CompoEditView.labels.showVotingResultsOff"),"hint-on":e(l)("CompoEditView.labels.showVotingResultsHintOn"),"hint-off":e(l)("CompoEditView.labels.showVotingResultsHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"]),a(h,{modelValue:Ve.value,"onUpdate:modelValue":t[19]||(t[19]=i=>Ve.value=i),"error-message":e(Q).errorMessage.value,"label-on":e(l)("CompoEditView.labels.hideFromArchiveOff"),"label-off":e(l)("CompoEditView.labels.hideFromArchiveOn"),"hint-on":e(l)("CompoEditView.labels.hideFromArchiveHintOn"),"hint-off":e(l)("CompoEditView.labels.hideFromArchiveHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"]),a(h,{modelValue:ge.value,"onUpdate:modelValue":t[20]||(t[20]=i=>ge.value=i),"error-message":e(W).errorMessage.value,"label-on":e(l)("CompoEditView.labels.hideFromFrontpageOff"),"label-off":e(l)("CompoEditView.labels.hideFromFrontpageOn"),"hint-on":e(l)("CompoEditView.labels.hideFromFrontpageHintOn"),"hint-off":e(l)("CompoEditView.labels.hideFromFrontpageHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"])]),_:1},8,["onSubmit"])]),_:1}),a(lt,{class:"justify-end"},{default:r(()=>[a(Fe,{variant:"text",onClick:Y},{default:r(()=>[v(d(e(l)("General.cancel")),1)]),_:1}),a(Fe,{variant:"elevated",color:"primary",loading:x.value,disabled:!e(He).valid,onClick:e(be)},{prepend:r(()=>[a(e(at),{icon:e(it)},null,8,["icon"])]),default:r(()=>[v(" "+d(e(l)("General.save")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1}))]),_:1},8,["breadcrumbs"])}}});export{Mt as default};
//# sourceMappingURL=CompoEditView-vaQSjVH9.js.map
