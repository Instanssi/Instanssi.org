import{d as N,a as j,u as q,H as G,I as R,v as z,b,g as k,w as o,e as s,j as a,P as f,V as H,i as J,t as Q,k as W,J as X,K as Y,m as Z,q as ee,G as I,s as l,ae as te,af as ae,E as oe}from"./index-BSHMv_df.js";import{_ as se}from"./BooleanIcon.vue_vue_type_script_setup_true_lang-COcceYO8.js";import{_ as g}from"./DateTimeCell.vue_vue_type_script_setup_true_lang-CG8AjqQo.js";import{V as x,_ as ne}from"./LayoutBase.vue_vue_type_script_setup_true_lang-C8aKWyeJ.js";import{_ as ie}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-DouyropJ.js";import{d as le,V as re,g as de}from"./query_tools-Co6bP9h2.js";import{g as me}from"./http-BZkoYM_m.js";import{V as D}from"./VRow-BUBfmFS3.js";import{p as E}from"./parseInt-3OpbdfxQ.js";import"./datetime-DsxOZgAd.js";import"./classApi-bnmGQydb.js";import"./VContainer--EpXOfw5.js";import"./VDataTable-CpUosGjF.js";import"./filter-C6Uu0LOB.js";const Ie=N({__name:"ComposView",props:{eventId:{}},setup(P){const d=P,{t}=j(),C=q(),O=G(R),m=z(),u=ee(),{getEventById:$}=oe(),r=I(()=>E(d.eventId,10)),c=l(!1),A=I(()=>[{title:$(r.value)?.name??"...",to:{name:"dashboard",params:{eventId:d.eventId}}},{title:t("ComposView.title"),disabled:!0}]),_=[25,50,100],V=l(_[0]),w=l(0),F=l(1),h=l([]),p=l(""),v=l(null),S=[{title:t("ComposView.headers.id"),sortable:!0,key:"id"},{title:t("ComposView.headers.name"),sortable:!0,key:"name"},{title:t("ComposView.headers.addingEnd"),sortable:!0,key:"adding_end"},{title:t("ComposView.headers.votingStart"),sortable:!0,key:"voting_start"},{title:t("ComposView.headers.votingEnd"),sortable:!0,key:"voting_end"},{title:t("ComposView.headers.active"),sortable:!1,key:"active"},{title:t("ComposView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function T(){v.value&&y(v.value)}async function y(i){c.value=!0,v.value=i;try{const n=await ae({path:{event_pk:E(d.eventId,10)},query:{...de(i)}});h.value=n.data.results,w.value=n.data.count}catch(n){m.error(t("ComposView.loadFailure")),console.error(n)}finally{c.value=!1}}const B=le(y,250);async function K(i){const n=t("ComposView.confirmDelete",i);await O.value.ifConfirmed(n,async()=>{try{await te({path:{event_pk:r.value,id:i.id}}),m.success(t("ComposView.deleteSuccess")),T()}catch(e){m.error(me(e,t("ComposView.deleteFailure"))),console.error(e)}})}function L(i){C.push({name:"compos-edit",params:{eventId:r.value,id:i}})}function M(){C.push({name:"compos-new",params:{eventId:r.value}})}return(i,n)=>(b(),k(ne,{key:`compos-${r.value}`,breadcrumbs:A.value},{default:o(()=>[s(x,null,{default:o(()=>[s(D,null,{default:o(()=>[a(u).canAdd(a(f).COMPO)?(b(),k(H,{key:0,onClick:M},{prepend:o(()=>[s(a(W),{icon:a(X)},null,8,["icon"])]),default:o(()=>[J(" "+Q(a(t)("ComposView.newCompo")),1)]),_:1})):Y("",!0),s(Z,{modelValue:p.value,"onUpdate:modelValue":n[0]||(n[0]=e=>p.value=e),variant:"outlined",density:"compact",label:a(t)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),s(x,null,{default:o(()=>[s(D,null,{default:o(()=>[s(re,{"items-per-page":V.value,"onUpdate:itemsPerPage":n[1]||(n[1]=e=>V.value=e),class:"elevation-1 primary","item-value":"id",density:"compact",headers:S,items:h.value,"items-length":w.value,loading:c.value,search:p.value,page:F.value,"items-per-page-options":_,"no-data-text":a(t)("ComposView.noComposFound"),"loading-text":a(t)("ComposView.loadingCompos"),"onUpdate:options":a(B)},{"item.active":o(({item:e})=>[s(se,{value:e.active},null,8,["value"])]),"item.adding_end":o(({item:e})=>[s(g,{value:e.adding_end},null,8,["value"])]),"item.voting_start":o(({item:e})=>[s(g,{value:e.voting_start},null,8,["value"])]),"item.voting_end":o(({item:e})=>[s(g,{value:e.voting_end},null,8,["value"])]),"item.actions":o(({item:e})=>[s(ie,{"can-edit":a(u).canChange(a(f).COMPO),"can-delete":a(u).canDelete(a(f).COMPO),onEdit:U=>L(e.id),onDelete:U=>K(e)},null,8,["can-edit","can-delete","onEdit","onDelete"])]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Ie as default};
//# sourceMappingURL=ComposView-ClRjcg4t.js.map
