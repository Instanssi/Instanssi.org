import{d as j,a as q,u as R,J as z,K as G,v as H,L as h,b as k,g as x,w as n,e as l,j as e,P as V,V as J,i as Q,t as W,k as X,M as Y,D as Z,m as ee,N as ae,O as te,q as oe,I,s as d,ap as se,aq as le,H as ne}from"./index-CQkWvXOv.js";import{_ as ie}from"./BooleanIcon.vue_vue_type_script_setup_true_lang-BUZkEwsX.js";import{_ as C}from"./DateTimeCell.vue_vue_type_script_setup_true_lang-DaLynL44.js";import{V as P,_ as re}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D5aCeQDf.js";import{_ as ue}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-DepTf6Bi.js";import{u as me,d as de}from"./useTableState-CutuDm2i.js";import{g as pe}from"./query_tools-BInV9OzK.js";import{g as ce}from"./http-CET7UDul.js";import{V as O}from"./VRow-CXIXhuhq.js";import{V as ve}from"./VDataTableServer-C6tuZDKn.js";import{p as D}from"./parseInt-BJ5A4_3y.js";import"./datetime-Dz9fjSvq.js";import"./VContainer-DqJ8gu3P.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-1MnYozFL.js";import"./useAuditLogUtils-BdjF9k7b.js";import"./VDataTable-f5_9vewM.js";const Be=j({__name:"ComposView",props:{eventId:{}},setup(S){const p=S,{t:a}=q(),y=R(),B=z(G),c=H(),v=oe(),{getEventById:E}=ne(),r=I(()=>D(p.eventId,10)),f=d(!1),A=I(()=>[{title:E(r.value)?.name??"...",to:{name:"dashboard",params:{eventId:p.eventId}}},{title:a("ComposView.title"),disabled:!0}]),o=me({filterKeys:["active"]}),w=d(0),b=d([]),m=d(null),u=o.useBooleanFilter("active"),F=[{title:a("ComposView.headers.id"),sortable:!0,key:"id"},{title:a("ComposView.headers.name"),sortable:!0,key:"name"},{title:a("ComposView.headers.addingEnd"),sortable:!0,key:"adding_end"},{title:a("ComposView.headers.votingStart"),sortable:!0,key:"voting_start"},{title:a("ComposView.headers.votingEnd"),sortable:!0,key:"voting_end"},{title:a("ComposView.headers.active"),sortable:!0,key:"active"},{title:a("ComposView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function T(){m.value&&_(m.value)}async function _(i){f.value=!0,m.value=i;try{const s=await le({path:{event_pk:D(p.eventId,10)},query:{...pe(i),...u.value!==null?{active:u.value}:{}}});b.value=s.data.results,w.value=s.data.count}catch(s){c.error(a("ComposView.loadFailure")),console.error(s)}finally{f.value=!1}}const g=de(_,250);h(u,()=>{m.value&&g({...m.value,page:1})});function $(i){o.onOptionsUpdate(i),g(i)}function L(){o.setFilter("active",null),o.search.value="",o.page.value=1,g({page:1,itemsPerPage:o.perPage.value??25,sortBy:[],groupBy:[],search:""})}h(r,L);async function U(i){const s=a("ComposView.confirmDelete",i);await B.value.ifConfirmed(s,async()=>{try{await se({path:{event_pk:r.value,id:i.id}}),c.success(a("ComposView.deleteSuccess")),T()}catch(t){c.error(ce(t,a("ComposView.deleteFailure"))),console.error(t)}})}function K(i){y.push({name:"compos-edit",params:{eventId:r.value,id:i}})}function M(){y.push({name:"compos-new",params:{eventId:r.value}})}return(i,s)=>(k(),x(re,{key:`compos-${r.value}`,breadcrumbs:A.value},{default:n(()=>[l(P,null,{default:n(()=>[l(O,null,{default:n(()=>[e(v).canAdd(e(V).COMPO)?(k(),x(J,{key:0,color:"primary",onClick:M},{prepend:n(()=>[l(e(X),{icon:e(Y)},null,8,["icon"])]),default:n(()=>[Q(" "+W(e(a)("ComposView.newCompo")),1)]),_:1})):Z("",!0),l(ee,{modelValue:e(o).search.value,"onUpdate:modelValue":s[0]||(s[0]=t=>e(o).search.value=t),variant:"outlined",density:"compact",label:e(a)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"]),l(ae,{modelValue:e(u),"onUpdate:modelValue":s[1]||(s[1]=t=>te(u)?u.value=t:null),items:[{title:e(a)("ComposView.allStatuses"),value:null},{title:e(a)("ComposView.activeOnly"),value:!0},{title:e(a)("ComposView.inactiveOnly"),value:!1}],variant:"outlined",density:"compact",label:e(a)("ComposView.filterByStatus"),style:{"max-width":"200px"},class:"ma-0 pa-0 ml-4"},null,8,["modelValue","items","label"])]),_:1})]),_:1}),l(P,null,{default:n(()=>[l(O,null,{default:n(()=>[l(ve,{"items-per-page":e(o).perPage.value,"onUpdate:itemsPerPage":s[2]||(s[2]=t=>e(o).perPage.value=t),"sort-by":e(o).sortByArray.value,class:"elevation-1 primary","item-value":"id",density:"compact",headers:F,items:b.value,"items-length":w.value,loading:f.value,search:e(o).search.value,page:e(o).page.value,"items-per-page-options":e(o).pageSizeOptions,"no-data-text":e(a)("ComposView.noComposFound"),"loading-text":e(a)("ComposView.loadingCompos"),"onUpdate:options":$},{"item.active":n(({item:t})=>[l(ie,{value:t.active},null,8,["value"])]),"item.adding_end":n(({item:t})=>[l(C,{value:t.adding_end},null,8,["value"])]),"item.voting_start":n(({item:t})=>[l(C,{value:t.voting_start},null,8,["value"])]),"item.voting_end":n(({item:t})=>[l(C,{value:t.voting_end},null,8,["value"])]),"item.actions":n(({item:t})=>[l(ue,{"can-edit":e(v).canChange(e(V).COMPO),"can-delete":e(v).canDelete(e(V).COMPO),"audit-log":{appLabel:"kompomaatti",model:"compo",objectPk:t.id},onEdit:N=>K(t.id),onDelete:N=>U(t)},null,8,["can-edit","can-delete","audit-log","onEdit","onDelete"])]),_:1},8,["items-per-page","sort-by","items","items-length","loading","search","page","items-per-page-options","no-data-text","loading-text"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Be as default};
//# sourceMappingURL=ComposView-CrxYQ6EY.js.map
