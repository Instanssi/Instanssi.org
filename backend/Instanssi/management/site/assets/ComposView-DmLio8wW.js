import{d as j,a as q,u as G,H as R,I as z,v as H,Z as J,b as k,g as I,w as o,e as s,j as t,P as f,V as Z,i as Q,t as W,k as X,J as Y,K as ee,m as ae,q as te,G as x,s as l,ae as oe,af as se,E as ne}from"./index-CY4kEXQX.js";import{_ as ie}from"./BooleanIcon.vue_vue_type_script_setup_true_lang-DXbGa2AH.js";import{_ as C}from"./DateTimeCell.vue_vue_type_script_setup_true_lang-CA7qmznU.js";import{V as P,_ as le}from"./LayoutBase.vue_vue_type_script_setup_true_lang-mBpG7FYr.js";import{_ as re}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-CU2jcJ7N.js";import{d as de,V as me,g as ue}from"./query_tools-D1ttn1y9.js";import{g as ce}from"./http-h2SUVdDm.js";import{V as D}from"./VRow-Dt2mDaW0.js";import{p as E}from"./parseInt-DjOfejfT.js";import"./datetime-DsxOZgAd.js";import"./classApi-bnmGQydb.js";import"./VContainer-DyZfstE_.js";import"./VDataTable-K-Y489M6.js";import"./filter-B_C-txEo.js";const Pe=j({__name:"ComposView",props:{eventId:{}},setup(O){const m=O,{t:a}=q(),_=G(),$=R(z),u=H(),c=te(),{getEventById:A}=ne(),r=x(()=>E(m.eventId,10)),p=l(!1),B=x(()=>[{title:A(r.value)?.name??"...",to:{name:"dashboard",params:{eventId:m.eventId}}},{title:a("ComposView.title"),disabled:!0}]),V=[25,50,100],v=l(V[0]),h=l(0),F=l(1),w=l([]),d=l(""),g=l(null),S=[{title:a("ComposView.headers.id"),sortable:!0,key:"id"},{title:a("ComposView.headers.name"),sortable:!0,key:"name"},{title:a("ComposView.headers.addingEnd"),sortable:!0,key:"adding_end"},{title:a("ComposView.headers.votingStart"),sortable:!0,key:"voting_start"},{title:a("ComposView.headers.votingEnd"),sortable:!0,key:"voting_end"},{title:a("ComposView.headers.active"),sortable:!1,key:"active"},{title:a("ComposView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function T(){g.value&&y(g.value)}async function y(i){p.value=!0,g.value=i;try{const n=await se({path:{event_pk:E(m.eventId,10)},query:{...ue(i)}});w.value=n.data.results,h.value=n.data.count}catch(n){u.error(a("ComposView.loadFailure")),console.error(n)}finally{p.value=!1}}const b=de(y,250);function K(){d.value="",b({page:1,itemsPerPage:v.value??25,sortBy:[],groupBy:[],search:""})}J(r,K);async function L(i){const n=a("ComposView.confirmDelete",i);await $.value.ifConfirmed(n,async()=>{try{await oe({path:{event_pk:r.value,id:i.id}}),u.success(a("ComposView.deleteSuccess")),T()}catch(e){u.error(ce(e,a("ComposView.deleteFailure"))),console.error(e)}})}function M(i){_.push({name:"compos-edit",params:{eventId:r.value,id:i}})}function U(){_.push({name:"compos-new",params:{eventId:r.value}})}return(i,n)=>(k(),I(le,{key:`compos-${r.value}`,breadcrumbs:B.value},{default:o(()=>[s(P,null,{default:o(()=>[s(D,null,{default:o(()=>[t(c).canAdd(t(f).COMPO)?(k(),I(Z,{key:0,onClick:U},{prepend:o(()=>[s(t(X),{icon:t(Y)},null,8,["icon"])]),default:o(()=>[Q(" "+W(t(a)("ComposView.newCompo")),1)]),_:1})):ee("",!0),s(ae,{modelValue:d.value,"onUpdate:modelValue":n[0]||(n[0]=e=>d.value=e),variant:"outlined",density:"compact",label:t(a)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),s(P,null,{default:o(()=>[s(D,null,{default:o(()=>[s(me,{"items-per-page":v.value,"onUpdate:itemsPerPage":n[1]||(n[1]=e=>v.value=e),class:"elevation-1 primary","item-value":"id",density:"compact",headers:S,items:w.value,"items-length":h.value,loading:p.value,search:d.value,page:F.value,"items-per-page-options":V,"no-data-text":t(a)("ComposView.noComposFound"),"loading-text":t(a)("ComposView.loadingCompos"),"onUpdate:options":t(b)},{"item.active":o(({item:e})=>[s(ie,{value:e.active},null,8,["value"])]),"item.adding_end":o(({item:e})=>[s(C,{value:e.adding_end},null,8,["value"])]),"item.voting_start":o(({item:e})=>[s(C,{value:e.voting_start},null,8,["value"])]),"item.voting_end":o(({item:e})=>[s(C,{value:e.voting_end},null,8,["value"])]),"item.actions":o(({item:e})=>[s(re,{"can-edit":t(c).canChange(t(f).COMPO),"can-delete":t(c).canDelete(t(f).COMPO),onEdit:N=>M(e.id),onDelete:N=>L(e)},null,8,["can-edit","can-delete","onEdit","onDelete"])]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Pe as default};
//# sourceMappingURL=ComposView-DmLio8wW.js.map
