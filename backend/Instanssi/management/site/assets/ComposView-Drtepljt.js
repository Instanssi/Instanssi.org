import{d as N,a as q,u as R,J as z,K as G,v as H,U as J,b as k,g as I,w as o,e as s,j as t,P as f,V as Q,i as W,t as X,k as Y,L as Z,D as ee,m as ae,q as te,I as P,s as l,ao as oe,ap as se,H as ne}from"./index-DXU74lGt.js";import{_ as ie}from"./BooleanIcon.vue_vue_type_script_setup_true_lang-CqjGGkAi.js";import{_ as C}from"./DateTimeCell.vue_vue_type_script_setup_true_lang-BMnBYvTq.js";import{V as x,_ as le}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D4jd1chv.js";import{_ as re}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-CUVfxWfg.js";import{g as me}from"./query_tools-BInV9OzK.js";import{g as de}from"./http-BTZWMaMN.js";import{d as ue}from"./debounce-CQ84CrOG.js";import{V as D}from"./VRow-B94Tto0H.js";import{V as pe}from"./VDataTableServer-CMLVDy59.js";import{p as E}from"./parseInt-Bzw_2rWL.js";import"./datetime-Dz9fjSvq.js";import"./VContainer-BfWqa_tJ.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-WkXOSlqa.js";import"./useAuditLogUtils-BqNOieoY.js";import"./VDataTable-Jd7io3gq.js";const Ee=N({__name:"ComposView",props:{eventId:{}},setup(O){const d=O,{t:a}=q(),_=R(),$=z(G),u=H(),p=te(),{getEventById:A}=ne(),r=P(()=>E(d.eventId,10)),c=l(!1),B=P(()=>[{title:A(r.value)?.name??"...",to:{name:"dashboard",params:{eventId:d.eventId}}},{title:a("ComposView.title"),disabled:!0}]),V=[25,50,100],v=l(V[0]),h=l(0),L=l(1),w=l([]),m=l(""),g=l(null),F=[{title:a("ComposView.headers.id"),sortable:!0,key:"id"},{title:a("ComposView.headers.name"),sortable:!0,key:"name"},{title:a("ComposView.headers.addingEnd"),sortable:!0,key:"adding_end"},{title:a("ComposView.headers.votingStart"),sortable:!0,key:"voting_start"},{title:a("ComposView.headers.votingEnd"),sortable:!0,key:"voting_end"},{title:a("ComposView.headers.active"),sortable:!1,key:"active"},{title:a("ComposView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function S(){g.value&&y(g.value)}async function y(i){c.value=!0,g.value=i;try{const n=await se({path:{event_pk:E(d.eventId,10)},query:{...me(i)}});w.value=n.data.results,h.value=n.data.count}catch(n){u.error(a("ComposView.loadFailure")),console.error(n)}finally{c.value=!1}}const b=ue(y,250);function T(){m.value="",b({page:1,itemsPerPage:v.value??25,sortBy:[],groupBy:[],search:""})}J(r,T);async function U(i){const n=a("ComposView.confirmDelete",i);await $.value.ifConfirmed(n,async()=>{try{await oe({path:{event_pk:r.value,id:i.id}}),u.success(a("ComposView.deleteSuccess")),S()}catch(e){u.error(de(e,a("ComposView.deleteFailure"))),console.error(e)}})}function K(i){_.push({name:"compos-edit",params:{eventId:r.value,id:i}})}function M(){_.push({name:"compos-new",params:{eventId:r.value}})}return(i,n)=>(k(),I(le,{key:`compos-${r.value}`,breadcrumbs:B.value},{default:o(()=>[s(x,null,{default:o(()=>[s(D,null,{default:o(()=>[t(p).canAdd(t(f).COMPO)?(k(),I(Q,{key:0,color:"primary",onClick:M},{prepend:o(()=>[s(t(Y),{icon:t(Z)},null,8,["icon"])]),default:o(()=>[W(" "+X(t(a)("ComposView.newCompo")),1)]),_:1})):ee("",!0),s(ae,{modelValue:m.value,"onUpdate:modelValue":n[0]||(n[0]=e=>m.value=e),variant:"outlined",density:"compact",label:t(a)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),s(x,null,{default:o(()=>[s(D,null,{default:o(()=>[s(pe,{"items-per-page":v.value,"onUpdate:itemsPerPage":n[1]||(n[1]=e=>v.value=e),class:"elevation-1 primary","item-value":"id",density:"compact",headers:F,items:w.value,"items-length":h.value,loading:c.value,search:m.value,page:L.value,"items-per-page-options":V,"no-data-text":t(a)("ComposView.noComposFound"),"loading-text":t(a)("ComposView.loadingCompos"),"onUpdate:options":t(b)},{"item.active":o(({item:e})=>[s(ie,{value:e.active},null,8,["value"])]),"item.adding_end":o(({item:e})=>[s(C,{value:e.adding_end},null,8,["value"])]),"item.voting_start":o(({item:e})=>[s(C,{value:e.voting_start},null,8,["value"])]),"item.voting_end":o(({item:e})=>[s(C,{value:e.voting_end},null,8,["value"])]),"item.actions":o(({item:e})=>[s(re,{"can-edit":t(p).canChange(t(f).COMPO),"can-delete":t(p).canDelete(t(f).COMPO),"audit-log":{appLabel:"kompomaatti",model:"compo",objectPk:e.id},onEdit:j=>K(e.id),onDelete:j=>U(e)},null,8,["can-edit","can-delete","audit-log","onEdit","onDelete"])]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Ee as default};
//# sourceMappingURL=ComposView-Drtepljt.js.map
