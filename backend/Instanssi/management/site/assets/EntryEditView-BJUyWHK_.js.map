{"version":3,"file":"EntryEditView-BJUyWHK_.js","sources":["../../../../../admin/src/views/kompomaatti/EntryEditView.vue"],"sourcesContent":["<template>\n    <LayoutBase :breadcrumbs=\"breadcrumbs\">\n        <v-col v-if=\"loading\" class=\"d-flex justify-center my-8\">\n            <v-progress-circular indeterminate size=\"64\" />\n        </v-col>\n        <v-col v-else>\n            <v-card>\n                <v-card-text>\n                    <v-form @submit.prevent=\"submit\">\n                        <v-row>\n                            <v-col cols=\"12\" md=\"6\">\n                                <v-text-field\n                                    v-model=\"name.value.value\"\n                                    :error-messages=\"name.errorMessage.value\"\n                                    variant=\"outlined\"\n                                    :label=\"t('EntryEditView.labels.name') + ' *'\"\n                                />\n                            </v-col>\n                            <v-col cols=\"12\" md=\"6\">\n                                <v-text-field\n                                    v-model=\"creator.value.value\"\n                                    :error-messages=\"creator.errorMessage.value\"\n                                    variant=\"outlined\"\n                                    :label=\"t('EntryEditView.labels.creator') + ' *'\"\n                                />\n                            </v-col>\n                        </v-row>\n\n                        <v-textarea\n                            v-model=\"description.value.value\"\n                            :error-messages=\"description.errorMessage.value\"\n                            variant=\"outlined\"\n                            :label=\"t('EntryEditView.labels.description')\"\n                            rows=\"3\"\n                        />\n\n                        <v-row>\n                            <v-col cols=\"12\" md=\"4\">\n                                <v-select\n                                    v-model.number=\"compo.value.value\"\n                                    :items=\"compoOptions\"\n                                    :error-messages=\"compo.errorMessage.value\"\n                                    variant=\"outlined\"\n                                    :label=\"t('EntryEditView.labels.compo') + ' *'\"\n                                    :disabled=\"isEditMode\"\n                                />\n                            </v-col>\n                            <v-col cols=\"12\" md=\"4\">\n                                <v-text-field\n                                    v-model=\"platform.value.value\"\n                                    :error-messages=\"platform.errorMessage.value\"\n                                    variant=\"outlined\"\n                                    :label=\"t('EntryEditView.labels.platform')\"\n                                />\n                            </v-col>\n                            <v-col cols=\"12\" md=\"4\">\n                                <v-autocomplete\n                                    v-model.number=\"user.value.value\"\n                                    :items=\"userOptions\"\n                                    :error-messages=\"user.errorMessage.value\"\n                                    variant=\"outlined\"\n                                    :label=\"t('EntryEditView.labels.user') + ' *'\"\n                                    :disabled=\"isEditMode\"\n                                />\n                            </v-col>\n                        </v-row>\n\n                        <FormSection>\n                            {{ t(\"EntryEditView.sections.files\") }}\n                        </FormSection>\n                        <v-row>\n                            <v-col cols=\"12\" md=\"4\">\n                                <FileUploadField\n                                    v-model=\"entryFile.value.value\"\n                                    :current-file-url=\"existingFiles?.entryfile_url\"\n                                    :label=\"t('EntryEditView.labels.entryfile')\"\n                                    :error-message=\"entryFile.errorMessage.value\"\n                                    :accept=\"entryAccept\"\n                                    required\n                                />\n                            </v-col>\n                            <v-col cols=\"12\" md=\"4\">\n                                <FileUploadField\n                                    v-model=\"sourceFile.value.value\"\n                                    :current-file-url=\"existingFiles?.sourcefile_url\"\n                                    :label=\"t('EntryEditView.labels.sourcefile')\"\n                                    :accept=\"sourceAccept\"\n                                />\n                            </v-col>\n                            <v-col v-if=\"allowsImageFile\" cols=\"12\" md=\"4\">\n                                <ImageUploadField\n                                    v-model=\"imageFile.value.value\"\n                                    :current-image-url=\"existingFiles?.imagefile_original_url\"\n                                    :label=\"t('EntryEditView.labels.imagefile')\"\n                                    :error-message=\"imageFile.errorMessage.value\"\n                                    :accept=\"imageAccept\"\n                                    :required=\"requiresImageFile\"\n                                />\n                            </v-col>\n                        </v-row>\n\n                        <FormSection>\n                            {{ t(\"EntryEditView.sections.media\") }}\n                        </FormSection>\n                        <v-text-field\n                            v-model=\"youtubeUrl.value.value\"\n                            :error-messages=\"youtubeUrl.errorMessage.value\"\n                            variant=\"outlined\"\n                            :label=\"t('EntryEditView.labels.youtubeUrl')\"\n                            placeholder=\"e.g. https://www.youtube.com/watch?v=dQw4w9WgXcQ\"\n                        />\n\n                        <FormSection v-if=\"isEditMode\">\n                            {{ t(\"EntryEditView.sections.ranking\") }}\n                        </FormSection>\n                        <v-row v-if=\"isEditMode\">\n                            <v-col cols=\"6\" md=\"3\">\n                                <div class=\"text-body-2 text-medium-emphasis\">\n                                    {{ t(\"EntryEditView.labels.score\") }}\n                                </div>\n                                <div class=\"text-h6\">{{ votingScore }}</div>\n                            </v-col>\n                            <v-col cols=\"6\" md=\"3\">\n                                <div class=\"text-body-2 text-medium-emphasis\">\n                                    {{ t(\"EntryEditView.labels.rank\") }}\n                                </div>\n                                <div class=\"text-h6\">{{ votingRank }}</div>\n                            </v-col>\n                        </v-row>\n\n                        <FormSection>\n                            {{ t(\"EntryEditView.sections.disqualification\") }}\n                        </FormSection>\n                        <DisqualificationField\n                            v-model=\"disqualified.value.value\"\n                            v-model:reason=\"disqualifiedReason.value.value\"\n                            :error-message=\"disqualified.errorMessage.value\"\n                            :reason-error-message=\"disqualifiedReason.errorMessage.value\"\n                            :label-on=\"t('EntryEditView.labels.disqualifiedOn')\"\n                            :label-off=\"t('EntryEditView.labels.disqualifiedOff')\"\n                            :reason-label=\"t('EntryEditView.labels.disqualifiedReason')\"\n                        />\n\n                        <template v-if=\"isEditMode && alternateFiles.length > 0\">\n                            <FormSection>\n                                {{ t(\"EntryEditView.sections.alternateFiles\") }}\n                            </FormSection>\n                            <v-list density=\"compact\">\n                                <v-list-item\n                                    v-for=\"file in alternateFiles\"\n                                    :key=\"file.url\"\n                                    :href=\"file.url\"\n                                    target=\"_blank\"\n                                    :title=\"file.format\"\n                                    :subtitle=\"file.url\"\n                                >\n                                    <template #prepend>\n                                        <FontAwesomeIcon :icon=\"faDownload\" class=\"mr-4\" />\n                                    </template>\n                                </v-list-item>\n                            </v-list>\n                        </template>\n                    </v-form>\n                </v-card-text>\n                <v-card-actions class=\"justify-end\">\n                    <v-btn variant=\"text\" @click=\"goBack\">\n                        {{ t(\"General.cancel\") }}\n                    </v-btn>\n                    <v-btn\n                        variant=\"elevated\"\n                        color=\"primary\"\n                        :loading=\"saving\"\n                        :disabled=\"!meta.valid\"\n                        @click=\"submit\"\n                    >\n                        <template #prepend>\n                            <FontAwesomeIcon :icon=\"faSave\" />\n                        </template>\n                        {{ t(\"General.save\") }}\n                    </v-btn>\n                </v-card-actions>\n            </v-card>\n        </v-col>\n    </LayoutBase>\n</template>\n\n<script setup lang=\"ts\">\nimport { faDownload, faFloppyDisk as faSave } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/vue-fontawesome\";\nimport { parseInt } from \"lodash-es\";\nimport { type GenericObject, useField, useForm } from \"vee-validate\";\nimport { computed, onMounted, ref, type Ref } from \"vue\";\nimport { useI18n } from \"vue-i18n\";\nimport { useRouter } from \"vue-router\";\nimport { useToast } from \"vue-toastification\";\nimport {\n    boolean as yupBoolean,\n    mixed as yupMixed,\n    number as yupNumber,\n    object as yupObject,\n    string as yupString,\n} from \"yup\";\n\nimport * as api from \"@/api\";\nimport type { AlternateEntryFile, Compo, CompoEntry, User } from \"@/api\";\nimport DisqualificationField from \"@/components/form/DisqualificationField.vue\";\nimport FileUploadField from \"@/components/form/FileUploadField.vue\";\nimport FormSection from \"@/components/form/FormSection.vue\";\nimport ImageUploadField from \"@/components/form/ImageUploadField.vue\";\nimport LayoutBase, { type BreadcrumbItem } from \"@/components/layout/LayoutBase.vue\";\nimport { useEvents } from \"@/services/events\";\nimport { type FileValue, getFile } from \"@/utils/file\";\nimport { prepareFileField, toFormData } from \"@/utils/formdata\";\nimport { handleApiError, type FieldMapping } from \"@/utils/http\";\n\n/** Maps API field names (snake_case) to form field names (camelCase) */\nconst API_FIELD_MAPPING: FieldMapping = {\n    name: \"name\",\n    creator: \"creator\",\n    description: \"description\",\n    compo: \"compo\",\n    user: \"user\",\n    platform: \"platform\",\n    entryfile: \"entryFile\",\n    sourcefile: \"sourceFile\",\n    imagefile_original: \"imageFile\",\n    youtube_url: \"youtubeUrl\",\n    disqualified: \"disqualified\",\n    disqualified_reason: \"disqualifiedReason\",\n};\n\nconst props = defineProps<{\n    eventId: string;\n    id?: string;\n}>();\n\nconst { t } = useI18n();\nconst router = useRouter();\nconst toast = useToast();\nconst { getEventById } = useEvents();\n\nconst loading = ref(false);\nconst saving = ref(false);\nconst entryName = ref<string>(\"\");\nconst eventId = computed(() => parseInt(props.eventId, 10));\nconst isEditMode = computed(() => props.id !== undefined);\n\nconst compos: Ref<Compo[]> = ref([]);\nconst users: Ref<User[]> = ref([]);\nconst existingFiles: Ref<Pick<\n    CompoEntry,\n    \"entryfile_url\" | \"sourcefile_url\" | \"imagefile_original_url\"\n> | null> = ref(null);\n\n// Readonly data for edit mode\nconst votingScore = ref<string>(\"-\");\nconst votingRank = ref<string>(\"-\");\nconst alternateFiles: Ref<AlternateEntryFile[]> = ref([]);\n\nconst breadcrumbs = computed<BreadcrumbItem[]>(() => {\n    const items: BreadcrumbItem[] = [\n        {\n            title: getEventById(eventId.value)?.name ?? \"...\",\n            to: { name: \"dashboard\", params: { eventId: props.eventId } },\n        },\n        {\n            title: t(\"EntriesView.title\"),\n            to: { name: \"entries\", params: { eventId: props.eventId } },\n        },\n    ];\n    if (isEditMode.value) {\n        items.push({ title: entryName.value || \"...\", disabled: true });\n    } else {\n        items.push({ title: t(\"Breadcrumbs.newEntry\"), disabled: true });\n    }\n    return items;\n});\n\nconst compoOptions = computed(() => compos.value.map((c) => ({ title: c.name, value: c.id })));\nconst userOptions = computed(() => users.value.map((u) => ({ title: u.username, value: u.id })));\n\n// Helper to get compo by ID for validation\nfunction getCompoById(compoId: number | null): Compo | null {\n    if (!compoId) return null;\n    return compos.value.find((c) => c.id === compoId) ?? null;\n}\n\nconst validationSchema = yupObject({\n    name: yupString().required().min(1).max(64),\n    creator: yupString().required().min(1).max(64),\n    description: yupString(),\n    compo: yupNumber().nullable().required(),\n    user: yupNumber().nullable().required(),\n    platform: yupString().nullable(),\n    youtubeUrl: yupString().nullable(),\n    disqualified: yupBoolean(),\n    disqualifiedReason: yupString(),\n    entryFile: yupMixed()\n        .nullable()\n        .test(\"entry-file-required\", t(\"EntryEditView.entryFileRequired\"), (value) => {\n            // Entry file is always required\n            // If a new file is selected, it's valid\n            if (getFile(value as FileValue)) return true;\n            // In edit mode, existing file is also OK\n            // value is undefined initially, null when cleared\n            if (value === undefined && existingFiles.value?.entryfile_url) return true;\n            return false;\n        }),\n    sourceFile: yupMixed().nullable(),\n    imageFile: yupMixed()\n        .nullable()\n        .test(\"image-file-required\", t(\"EntryEditView.imageFileRequired\"), function (value) {\n            // Image file is required when compo's thumbnail_pref === 0\n            const compoId = this.parent.compo;\n            const selectedCompo = getCompoById(compoId);\n            const requiresImage = selectedCompo?.thumbnail_pref === 0;\n            if (!requiresImage) return true;\n            // If a new file is selected, it's valid\n            if (getFile(value as FileValue)) return true;\n            // In edit mode, existing file is also OK\n            // value is undefined initially, null when cleared\n            if (value === undefined && existingFiles.value?.imagefile_original_url) return true;\n            return false;\n        }),\n});\n\nconst { handleSubmit, setValues, setErrors, meta } = useForm({\n    validationSchema,\n    initialValues: {\n        name: \"\",\n        creator: \"\",\n        description: \"\",\n        compo: null as number | null,\n        user: null as number | null,\n        platform: \"\",\n        youtubeUrl: \"\",\n        disqualified: false,\n        disqualifiedReason: \"\",\n        entryFile: undefined as FileValue | undefined,\n        sourceFile: undefined as FileValue | undefined,\n        imageFile: undefined as FileValue | undefined,\n    },\n});\n\nconst name = useField<string>(\"name\");\nconst creator = useField<string>(\"creator\");\nconst description = useField<string>(\"description\");\nconst compo = useField<number | null>(\"compo\");\nconst user = useField<number | null>(\"user\");\nconst platform = useField<string>(\"platform\");\nconst youtubeUrl = useField<string>(\"youtubeUrl\");\nconst disqualified = useField<boolean>(\"disqualified\");\nconst disqualifiedReason = useField<string>(\"disqualifiedReason\");\nconst entryFile = useField<FileValue>(\"entryFile\");\nconst sourceFile = useField<FileValue>(\"sourceFile\");\nconst imageFile = useField<FileValue>(\"imageFile\");\n\n// Get selected compo details for format restrictions\nconst selectedCompo = computed(() => {\n    const compoId = compo.value.value;\n    if (!compoId) return null;\n    return compos.value.find((c) => c.id === compoId) ?? null;\n});\n\n// Convert pipe-separated formats to accept attribute (e.g., \"zip|7z\" -> \".zip,.7z\")\nfunction formatsToAccept(formats: string | undefined): string | undefined {\n    if (!formats) return undefined;\n    return formats\n        .split(\"|\")\n        .filter(Boolean)\n        .map((ext) => `.${ext}`)\n        .join(\",\");\n}\n\n// File accept attributes based on selected compo\nconst entryAccept = computed(() => formatsToAccept(selectedCompo.value?.formats));\nconst sourceAccept = computed(() => formatsToAccept(selectedCompo.value?.source_formats));\nconst imageAccept = computed(() => formatsToAccept(selectedCompo.value?.image_formats));\n\n// Image file is allowed based on thumbnail_pref:\n// 0 = required, 1 = use entry file (no separate image), 2 = optional, 3 = not allowed\nconst allowsImageFile = computed(() => {\n    const pref = selectedCompo.value?.thumbnail_pref;\n    return pref === 0 || pref === 2;\n});\n\n// Image file is required when thumbnail_pref is 0\nconst requiresImageFile = computed(() => selectedCompo.value?.thumbnail_pref === 0);\n\nconst submit = handleSubmit(async (values) => {\n    saving.value = true;\n    let ok: boolean;\n    if (isEditMode.value) {\n        ok = await editItem(parseInt(props.id!, 10), values);\n    } else {\n        ok = await createItem(values);\n    }\n    saving.value = false;\n    if (ok) {\n        goBack();\n    }\n});\n\nfunction buildBody(values: GenericObject, isCreate: boolean) {\n    // For create, use getFile (requires a file). For edit, use prepareFileField (file is optional).\n    const fileGetter = isCreate ? getFile : prepareFileField;\n    return {\n        name: values.name,\n        creator: values.creator,\n        description: values.description || \"\",\n        // compo and user can only be set on create, not on edit\n        compo: isCreate ? values.compo : undefined,\n        user: isCreate ? values.user : undefined,\n        platform: values.platform || null,\n        entryfile: fileGetter(values.entryFile),\n        sourcefile: fileGetter(values.sourceFile),\n        imagefile_original: allowsImageFile.value ? fileGetter(values.imageFile) : undefined,\n        youtube_url: values.youtubeUrl || null,\n        disqualified: values.disqualified,\n        disqualified_reason: values.disqualifiedReason || \"\",\n    };\n}\n\nasync function createItem(values: GenericObject) {\n    const body = buildBody(values, true);\n    try {\n        await api.adminEventKompomaattiEntriesCreate({\n            path: { event_pk: eventId.value },\n            // Type assertion needed: our bodySerializer handles null for file clearing\n            body: body as api.CompoEntryRequest,\n            bodySerializer: () => toFormData(body),\n        });\n        toast.success(t(\"EntryEditView.createSuccess\"));\n        return true;\n    } catch (e) {\n        handleApiError(e, setErrors, toast, t(\"EntryEditView.createFailure\"), API_FIELD_MAPPING);\n    }\n    return false;\n}\n\nasync function editItem(itemId: number, values: GenericObject) {\n    const body = buildBody(values, false);\n    try {\n        await api.adminEventKompomaattiEntriesPartialUpdate({\n            path: { event_pk: eventId.value, id: itemId },\n            // Type assertion needed: our bodySerializer handles null for file clearing\n            body: body as api.PatchedCompoEntryRequest,\n            bodySerializer: () => toFormData(body),\n        });\n        toast.success(t(\"EntryEditView.editSuccess\"));\n        return true;\n    } catch (e) {\n        handleApiError(e, setErrors, toast, t(\"EntryEditView.editFailure\"), API_FIELD_MAPPING);\n    }\n    return false;\n}\n\nfunction goBack() {\n    router.push({ name: \"entries\", params: { eventId: props.eventId } });\n}\n\nasync function loadCompos() {\n    try {\n        const response = await api.adminEventKompomaattiComposList({\n            path: { event_pk: eventId.value },\n            query: { limit: 100 },\n        });\n        compos.value = response.data!.results;\n    } catch (e) {\n        console.error(\"Failed to load compos:\", e);\n    }\n}\n\nasync function loadUsers() {\n    try {\n        const response = await api.adminUsersList({\n            query: { limit: 1000 },\n        });\n        users.value = response.data!.results;\n    } catch (e) {\n        console.error(\"Failed to load users:\", e);\n    }\n}\n\nonMounted(async () => {\n    await Promise.all([loadCompos(), loadUsers()]);\n\n    if (isEditMode.value) {\n        loading.value = true;\n        try {\n            const response = await api.adminEventKompomaattiEntriesRetrieve({\n                path: { event_pk: eventId.value, id: parseInt(props.id!, 10) },\n            });\n            const item = response.data!;\n            entryName.value = item.name;\n            existingFiles.value = {\n                entryfile_url: item.entryfile_url,\n                sourcefile_url: item.sourcefile_url,\n                imagefile_original_url: item.imagefile_original_url,\n            };\n\n            // Set readonly voting results\n            votingScore.value = item.score?.toString() ?? \"-\";\n            votingRank.value = item.rank?.toString() ?? \"-\";\n            alternateFiles.value = item.alternate_files ?? [];\n\n            setValues({\n                name: item.name,\n                creator: item.creator,\n                description: item.description ?? \"\",\n                compo: item.compo,\n                user: item.user,\n                platform: item.platform ?? \"\",\n                youtubeUrl: item.youtube_url ?? \"\",\n                disqualified: item.disqualified ?? false,\n                disqualifiedReason: item.disqualified_reason ?? \"\",\n            });\n        } catch (e) {\n            toast.error(t(\"EntryEditView.loadFailure\"));\n            console.error(e);\n            goBack();\n        } finally {\n            loading.value = false;\n        }\n    }\n});\n</script>\n"],"names":["API_FIELD_MAPPING","props","__props","t","useI18n","router","useRouter","toast","useToast","getEventById","useEvents","loading","ref","saving","entryName","eventId","computed","parseInt","isEditMode","compos","users","existingFiles","votingScore","votingRank","alternateFiles","breadcrumbs","items","compoOptions","c","userOptions","u","getCompoById","compoId","validationSchema","yupObject","yupString","yupNumber","yupBoolean","yupMixed","value","getFile","handleSubmit","setValues","setErrors","meta","useForm","name","useField","creator","description","compo","user","platform","youtubeUrl","disqualified","disqualifiedReason","entryFile","sourceFile","imageFile","selectedCompo","formatsToAccept","formats","ext","entryAccept","sourceAccept","imageAccept","allowsImageFile","pref","requiresImageFile","submit","values","ok","editItem","createItem","goBack","buildBody","isCreate","fileGetter","prepareFileField","body","api.adminEventKompomaattiEntriesCreate","toFormData","e","handleApiError","itemId","api.adminEventKompomaattiEntriesPartialUpdate","loadCompos","response","api.adminEventKompomaattiComposList","loadUsers","api.adminUsersList","onMounted","item","api.adminEventKompomaattiEntriesRetrieve","_createBlock","LayoutBase","_component_v_col","_createVNode","_component_v_progress_circular","_component_v_card","_component_v_card_text","_component_v_form","_unref","_component_v_row","_component_v_text_field","$event","_component_v_textarea","_component_v_select","_component_v_autocomplete","FormSection","FileUploadField","ImageUploadField","_createElementVNode","_hoisted_1","_toDisplayString","_hoisted_2","_hoisted_3","_hoisted_4","DisqualificationField","_createElementBlock","_Fragment","_component_v_list","_renderList","file","_component_v_list_item","FontAwesomeIcon","faDownload","_component_v_card_actions","_component_v_btn","faSave","_createTextVNode"],"mappings":"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"}