import{d as Se,a as he,u as Re,v as Be,ay as Ae,az as $e,o as De,aA as Le,b as m,g as p,w as s,e as r,A as Ne,p as Pe,B as Te,l as je,j as e,m as I,a2 as Ge,i as b,t as n,K as k,f as U,c as re,F as ie,aB as Ke,r as ze,aj as Oe,k as se,ax as Qe,C as We,V as oe,D as Xe,s as c,G as d,af as He,S as Je,E as Ye}from"./index-BSHMv_df.js";import{c as Ze,f as K,a as V,d as ea,g as ue,u as aa,b as o,V as la}from"./index.esm-71TeWLhH.js";import{V as ta,_ as ra}from"./DisqualificationField.vue_vue_type_script_setup_true_lang-BBN2Bs-E.js";import{F as ne}from"./FileUploadField-CMDx8I9D.js";import{F as w}from"./FormSection-Dax0lJeU.js";import{I as ia}from"./ImageUploadField-C30q5UXp.js";import{V as u,_ as sa}from"./LayoutBase.vue_vue_type_script_setup_true_lang-C8aKWyeJ.js";import{g as z,t as de,p as oa}from"./formdata-C-bOWTdV.js";import{h as me}from"./http-BZkoYM_m.js";import{p as O}from"./parseInt-3OpbdfxQ.js";import{V as x}from"./VRow-BUBfmFS3.js";import{V as ua}from"./VTextarea-D79tNJe6.js";import"./filter-C6Uu0LOB.js";import"./VSwitch-DkiL1OKS.js";import"./VContainer--EpXOfw5.js";const na={class:"text-body-2 text-medium-emphasis"},da={class:"text-h6"},ma={class:"text-body-2 text-medium-emphasis"},ca={class:"text-h6"},xa=Se({__name:"EntryEditView",props:{eventId:{},id:{}},setup(ce){const Q={name:"name",creator:"creator",description:"description",compo:"compo",user:"user",platform:"platform",entryfile:"entryFile",sourcefile:"sourceFile",imagefile_original:"imageFile",youtube_url:"youtubeUrl",disqualified:"disqualified",disqualified_reason:"disqualifiedReason"},v=ce,{t:i}=he(),fe=Re(),g=Be(),{getEventById:ve}=Ye(),C=c(!1),M=c(!1),W=c(""),E=d(()=>O(v.eventId,10)),f=d(()=>v.id!==void 0),F=c([]),X=c([]),y=c(null),H=c("-"),J=c("-"),S=c([]),pe=d(()=>{const l=[{title:ve(E.value)?.name??"...",to:{name:"dashboard",params:{eventId:v.eventId}}},{title:i("EntriesView.title"),to:{name:"entries",params:{eventId:v.eventId}}}];return f.value?l.push({title:W.value||"...",disabled:!0}):l.push({title:i("Breadcrumbs.newEntry"),disabled:!0}),l}),be=d(()=>F.value.map(l=>({title:l.name,value:l.id}))),ye=d(()=>X.value.map(l=>({title:l.username,value:l.id})));function Ve(l){return l?F.value.find(a=>a.id===l)??null:null}const ge=Ze({name:V().required().min(1).max(64),creator:V().required().min(1).max(64),description:V(),compo:ue().nullable().required(),user:ue().nullable().required(),platform:V().nullable(),youtubeUrl:V().nullable(),disqualified:ea(),disqualifiedReason:V(),entryFile:K().nullable().test("entry-file-required",i("EntryEditView.entryFileRequired"),l=>!!(z(l)||l===void 0&&y.value?.entryfile_url)),sourceFile:K().nullable(),imageFile:K().nullable().test("image-file-required",i("EntryEditView.imageFileRequired"),function(l){const a=this.parent.compo;return!!(!(Ve(a)?.thumbnail_pref===0)||z(l)||l===void 0&&y.value?.imagefile_original_url)})}),{handleSubmit:Ee,setValues:_e,setErrors:Y,meta:we}=aa({validationSchema:ge,initialValues:{name:"",creator:"",description:"",compo:null,user:null,platform:"",youtubeUrl:"",disqualified:!1,disqualifiedReason:"",entryFile:void 0,sourceFile:void 0,imageFile:void 0}}),h=o("name"),R=o("creator"),B=o("description"),q=o("compo"),A=o("user"),$=o("platform"),D=o("youtubeUrl"),L=o("disqualified"),N=o("disqualifiedReason"),P=o("entryFile"),Z=o("sourceFile"),T=o("imageFile"),_=d(()=>{const l=q.value.value;return l?F.value.find(a=>a.id===l)??null:null});function j(l){if(l)return l.split("|").filter(Boolean).map(a=>`.${a}`).join(",")}const Fe=d(()=>j(_.value?.formats)),qe=d(()=>j(_.value?.source_formats)),Ie=d(()=>j(_.value?.image_formats)),ee=d(()=>{const l=_.value?.thumbnail_pref;return l===0||l===2}),ke=d(()=>_.value?.thumbnail_pref===0),ae=Ee(async l=>{M.value=!0;let a;f.value?a=await xe(O(v.id,10),l):a=await Ue(l),M.value=!1,a&&G()});function le(l,a){const t=a?z:oa;return{name:l.name,creator:l.creator,description:l.description||"",compo:a?l.compo:void 0,user:a?l.user:void 0,platform:l.platform||null,entryfile:t(l.entryFile),sourcefile:t(l.sourceFile),imagefile_original:ee.value?t(l.imageFile):void 0,youtube_url:l.youtubeUrl||null,disqualified:l.disqualified,disqualified_reason:l.disqualifiedReason||""}}async function Ue(l){const a=le(l,!0);try{return await Ae({path:{event_pk:E.value},body:a,bodySerializer:()=>de(a)}),g.success(i("EntryEditView.createSuccess")),!0}catch(t){me(t,Y,g,i("EntryEditView.createFailure"),Q)}return!1}async function xe(l,a){const t=le(a,!1);try{return await $e({path:{event_pk:E.value,id:l},body:t,bodySerializer:()=>de(t)}),g.success(i("EntryEditView.editSuccess")),!0}catch(te){me(te,Y,g,i("EntryEditView.editFailure"),Q)}return!1}function G(){fe.push({name:"entries",params:{eventId:v.eventId}})}async function Ce(){try{const l=await He({path:{event_pk:E.value},query:{limit:100}});F.value=l.data.results}catch(l){console.error("Failed to load compos:",l)}}async function Me(){try{const l=await Je({query:{limit:1e3}});X.value=l.data.results}catch(l){console.error("Failed to load users:",l)}}return De(async()=>{if(await Promise.all([Ce(),Me()]),f.value){C.value=!0;try{const a=(await Le({path:{event_pk:E.value,id:O(v.id,10)}})).data;W.value=a.name,y.value={entryfile_url:a.entryfile_url,sourcefile_url:a.sourcefile_url,imagefile_original_url:a.imagefile_original_url},H.value=a.score?.toString()??"-",J.value=a.rank?.toString()??"-",S.value=a.alternate_files??[],_e({name:a.name,creator:a.creator,description:a.description??"",compo:a.compo,user:a.user,platform:a.platform??"",youtubeUrl:a.youtube_url??"",disqualified:a.disqualified??!1,disqualifiedReason:a.disqualified_reason??""})}catch(l){g.error(i("EntryEditView.loadFailure")),console.error(l),G()}finally{C.value=!1}}}),(l,a)=>(m(),p(sa,{breadcrumbs:pe.value},{default:s(()=>[C.value?(m(),p(u,{key:0,class:"d-flex justify-center my-8"},{default:s(()=>[r(Ne,{indeterminate:"",size:"64"})]),_:1})):(m(),p(u,{key:1},{default:s(()=>[r(Pe,null,{default:s(()=>[r(Te,null,{default:s(()=>[r(la,{onSubmit:je(e(ae),["prevent"])},{default:s(()=>[r(x,null,{default:s(()=>[r(u,{cols:"12",md:"6"},{default:s(()=>[r(I,{modelValue:e(h).value.value,"onUpdate:modelValue":a[0]||(a[0]=t=>e(h).value.value=t),"error-messages":e(h).errorMessage.value,variant:"outlined",label:e(i)("EntryEditView.labels.name")+" *"},null,8,["modelValue","error-messages","label"])]),_:1}),r(u,{cols:"12",md:"6"},{default:s(()=>[r(I,{modelValue:e(R).value.value,"onUpdate:modelValue":a[1]||(a[1]=t=>e(R).value.value=t),"error-messages":e(R).errorMessage.value,variant:"outlined",label:e(i)("EntryEditView.labels.creator")+" *"},null,8,["modelValue","error-messages","label"])]),_:1})]),_:1}),r(ua,{modelValue:e(B).value.value,"onUpdate:modelValue":a[2]||(a[2]=t=>e(B).value.value=t),"error-messages":e(B).errorMessage.value,variant:"outlined",label:e(i)("EntryEditView.labels.description"),rows:"3"},null,8,["modelValue","error-messages","label"]),r(x,null,{default:s(()=>[r(u,{cols:"12",md:"4"},{default:s(()=>[r(Ge,{modelValue:e(q).value.value,"onUpdate:modelValue":a[3]||(a[3]=t=>e(q).value.value=t),modelModifiers:{number:!0},items:be.value,"error-messages":e(q).errorMessage.value,variant:"outlined",label:e(i)("EntryEditView.labels.compo")+" *",disabled:f.value},null,8,["modelValue","items","error-messages","label","disabled"])]),_:1}),r(u,{cols:"12",md:"4"},{default:s(()=>[r(I,{modelValue:e($).value.value,"onUpdate:modelValue":a[4]||(a[4]=t=>e($).value.value=t),"error-messages":e($).errorMessage.value,variant:"outlined",label:e(i)("EntryEditView.labels.platform")},null,8,["modelValue","error-messages","label"])]),_:1}),r(u,{cols:"12",md:"4"},{default:s(()=>[r(ta,{modelValue:e(A).value.value,"onUpdate:modelValue":a[5]||(a[5]=t=>e(A).value.value=t),modelModifiers:{number:!0},items:ye.value,"error-messages":e(A).errorMessage.value,variant:"outlined",label:e(i)("EntryEditView.labels.user")+" *",disabled:f.value},null,8,["modelValue","items","error-messages","label","disabled"])]),_:1})]),_:1}),r(w,null,{default:s(()=>[b(n(e(i)("EntryEditView.sections.files")),1)]),_:1}),r(x,null,{default:s(()=>[r(u,{cols:"12",md:"4"},{default:s(()=>[r(ne,{modelValue:e(P).value.value,"onUpdate:modelValue":a[6]||(a[6]=t=>e(P).value.value=t),"current-file-url":y.value?.entryfile_url,label:e(i)("EntryEditView.labels.entryfile"),"error-message":e(P).errorMessage.value,accept:Fe.value,required:""},null,8,["modelValue","current-file-url","label","error-message","accept"])]),_:1}),r(u,{cols:"12",md:"4"},{default:s(()=>[r(ne,{modelValue:e(Z).value.value,"onUpdate:modelValue":a[7]||(a[7]=t=>e(Z).value.value=t),"current-file-url":y.value?.sourcefile_url,label:e(i)("EntryEditView.labels.sourcefile"),accept:qe.value},null,8,["modelValue","current-file-url","label","accept"])]),_:1}),ee.value?(m(),p(u,{key:0,cols:"12",md:"4"},{default:s(()=>[r(ia,{modelValue:e(T).value.value,"onUpdate:modelValue":a[8]||(a[8]=t=>e(T).value.value=t),"current-image-url":y.value?.imagefile_original_url,label:e(i)("EntryEditView.labels.imagefile"),"error-message":e(T).errorMessage.value,accept:Ie.value,required:ke.value},null,8,["modelValue","current-image-url","label","error-message","accept","required"])]),_:1})):k("",!0)]),_:1}),r(w,null,{default:s(()=>[b(n(e(i)("EntryEditView.sections.media")),1)]),_:1}),r(I,{modelValue:e(D).value.value,"onUpdate:modelValue":a[9]||(a[9]=t=>e(D).value.value=t),"error-messages":e(D).errorMessage.value,variant:"outlined",label:e(i)("EntryEditView.labels.youtubeUrl"),placeholder:"e.g. https://www.youtube.com/watch?v=dQw4w9WgXcQ"},null,8,["modelValue","error-messages","label"]),f.value?(m(),p(w,{key:0},{default:s(()=>[b(n(e(i)("EntryEditView.sections.ranking")),1)]),_:1})):k("",!0),f.value?(m(),p(x,{key:1},{default:s(()=>[r(u,{cols:"6",md:"3"},{default:s(()=>[U("div",na,n(e(i)("EntryEditView.labels.score")),1),U("div",da,n(H.value),1)]),_:1}),r(u,{cols:"6",md:"3"},{default:s(()=>[U("div",ma,n(e(i)("EntryEditView.labels.rank")),1),U("div",ca,n(J.value),1)]),_:1})]),_:1})):k("",!0),r(w,null,{default:s(()=>[b(n(e(i)("EntryEditView.sections.disqualification")),1)]),_:1}),r(ra,{modelValue:e(L).value.value,"onUpdate:modelValue":a[10]||(a[10]=t=>e(L).value.value=t),reason:e(N).value.value,"onUpdate:reason":a[11]||(a[11]=t=>e(N).value.value=t),"error-message":e(L).errorMessage.value,"reason-error-message":e(N).errorMessage.value,"label-on":e(i)("EntryEditView.labels.disqualifiedOn"),"label-off":e(i)("EntryEditView.labels.disqualifiedOff"),"reason-label":e(i)("EntryEditView.labels.disqualifiedReason")},null,8,["modelValue","reason","error-message","reason-error-message","label-on","label-off","reason-label"]),f.value&&S.value.length>0?(m(),re(ie,{key:2},[r(w,null,{default:s(()=>[b(n(e(i)("EntryEditView.sections.alternateFiles")),1)]),_:1}),r(Ke,{density:"compact"},{default:s(()=>[(m(!0),re(ie,null,ze(S.value,t=>(m(),p(Oe,{key:t.url,href:t.url,target:"_blank",title:t.format,subtitle:t.url},{prepend:s(()=>[r(e(se),{icon:e(Qe),class:"mr-4"},null,8,["icon"])]),_:1},8,["href","title","subtitle"]))),128))]),_:1})],64)):k("",!0)]),_:1},8,["onSubmit"])]),_:1}),r(We,{class:"justify-end"},{default:s(()=>[r(oe,{variant:"text",onClick:G},{default:s(()=>[b(n(e(i)("General.cancel")),1)]),_:1}),r(oe,{variant:"elevated",color:"primary",loading:M.value,disabled:!e(we).valid,onClick:e(ae)},{prepend:s(()=>[r(e(se),{icon:e(Xe)},null,8,["icon"])]),default:s(()=>[b(" "+n(e(i)("General.save")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1}))]),_:1},8,["breadcrumbs"]))}});export{xa as default};
//# sourceMappingURL=EntryEditView-Be7-qlOW.js.map
