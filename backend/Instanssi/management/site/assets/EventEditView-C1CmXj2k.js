import{d as W,a as X,u as Y,v as Z,x as ee,y as ae,o as te,z as le,b as u,g as m,w as s,e as n,A as ne,p as re,B as se,l as oe,j as e,m as v,C as ie,D as de,E as ue,V as A,i as S,t as U,k as me,G as ve,H as ce,s as k,I as B}from"./index-DXU74lGt.js";import{c as fe,a as w,d as H,e as pe,u as ge,b as o}from"./index.esm-DWTrtXO7.js";import{_ as be}from"./AuditLogButton.vue_vue_type_script_setup_true_lang-5kFykphF.js";import{_ as N}from"./ToggleSwitch.vue_vue_type_script_setup_true_lang-p7genbiO.js";import{V as $,_ as he}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D4jd1chv.js";import{h as P}from"./http-BTZWMaMN.js";import{p as j}from"./parseInt-Bzw_2rWL.js";import{V as Ve}from"./VForm-C430u1Uz.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-WkXOSlqa.js";import"./useAuditLogUtils-BqNOieoY.js";import"./DateTimeCell.vue_vue_type_script_setup_true_lang-BMnBYvTq.js";import"./datetime-Dz9fjSvq.js";import"./VDataTableServer-CMLVDy59.js";import"./VDataTable-Jd7io3gq.js";import"./VSwitch-DB1fJMny.js";import"./VContainer-BfWqa_tJ.js";const Ne=W({__name:"EventEditView",props:{id:{}},setup(C){const x={name:"name",date:"date",archived:"archived",hidden:"hidden",tag:"tag",mainurl:"mainurl"},c=C,{t}=X(),q=Y(),i=Z(),{getLatestEvent:G,refreshEvents:O}=ce(),f=k(!1),p=k(!1),_=k(""),d=B(()=>c.id!==void 0),T=B(()=>{const l=G(),a=[{title:l?.name??"...",to:l?{name:"dashboard",params:{eventId:l.id}}:void 0},{title:t("EventView.title"),to:{name:"events"}}];return d.value?a.push({title:_.value||"...",disabled:!0}):a.push({title:t("Breadcrumbs.newEvent"),disabled:!0}),a}),z=fe({name:w().required().min(1).max(64),tag:w().required().min(1).max(8),date:pe().required(),archived:H(),hidden:H(),mainurl:w().required().url().max(200)}),{handleSubmit:L,setValues:R,setErrors:F,meta:J}=ge({validationSchema:z,initialValues:{name:"",tag:"",date:"",archived:!1,hidden:!1,mainurl:""}}),g=o("name"),b=o("tag"),h=o("date"),V=o("archived"),E=o("hidden"),y=o("mainurl"),I=L(async l=>{p.value=!0;let a;d.value?a=await Q(j(c.id,10),l):a=await K(l),p.value=!1,a&&(await O(),D())});function M(l){return{name:l.name,date:l.date,archived:l.archived,hidden:l.hidden,tag:l.tag,mainurl:l.mainurl}}async function K(l){try{return await ee({body:M(l)}),i.success(t("EventDialog.createSuccess")),!0}catch(a){P(a,F,i,t("EventDialog.createFailure"),x)}return!1}async function Q(l,a){try{return await ae({path:{id:l},body:M(a)}),i.success(t("EventDialog.editSuccess")),!0}catch(r){P(r,F,i,t("EventDialog.editFailure"),x)}return!1}function D(){q.push({name:"events"})}return te(async()=>{if(d.value){f.value=!0;try{const a=(await le({path:{id:j(c.id,10)}})).data;_.value=a.name,R({name:a.name,tag:a.tag??"",date:a.date,archived:a.archived??!1,hidden:a.hidden??!1,mainurl:a.mainurl??""})}catch(l){i.error(t("EventEditView.loadFailure")),console.error(l),D()}finally{f.value=!1}}}),(l,a)=>(u(),m(he,{breadcrumbs:T.value},{default:s(()=>[f.value?(u(),m($,{key:0,class:"d-flex justify-center my-8"},{default:s(()=>[n(ne,{indeterminate:"",size:"64"})]),_:1})):(u(),m($,{key:1},{default:s(()=>[n(re,null,{default:s(()=>[n(se,null,{default:s(()=>[n(Ve,{onSubmit:oe(e(I),["prevent"])},{default:s(()=>[n(v,{modelValue:e(g).value.value,"onUpdate:modelValue":a[0]||(a[0]=r=>e(g).value.value=r),"error-messages":e(g).errorMessage.value,variant:"outlined",label:e(t)("EventDialog.labels.name")+" *"},null,8,["modelValue","error-messages","label"]),n(v,{modelValue:e(b).value.value,"onUpdate:modelValue":a[1]||(a[1]=r=>e(b).value.value=r),"error-messages":e(b).errorMessage.value,variant:"outlined",label:e(t)("EventDialog.labels.tag")+" *"},null,8,["modelValue","error-messages","label"]),n(v,{modelValue:e(h).value.value,"onUpdate:modelValue":a[2]||(a[2]=r=>e(h).value.value=r),type:"date","error-messages":e(h).errorMessage.value,variant:"outlined",label:e(t)("EventDialog.labels.date")+" *"},null,8,["modelValue","error-messages","label"]),n(v,{modelValue:e(y).value.value,"onUpdate:modelValue":a[3]||(a[3]=r=>e(y).value.value=r),"error-messages":e(y).errorMessage.value,variant:"outlined",label:e(t)("EventDialog.labels.mainUrl")+" *"},null,8,["modelValue","error-messages","label"]),n(N,{modelValue:e(V).value.value,"onUpdate:modelValue":a[4]||(a[4]=r=>e(V).value.value=r),"error-message":e(V).errorMessage.value,"label-on":e(t)("EventDialog.labels.isArchived"),"label-off":e(t)("EventDialog.labels.isNotArchived"),"hint-on":e(t)("EventDialog.labels.archivedHintOn"),"hint-off":e(t)("EventDialog.labels.archivedHintOff"),color:"success"},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"]),n(N,{"model-value":!e(E).value.value,"error-message":e(E).errorMessage.value,"label-on":e(t)("EventDialog.labels.isNotHidden"),"label-off":e(t)("EventDialog.labels.isHidden"),"hint-on":e(t)("EventDialog.labels.hiddenHintOff"),"hint-off":e(t)("EventDialog.labels.hiddenHintOn"),color:"success","onUpdate:modelValue":a[5]||(a[5]=r=>e(E).value.value=!r)},null,8,["model-value","error-message","label-on","label-off","hint-on","hint-off"])]),_:1},8,["onSubmit"])]),_:1}),n(ie,null,{default:s(()=>[d.value?(u(),m(be,{key:0,"app-label":"kompomaatti",model:"event","object-pk":C.id},null,8,["object-pk"])):de("",!0),n(ue),n(A,{variant:"text",onClick:D},{default:s(()=>[S(U(e(t)("General.cancel")),1)]),_:1}),n(A,{variant:"elevated",color:"primary",loading:p.value,disabled:!e(J).valid,onClick:e(I)},{prepend:s(()=>[n(e(me),{icon:e(ve)},null,8,["icon"])]),default:s(()=>[S(" "+U(e(t)("General.save")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1}))]),_:1},8,["breadcrumbs"]))}});export{Ne as default};
//# sourceMappingURL=EventEditView-C1CmXj2k.js.map
