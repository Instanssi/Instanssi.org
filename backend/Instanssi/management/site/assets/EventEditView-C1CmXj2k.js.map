{"version":3,"file":"EventEditView-C1CmXj2k.js","sources":["../../../../../admin/src/views/events/EventEditView.vue"],"sourcesContent":["<template>\n    <LayoutBase :breadcrumbs=\"breadcrumbs\">\n        <v-col v-if=\"loading\" class=\"d-flex justify-center my-8\">\n            <v-progress-circular indeterminate size=\"64\" />\n        </v-col>\n        <v-col v-else>\n            <v-card>\n                <v-card-text>\n                    <v-form @submit.prevent=\"submit\">\n                        <v-text-field\n                            v-model=\"name.value.value\"\n                            :error-messages=\"name.errorMessage.value\"\n                            variant=\"outlined\"\n                            :label=\"t('EventDialog.labels.name') + ' *'\"\n                        />\n                        <v-text-field\n                            v-model=\"tag.value.value\"\n                            :error-messages=\"tag.errorMessage.value\"\n                            variant=\"outlined\"\n                            :label=\"t('EventDialog.labels.tag') + ' *'\"\n                        />\n                        <v-text-field\n                            v-model=\"date.value.value\"\n                            type=\"date\"\n                            :error-messages=\"date.errorMessage.value\"\n                            variant=\"outlined\"\n                            :label=\"t('EventDialog.labels.date') + ' *'\"\n                        />\n                        <v-text-field\n                            v-model=\"mainurl.value.value\"\n                            :error-messages=\"mainurl.errorMessage.value\"\n                            variant=\"outlined\"\n                            :label=\"t('EventDialog.labels.mainUrl') + ' *'\"\n                        />\n                        <ToggleSwitch\n                            v-model=\"archived.value.value\"\n                            :error-message=\"archived.errorMessage.value\"\n                            :label-on=\"t('EventDialog.labels.isArchived')\"\n                            :label-off=\"t('EventDialog.labels.isNotArchived')\"\n                            :hint-on=\"t('EventDialog.labels.archivedHintOn')\"\n                            :hint-off=\"t('EventDialog.labels.archivedHintOff')\"\n                            color=\"success\"\n                        />\n                        <ToggleSwitch\n                            :model-value=\"!hidden.value.value\"\n                            :error-message=\"hidden.errorMessage.value\"\n                            :label-on=\"t('EventDialog.labels.isNotHidden')\"\n                            :label-off=\"t('EventDialog.labels.isHidden')\"\n                            :hint-on=\"t('EventDialog.labels.hiddenHintOff')\"\n                            :hint-off=\"t('EventDialog.labels.hiddenHintOn')\"\n                            color=\"success\"\n                            @update:model-value=\"hidden.value.value = !$event\"\n                        />\n                    </v-form>\n                </v-card-text>\n                <v-card-actions>\n                    <AuditLogButton\n                        v-if=\"isEditMode\"\n                        app-label=\"kompomaatti\"\n                        model=\"event\"\n                        :object-pk=\"id\"\n                    />\n                    <v-spacer />\n                    <v-btn variant=\"text\" @click=\"goBack\">\n                        {{ t(\"General.cancel\") }}\n                    </v-btn>\n                    <v-btn\n                        variant=\"elevated\"\n                        color=\"primary\"\n                        :loading=\"saving\"\n                        :disabled=\"!meta.valid\"\n                        @click=\"submit\"\n                    >\n                        <template #prepend>\n                            <FontAwesomeIcon :icon=\"faSave\" />\n                        </template>\n                        {{ t(\"General.save\") }}\n                    </v-btn>\n                </v-card-actions>\n            </v-card>\n        </v-col>\n    </LayoutBase>\n</template>\n\n<script setup lang=\"ts\">\nimport { faFloppyDisk as faSave } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/vue-fontawesome\";\nimport { parseInt } from \"lodash-es\";\nimport { type GenericObject, useField, useForm } from \"vee-validate\";\nimport { computed, onMounted, ref } from \"vue\";\nimport { useI18n } from \"vue-i18n\";\nimport { useRouter } from \"vue-router\";\nimport { useToast } from \"vue-toastification\";\nimport {\n    date as yupDate,\n    boolean as yupBoolean,\n    object as yupObject,\n    string as yupString,\n} from \"yup\";\n\nimport * as api from \"@/api\";\nimport AuditLogButton from \"@/components/auditlog/AuditLogButton.vue\";\nimport ToggleSwitch from \"@/components/form/ToggleSwitch.vue\";\nimport LayoutBase, { type BreadcrumbItem } from \"@/components/layout/LayoutBase.vue\";\nimport { useEvents } from \"@/services/events\";\nimport { handleApiError, type FieldMapping } from \"@/utils/http\";\n\n/** Maps API field names (snake_case) to form field names (camelCase) */\nconst API_FIELD_MAPPING: FieldMapping = {\n    name: \"name\",\n    date: \"date\",\n    archived: \"archived\",\n    hidden: \"hidden\",\n    tag: \"tag\",\n    mainurl: \"mainurl\",\n};\n\nconst props = defineProps<{\n    id?: string;\n}>();\n\nconst { t } = useI18n();\nconst router = useRouter();\nconst toast = useToast();\nconst { getLatestEvent, refreshEvents } = useEvents();\n\nconst loading = ref(false);\nconst saving = ref(false);\nconst eventName = ref<string>(\"\");\nconst isEditMode = computed(() => props.id !== undefined);\n\nconst breadcrumbs = computed<BreadcrumbItem[]>(() => {\n    const event = getLatestEvent();\n    const items: BreadcrumbItem[] = [\n        {\n            title: event?.name ?? \"...\",\n            to: event ? { name: \"dashboard\", params: { eventId: event.id } } : undefined,\n        },\n        { title: t(\"EventView.title\"), to: { name: \"events\" } },\n    ];\n    if (isEditMode.value) {\n        items.push({ title: eventName.value || \"...\", disabled: true });\n    } else {\n        items.push({ title: t(\"Breadcrumbs.newEvent\"), disabled: true });\n    }\n    return items;\n});\n\n// Form validation\nconst validationSchema = yupObject({\n    name: yupString().required().min(1).max(64),\n    tag: yupString().required().min(1).max(8),\n    date: yupDate().required(),\n    archived: yupBoolean(),\n    hidden: yupBoolean(),\n    mainurl: yupString().required().url().max(200),\n});\nconst { handleSubmit, setValues, setErrors, meta } = useForm({\n    validationSchema,\n    initialValues: {\n        name: \"\",\n        tag: \"\",\n        date: \"\",\n        archived: false,\n        hidden: false,\n        mainurl: \"\",\n    },\n});\nconst name = useField<string>(\"name\");\nconst tag = useField<string>(\"tag\");\nconst date = useField<string>(\"date\");\nconst archived = useField<boolean>(\"archived\");\nconst hidden = useField<boolean>(\"hidden\");\nconst mainurl = useField<string>(\"mainurl\");\n\nconst submit = handleSubmit(async (values) => {\n    saving.value = true;\n    let ok: boolean;\n    if (isEditMode.value) {\n        ok = await editItem(parseInt(props.id!, 10), values);\n    } else {\n        ok = await createItem(values);\n    }\n    saving.value = false;\n    if (ok) {\n        await refreshEvents();\n        goBack();\n    }\n});\n\nfunction buildBody(values: GenericObject) {\n    return {\n        name: values.name,\n        date: values.date,\n        archived: values.archived,\n        hidden: values.hidden,\n        tag: values.tag,\n        mainurl: values.mainurl,\n    };\n}\n\nasync function createItem(values: GenericObject) {\n    try {\n        await api.adminEventsCreate({\n            body: buildBody(values),\n        });\n        toast.success(t(\"EventDialog.createSuccess\"));\n        return true;\n    } catch (e) {\n        handleApiError(e, setErrors, toast, t(\"EventDialog.createFailure\"), API_FIELD_MAPPING);\n    }\n    return false;\n}\n\nasync function editItem(itemId: number, values: GenericObject) {\n    try {\n        await api.adminEventsPartialUpdate({\n            path: { id: itemId },\n            body: buildBody(values),\n        });\n        toast.success(t(\"EventDialog.editSuccess\"));\n        return true;\n    } catch (e) {\n        handleApiError(e, setErrors, toast, t(\"EventDialog.editFailure\"), API_FIELD_MAPPING);\n    }\n    return false;\n}\n\nfunction goBack() {\n    router.push({ name: \"events\" });\n}\n\nonMounted(async () => {\n    if (isEditMode.value) {\n        loading.value = true;\n        try {\n            const response = await api.adminEventsRetrieve({\n                path: { id: parseInt(props.id!, 10) },\n            });\n            const item = response.data!;\n            eventName.value = item.name;\n            setValues({\n                name: item.name,\n                tag: item.tag ?? \"\",\n                date: item.date,\n                archived: item.archived ?? false,\n                hidden: item.hidden ?? false,\n                mainurl: item.mainurl ?? \"\",\n            });\n        } catch (e) {\n            toast.error(t(\"EventEditView.loadFailure\"));\n            console.error(e);\n            goBack();\n        } finally {\n            loading.value = false;\n        }\n    }\n});\n</script>\n"],"names":["API_FIELD_MAPPING","props","__props","useI18n","router","useRouter","toast","useToast","getLatestEvent","refreshEvents","useEvents","loading","ref","saving","eventName","isEditMode","computed","breadcrumbs","event","items","validationSchema","yupObject","yupString","yupDate","yupBoolean","handleSubmit","setValues","setErrors","meta","useForm","name","useField","tag","date","archived","hidden","mainurl","submit","values","ok","editItem","parseInt","createItem","goBack","buildBody","api.adminEventsCreate","e","handleApiError","itemId","api.adminEventsPartialUpdate","onMounted","item","api.adminEventsRetrieve","_createBlock","LayoutBase","_component_v_col","_createVNode","_component_v_progress_circular","_component_v_card","_component_v_card_text","_component_v_form","_unref","_component_v_text_field","$event","ToggleSwitch","_component_v_card_actions","AuditLogButton","_component_v_spacer","_component_v_btn","FontAwesomeIcon","faSave","_createTextVNode"],"mappings":"gmCA4GA,MAAMA,EAAkC,CACpC,KAAM,OACN,KAAM,OACN,SAAU,WACV,OAAQ,SACR,IAAK,MACL,QAAS,SAAA,EAGPC,EAAQC,EAIR,CAAE,CAAA,EAAMC,EAAA,EACRC,EAASC,EAAA,EACTC,EAAQC,EAAA,EACR,CAAE,eAAAC,EAAgB,cAAAC,CAAA,EAAkBC,GAAA,EAEpCC,EAAUC,EAAI,EAAK,EACnBC,EAASD,EAAI,EAAK,EAClBE,EAAYF,EAAY,EAAE,EAC1BG,EAAaC,EAAS,IAAMf,EAAM,KAAO,MAAS,EAElDgB,EAAcD,EAA2B,IAAM,CACjD,MAAME,EAAQV,EAAA,EACRW,EAA0B,CAC5B,CACI,MAAOD,GAAO,MAAQ,MACtB,GAAIA,EAAQ,CAAE,KAAM,YAAa,OAAQ,CAAE,QAASA,EAAM,EAAA,GAAS,MAAA,EAEvE,CAAE,MAAO,EAAE,iBAAiB,EAAG,GAAI,CAAE,KAAM,QAAA,CAAS,CAAE,EAE1D,OAAIH,EAAW,MACXI,EAAM,KAAK,CAAE,MAAOL,EAAU,OAAS,MAAO,SAAU,GAAM,EAE9DK,EAAM,KAAK,CAAE,MAAO,EAAE,sBAAsB,EAAG,SAAU,GAAM,EAE5DA,CACX,CAAC,EAGKC,EAAmBC,GAAU,CAC/B,KAAMC,IAAY,SAAA,EAAW,IAAI,CAAC,EAAE,IAAI,EAAE,EAC1C,IAAKA,IAAY,SAAA,EAAW,IAAI,CAAC,EAAE,IAAI,CAAC,EACxC,KAAMC,GAAA,EAAU,SAAA,EAChB,SAAUC,EAAA,EACV,OAAQA,EAAA,EACR,QAASF,IAAY,SAAA,EAAW,IAAA,EAAM,IAAI,GAAG,CAAA,CAChD,EACK,CAAE,aAAAG,EAAc,UAAAC,EAAW,UAAAC,EAAW,KAAAC,CAAA,EAASC,GAAQ,CACzD,iBAAAT,EACA,cAAe,CACX,KAAM,GACN,IAAK,GACL,KAAM,GACN,SAAU,GACV,OAAQ,GACR,QAAS,EAAA,CACb,CACH,EACKU,EAAOC,EAAiB,MAAM,EAC9BC,EAAMD,EAAiB,KAAK,EAC5BE,EAAOF,EAAiB,MAAM,EAC9BG,EAAWH,EAAkB,UAAU,EACvCI,EAASJ,EAAkB,QAAQ,EACnCK,EAAUL,EAAiB,SAAS,EAEpCM,EAASZ,EAAa,MAAOa,GAAW,CAC1CzB,EAAO,MAAQ,GACf,IAAI0B,EACAxB,EAAW,MACXwB,EAAK,MAAMC,EAASC,EAASxC,EAAM,GAAK,EAAE,EAAGqC,CAAM,EAEnDC,EAAK,MAAMG,EAAWJ,CAAM,EAEhCzB,EAAO,MAAQ,GACX0B,IACA,MAAM9B,EAAA,EACNkC,EAAA,EAER,CAAC,EAED,SAASC,EAAUN,EAAuB,CACtC,MAAO,CACH,KAAMA,EAAO,KACb,KAAMA,EAAO,KACb,SAAUA,EAAO,SACjB,OAAQA,EAAO,OACf,IAAKA,EAAO,IACZ,QAASA,EAAO,OAAA,CAExB,CAEA,eAAeI,EAAWJ,EAAuB,CAC7C,GAAI,CACA,aAAMO,GAAsB,CACxB,KAAMD,EAAUN,CAAM,CAAA,CACzB,EACDhC,EAAM,QAAQ,EAAE,2BAA2B,CAAC,EACrC,EACX,OAASwC,EAAG,CACRC,EAAeD,EAAGnB,EAAWrB,EAAO,EAAE,2BAA2B,EAAGN,CAAiB,CACzF,CACA,MAAO,EACX,CAEA,eAAewC,EAASQ,EAAgBV,EAAuB,CAC3D,GAAI,CACA,aAAMW,GAA6B,CAC/B,KAAM,CAAE,GAAID,CAAA,EACZ,KAAMJ,EAAUN,CAAM,CAAA,CACzB,EACDhC,EAAM,QAAQ,EAAE,yBAAyB,CAAC,EACnC,EACX,OAASwC,EAAG,CACRC,EAAeD,EAAGnB,EAAWrB,EAAO,EAAE,yBAAyB,EAAGN,CAAiB,CACvF,CACA,MAAO,EACX,CAEA,SAAS2C,GAAS,CACdvC,EAAO,KAAK,CAAE,KAAM,QAAA,CAAU,CAClC,CAEA,OAAA8C,GAAU,SAAY,CAClB,GAAInC,EAAW,MAAO,CAClBJ,EAAQ,MAAQ,GAChB,GAAI,CAIA,MAAMwC,GAHW,MAAMC,GAAwB,CAC3C,KAAM,CAAE,GAAIX,EAASxC,EAAM,GAAK,EAAE,CAAA,CAAE,CACvC,GACqB,KACtBa,EAAU,MAAQqC,EAAK,KACvBzB,EAAU,CACN,KAAMyB,EAAK,KACX,IAAKA,EAAK,KAAO,GACjB,KAAMA,EAAK,KACX,SAAUA,EAAK,UAAY,GAC3B,OAAQA,EAAK,QAAU,GACvB,QAASA,EAAK,SAAW,EAAA,CAC5B,CACL,OAASL,EAAG,CACRxC,EAAM,MAAM,EAAE,2BAA2B,CAAC,EAC1C,QAAQ,MAAMwC,CAAC,EACfH,EAAA,CACJ,QAAA,CACIhC,EAAQ,MAAQ,EACpB,CACJ,CACJ,CAAC,cAhQG0C,EAgFaC,GAAA,CAhFA,YAAarC,EAAA,OAAW,WACjC,IAEQ,CAFKN,EAAA,WAAb0C,EAEQE,EAAA,OAFc,MAAM,4BAAA,aACxB,IAA+C,CAA/CC,EAA+CC,GAAA,CAA1B,cAAA,GAAc,KAAK,IAAA,iBAE5CJ,EA2EQE,EAAA,CAAA,IAAA,GAAA,WA1EJ,IAyES,CAzETC,EAyESE,GAAA,KAAA,WAxEL,IA+Cc,CA/CdF,EA+CcG,GAAA,KAAA,WA9CV,IA6CS,CA7CTH,EA6CSI,GAAA,CA7CA,YAAgBC,EAAAxB,CAAA,EAAM,CAAA,SAAA,CAAA,CAAA,aAC3B,IAKE,CALFmB,EAKEM,EAAA,YAJWD,EAAA/B,CAAA,EAAK,MAAM,2CAAX+B,EAAA/B,CAAA,EAAK,MAAM,MAAKiC,GACxB,iBAAgBF,EAAA/B,CAAA,EAAK,aAAa,MACnC,QAAQ,WACP,MAAO+B,EAAA,CAAA,EAAC,yBAAA,EAAA,IAAA,kDAEbL,EAKEM,EAAA,YAJWD,EAAA7B,CAAA,EAAI,MAAM,2CAAV6B,EAAA7B,CAAA,EAAI,MAAM,MAAK+B,GACvB,iBAAgBF,EAAA7B,CAAA,EAAI,aAAa,MAClC,QAAQ,WACP,MAAO6B,EAAA,CAAA,EAAC,wBAAA,EAAA,IAAA,kDAEbL,EAMEM,EAAA,YALWD,EAAA5B,CAAA,EAAK,MAAM,2CAAX4B,EAAA5B,CAAA,EAAK,MAAM,MAAK8B,GACzB,KAAK,OACJ,iBAAgBF,EAAA5B,CAAA,EAAK,aAAa,MACnC,QAAQ,WACP,MAAO4B,EAAA,CAAA,EAAC,yBAAA,EAAA,IAAA,kDAEbL,EAKEM,EAAA,YAJWD,EAAAzB,CAAA,EAAQ,MAAM,2CAAdyB,EAAAzB,CAAA,EAAQ,MAAM,MAAK2B,GAC3B,iBAAgBF,EAAAzB,CAAA,EAAQ,aAAa,MACtC,QAAQ,WACP,MAAOyB,EAAA,CAAA,EAAC,4BAAA,EAAA,IAAA,kDAEbL,EAQEQ,EAAA,YAPWH,EAAA3B,CAAA,EAAS,MAAM,2CAAf2B,EAAA3B,CAAA,EAAS,MAAM,MAAK6B,GAC5B,gBAAeF,EAAA3B,CAAA,EAAS,aAAa,MACrC,WAAU2B,EAAA,CAAA,EAAC,+BAAA,EACX,YAAWA,EAAA,CAAA,EAAC,kCAAA,EACZ,UAASA,EAAA,CAAA,EAAC,mCAAA,EACV,WAAUA,EAAA,CAAA,EAAC,oCAAA,EACZ,MAAM,SAAA,qFAEVL,EASEQ,EAAA,CARG,cAAW,CAAGH,EAAA1B,CAAA,EAAO,MAAM,MAC3B,gBAAe0B,EAAA1B,CAAA,EAAO,aAAa,MACnC,WAAU0B,EAAA,CAAA,EAAC,gCAAA,EACX,YAAWA,EAAA,CAAA,EAAC,6BAAA,EACZ,UAASA,EAAA,CAAA,EAAC,kCAAA,EACV,WAAUA,EAAA,CAAA,EAAC,iCAAA,EACZ,MAAM,UACL,qCAAoBA,EAAA1B,CAAA,EAAO,MAAM,OAAS4B,EAAA,qHAIvDP,EAuBiBS,GAAA,KAAA,WAtBb,IAKE,CAJQlD,EAAA,WADVsC,EAKEa,GAAA,OAHE,YAAU,cACV,MAAM,QACL,YAAWhE,EAAA,EAAA,mCAEhBsD,EAAYW,EAAA,EACZX,EAEQY,EAAA,CAFD,QAAQ,OAAQ,QAAOzB,CAAA,aAC1B,IAAyB,KAAtBkB,EAAA,CAAA,EAAC,gBAAA,CAAA,EAAA,CAAA,CAAA,SAERL,EAWQY,EAAA,CAVJ,QAAQ,WACR,MAAM,UACL,QAASvD,EAAA,MACT,SAAQ,CAAGgD,EAAAjC,CAAA,EAAK,MAChB,QAAOiC,EAAAxB,CAAA,CAAA,GAEG,UACP,IAAkC,CAAlCmB,EAAkCK,EAAAQ,EAAA,EAAA,CAAhB,KAAMR,EAAAS,EAAA,GAAM,KAAA,EAAA,CAAA,MAAA,CAAA,CAAA,aACvB,IACX,CADWC,EAAA,MACRV,EAAA,CAAA,EAAC,cAAA,CAAA,EAAA,CAAA,CAAA"}