import{d as O,a as Q,u as W,v as X,x as Y,y as Z,o as ee,z as ae,b as h,g as y,w as n,e as s,A as te,p as le,B as se,l as re,j as a,m as d,C as ne,V as M,i as A,t as S,k as ie,D as oe,E as ue,s as w,G as D}from"./index-CY4kEXQX.js";import{c as de,a as x,d as me,e as ve,u as ce,b as o,V as ge}from"./index.esm-gAaR2kR-.js";import{V as B,_ as fe}from"./LayoutBase.vue_vue_type_script_setup_true_lang-mBpG7FYr.js";import{h as U}from"./http-h2SUVdDm.js";import{p as N}from"./parseInt-DjOfejfT.js";import{V as pe}from"./VSwitch-DOWmaHjD.js";import"./VContainer-DyZfstE_.js";const xe=O({__name:"EventEditView",props:{id:{}},setup(P){const C={name:"name",date:"date",archived:"archived",tag:"tag",mainurl:"mainurl"},m=P,{t:l}=Q(),$=W(),i=X(),{getLatestEvent:q,refreshEvents:G}=ue(),v=w(!1),c=w(!1),k=w(""),g=D(()=>m.id!==void 0),T=D(()=>{const t=q(),e=[{title:t?.name??"...",to:t?{name:"dashboard",params:{eventId:t.id}}:void 0},{title:l("EventView.title"),to:{name:"events"}}];return g.value?e.push({title:k.value||"...",disabled:!0}):e.push({title:l("Breadcrumbs.newEvent"),disabled:!0}),e}),j=D(()=>u.value.value?l("EventDialog.labels.isArchived"):l("EventDialog.labels.isNotArchived")),L=de({name:x().required().min(1).max(64),tag:x().required().min(1).max(8),date:ve().required(),archived:me(),mainurl:x().required().url().max(200)}),{handleSubmit:z,setValues:R,setErrors:F,meta:H}=ce({validationSchema:L,initialValues:{name:"",tag:"",date:"",archived:!1,mainurl:""}}),f=o("name"),p=o("tag"),b=o("date"),u=o("archived"),V=o("mainurl"),_=z(async t=>{c.value=!0;let e;g.value?e=await K(N(m.id,10),t):e=await J(t),c.value=!1,e&&(await G(),E())});function I(t){return{name:t.name,date:t.date,archived:t.archived,tag:t.tag,mainurl:t.mainurl}}async function J(t){try{return await Y({body:I(t)}),i.success(l("EventDialog.createSuccess")),!0}catch(e){U(e,F,i,l("EventDialog.createFailure"),C)}return!1}async function K(t,e){try{return await Z({path:{id:t},body:I(e)}),i.success(l("EventDialog.editSuccess")),!0}catch(r){U(r,F,i,l("EventDialog.editFailure"),C)}return!1}function E(){$.push({name:"events"})}return ee(async()=>{if(g.value){v.value=!0;try{const e=(await ae({path:{id:N(m.id,10)}})).data;k.value=e.name,R({name:e.name,tag:e.tag??"",date:e.date,archived:e.archived??!1,mainurl:e.mainurl??""})}catch(t){i.error(l("EventEditView.loadFailure")),console.error(t),E()}finally{v.value=!1}}}),(t,e)=>(h(),y(fe,{breadcrumbs:T.value},{default:n(()=>[v.value?(h(),y(B,{key:0,class:"d-flex justify-center my-8"},{default:n(()=>[s(te,{indeterminate:"",size:"64"})]),_:1})):(h(),y(B,{key:1},{default:n(()=>[s(le,null,{default:n(()=>[s(se,null,{default:n(()=>[s(ge,{onSubmit:re(a(_),["prevent"])},{default:n(()=>[s(d,{modelValue:a(f).value.value,"onUpdate:modelValue":e[0]||(e[0]=r=>a(f).value.value=r),"error-messages":a(f).errorMessage.value,variant:"outlined",label:a(l)("EventDialog.labels.name")+" *"},null,8,["modelValue","error-messages","label"]),s(d,{modelValue:a(p).value.value,"onUpdate:modelValue":e[1]||(e[1]=r=>a(p).value.value=r),"error-messages":a(p).errorMessage.value,variant:"outlined",label:a(l)("EventDialog.labels.tag")+" *"},null,8,["modelValue","error-messages","label"]),s(d,{modelValue:a(b).value.value,"onUpdate:modelValue":e[2]||(e[2]=r=>a(b).value.value=r),type:"date","error-messages":a(b).errorMessage.value,variant:"outlined",label:a(l)("EventDialog.labels.date")+" *"},null,8,["modelValue","error-messages","label"]),s(d,{modelValue:a(V).value.value,"onUpdate:modelValue":e[3]||(e[3]=r=>a(V).value.value=r),"error-messages":a(V).errorMessage.value,variant:"outlined",label:a(l)("EventDialog.labels.mainUrl")+" *"},null,8,["modelValue","error-messages","label"]),s(pe,{modelValue:a(u).value.value,"onUpdate:modelValue":e[4]||(e[4]=r=>a(u).value.value=r),"error-messages":a(u).errorMessage.value,label:j.value},null,8,["modelValue","error-messages","label"])]),_:1},8,["onSubmit"])]),_:1}),s(ne,{class:"justify-end"},{default:n(()=>[s(M,{variant:"text",onClick:E},{default:n(()=>[A(S(a(l)("General.cancel")),1)]),_:1}),s(M,{variant:"elevated",color:"primary",loading:c.value,disabled:!a(H).valid,onClick:a(_)},{prepend:n(()=>[s(a(ie),{icon:a(oe)},null,8,["icon"])]),default:n(()=>[A(" "+S(a(l)("General.save")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1}))]),_:1},8,["breadcrumbs"]))}});export{xe as default};
//# sourceMappingURL=EventEditView-Cd92ENAH.js.map
