import{j as B,r as s,l as F,c as M,y as V,D as y,v as o,q as r,H as D,u as a,I as O,J as Q,K as W,k as X,m as Y,F as Z,f as ee,P as T,z as U,A,E as N,L as P,M as I,N as ae}from"./index-D2OhOofM.js";import{_ as te,V as L}from"./LayoutBase.vue_vue_type_script_setup_true_lang-BVanmNRw.js";import{V as le,d as ne,a as oe,g as se}from"./VDataTableServer-D_rdW6Be.js";import{V as ie}from"./VForm-CKx-B79r.js";import{a as $}from"./VRow-CwdARop4.js";const re=B({__name:"EventDialog",setup(S,{expose:e}){const b=s(),{t:i}=F(),E=s(""),v=s(""),d=s(""),c=s(!1),f=s(""),h=M(()=>c.value?i("EventDialog.labels.isArchived"):i("EventDialog.labels.isNotArchived"));async function _(m=void 0){var t;return m!==void 0?(E.value=m.name,v.value=m.tag??"",d.value=m.date,c.value=m.archived??!1,f.value=m.mainurl??""):(E.value="",v.value="",d.value="",c.value=!1,f.value=""),{ok:await((t=b.value)==null?void 0:t.modal())??!1,name:E.value,tag:v.value,date:d.value,archived:c.value,mainUrl:f.value}}return e({modal:_}),(m,n)=>(V(),y(O,{title:a(i)("EventDialog.title"),"ok-text":a(i)("General.save"),"ok-icon":"fas fa-floppy-disk",width:1e3,ref_key:"dialog",ref:b},{default:o(()=>[r(ie,null,{default:o(()=>[r(D,{modelValue:E.value,"onUpdate:modelValue":n[0]||(n[0]=t=>E.value=t),variant:"outlined",label:a(i)("EventDialog.labels.name")},null,8,["modelValue","label"]),r(D,{modelValue:v.value,"onUpdate:modelValue":n[1]||(n[1]=t=>v.value=t),variant:"outlined",label:a(i)("EventDialog.labels.tag")},null,8,["modelValue","label"]),r(D,{type:"date",modelValue:d.value,"onUpdate:modelValue":n[2]||(n[2]=t=>d.value=t),variant:"outlined",label:a(i)("EventDialog.labels.date")},null,8,["modelValue","label"]),r(D,{modelValue:f.value,"onUpdate:modelValue":n[3]||(n[3]=t=>f.value=t),variant:"outlined",label:a(i)("EventDialog.labels.mainUrl")},null,8,["modelValue","label"]),r(le,{modelValue:c.value,"onUpdate:modelValue":n[4]||(n[4]=t=>c.value=t),label:h.value},null,8,["modelValue","label"])]),_:1})]),_:1},8,["title","ok-text"]))}}),fe=B({__name:"EventView",props:{eventId:{}},setup(S){const{t:e,d:b}=F(),i=s(void 0),E=ee(ae),v=Q(),d=W(),c=X(),f=s(!1),h=[25,50,100],_=s(h[0]),m=s(0),n=s(1),t=s([]),x=s(0),K=[{title:e("EventView.headers.id"),sortable:!0,key:"id"},{title:e("EventView.headers.name"),sortable:!1,key:"name"},{title:e("EventView.headers.tag"),sortable:!1,key:"tag"},{title:e("EventView.headers.date"),sortable:!0,key:"date"},{title:e("EventView.headers.archived"),sortable:!1,key:"archived"},{title:e("EventView.headers.mainUrl"),sortable:!1,key:"mainurl"},{title:e("EventView.headers.actions"),sortable:!1,key:"actions",align:"end"}];async function j(p){f.value=!0;const{offset:u,limit:l,sortBy:g}=se(p);try{const{count:k,results:w}=await d.events.eventsList(l,void 0,u,g);t.value=w,m.value=k}catch(k){v.error(e("EventView.errors.failedToLoad")),console.error(k)}finally{f.value=!1}}const q=ne(j,250);async function z(p){const u=e("EventView.confirmDelete",p);if(await E.value.confirm(u)){try{await d.events.eventsDestroy(p.id)}catch(g){v.error(e("EventView.errors.failedToDelete")),console.error(g)}x.value+=1}}async function R(p){const u=await d.events.eventsRetrieve(p),{ok:l,name:g,date:k,archived:w,tag:C,mainUrl:H}=await i.value.modal(u);if(l){try{await d.events.eventsPartialUpdate(u.id,{name:g,date:k,archived:w,tag:C,mainurl:H})}catch(J){v.error(e("EventView.errors.failedToEdit")),console.error(J)}x.value+=1}}async function G(){const{ok:p,name:u,date:l,archived:g,tag:k,mainUrl:w}=await i.value.modal();if(p){try{await d.events.eventsCreate({name:u,date:l,archived:g,tag:k,mainurl:w})}catch(C){v.error(e("EventView.errors.failedToCreate")),console.error(C)}n.value=1,x.value+=1}}return(p,u)=>(V(),Y(Z,null,[r(te,{title:a(e)("EventView.title")},{default:o(()=>[r(L,null,{default:o(()=>[r($,null,{default:o(()=>[a(c).canAdd(a(T).EVENT)?(V(),y(N,{key:0,"prepend-icon":"fas fa-plus",onClick:G},{default:o(()=>[U(A(a(e)("EventView.newEvent")),1)]),_:1})):P("",!0)]),_:1})]),_:1}),r(L,null,{default:o(()=>[r($,null,{default:o(()=>[(V(),y(oe,{class:"elevation-1 primary","item-value":"id",density:"compact",key:`blog-table-${x.value}`,headers:K,items:t.value,"items-length":m.value,loading:f.value,page:n.value,"items-per-page-options":h,"no-data-text":a(e)("EventView.noEventsFound"),"loading-text":a(e)("EventView.loadingEvents"),"items-per-page":_.value,"onUpdate:itemsPerPage":u[0]||(u[0]=l=>_.value=l),"onUpdate:options":a(q)},{"item.archived":o(({item:l})=>[l.archived?(V(),y(I,{key:0,icon:"fas fa-check",color:"green"})):(V(),y(I,{key:1,icon:"fas fa-xmark",color:"red"}))]),"item.date":o(({item:l})=>[U(A(a(b)(l.date,"long")),1)]),"item.actions":o(({item:l})=>[a(c).canDelete(a(T).EVENT)?(V(),y(N,{key:0,density:"compact",variant:"text",onClick:g=>z(l),"prepend-icon":"fas fa-xmark",color:"red"},{default:o(()=>[U("Delete")]),_:2},1032,["onClick"])):P("",!0),a(c).canChange(a(T).EVENT)?(V(),y(N,{key:1,density:"compact",variant:"text",onClick:g=>R(l.id),"prepend-icon":"fas fa-pen-to-square"},{default:o(()=>[U("Edit")]),_:2},1032,["onClick"])):P("",!0)]),_:1},8,["items","items-length","loading","page","no-data-text","loading-text","items-per-page","onUpdate:options"]))]),_:1})]),_:1})]),_:1},8,["title"]),r(re,{ref_key:"dialog",ref:i},null,512)],64))}});export{fe as default};
//# sourceMappingURL=EventView-B31VrPUd.js.map
