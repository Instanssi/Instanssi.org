import{d as F,a as O,b as h,c as L,t as b,I as N,u as M,J as X,K as z,v as G,L as J,g as T,w as s,e as i,j as t,P as w,V as Q,i as W,k as Y,M as Z,D as A,m as ee,N as S,O as B,q as te,s as f,Q as ae,R as le,H as ne}from"./index-CQkWvXOv.js";import{_ as P}from"./BooleanIcon.vue_vue_type_script_setup_true_lang-BUZkEwsX.js";import{X as ie}from"./datetime-Dz9fjSvq.js";import{V as U,_ as se}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D5aCeQDf.js";import{_ as oe}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-DepTf6Bi.js";import{u as re,d as ue}from"./useTableState-CutuDm2i.js";import{g as de}from"./query_tools-BInV9OzK.js";import{g as ce}from"./http-CET7UDul.js";import{V as C}from"./VRow-CXIXhuhq.js";import{V as me}from"./VDataTableServer-C6tuZDKn.js";import"./VContainer-DqJ8gu3P.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-1MnYozFL.js";import"./useAuditLogUtils-BdjF9k7b.js";import"./DateTimeCell.vue_vue_type_script_setup_true_lang-DaLynL44.js";import"./VDataTable-f5_9vewM.js";const ve=F({__name:"DateCell",props:{value:{default:null},format:{default:"long"},fallback:{default:"-"}},setup(g){const e=g,{locale:v}=O(),V=N(()=>{if(!e.value)return e.fallback;const r=ie.PlainDate.from(e.value),c=e.format==="short"?{dateStyle:"short"}:{dateStyle:"long"};return new Intl.DateTimeFormat(v.value,c).format(new Date(Date.UTC(r.year,r.month-1,r.day)))});return(r,c)=>(h(),L("span",null,b(V.value),1))}}),pe=["href"],Be=F({__name:"EventView",setup(g){const{t:e}=O(),v=M(),V=X(z),r=G(),c=ne(),E=te(),I=N(()=>{const l=c.getLatestEvent();return[{title:l?.name??"...",to:l?{name:"dashboard",params:{eventId:l.id}}:void 0},{title:e("EventView.title"),disabled:!0}]}),o=re({filterKeys:["archived","hidden"]}),y=f(!1),_=f(0),k=f([]),m=f(null),u=o.useBooleanFilter("archived"),d=o.useBooleanFilter("hidden"),$=[{title:e("EventView.headers.id"),sortable:!0,key:"id"},{title:e("EventView.headers.name"),sortable:!0,key:"name"},{title:e("EventView.headers.tag"),sortable:!0,key:"tag"},{title:e("EventView.headers.date"),sortable:!0,key:"date"},{title:e("EventView.headers.archived"),sortable:!1,key:"archived"},{title:e("EventView.headers.hidden"),sortable:!1,key:"hidden"},{title:e("EventView.headers.mainUrl"),sortable:!1,key:"mainurl"},{title:e("EventView.headers.actions"),sortable:!1,key:"actions",align:"end"}];async function R(){m.value&&await D(m.value),await c.refreshEvents()}async function D(l){y.value=!0,m.value=l;try{const n=await le({query:{...de(l),...u.value!==null?{archived:u.value}:{},...d.value!==null?{hidden:d.value}:{}}});k.value=n.data.results,_.value=n.data.count}catch(n){r.error(e("EventView.loadFailure")),console.error(n)}finally{y.value=!1}}const x=ue(D,250);J([u,d],()=>{m.value&&x({...m.value,page:1})});function j(l){o.onOptionsUpdate(l),x(l)}async function K(l){const n=e("EventView.confirmDelete",l);if(await V.value.confirm(n))try{await ae({path:{id:l.id}}),await R(),r.success(e("EventView.deleteSuccess"))}catch(p){r.error(ce(p,e("EventView.deleteFailure"))),console.error(p)}}function q(l){v.push({name:"events-edit",params:{id:l}})}function H(){v.push({name:"events-new"})}return(l,n)=>(h(),T(se,{breadcrumbs:I.value},{default:s(()=>[i(U,null,{default:s(()=>[i(C,null,{default:s(()=>[t(E).canAdd(t(w).EVENT)?(h(),T(Q,{key:0,color:"primary",onClick:H},{prepend:s(()=>[i(t(Y),{icon:t(Z)},null,8,["icon"])]),default:s(()=>[W(" "+b(t(e)("EventView.newEvent")),1)]),_:1})):A("",!0),i(ee,{modelValue:t(o).search.value,"onUpdate:modelValue":n[0]||(n[0]=a=>t(o).search.value=a),variant:"outlined",density:"compact",label:t(e)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"]),i(S,{modelValue:t(u),"onUpdate:modelValue":n[1]||(n[1]=a=>B(u)?u.value=a:null),items:[{title:t(e)("EventView.allEvents"),value:null},{title:t(e)("EventView.archivedOnly"),value:!0},{title:t(e)("EventView.notArchivedOnly"),value:!1}],variant:"outlined",density:"compact",label:t(e)("EventView.filterByArchived"),style:{"max-width":"200px"},class:"ma-0 pa-0 ml-4"},null,8,["modelValue","items","label"]),i(S,{modelValue:t(d),"onUpdate:modelValue":n[2]||(n[2]=a=>B(d)?d.value=a:null),items:[{title:t(e)("EventView.allVisibility"),value:null},{title:t(e)("EventView.hiddenOnly"),value:!0},{title:t(e)("EventView.visibleOnly"),value:!1}],variant:"outlined",density:"compact",label:t(e)("EventView.filterByVisibility"),style:{"max-width":"200px"},class:"ma-0 pa-0 ml-4"},null,8,["modelValue","items","label"])]),_:1})]),_:1}),i(U,null,{default:s(()=>[i(C,null,{default:s(()=>[i(me,{"items-per-page":t(o).perPage.value,"onUpdate:itemsPerPage":n[3]||(n[3]=a=>t(o).perPage.value=a),"sort-by":t(o).sortByArray.value,class:"elevation-1 primary","item-value":"id",density:"compact",headers:$,items:k.value,"items-length":_.value,loading:y.value,page:t(o).page.value,search:t(o).search.value,"items-per-page-options":t(o).pageSizeOptions,"no-data-text":t(e)("EventView.noEventsFound"),"loading-text":t(e)("EventView.loadingEvents"),"onUpdate:options":j},{"item.archived":s(({item:a})=>[i(P,{value:a.archived},null,8,["value"])]),"item.hidden":s(({item:a})=>[i(P,{value:a.hidden},null,8,["value"])]),"item.date":s(({item:a})=>[i(ve,{value:a.date},null,8,["value"])]),"item.mainurl":s(({item:a})=>[a.mainurl?(h(),L("a",{key:0,href:a.mainurl,target:"_blank"},b(a.mainurl),9,pe)):A("",!0)]),"item.actions":s(({item:a})=>[i(oe,{"can-edit":t(E).canChange(t(w).EVENT),"can-delete":t(E).canDelete(t(w).EVENT),"audit-log":{appLabel:"kompomaatti",model:"event",objectPk:a.id},onEdit:p=>q(a.id),onDelete:p=>K(a)},null,8,["can-edit","can-delete","audit-log","onEdit","onDelete"])]),_:1},8,["items-per-page","sort-by","items","items-length","loading","page","search","items-per-page-options","no-data-text","loading-text"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Be as default};
//# sourceMappingURL=EventView-B5Gesu8Q.js.map
