{"version":3,"file":"EventView-B5Gesu8Q.js","sources":["../../../../../admin/src/components/table/DateCell.vue","../../../../../admin/src/views/events/EventView.vue"],"sourcesContent":["<template>\n    <span>{{ formattedDate }}</span>\n</template>\n\n<script setup lang=\"ts\">\n/**\n * DateCell - Display date-only values (from Django DateField)\n * For datetime values with time, use DateTimeCell instead.\n */\nimport { Temporal } from \"temporal-polyfill\";\nimport { computed } from \"vue\";\nimport { useI18n } from \"vue-i18n\";\n\nconst props = withDefaults(\n    defineProps<{\n        value?: string | null;\n        format?: \"short\" | \"long\";\n        fallback?: string;\n    }>(),\n    {\n        value: null,\n        format: \"long\",\n        fallback: \"-\",\n    }\n);\n\nconst { locale } = useI18n();\n\nconst formattedDate = computed(() => {\n    if (!props.value) return props.fallback;\n\n    const plainDate = Temporal.PlainDate.from(props.value);\n    const options: Intl.DateTimeFormatOptions =\n        props.format === \"short\" ? { dateStyle: \"short\" } : { dateStyle: \"long\" };\n    return new Intl.DateTimeFormat(locale.value, options).format(\n        new Date(Date.UTC(plainDate.year, plainDate.month - 1, plainDate.day))\n    );\n});\n</script>\n","<template>\n    <LayoutBase :breadcrumbs=\"breadcrumbs\">\n        <v-col>\n            <v-row>\n                <v-btn\n                    v-if=\"auth.canAdd(PermissionTarget.EVENT)\"\n                    color=\"primary\"\n                    @click=\"createEvent\"\n                >\n                    <template #prepend>\n                        <FontAwesomeIcon :icon=\"faPlus\" />\n                    </template>\n                    {{ t(\"EventView.newEvent\") }}\n                </v-btn>\n                <v-text-field\n                    v-model=\"tableState.search.value\"\n                    variant=\"outlined\"\n                    density=\"compact\"\n                    :label=\"t('General.search')\"\n                    style=\"max-width: 400px\"\n                    class=\"ma-0 pa-0 ml-4\"\n                    clearable\n                />\n                <v-select\n                    v-model=\"filterArchived\"\n                    :items=\"[\n                        { title: t('EventView.allEvents'), value: null },\n                        { title: t('EventView.archivedOnly'), value: true },\n                        { title: t('EventView.notArchivedOnly'), value: false },\n                    ]\"\n                    variant=\"outlined\"\n                    density=\"compact\"\n                    :label=\"t('EventView.filterByArchived')\"\n                    style=\"max-width: 200px\"\n                    class=\"ma-0 pa-0 ml-4\"\n                />\n                <v-select\n                    v-model=\"filterHidden\"\n                    :items=\"[\n                        { title: t('EventView.allVisibility'), value: null },\n                        { title: t('EventView.hiddenOnly'), value: true },\n                        { title: t('EventView.visibleOnly'), value: false },\n                    ]\"\n                    variant=\"outlined\"\n                    density=\"compact\"\n                    :label=\"t('EventView.filterByVisibility')\"\n                    style=\"max-width: 200px\"\n                    class=\"ma-0 pa-0 ml-4\"\n                />\n            </v-row>\n        </v-col>\n        <v-col>\n            <v-row>\n                <v-data-table-server\n                    v-model:items-per-page=\"tableState.perPage.value\"\n                    :sort-by=\"tableState.sortByArray.value\"\n                    class=\"elevation-1 primary\"\n                    item-value=\"id\"\n                    density=\"compact\"\n                    :headers=\"headers\"\n                    :items=\"events\"\n                    :items-length=\"totalItems\"\n                    :loading=\"loading\"\n                    :page=\"tableState.page.value\"\n                    :search=\"tableState.search.value\"\n                    :items-per-page-options=\"tableState.pageSizeOptions\"\n                    :no-data-text=\"t('EventView.noEventsFound')\"\n                    :loading-text=\"t('EventView.loadingEvents')\"\n                    @update:options=\"onTableOptionsUpdate\"\n                >\n                    <template #item.archived=\"{ item }\">\n                        <BooleanIcon :value=\"item.archived\" />\n                    </template>\n                    <template #item.hidden=\"{ item }\">\n                        <BooleanIcon :value=\"item.hidden\" />\n                    </template>\n                    <template #item.date=\"{ item }\">\n                        <DateCell :value=\"item.date\" />\n                    </template>\n                    <template #item.mainurl=\"{ item }\">\n                        <a v-if=\"item.mainurl\" :href=\"item.mainurl\" target=\"_blank\">\n                            {{ item.mainurl }}\n                        </a>\n                    </template>\n                    <template #item.actions=\"{ item }\">\n                        <TableActionButtons\n                            :can-edit=\"auth.canChange(PermissionTarget.EVENT)\"\n                            :can-delete=\"auth.canDelete(PermissionTarget.EVENT)\"\n                            :audit-log=\"{\n                                appLabel: 'kompomaatti',\n                                model: 'event',\n                                objectPk: item.id,\n                            }\"\n                            @edit=\"editEvent(item.id)\"\n                            @delete=\"deleteEvent(item)\"\n                        />\n                    </template>\n                </v-data-table-server>\n            </v-row>\n        </v-col>\n    </LayoutBase>\n</template>\n\n<script setup lang=\"ts\">\nimport { faPlus } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/vue-fontawesome\";\nimport { debounce } from \"lodash-es\";\nimport { type Ref, computed, inject, ref, watch } from \"vue\";\nimport { useI18n } from \"vue-i18n\";\nimport { useRouter } from \"vue-router\";\nimport { useToast } from \"vue-toastification\";\nimport type { VDataTable } from \"vuetify/components\";\n\nimport * as api from \"@/api\";\nimport type { Event } from \"@/api\";\nimport BooleanIcon from \"@/components/table/BooleanIcon.vue\";\nimport DateCell from \"@/components/table/DateCell.vue\";\nimport LayoutBase, { type BreadcrumbItem } from \"@/components/layout/LayoutBase.vue\";\nimport TableActionButtons from \"@/components/table/TableActionButtons.vue\";\nimport { useTableState } from \"@/composables/useTableState\";\nimport { PermissionTarget, useAuth } from \"@/services/auth\";\nimport { useEvents } from \"@/services/events\";\nimport { type LoadArgs, getLoadArgs } from \"@/services/utils/query_tools\";\nimport { confirmDialogKey } from \"@/symbols\";\nimport type { ConfirmDialogType } from \"@/symbols\";\nimport { getApiErrorMessage } from \"@/utils/http\";\n\ntype ReadonlyHeaders = VDataTable[\"$props\"][\"headers\"];\n\nconst { t } = useI18n();\nconst router = useRouter();\n\nconst confirmDialog: ConfirmDialogType = inject(confirmDialogKey)!;\n\nconst toast = useToast();\nconst eventService = useEvents();\nconst auth = useAuth();\n\nconst breadcrumbs = computed<BreadcrumbItem[]>(() => {\n    const event = eventService.getLatestEvent();\n    return [\n        {\n            title: event?.name ?? \"...\",\n            to: event ? { name: \"dashboard\", params: { eventId: event.id } } : undefined,\n        },\n        { title: t(\"EventView.title\"), disabled: true },\n    ];\n});\n\nconst tableState = useTableState({ filterKeys: [\"archived\", \"hidden\"] });\nconst loading = ref(false);\nconst totalItems = ref(0);\nconst events: Ref<Event[]> = ref([]);\nconst lastLoadArgs: Ref<LoadArgs | null> = ref(null);\n\nconst filterArchived = tableState.useBooleanFilter(\"archived\");\nconst filterHidden = tableState.useBooleanFilter(\"hidden\");\nconst headers: ReadonlyHeaders = [\n    {\n        title: t(\"EventView.headers.id\"),\n        sortable: true,\n        key: \"id\",\n    },\n    {\n        title: t(\"EventView.headers.name\"),\n        sortable: true,\n        key: \"name\",\n    },\n    {\n        title: t(\"EventView.headers.tag\"),\n        sortable: true,\n        key: \"tag\",\n    },\n    {\n        title: t(\"EventView.headers.date\"),\n        sortable: true,\n        key: \"date\",\n    },\n    {\n        title: t(\"EventView.headers.archived\"),\n        sortable: false,\n        key: \"archived\",\n    },\n    {\n        title: t(\"EventView.headers.hidden\"),\n        sortable: false,\n        key: \"hidden\",\n    },\n    {\n        title: t(\"EventView.headers.mainUrl\"),\n        sortable: false,\n        key: \"mainurl\",\n    },\n    {\n        title: t(\"EventView.headers.actions\"),\n        sortable: false,\n        key: \"actions\",\n        align: \"end\",\n    },\n];\n\nasync function flushData() {\n    if (lastLoadArgs.value) {\n        await load(lastLoadArgs.value);\n    }\n    await eventService.refreshEvents();\n}\n\nasync function load(args: LoadArgs) {\n    loading.value = true;\n    lastLoadArgs.value = args;\n    try {\n        const response = await api.adminEventsList({\n            query: {\n                ...getLoadArgs(args),\n                ...(filterArchived.value !== null ? { archived: filterArchived.value } : {}),\n                ...(filterHidden.value !== null ? { hidden: filterHidden.value } : {}),\n            },\n        });\n        events.value = response.data!.results;\n        totalItems.value = response.data!.count;\n    } catch (e) {\n        toast.error(t(\"EventView.loadFailure\"));\n        console.error(e);\n    } finally {\n        loading.value = false;\n    }\n}\n\nconst debouncedLoad = debounce(load, 250);\n\n// Reload when filters change\nwatch([filterArchived, filterHidden], () => {\n    if (lastLoadArgs.value) {\n        debouncedLoad({ ...lastLoadArgs.value, page: 1 });\n    }\n});\n\nfunction onTableOptionsUpdate(args: LoadArgs) {\n    tableState.onOptionsUpdate(args);\n    debouncedLoad(args);\n}\n\nasync function deleteEvent(item: Event): Promise<void> {\n    const text = t(\"EventView.confirmDelete\", item);\n    const ok = await confirmDialog.value!.confirm(text);\n    if (ok) {\n        try {\n            await api.adminEventsDestroy({ path: { id: item.id } });\n            await flushData();\n            toast.success(t(\"EventView.deleteSuccess\"));\n        } catch (e) {\n            toast.error(getApiErrorMessage(e, t(\"EventView.deleteFailure\")));\n            console.error(e);\n        }\n    }\n}\n\nfunction editEvent(id: number): void {\n    router.push({ name: \"events-edit\", params: { id } });\n}\n\nfunction createEvent(): void {\n    router.push({ name: \"events-new\" });\n}\n</script>\n"],"names":["props","__props","locale","useI18n","formattedDate","computed","plainDate","Temporal","options","_openBlock","_createElementBlock","t","router","useRouter","confirmDialog","inject","confirmDialogKey","toast","useToast","eventService","useEvents","auth","useAuth","breadcrumbs","event","tableState","useTableState","loading","ref","totalItems","events","lastLoadArgs","filterArchived","filterHidden","headers","flushData","load","args","response","api.adminEventsList","getLoadArgs","e","debouncedLoad","debounce","watch","onTableOptionsUpdate","deleteEvent","item","text","api.adminEventsDestroy","getApiErrorMessage","editEvent","id","createEvent","_createBlock","LayoutBase","_createVNode","_component_v_col","_component_v_row","_unref","PermissionTarget","_component_v_btn","FontAwesomeIcon","faPlus","_createTextVNode","_component_v_text_field","$event","_component_v_select","_component_v_data_table_server","_withCtx","BooleanIcon","DateCell","_toDisplayString","_hoisted_1","TableActionButtons"],"mappings":"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"}