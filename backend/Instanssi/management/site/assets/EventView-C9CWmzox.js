import{d as S,a as A,b as m,c as F,t as V,G as I,u as K,H as M,I as R,v as X,g as x,w as l,e as o,j as a,P as h,V as z,i as H,k as J,J as O,K as T,m as Q,q as W,s as i,L as Y,M as Z,E as ee}from"./index-BSHMv_df.js";import{_ as te}from"./BooleanIcon.vue_vue_type_script_setup_true_lang-COcceYO8.js";import{X as ae}from"./classApi-bnmGQydb.js";import{V as C,_ as ne}from"./LayoutBase.vue_vue_type_script_setup_true_lang-C8aKWyeJ.js";import{_ as se}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-DouyropJ.js";import{d as le,V as oe,g as re}from"./query_tools-Co6bP9h2.js";import{g as ie}from"./http-BZkoYM_m.js";import{V as P}from"./VRow-BUBfmFS3.js";import"./VContainer--EpXOfw5.js";import"./VDataTable-CpUosGjF.js";import"./filter-C6Uu0LOB.js";const ue=S({__name:"DateCell",props:{value:{default:null},format:{default:"long"},fallback:{default:"-"}},setup(w){const e=w,{locale:c}=A(),v=I(()=>{if(!e.value)return e.fallback;const r=ae.PlainDate.from(e.value),u=e.format==="short"?{dateStyle:"short"}:{dateStyle:"long"};return new Intl.DateTimeFormat(c.value,u).format(new Date(Date.UTC(r.year,r.month-1,r.day)))});return(r,u)=>(m(),F("span",null,V(v.value),1))}}),ce=["href"],ye=S({__name:"EventView",setup(w){const{t:e}=A(),c=K(),v=M(R),r=X(),u=ee(),p=W(),L=I(()=>{const n=u.getLatestEvent();return[{title:n?.name??"...",to:n?{name:"dashboard",params:{eventId:n.id}}:void 0},{title:e("EventView.title"),disabled:!0}]}),f=i(!1),_=[25,50,100],y=i(_[0]),b=i(0),N=i(1),k=i([]),E=i(""),g=i(null),U=[{title:e("EventView.headers.id"),sortable:!0,key:"id"},{title:e("EventView.headers.name"),sortable:!1,key:"name"},{title:e("EventView.headers.tag"),sortable:!1,key:"tag"},{title:e("EventView.headers.date"),sortable:!0,key:"date"},{title:e("EventView.headers.archived"),sortable:!1,key:"archived"},{title:e("EventView.headers.mainUrl"),sortable:!1,key:"mainurl"},{title:e("EventView.headers.actions"),sortable:!1,key:"actions",align:"end"}];async function $(){g.value&&await D(g.value),await u.refreshEvents()}async function D(n){f.value=!0,g.value=n;try{const s=await Z({query:re(n)});k.value=s.data.results,b.value=s.data.count}catch(s){r.error(e("EventView.loadFailure")),console.error(s)}finally{f.value=!1}}const B=le(D,250);async function j(n){const s=e("EventView.confirmDelete",n);if(await v.value.confirm(s))try{await Y({path:{id:n.id}}),await $(),r.success(e("EventView.deleteSuccess"))}catch(d){r.error(ie(d,e("EventView.deleteFailure"))),console.error(d)}}function q(n){c.push({name:"events-edit",params:{id:n}})}function G(){c.push({name:"events-new"})}return(n,s)=>(m(),x(ne,{breadcrumbs:L.value},{default:l(()=>[o(C,null,{default:l(()=>[o(P,null,{default:l(()=>[a(p).canAdd(a(h).EVENT)?(m(),x(z,{key:0,onClick:G},{prepend:l(()=>[o(a(J),{icon:a(O)},null,8,["icon"])]),default:l(()=>[H(" "+V(a(e)("EventView.newEvent")),1)]),_:1})):T("",!0),o(Q,{modelValue:E.value,"onUpdate:modelValue":s[0]||(s[0]=t=>E.value=t),variant:"outlined",density:"compact",label:a(e)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),o(C,null,{default:l(()=>[o(P,null,{default:l(()=>[o(oe,{"items-per-page":y.value,"onUpdate:itemsPerPage":s[1]||(s[1]=t=>y.value=t),class:"elevation-1 primary","item-value":"id",density:"compact",headers:U,items:k.value,"items-length":b.value,loading:f.value,page:N.value,search:E.value,"items-per-page-options":_,"no-data-text":a(e)("EventView.noEventsFound"),"loading-text":a(e)("EventView.loadingEvents"),"onUpdate:options":a(B)},{"item.archived":l(({item:t})=>[o(te,{value:t.archived},null,8,["value"])]),"item.date":l(({item:t})=>[o(ue,{value:t.date},null,8,["value"])]),"item.mainurl":l(({item:t})=>[t.mainurl?(m(),F("a",{key:0,href:t.mainurl,target:"_blank"},V(t.mainurl),9,ce)):T("",!0)]),"item.actions":l(({item:t})=>[o(se,{"can-edit":a(p).canChange(a(h).EVENT),"can-delete":a(p).canDelete(a(h).EVENT),onEdit:d=>q(t.id),onDelete:d=>j(t)},null,8,["can-edit","can-delete","onEdit","onDelete"])]),_:1},8,["items-per-page","items","items-length","loading","page","search","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{ye as default};
//# sourceMappingURL=EventView-C9CWmzox.js.map
