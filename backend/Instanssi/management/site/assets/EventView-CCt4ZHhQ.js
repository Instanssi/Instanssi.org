import{d as z,a as G,p as K,q as J,s as O,b as u,g as v,w as o,e as r,k as C,j as e,n as i,v as X,x as Q,y as W,c as Y,P as A,V as I,h as F,t as M,z as k,A as Z,B as N,C as L,D as ee,E as ae,F as te,m as le,G as ne,H as se,I as oe,J as re}from"./index-DudmwCVs.js";import{c as ie,a as B,d as de,e as ue,u as ce,b as h,V as ve}from"./index.esm-CJ66woXM.js";import{_ as me,d as ge,V as fe,g as pe}from"./query_tools-BEmCAtlc.js";import{V as Ee}from"./VSwitch-yFnYpSe8.js";import{V as R,_ as Ve}from"./LayoutBase.vue_vue_type_script_setup_true_lang-ClMmmHYA.js";import{a as j}from"./VRow-BewpdHHM.js";const ye=z({__name:"EventDialog",setup(H,{expose:n}){const E=i(),{t:s}=G(),m=K(),c=i(!1),g=i(0),V=X(()=>d.value?s("EventDialog.labels.isArchived"):s("EventDialog.labels.isNotArchived")),y=ie({name:B().required().min(1).max(64),tag:B().required().min(1).max(8),date:ue().required(),archived:de(),mainUrl:B().required().url().max(200)}),{handleSubmit:x,setTouched:D,resetForm:_,setValues:U}=ce({validationSchema:y}),f=h("name"),p=h("tag"),w=h("date"),d=h("archived"),b=h("mainUrl"),S=x(async t=>{let a;c.value=!0,g.value!==void 0?a=await $(g.value,t):a=await T(t),c.value=!1,a&&E.value?.setResult(!0)});async function T(t){try{return await J({body:{name:t.name,date:t.date,archived:t.archived,tag:t.tag,mainurl:t.mainUrl}}),m.success(s("EventDialog.createSuccess")),!0}catch(a){m.error(s("EventDialog.createFailure")),console.error(a)}return!1}async function $(t,a){try{return await O({path:{id:t},body:{name:a.name,date:a.date,archived:a.archived,tag:a.tag,mainurl:a.mainUrl}}),m.success(s("EventDialog.editSuccess")),!0}catch(l){m.error(s("EventDialog.editFailure")),console.error(l)}return!1}async function P(t=void 0){return t!==void 0?(g.value=t.id,U({name:t.name,tag:t.tag,date:t.date,archived:t.archived??!1,mainUrl:t.mainurl??""})):(g.value=void 0,_(),D(!1)),await E.value?.modal()??!1}return n({modal:P}),(t,a)=>(u(),v(me,{ref_key:"dialog",ref:E,title:e(s)("EventDialog.title"),"ok-text":e(s)("General.save"),"ok-icon":"fas fa-floppy-disk",width:1e3,loading:c.value,onSubmit:e(S)},{default:o(()=>[r(ve,null,{default:o(()=>[r(C,{modelValue:e(f).value.value,"onUpdate:modelValue":a[0]||(a[0]=l=>e(f).value.value=l),"error-messages":e(f).errorMessage.value,variant:"outlined",label:e(s)("EventDialog.labels.name")},null,8,["modelValue","error-messages","label"]),r(C,{modelValue:e(p).value.value,"onUpdate:modelValue":a[1]||(a[1]=l=>e(p).value.value=l),"error-messages":e(p).errorMessage.value,variant:"outlined",label:e(s)("EventDialog.labels.tag")},null,8,["modelValue","error-messages","label"]),r(C,{modelValue:e(w).value.value,"onUpdate:modelValue":a[2]||(a[2]=l=>e(w).value.value=l),type:"date","error-messages":e(w).errorMessage.value,variant:"outlined",label:e(s)("EventDialog.labels.date")},null,8,["modelValue","error-messages","label"]),r(C,{modelValue:e(b).value.value,"onUpdate:modelValue":a[3]||(a[3]=l=>e(b).value.value=l),"error-messages":e(b).errorMessage.value,variant:"outlined",label:e(s)("EventDialog.labels.mainUrl")},null,8,["modelValue","error-messages","label"]),r(Ee,{modelValue:e(d).value.value,"onUpdate:modelValue":a[4]||(a[4]=l=>e(d).value.value=l),"error-messages":e(d).errorMessage.value,label:V.value},null,8,["modelValue","error-messages","label"])]),_:1})]),_:1},8,["title","ok-text","loading","onSubmit"]))}}),_e=z({__name:"EventView",setup(H){const{t:n,d:E}=G(),s=i(void 0),m=Q(W),c=K(),g=oe(),V=le(),y=i(!1),x=[25,50,100],D=i(x[0]),_=i(0),U=i(1),f=i([]),p=i(0),w=[{title:n("EventView.headers.id"),sortable:!0,key:"id"},{title:n("EventView.headers.name"),sortable:!1,key:"name"},{title:n("EventView.headers.tag"),sortable:!1,key:"tag"},{title:n("EventView.headers.date"),sortable:!0,key:"date"},{title:n("EventView.headers.archived"),sortable:!1,key:"archived"},{title:n("EventView.headers.mainUrl"),sortable:!1,key:"mainurl"},{title:n("EventView.headers.actions"),sortable:!1,key:"actions",align:"end"}];async function d(){p.value+=1,await g.refreshEvents()}async function b(t){y.value=!0;try{const a=await re({query:pe(t)});f.value=a.data.results,_.value=a.data.count}catch(a){c.error(n("EventView.loadFailure")),console.error(a)}finally{y.value=!1}}const S=ge(b,250);async function T(t){const a=n("EventView.confirmDelete",t);if(await m.value.confirm(a))try{await ne({path:{id:t.id}}),await d(),c.success(n("EventView.deleteSuccess"))}catch(q){c.error(n("EventView.deleteFailure")),console.error(q)}}async function $(t){const a=await se({path:{id:t}});await s.value.modal(a.data)&&await d()}async function P(){await s.value.modal()&&(U.value=1,await d())}return(t,a)=>(u(),Y(te,null,[r(Ve,{title:e(n)("EventView.title")},{default:o(()=>[r(R,null,{default:o(()=>[r(j,null,{default:o(()=>[e(V).canAdd(e(A).EVENT)?(u(),v(I,{key:0,onClick:P},{prepend:o(()=>[r(e(k),{icon:e(Z)},null,8,["icon"])]),default:o(()=>[F(" "+M(e(n)("EventView.newEvent")),1)]),_:1})):N("",!0)]),_:1})]),_:1}),r(R,null,{default:o(()=>[r(j,null,{default:o(()=>[(u(),v(fe,{key:`blog-table-${p.value}`,"items-per-page":D.value,"onUpdate:itemsPerPage":a[0]||(a[0]=l=>D.value=l),class:"elevation-1 primary","item-value":"id",density:"compact",headers:w,items:f.value,"items-length":_.value,loading:y.value,page:U.value,"items-per-page-options":x,"no-data-text":e(n)("EventView.noEventsFound"),"loading-text":e(n)("EventView.loadingEvents"),"onUpdate:options":e(S)},{"item.archived":o(({item:l})=>[l.archived?(u(),v(e(k),{key:0,icon:e(ae),class:"text-green"},null,8,["icon"])):(u(),v(e(k),{key:1,icon:e(L),class:"text-red"},null,8,["icon"]))]),"item.date":o(({item:l})=>[F(M(e(E)(l.date,"long")),1)]),"item.actions":o(({item:l})=>[e(V).canDelete(e(A).EVENT)?(u(),v(I,{key:0,density:"compact",variant:"text",color:"red",onClick:q=>T(l)},{prepend:o(()=>[r(e(k),{icon:e(L)},null,8,["icon"])]),default:o(()=>[a[1]||(a[1]=F(" Delete ",-1))]),_:1},8,["onClick"])):N("",!0),e(V).canChange(e(A).EVENT)?(u(),v(I,{key:1,density:"compact",variant:"text",onClick:q=>$(l.id)},{prepend:o(()=>[r(e(k),{icon:e(ee)},null,8,["icon"])]),default:o(()=>[a[2]||(a[2]=F(" Edit ",-1))]),_:1},8,["onClick"])):N("",!0)]),_:1},8,["items-per-page","items","items-length","loading","page","no-data-text","loading-text","onUpdate:options"]))]),_:1})]),_:1})]),_:1},8,["title"]),r(ye,{ref_key:"dialog",ref:s},null,512)],64))}});export{_e as default};
//# sourceMappingURL=EventView-CCt4ZHhQ.js.map
