import{j as F,r as s,l as L,c as M,y as g,D as k,v as o,q as d,H as x,u as a,I as O,J as Q,K as W,k as X,m as Y,F as Z,f as ee,P as T,z as D,A,E as P,L as N,M as I,N as ae}from"./index-Dc_14tgw.js";import{_ as te,V as $}from"./LayoutBase.vue_vue_type_script_setup_true_lang-C2uo4hv-.js";import{V as le,d as ne,a as oe}from"./VDataTableServer-B-Q_eXiX.js";import{V as se}from"./VForm-BYzCI_2L.js";import{a as B}from"./VRow-BqJ1k-Cp.js";const ie=F({__name:"EventDialog",setup(S,{expose:e}){const w=s(),{t:i}=L(),E=s(""),m=s(""),u=s(""),f=s(!1),V=s(""),b=M(()=>f.value?i("EventDialog.labels.isArchived"):i("EventDialog.labels.isNotArchived"));async function h(p=void 0){var t;return p!==void 0?(E.value=p.name,m.value=p.tag??"",u.value=p.date,f.value=p.archived??!1,V.value=p.mainurl??""):(E.value="",m.value="",u.value="",f.value=!1,V.value=""),{ok:await((t=w.value)==null?void 0:t.modal())??!1,name:E.value,tag:m.value,date:u.value,archived:f.value,mainUrl:V.value}}return e({modal:h}),(p,n)=>(g(),k(O,{title:a(i)("EventDialog.title"),"ok-text":a(i)("General.save"),"ok-icon":"fas fa-floppy-disk",width:1e3,ref_key:"dialog",ref:w},{default:o(()=>[d(se,null,{default:o(()=>[d(x,{modelValue:E.value,"onUpdate:modelValue":n[0]||(n[0]=t=>E.value=t),variant:"outlined",label:a(i)("EventDialog.labels.name")},null,8,["modelValue","label"]),d(x,{modelValue:m.value,"onUpdate:modelValue":n[1]||(n[1]=t=>m.value=t),variant:"outlined",label:a(i)("EventDialog.labels.tag")},null,8,["modelValue","label"]),d(x,{type:"date",modelValue:u.value,"onUpdate:modelValue":n[2]||(n[2]=t=>u.value=t),variant:"outlined",label:a(i)("EventDialog.labels.date")},null,8,["modelValue","label"]),d(x,{modelValue:V.value,"onUpdate:modelValue":n[3]||(n[3]=t=>V.value=t),variant:"outlined",label:a(i)("EventDialog.labels.mainUrl")},null,8,["modelValue","label"]),d(le,{modelValue:f.value,"onUpdate:modelValue":n[4]||(n[4]=t=>f.value=t),label:b.value},null,8,["modelValue","label"])]),_:1})]),_:1},8,["title","ok-text"]))}}),me=F({__name:"EventView",props:{eventId:{}},setup(S){const{t:e,d:w}=L(),i=s(void 0),E=ee(ae),m=Q(),u=W(),f=X(),V=s(!1),b=[25,50,100],h=s(b[0]),p=s(0),n=s(1),t=s([]),_=s(0),K=[{title:e("EventView.headers.id"),sortable:!0,key:"id"},{title:e("EventView.headers.name"),sortable:!1,key:"name"},{title:e("EventView.headers.tag"),sortable:!1,key:"tag"},{title:e("EventView.headers.date"),sortable:!0,key:"date"},{title:e("EventView.headers.archived"),sortable:!1,key:"archived"},{title:e("EventView.headers.mainUrl"),sortable:!1,key:"mainurl"},{title:e("EventView.headers.actions"),sortable:!1,key:"actions",align:"end"}];async function j(v){V.value=!0;const r=v.itemsPerPage,l=(v.page-1)*r;try{const{count:c,results:y}=await u.events.eventsList(r,void 0,l,v.sortBy);t.value=y,p.value=c}catch(c){m.error(e("EventView.errors.failedToLoad")),console.error(c)}finally{V.value=!1}}const q=ne(j,250);async function z(v){const r=e("EventView.confirmDelete",v);if(await E.value.confirm(r)){try{await u.events.eventsDestroy(v.id)}catch(c){m.error(e("EventView.errors.failedToDelete")),console.error(c)}_.value+=1}}async function R(v){const r=await u.events.eventsRetrieve(v),{ok:l,name:c,date:y,archived:U,tag:C,mainUrl:H}=await i.value.modal(r);if(l){try{await u.events.eventsPartialUpdate(r.id,{name:c,date:y,archived:U,tag:C,mainurl:H})}catch(J){m.error(e("EventView.errors.failedToEdit")),console.error(J)}_.value+=1}}async function G(){const{ok:v,name:r,date:l,archived:c,tag:y,mainUrl:U}=await i.value.modal();if(v){try{await u.events.eventsCreate({name:r,date:l,archived:c,tag:y,mainurl:U})}catch(C){m.error(e("EventView.errors.failedToCreate")),console.error(C)}n.value=1,_.value+=1}}return(v,r)=>(g(),Y(Z,null,[d(te,{title:a(e)("EventView.title")},{default:o(()=>[d($,null,{default:o(()=>[d(B,null,{default:o(()=>[a(f).canAdd(a(T).EVENT)?(g(),k(P,{key:0,"prepend-icon":"fas fa-plus",onClick:G},{default:o(()=>[D(A(a(e)("EventView.newEvent")),1)]),_:1})):N("",!0)]),_:1})]),_:1}),d($,null,{default:o(()=>[d(B,null,{default:o(()=>[(g(),k(oe,{class:"elevation-1 primary","item-value":"id",density:"compact",key:`blog-table-${_.value}`,headers:K,items:t.value,"items-length":p.value,loading:V.value,page:n.value,"items-per-page-options":b,"no-data-text":a(e)("EventView.noEventsFound"),"loading-text":a(e)("EventView.loadingEvents"),"items-per-page":h.value,"onUpdate:itemsPerPage":r[0]||(r[0]=l=>h.value=l),"onUpdate:options":a(q)},{"item.archived":o(({item:l})=>[l.archived?(g(),k(I,{key:0,icon:"fas fa-check",color:"green"})):(g(),k(I,{key:1,icon:"fas fa-xmark",color:"red"}))]),"item.date":o(({item:l})=>[D(A(a(w)(l.date,"long")),1)]),"item.actions":o(({item:l})=>[a(f).canDelete(a(T).EVENT)?(g(),k(P,{key:0,density:"compact",variant:"text",onClick:c=>z(l),"prepend-icon":"fas fa-xmark",color:"red"},{default:o(()=>[D("Delete")]),_:2},1032,["onClick"])):N("",!0),a(f).canChange(a(T).EVENT)?(g(),k(P,{key:1,density:"compact",variant:"text",onClick:c=>R(l.id),"prepend-icon":"fas fa-pen-to-square"},{default:o(()=>[D("Edit")]),_:2},1032,["onClick"])):N("",!0)]),_:1},8,["items","items-length","loading","page","no-data-text","loading-text","items-per-page","onUpdate:options"]))]),_:1})]),_:1})]),_:1},8,["title"]),d(ie,{ref_key:"dialog",ref:i},null,512)],64))}});export{me as default};
//# sourceMappingURL=EventView-Chh-szq6.js.map
