import{d as N,a as S,b as m,c as A,t as V,I as F,u as R,J as X,K as z,v as G,g as x,w as s,e as l,j as a,P as E,V as H,i as J,k as O,L as Q,D as T,m as W,q as Y,s as i,M as Z,N as ee,H as te}from"./index-DXU74lGt.js";import{_ as P}from"./BooleanIcon.vue_vue_type_script_setup_true_lang-CqjGGkAi.js";import{X as ae}from"./datetime-Dz9fjSvq.js";import{V as C,_ as ne}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D4jd1chv.js";import{_ as se}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-CUVfxWfg.js";import{g as oe}from"./query_tools-BInV9OzK.js";import{g as le}from"./http-BTZWMaMN.js";import{d as re}from"./debounce-CQ84CrOG.js";import{V as L}from"./VRow-B94Tto0H.js";import{V as ie}from"./VDataTableServer-CMLVDy59.js";import"./VContainer-BfWqa_tJ.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-WkXOSlqa.js";import"./useAuditLogUtils-BqNOieoY.js";import"./DateTimeCell.vue_vue_type_script_setup_true_lang-BMnBYvTq.js";import"./VDataTable-Jd7io3gq.js";const de=N({__name:"DateCell",props:{value:{default:null},format:{default:"long"},fallback:{default:"-"}},setup(w){const e=w,{locale:u}=S(),v=F(()=>{if(!e.value)return e.fallback;const r=ae.PlainDate.from(e.value),d=e.format==="short"?{dateStyle:"short"}:{dateStyle:"long"};return new Intl.DateTimeFormat(u.value,d).format(new Date(Date.UTC(r.year,r.month-1,r.day)))});return(r,d)=>(m(),A("span",null,V(v.value),1))}}),ue=["href"],xe=N({__name:"EventView",setup(w){const{t:e}=S(),u=R(),v=X(z),r=G(),d=te(),p=Y(),I=F(()=>{const n=d.getLatestEvent();return[{title:n?.name??"...",to:n?{name:"dashboard",params:{eventId:n.id}}:void 0},{title:e("EventView.title"),disabled:!0}]}),f=i(!1),y=[25,50,100],_=i(y[0]),b=i(0),U=i(1),k=i([]),h=i(""),g=i(null),$=[{title:e("EventView.headers.id"),sortable:!0,key:"id"},{title:e("EventView.headers.name"),sortable:!1,key:"name"},{title:e("EventView.headers.tag"),sortable:!1,key:"tag"},{title:e("EventView.headers.date"),sortable:!0,key:"date"},{title:e("EventView.headers.archived"),sortable:!1,key:"archived"},{title:e("EventView.headers.hidden"),sortable:!1,key:"hidden"},{title:e("EventView.headers.mainUrl"),sortable:!1,key:"mainurl"},{title:e("EventView.headers.actions"),sortable:!1,key:"actions",align:"end"}];async function B(){g.value&&await D(g.value),await d.refreshEvents()}async function D(n){f.value=!0,g.value=n;try{const o=await ee({query:oe(n)});k.value=o.data.results,b.value=o.data.count}catch(o){r.error(e("EventView.loadFailure")),console.error(o)}finally{f.value=!1}}const j=re(D,250);async function q(n){const o=e("EventView.confirmDelete",n);if(await v.value.confirm(o))try{await Z({path:{id:n.id}}),await B(),r.success(e("EventView.deleteSuccess"))}catch(c){r.error(le(c,e("EventView.deleteFailure"))),console.error(c)}}function K(n){u.push({name:"events-edit",params:{id:n}})}function M(){u.push({name:"events-new"})}return(n,o)=>(m(),x(ne,{breadcrumbs:I.value},{default:s(()=>[l(C,null,{default:s(()=>[l(L,null,{default:s(()=>[a(p).canAdd(a(E).EVENT)?(m(),x(H,{key:0,color:"primary",onClick:M},{prepend:s(()=>[l(a(O),{icon:a(Q)},null,8,["icon"])]),default:s(()=>[J(" "+V(a(e)("EventView.newEvent")),1)]),_:1})):T("",!0),l(W,{modelValue:h.value,"onUpdate:modelValue":o[0]||(o[0]=t=>h.value=t),variant:"outlined",density:"compact",label:a(e)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),l(C,null,{default:s(()=>[l(L,null,{default:s(()=>[l(ie,{"items-per-page":_.value,"onUpdate:itemsPerPage":o[1]||(o[1]=t=>_.value=t),class:"elevation-1 primary","item-value":"id",density:"compact",headers:$,items:k.value,"items-length":b.value,loading:f.value,page:U.value,search:h.value,"items-per-page-options":y,"no-data-text":a(e)("EventView.noEventsFound"),"loading-text":a(e)("EventView.loadingEvents"),"onUpdate:options":a(j)},{"item.archived":s(({item:t})=>[l(P,{value:t.archived},null,8,["value"])]),"item.hidden":s(({item:t})=>[l(P,{value:t.hidden},null,8,["value"])]),"item.date":s(({item:t})=>[l(de,{value:t.date},null,8,["value"])]),"item.mainurl":s(({item:t})=>[t.mainurl?(m(),A("a",{key:0,href:t.mainurl,target:"_blank"},V(t.mainurl),9,ue)):T("",!0)]),"item.actions":s(({item:t})=>[l(se,{"can-edit":a(p).canChange(a(E).EVENT),"can-delete":a(p).canDelete(a(E).EVENT),"audit-log":{appLabel:"kompomaatti",model:"event",objectPk:t.id},onEdit:c=>K(t.id),onDelete:c=>q(t)},null,8,["can-edit","can-delete","audit-log","onEdit","onDelete"])]),_:1},8,["items-per-page","items","items-length","loading","page","search","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{xe as default};
//# sourceMappingURL=EventView-DBH2w-Nu.js.map
