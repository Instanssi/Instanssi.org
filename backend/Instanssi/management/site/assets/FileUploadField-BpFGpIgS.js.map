{"version":3,"file":"FileUploadField-BpFGpIgS.js","sources":["../../../../../admin/src/components/form/FileUploadField.vue"],"sourcesContent":["<template>\n    <v-file-input\n        ref=\"fileInputRef\"\n        :model-value=\"displayValue\"\n        :label=\"computedLabel\"\n        :error-messages=\"errorMessage\"\n        :accept=\"accept\"\n        variant=\"outlined\"\n        prepend-icon=\"\"\n        clearable\n        @update:model-value=\"handleFileChange\"\n        @click:clear=\"handleClear\"\n    >\n        <template #prepend-inner>\n            <FontAwesomeIcon :icon=\"faUpload\" class=\"mr-2\" />\n        </template>\n        <template v-if=\"previewUrl\" #append-inner>\n            <!-- Image preview -->\n            <div\n                v-if=\"fileType === 'image'\"\n                class=\"file-preview\"\n                role=\"button\"\n                tabindex=\"0\"\n                :title=\"t('FileUploadField.clickToPreview')\"\n                @click.stop=\"showImagePreview = true\"\n                @keydown.enter=\"showImagePreview = true\"\n                @keydown.space.prevent=\"showImagePreview = true\"\n            >\n                <v-img :src=\"previewUrl\" width=\"32\" height=\"32\" cover class=\"rounded\" />\n            </div>\n\n            <!-- Video preview button -->\n            <v-btn\n                v-else-if=\"fileType === 'video'\"\n                icon\n                variant=\"text\"\n                size=\"x-small\"\n                :title=\"t('FileUploadField.clickToPreview')\"\n                @click.stop=\"showVideoPreview = true\"\n            >\n                <FontAwesomeIcon :icon=\"faCirclePlay\" size=\"lg\" />\n            </v-btn>\n\n            <!-- Audio preview button -->\n            <v-btn\n                v-else-if=\"fileType === 'audio'\"\n                icon\n                variant=\"text\"\n                size=\"x-small\"\n                :title=\"t('FileUploadField.clickToPreview')\"\n                @click.stop=\"showAudioPreview = true\"\n            >\n                <FontAwesomeIcon :icon=\"faVolumeHigh\" size=\"lg\" />\n            </v-btn>\n\n            <!-- Download button for other files -->\n            <v-btn\n                v-else\n                icon\n                variant=\"text\"\n                size=\"x-small\"\n                :href=\"previewUrl\"\n                target=\"_blank\"\n                :title=\"t('FileUploadField.download')\"\n                @click.stop\n            >\n                <FontAwesomeIcon :icon=\"faDownload\" size=\"lg\" />\n            </v-btn>\n        </template>\n    </v-file-input>\n\n    <!-- Image Preview Dialog -->\n    <v-dialog v-model=\"showImagePreview\" max-width=\"900\">\n        <v-card>\n            <v-card-title class=\"d-flex justify-space-between align-center\">\n                <span>{{ t(\"FileUploadField.imagePreviewTitle\") }}</span>\n                <v-btn icon variant=\"text\" density=\"compact\" @click=\"showImagePreview = false\">\n                    <FontAwesomeIcon :icon=\"faXmark\" />\n                </v-btn>\n            </v-card-title>\n            <v-divider />\n            <v-card-text class=\"d-flex justify-center pa-4\">\n                <v-img :src=\"previewUrl ?? undefined\" max-height=\"70vh\" max-width=\"100%\" />\n            </v-card-text>\n        </v-card>\n    </v-dialog>\n\n    <!-- Video Preview Dialog -->\n    <v-dialog v-model=\"showVideoPreview\" max-width=\"900\">\n        <v-card>\n            <v-card-title class=\"d-flex justify-space-between align-center\">\n                <span>{{ t(\"FileUploadField.videoPreviewTitle\") }}</span>\n                <v-btn icon variant=\"text\" density=\"compact\" @click=\"showVideoPreview = false\">\n                    <FontAwesomeIcon :icon=\"faXmark\" />\n                </v-btn>\n            </v-card-title>\n            <v-divider />\n            <v-card-text class=\"d-flex justify-center pa-4\">\n                <video\n                    v-if=\"showVideoPreview && previewUrl\"\n                    :src=\"previewUrl\"\n                    controls\n                    autoplay\n                    class=\"video-player\"\n                >\n                    {{ t(\"FileUploadField.videoNotSupported\") }}\n                </video>\n            </v-card-text>\n        </v-card>\n    </v-dialog>\n\n    <!-- Audio Preview Dialog -->\n    <v-dialog v-model=\"showAudioPreview\" max-width=\"500\">\n        <v-card>\n            <v-card-title class=\"d-flex justify-space-between align-center\">\n                <span>{{ t(\"FileUploadField.audioPreviewTitle\") }}</span>\n                <v-btn icon variant=\"text\" density=\"compact\" @click=\"showAudioPreview = false\">\n                    <FontAwesomeIcon :icon=\"faXmark\" />\n                </v-btn>\n            </v-card-title>\n            <v-divider />\n            <v-card-text class=\"d-flex justify-center pa-4\">\n                <audio\n                    v-if=\"showAudioPreview && previewUrl\"\n                    :src=\"previewUrl\"\n                    controls\n                    autoplay\n                    class=\"audio-player\"\n                >\n                    {{ t(\"FileUploadField.audioNotSupported\") }}\n                </audio>\n            </v-card-text>\n        </v-card>\n    </v-dialog>\n</template>\n\n<script setup lang=\"ts\">\nimport {\n    faCirclePlay,\n    faDownload,\n    faUpload,\n    faVolumeHigh,\n    faXmark,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/vue-fontawesome\";\nimport { computed, onBeforeUnmount, ref, watch } from \"vue\";\nimport { useI18n } from \"vue-i18n\";\n\nimport { type FileValue, getFile } from \"@/utils/file\";\n\n// File type detection based on extension or MIME type\nconst IMAGE_EXTENSIONS = [\"jpg\", \"jpeg\", \"png\", \"gif\", \"webp\", \"svg\", \"bmp\", \"ico\"];\nconst VIDEO_EXTENSIONS = [\"mp4\", \"mkv\", \"webm\", \"avi\", \"mov\", \"wmv\", \"flv\", \"ogv\"];\nconst AUDIO_EXTENSIONS = [\"mp3\", \"ogg\", \"opus\", \"aac\", \"wav\", \"flac\", \"m4a\", \"wma\"];\n\ntype FileType = \"image\" | \"video\" | \"audio\" | \"other\";\n\nfunction detectFileType(filename: string | null, mimeType: string | null): FileType {\n    // Try MIME type first\n    if (mimeType) {\n        if (mimeType.startsWith(\"image/\")) return \"image\";\n        if (mimeType.startsWith(\"video/\")) return \"video\";\n        if (mimeType.startsWith(\"audio/\")) return \"audio\";\n    }\n\n    // Fall back to extension\n    if (filename) {\n        const ext = filename.split(\".\").pop()?.toLowerCase();\n        if (ext) {\n            if (IMAGE_EXTENSIONS.includes(ext)) return \"image\";\n            if (VIDEO_EXTENSIONS.includes(ext)) return \"video\";\n            if (AUDIO_EXTENSIONS.includes(ext)) return \"audio\";\n        }\n    }\n\n    return \"other\";\n}\n\nfunction getFilenameFromUrl(url: string | null): string | null {\n    if (!url) return null;\n    try {\n        const pathname = new URL(url).pathname;\n        return pathname.split(\"/\").pop() || null;\n    } catch {\n        // If URL parsing fails, try to extract filename directly\n        return url.split(\"/\").pop()?.split(\"?\")[0] || null;\n    }\n}\n\nconst props = withDefaults(\n    defineProps<{\n        modelValue: FileValue;\n        currentFileUrl?: string | null;\n        label: string;\n        errorMessage?: string;\n        accept?: string;\n        required?: boolean;\n    }>(),\n    {\n        currentFileUrl: null,\n        errorMessage: undefined,\n        accept: undefined,\n        required: false,\n    }\n);\n\nconst emit = defineEmits<{\n    \"update:modelValue\": [value: FileValue];\n}>();\n\nconst { t } = useI18n();\nconst fileInputRef = ref();\nconst showImagePreview = ref(false);\nconst showVideoPreview = ref(false);\nconst showAudioPreview = ref(false);\nconst objectUrl = ref<string | null>(null);\nconst wasCleared = ref(false);\n\nconst computedLabel = computed(() => {\n    return props.required ? `${props.label} *` : props.label;\n});\n\n// Get the currently selected file\nconst selectedFile = computed(() => getFile(props.modelValue));\n\n// Create a fake File object to display the current URL filename\nconst displayValue = computed((): FileValue => {\n    // If user selected a new file, show that\n    if (selectedFile.value) {\n        return selectedFile.value;\n    }\n\n    // If cleared, show nothing\n    if (wasCleared.value) {\n        return null;\n    }\n\n    // If we have a current URL, create a placeholder to show the filename\n    if (props.currentFileUrl) {\n        const filename = getFilenameFromUrl(props.currentFileUrl);\n        if (filename) {\n            // Create a minimal File-like object for display purposes\n            // VFileInput will show the filename from this\n            return new File([], filename);\n        }\n    }\n\n    return null;\n});\n\n// Determine file type from selected file or current URL\nconst fileType = computed<FileType>(() => {\n    if (selectedFile.value) {\n        return detectFileType(selectedFile.value.name, selectedFile.value.type);\n    }\n    if (!wasCleared.value && props.currentFileUrl) {\n        const filename = getFilenameFromUrl(props.currentFileUrl);\n        return detectFileType(filename, null);\n    }\n    return \"other\";\n});\n\n// Create object URL for selected file preview\nwatch(\n    () => props.modelValue,\n    (newValue) => {\n        // Clean up previous object URL\n        if (objectUrl.value) {\n            URL.revokeObjectURL(objectUrl.value);\n            objectUrl.value = null;\n        }\n\n        // Create new object URL for the selected file\n        const file = getFile(newValue);\n        if (file) {\n            objectUrl.value = URL.createObjectURL(file);\n            wasCleared.value = false;\n        }\n    },\n    { immediate: true }\n);\n\n// Clean up object URL on unmount\nonBeforeUnmount(() => {\n    if (objectUrl.value) {\n        URL.revokeObjectURL(objectUrl.value);\n    }\n});\n\n// Preview URL: prefer newly selected file, fall back to existing server URL\nconst previewUrl = computed(() => {\n    if (objectUrl.value) return objectUrl.value;\n    if (wasCleared.value) return null;\n    return props.currentFileUrl ?? null;\n});\n\nfunction handleFileChange(value: FileValue) {\n    wasCleared.value = false;\n    emit(\"update:modelValue\", value);\n}\n\nfunction handleClear() {\n    wasCleared.value = true;\n    emit(\"update:modelValue\", null);\n}\n</script>\n\n<style scoped>\n.file-preview {\n    cursor: pointer;\n    border: 1px solid rgba(var(--v-border-color), var(--v-border-opacity));\n    border-radius: 4px;\n    padding: 1px;\n    transition: border-color 0.2s;\n}\n\n.file-preview:hover {\n    border-color: rgb(var(--v-theme-primary));\n}\n\n.file-preview:focus {\n    outline: 2px solid rgb(var(--v-theme-primary));\n    outline-offset: 1px;\n}\n\n.video-player {\n    max-width: 100%;\n    max-height: 70vh;\n}\n\n.audio-player {\n    width: 100%;\n    min-width: 300px;\n}\n</style>\n"],"names":["IMAGE_EXTENSIONS","VIDEO_EXTENSIONS","AUDIO_EXTENSIONS","detectFileType","filename","mimeType","ext","getFilenameFromUrl","url","props","__props","emit","__emit","t","useI18n","fileInputRef","ref","showImagePreview","showVideoPreview","showAudioPreview","objectUrl","wasCleared","computedLabel","computed","selectedFile","getFile","displayValue","fileType","watch","newValue","file","onBeforeUnmount","previewUrl","handleFileChange","value","handleClear","_createVNode","_component_v_file_input","_unref","FontAwesomeIcon","faUpload","_createElementBlock","_component_v_img","_createBlock","_component_v_btn","faCirclePlay","faVolumeHigh","faDownload","_component_v_dialog","$event","_component_v_card","_component_v_card_title","_createElementVNode","faXmark","_component_v_divider","_component_v_card_text","_hoisted_2","_hoisted_3"],"mappings":"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"}