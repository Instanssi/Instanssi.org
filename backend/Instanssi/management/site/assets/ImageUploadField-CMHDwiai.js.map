{"version":3,"file":"ImageUploadField-CMHDwiai.js","sources":["../../../../../admin/src/components/form/ImageUploadField.vue"],"sourcesContent":["<template>\n    <v-file-input\n        :model-value=\"displayValue\"\n        :label=\"computedLabel\"\n        :error-messages=\"errorMessage\"\n        :accept=\"accept\"\n        variant=\"outlined\"\n        prepend-icon=\"\"\n        clearable\n        @update:model-value=\"handleFileChange\"\n        @click:clear=\"handleClear\"\n    >\n        <template #prepend-inner>\n            <FontAwesomeIcon :icon=\"faImage\" class=\"mr-2\" />\n        </template>\n        <template v-if=\"previewUrl\" #append-inner>\n            <div\n                class=\"image-preview\"\n                role=\"button\"\n                tabindex=\"0\"\n                :title=\"t('ImageUploadField.clickToPreview')\"\n                @click.stop=\"showPreview = true\"\n                @keydown.enter=\"showPreview = true\"\n                @keydown.space.prevent=\"showPreview = true\"\n            >\n                <v-img :src=\"previewUrl\" width=\"32\" height=\"32\" cover class=\"rounded\" />\n            </div>\n        </template>\n    </v-file-input>\n\n    <v-dialog v-model=\"showPreview\" max-width=\"900\">\n        <v-card>\n            <v-card-title class=\"d-flex justify-space-between align-center\">\n                <span>{{ t(\"ImageUploadField.previewTitle\") }}</span>\n                <v-btn icon variant=\"text\" density=\"compact\" @click=\"showPreview = false\">\n                    <FontAwesomeIcon :icon=\"faXmark\" />\n                </v-btn>\n            </v-card-title>\n            <v-divider />\n            <v-card-text class=\"d-flex justify-center pa-4\">\n                <v-img :src=\"previewUrl ?? undefined\" max-height=\"70vh\" max-width=\"100%\" />\n            </v-card-text>\n        </v-card>\n    </v-dialog>\n</template>\n\n<script setup lang=\"ts\">\nimport { faImage, faXmark } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/vue-fontawesome\";\nimport { computed, onBeforeUnmount, ref, watch } from \"vue\";\nimport { useI18n } from \"vue-i18n\";\n\nimport { type FileValue, getFile } from \"@/utils/file\";\n\nconst props = withDefaults(\n    defineProps<{\n        modelValue: FileValue;\n        currentImageUrl?: string | null;\n        label: string;\n        errorMessage?: string;\n        accept?: string;\n        required?: boolean;\n    }>(),\n    {\n        currentImageUrl: null,\n        errorMessage: undefined,\n        accept: \"image/*\",\n        required: false,\n    }\n);\n\nconst emit = defineEmits<{\n    \"update:modelValue\": [value: FileValue];\n}>();\n\nconst { t } = useI18n();\nconst showPreview = ref(false);\nconst objectUrl = ref<string | null>(null);\nconst wasCleared = ref(false);\n\nconst computedLabel = computed(() => {\n    return props.required ? `${props.label} *` : props.label;\n});\n\n// Get the currently selected file\nconst selectedFile = computed(() => getFile(props.modelValue));\n\n// Extract filename from URL\nfunction getFilenameFromUrl(url: string | null): string | null {\n    if (!url) return null;\n    try {\n        const pathname = new URL(url).pathname;\n        return pathname.split(\"/\").pop() || null;\n    } catch {\n        return url.split(\"/\").pop()?.split(\"?\")[0] || null;\n    }\n}\n\n// Create a display value that shows the current URL filename when no new file is selected\nconst displayValue = computed((): FileValue => {\n    // If user selected a new file, show that\n    if (selectedFile.value) {\n        return selectedFile.value;\n    }\n\n    // If cleared, show nothing\n    if (wasCleared.value) {\n        return null;\n    }\n\n    // If we have a current URL, create a placeholder to show the filename\n    if (props.currentImageUrl) {\n        const filename = getFilenameFromUrl(props.currentImageUrl);\n        if (filename) {\n            return new File([], filename);\n        }\n    }\n\n    return null;\n});\n\n// Create object URL for selected file preview\nwatch(\n    () => props.modelValue,\n    (newValue) => {\n        // Clean up previous object URL\n        if (objectUrl.value) {\n            URL.revokeObjectURL(objectUrl.value);\n            objectUrl.value = null;\n        }\n\n        // Create new object URL for the selected file\n        const file = getFile(newValue);\n        if (file) {\n            objectUrl.value = URL.createObjectURL(file);\n            wasCleared.value = false;\n        }\n    },\n    { immediate: true }\n);\n\n// Clean up object URL on unmount\nonBeforeUnmount(() => {\n    if (objectUrl.value) {\n        URL.revokeObjectURL(objectUrl.value);\n    }\n});\n\n// Preview URL: prefer newly selected file, fall back to existing server URL\nconst previewUrl = computed(() => {\n    if (objectUrl.value) return objectUrl.value;\n    if (wasCleared.value) return null;\n    return props.currentImageUrl ?? null;\n});\n\nfunction handleFileChange(value: FileValue) {\n    wasCleared.value = false;\n    emit(\"update:modelValue\", value);\n}\n\nfunction handleClear() {\n    wasCleared.value = true;\n    emit(\"update:modelValue\", null);\n}\n</script>\n\n<style scoped>\n.image-preview {\n    cursor: pointer;\n    border: 1px solid rgba(var(--v-border-color), var(--v-border-opacity));\n    border-radius: 4px;\n    padding: 1px;\n    transition: border-color 0.2s;\n}\n\n.image-preview:hover {\n    border-color: rgb(var(--v-theme-primary));\n}\n\n.image-preview:focus {\n    outline: 2px solid rgb(var(--v-theme-primary));\n    outline-offset: 1px;\n}\n</style>\n"],"names":["props","__props","emit","__emit","t","useI18n","showPreview","ref","objectUrl","wasCleared","computedLabel","computed","selectedFile","getFile","getFilenameFromUrl","url","displayValue","filename","watch","newValue","file","onBeforeUnmount","previewUrl","handleFileChange","value","handleClear","_createVNode","_component_v_file_input","_unref","FontAwesomeIcon","faImage","_createElementVNode","_component_v_img","_component_v_dialog","$event","_component_v_card","_component_v_card_title","_component_v_btn","faXmark","_component_v_divider","_component_v_card_text"],"mappings":"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"}