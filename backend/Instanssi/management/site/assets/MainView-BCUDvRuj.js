import{d as N,a as A,b as r,g as d,j as t,dI as rt,w as a,e as s,I as E,dS as ut,a5 as j,i as k,t as C,u as dt,L as pt,p as B,aD as D,k as P,dT as mt,D as y,B as F,f as L,c as T,P as m,dU as vt,dV as ft,dW as gt,dX as _t,dY as yt,cB as bt,aN as U,F as G,r as X,au as Z,ab as Ct,c8 as ht,dH as wt,dZ as Vt,d_ as Et,q as kt,s as w,z as Mt,ad as It,aq as Pt,aA as Tt,aR as Rt,bu as Ot,c7 as Nt,bK as At}from"./index-CQkWvXOv.js";import{C as H,B as $t,a as xt,p as W,L as qt,b as J,_ as tt,c as Bt,A as Dt,P as Ft,d as R,e as Lt}from"./StatCard.vue_vue_type_script_setup_true_lang-Dj0FEt_9.js";import{X as Q,A as St}from"./datetime-Dz9fjSvq.js";import{V as b,_ as zt}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D5aCeQDf.js";import{V as O}from"./VRow-CXIXhuhq.js";import{p as Yt}from"./parseInt-BJ5A4_3y.js";import"./VContainer-DqJ8gu3P.js";const Kt=N({__name:"CompetitionParticipantsChart",props:{competitions:{},participantCounts:{}},setup(f){H.register($t,xt,W,qt,J);const p=f,{t:v}=A(),o={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}},h=E(()=>({labels:p.competitions.map(i=>i.name),datasets:[{label:v("MainView.stats.participants"),data:p.competitions.map(i=>p.participantCounts.get(i.id)??0),backgroundColor:"#2196F3"}]}));return(i,l)=>(r(),d(tt,{title:t(v)("MainView.charts.competitionParticipants"),icon:t(rt),"has-data":h.value.labels.length>0,"no-data-text":t(v)("MainView.charts.noData")},{default:a(()=>[s(t(Bt),{data:h.value,options:o},null,8,["data"])]),_:1},8,["title","icon","has-data","no-data-text"]))}}),Ut=N({__name:"EntriesPerCompoChart",props:{compos:{},entryCounts:{}},setup(f){H.register(Dt,W,J);const p=f,{t:v}=A(),o=["#4CAF50","#2196F3","#FF9800","#9C27B0","#E91E63","#00BCD4","#FFEB3B","#795548","#607D8B","#F44336"],h={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right"}}},i=E(()=>({labels:p.compos.map(l=>l.name),datasets:[{data:p.compos.map(l=>p.entryCounts.get(l.id)??0),backgroundColor:o.slice(0,p.compos.length)}]}));return(l,M)=>(r(),d(tt,{title:t(v)("MainView.charts.entriesPerCompo"),icon:t(ut),"has-data":i.value.labels.length>0,"no-data-text":t(v)("MainView.charts.noData")},{default:a(()=>[s(t(Ft),{data:i.value,options:h},null,8,["data"])]),_:1},8,["title","icon","has-data","no-data-text"]))}}),Gt=N({__name:"EventCountdown",props:{date:{}},setup(f){const p=f,{t:v}=A(),o=E(()=>{const l=Q.PlainDate.from(p.date),M=Q.Now.zonedDateTimeISO(St).toPlainDate();return l.since(M).days}),h=E(()=>{const l=o.value;return l>0?v("MainView.daysUntil",{days:l}):l===0?v("MainView.today"):v("MainView.daysAgo",{days:Math.abs(l)})}),i=E(()=>{const l=o.value;return l>7?"green":l>0?"orange":l===0?"red":"grey"});return(l,M)=>(r(),d(j,{color:i.value,size:"small"},{default:a(()=>[k(C(h.value),1)]),_:1},8,["color"]))}}),Xt={class:"text-grey"},Zt={key:0,class:"mt-2"},Qt={class:"text-grey"},jt={key:1,class:"text-center text-grey py-4"},Ht={key:1,class:"text-center text-grey py-4"},oe=N({__name:"MainView",props:{eventId:{}},setup(f){const p=dt(),v=f,{t:o,d:h}=A(),i=kt(),l=w(null),M=E(()=>Yt(v.eventId,10)),et=E(()=>[{title:l.value?.name??"...",to:{name:"dashboard",params:{eventId:v.eventId}}},{title:o("MainView.title"),disabled:!0}]),u=w({blogPosts:{total:0,public:0,draft:0},compoEntries:0,compos:0,competitionParticipants:0,competitions:0,transactions:{total:0,paid:0},voteCodeRequests:{total:0,pending:0}}),$=w([]),x=w([]),q=w([]),S=w([]),z=w(new Map),Y=w(new Map);function at(c){return q.value.find(e=>e.id===c)?.name??o("MainView.unknown")}async function st(c){try{const e=await Mt({path:{id:c}});l.value=e.data??null}catch(e){console.error("Failed to load event:",e)}}async function nt(c){if(i.canView(m.BLOG_ENTRY))try{const n=(await It({query:{event:c,limit:1e3}})).data?.results??[],g=n.filter(_=>_.public).length;u.value.blogPosts={total:n.length,public:g,draft:n.length-g},$.value=n.slice(0,5)}catch(e){console.error("Failed to load blog posts:",e)}}async function ot(c){if(!(!i.canView(m.COMPO)&&!i.canView(m.ENTRY)))try{const[e,n]=await Promise.all([Pt({path:{event_pk:c},query:{limit:1e3}}),Tt({path:{event_pk:c},query:{limit:1e3}})]),g=e.data?.results??[],_=n.data?.results??[];q.value=g,u.value.compos=g.length,u.value.compoEntries=_.length,x.value=_.slice(0,5);const V=new Map;for(const I of _)V.set(I.compo,(V.get(I.compo)??0)+1);z.value=V}catch(e){console.error("Failed to load compos/entries:",e)}}async function it(c){if(!(!i.canView(m.COMPETITION)&&!i.canView(m.COMPETITION_PARTICIPATION)))try{const[e,n]=await Promise.all([Rt({path:{event_pk:c},query:{limit:1e3}}),Ot({path:{event_pk:c},query:{limit:1e3}})]),g=e.data?.results??[],_=n.data?.results??[];S.value=g,u.value.competitions=g.length,u.value.competitionParticipants=_.length;const V=new Map;for(const I of _)V.set(I.competition,(V.get(I.competition)??0)+1);Y.value=V}catch(e){console.error("Failed to load competitions/participants:",e)}}async function lt(c){if(i.canView(m.STORE_TRANSACTION))try{const n=(await Nt({path:{event_pk:c},query:{limit:1e3}})).data?.results??[],g=n.filter(_=>_.time_paid).length;u.value.transactions={total:n.length,paid:g}}catch(e){console.error("Failed to load transactions:",e)}}async function ct(c){if(i.canView(m.VOTE_CODE_REQUEST))try{const n=(await At({path:{event_pk:c},query:{limit:1e3}})).data?.results??[],g=n.filter(_=>_.status===0).length;u.value.voteCodeRequests={total:n.length,pending:g}}catch(e){console.error("Failed to load vote code requests:",e)}}async function K(){const c=M.value;await st(c),await Promise.all([nt(c),ot(c),it(c),lt(c),ct(c)])}return pt(()=>v.eventId,K),(c,e)=>(r(),d(zt,{key:`dashboard-${f.eventId}`,breadcrumbs:et.value},{default:a(()=>[s(O,null,{default:a(()=>[s(b,{cols:"12"},{default:a(()=>[s(B,null,{default:a(()=>[s(D,{class:"d-flex align-center"},{default:a(()=>[s(t(P),{icon:t(mt),class:"mr-2"},null,8,["icon"]),k(" "+C(l.value?.name??t(o)("MainView.noEvent"))+" ",1),l.value?.archived?(r(),d(j,{key:0,class:"ml-2",color:"grey",size:"small"},{default:a(()=>[k(C(t(o)("MainView.archived")),1)]),_:1})):y("",!0)]),_:1}),s(F,null,{default:a(()=>[L("div",null,[L("span",Xt,C(t(o)("MainView.eventDate"))+":",1),k(" "+C(l.value?t(h)(l.value.date,"short"):"-"),1)]),l.value?(r(),T("div",Zt,[L("span",Qt,C(t(o)("MainView.countdown"))+":",1),s(Gt,{date:l.value.date,class:"ml-1"},null,8,["date"])])):y("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),s(O,{class:"mt-2"},{default:a(()=>[t(i).canView(t(m).BLOG_ENTRY)?(r(),d(b,{key:0,cols:"12",sm:"6",lg:""},{default:a(()=>[s(R,{icon:t(vt),value:u.value.blogPosts.total,label:t(o)("MainView.stats.blogPosts"),subtitle:`${u.value.blogPosts.public} ${t(o)("MainView.stats.public")} / ${u.value.blogPosts.draft} ${t(o)("MainView.stats.draft")}`,color:"blue",clickable:"",onClick:e[0]||(e[0]=n=>t(p).push({name:"blog",params:{eventId:f.eventId}}))},null,8,["icon","value","label","subtitle"])]),_:1})):y("",!0),t(i).canView(t(m).ENTRY)?(r(),d(b,{key:1,cols:"12",sm:"6",lg:""},{default:a(()=>[s(R,{icon:t(ft),value:u.value.compoEntries,label:t(o)("MainView.stats.compoEntries"),subtitle:`${u.value.compos} ${t(o)("MainView.stats.compos")}`,color:"green",clickable:"",onClick:e[1]||(e[1]=n=>t(p).push({name:"entries",params:{eventId:f.eventId}}))},null,8,["icon","value","label","subtitle"])]),_:1})):y("",!0),t(i).canView(t(m).COMPETITION_PARTICIPATION)?(r(),d(b,{key:2,cols:"12",sm:"6",lg:""},{default:a(()=>[s(R,{icon:t(gt),value:u.value.competitionParticipants,label:t(o)("MainView.stats.competitionParticipants"),subtitle:`${u.value.competitions} ${t(o)("MainView.stats.competitions")}`,color:"orange-darken-3",clickable:"",onClick:e[2]||(e[2]=n=>t(p).push({name:"competition-participations",params:{eventId:f.eventId}}))},null,8,["icon","value","label","subtitle"])]),_:1})):y("",!0),t(i).canView(t(m).STORE_TRANSACTION)?(r(),d(b,{key:3,cols:"12",sm:"6",lg:""},{default:a(()=>[s(R,{icon:t(_t),value:u.value.transactions.total,label:t(o)("MainView.stats.transactions"),subtitle:`${u.value.transactions.paid} ${t(o)("MainView.stats.paid")}`,color:"teal",clickable:"",onClick:e[3]||(e[3]=n=>t(p).push({name:"store-transactions",params:{eventId:f.eventId}}))},null,8,["icon","value","label","subtitle"])]),_:1})):y("",!0),t(i).canView(t(m).VOTE_CODE_REQUEST)?(r(),d(b,{key:4,cols:"12",sm:"6",lg:""},{default:a(()=>[s(R,{icon:t(yt),value:u.value.voteCodeRequests.pending,label:t(o)("MainView.stats.pendingVoteRequests"),subtitle:`${u.value.voteCodeRequests.total} ${t(o)("MainView.stats.totalRequests")}`,color:"pink",clickable:"",onClick:e[4]||(e[4]=n=>t(p).push({name:"vote-code-requests",params:{eventId:f.eventId}}))},null,8,["icon","value","label","subtitle"])]),_:1})):y("",!0)]),_:1}),s(O,{class:"mt-2"},{default:a(()=>[t(i).canView(t(m).COMPO)?(r(),d(b,{key:0,cols:"12",md:"6"},{default:a(()=>[s(Ut,{compos:q.value,"entry-counts":z.value},null,8,["compos","entry-counts"])]),_:1})):y("",!0),t(i).canView(t(m).COMPETITION)?(r(),d(b,{key:1,cols:"12",md:"6"},{default:a(()=>[s(Kt,{competitions:S.value,"participant-counts":Y.value},null,8,["competitions","participant-counts"])]),_:1})):y("",!0)]),_:1}),s(O,{class:"mt-2 mb-1"},{default:a(()=>[t(i).canView(t(m).BLOG_ENTRY)?(r(),d(b,{key:0,cols:"12",md:"6"},{default:a(()=>[s(B,null,{default:a(()=>[s(D,null,{default:a(()=>[s(t(P),{icon:t(bt),class:"mr-2"},null,8,["icon"]),k(" "+C(t(o)("MainView.recentActivity.blogPosts")),1)]),_:1}),s(F,null,{default:a(()=>[$.value.length>0?(r(),d(U,{key:0,density:"compact"},{default:a(()=>[(r(!0),T(G,null,X($.value,n=>(r(),d(Z,{key:n.id,title:n.title,subtitle:t(h)(n.date,"long")},{prepend:a(()=>[s(t(P),{icon:n.public?t(ht):t(wt),class:Ct(n.public?"text-green mr-3":"text-grey mr-3"),size:"sm"},null,8,["icon","class"])]),_:2},1032,["title","subtitle"]))),128))]),_:1})):(r(),T("div",jt,C(t(o)("MainView.recentActivity.noRecentPosts")),1))]),_:1})]),_:1})]),_:1})):y("",!0),t(i).canView(t(m).ENTRY)?(r(),d(b,{key:1,cols:"12",md:"6"},{default:a(()=>[s(B,null,{default:a(()=>[s(D,null,{default:a(()=>[s(t(P),{icon:t(Vt),class:"mr-2"},null,8,["icon"]),k(" "+C(t(o)("MainView.recentActivity.compoEntries")),1)]),_:1}),s(F,null,{default:a(()=>[x.value.length>0?(r(),d(U,{key:0,density:"compact"},{default:a(()=>[(r(!0),T(G,null,X(x.value,n=>(r(),d(Z,{key:n.id,title:n.name,subtitle:at(n.compo)},{prepend:a(()=>[s(t(P),{icon:t(Et),size:"sm",class:"mr-3"},null,8,["icon"])]),_:1},8,["title","subtitle"]))),128))]),_:1})):(r(),T("div",Ht,C(t(o)("MainView.recentActivity.noRecentEntries")),1))]),_:1})]),_:1})]),_:1})):y("",!0)]),_:1}),s(Lt,{onRefresh:K})]),_:1},8,["breadcrumbs"]))}});export{oe as default};
//# sourceMappingURL=MainView-BCUDvRuj.js.map
