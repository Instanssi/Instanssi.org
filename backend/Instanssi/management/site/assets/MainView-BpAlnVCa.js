import{d as T,a as $,b as n,g as l,j as t,ds as yt,w as e,e as a,G as w,dC as ht,b4 as st,i as E,t as y,u as Ct,o as Vt,a1 as wt,A as kt,c as k,F as L,p as F,ar as O,k as M,dD as Et,K as g,B as S,f as z,P as C,dE as Mt,dF as Pt,dG as It,dH as Rt,dI as Tt,dJ as $t,aB as W,r as tt,aj as et,Y as xt,bW as At,dr as qt,dK as Bt,dL as Nt,q as Dt,s as V,z as Lt,$ as Ft,af as Ot,ao as St,aF as zt,bl as Kt,bX as Yt,bw as Gt}from"./index-BSHMv_df.js";import{C as nt,B as jt,a as Ut,p as ot,L as Xt,b as it,_ as lt,c as Zt,A as Ht,P as Jt,d as P}from"./StatCard.vue_vue_type_script_setup_true_lang-Czk55vUI.js";import{A as Qt}from"./datetime-DsxOZgAd.js";import{X as at}from"./classApi-bnmGQydb.js";import{V as _,_ as Wt}from"./LayoutBase.vue_vue_type_script_setup_true_lang-C8aKWyeJ.js";import{V as I}from"./VRow-BUBfmFS3.js";import{p as te}from"./parseInt-3OpbdfxQ.js";import"./VContainer--EpXOfw5.js";const ee=T({__name:"CompetitionParticipantsChart",props:{competitions:{},participantCounts:{}},setup(m){nt.register(jt,Ut,ot,Xt,it);const r=m,{t:p}=$(),s={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}},h=w(()=>({labels:r.competitions.map(i=>i.name),datasets:[{label:p("MainView.stats.participants"),data:r.competitions.map(i=>r.participantCounts.get(i.id)??0),backgroundColor:"#2196F3"}]}));return(i,o)=>(n(),l(lt,{title:t(p)("MainView.charts.competitionParticipants"),icon:t(yt),"has-data":h.value.labels.length>0,"no-data-text":t(p)("MainView.charts.noData")},{default:e(()=>[a(t(Zt),{data:h.value,options:s},null,8,["data"])]),_:1},8,["title","icon","has-data","no-data-text"]))}}),ae=T({__name:"EntriesPerCompoChart",props:{compos:{},entryCounts:{}},setup(m){nt.register(Ht,ot,it);const r=m,{t:p}=$(),s=["#4CAF50","#2196F3","#FF9800","#9C27B0","#E91E63","#00BCD4","#FFEB3B","#795548","#607D8B","#F44336"],h={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right"}}},i=w(()=>({labels:r.compos.map(o=>o.name),datasets:[{data:r.compos.map(o=>r.entryCounts.get(o.id)??0),backgroundColor:s.slice(0,r.compos.length)}]}));return(o,v)=>(n(),l(lt,{title:t(p)("MainView.charts.entriesPerCompo"),icon:t(ht),"has-data":i.value.labels.length>0,"no-data-text":t(p)("MainView.charts.noData")},{default:e(()=>[a(t(Jt),{data:i.value,options:h},null,8,["data"])]),_:1},8,["title","icon","has-data","no-data-text"]))}}),se=T({__name:"EventCountdown",props:{date:{}},setup(m){const r=m,{t:p}=$(),s=w(()=>{const o=at.PlainDate.from(r.date),v=at.Now.zonedDateTimeISO(Qt).toPlainDate();return o.since(v).days}),h=w(()=>{const o=s.value;return o>0?p("MainView.daysUntil",{days:o}):o===0?p("MainView.today"):p("MainView.daysAgo",{days:Math.abs(o)})}),i=w(()=>{const o=s.value;return o>7?"green":o>0?"orange":o===0?"red":"grey"});return(o,v)=>(n(),l(st,{color:i.value,size:"small"},{default:e(()=>[E(y(h.value),1)]),_:1},8,["color"]))}}),ne={class:"text-grey"},oe={key:0,class:"mt-2"},ie={class:"text-grey"},le={key:1,class:"text-center text-grey py-4"},ce={key:1,class:"text-center text-grey py-4"},ge=T({__name:"MainView",props:{eventId:{}},setup(m){const r=Ct(),p=m,{t:s,d:h}=$(),i=Dt(),o=V(!0),v=V(null),ct=w(()=>te(p.eventId,10)),rt=w(()=>[{title:v.value?.name??"...",to:{name:"dashboard",params:{eventId:p.eventId}}},{title:s("MainView.title"),disabled:!0}]),c=V({blogPosts:{total:0,public:0,draft:0},compoEntries:0,compos:0,competitionParticipants:0,competitions:0,transactions:{total:0,paid:0},voteCodeRequests:{total:0,pending:0}}),x=V([]),A=V([]),q=V([]),K=V([]),Y=V(new Map),G=V(new Map);function ut(f){return q.value.find(u=>u.id===f)?.name??s("MainView.unknown")}async function j(){o.value=!0;const f=ct.value;try{const u=await Lt({path:{id:f}});v.value=u.data??null;const[d,dt,pt,mt,vt,ft,bt]=await Promise.all([Ft({query:{event:f,limit:1e3}}),Ot({path:{event_pk:f},query:{limit:1e3}}),St({path:{event_pk:f},query:{limit:1e3}}),zt({path:{event_pk:f},query:{limit:1e3}}),Kt({path:{event_pk:f},query:{limit:1e3}}),Yt({path:{event_pk:f},query:{limit:1e3}}),Gt({path:{event_pk:f},query:{limit:1e3}})]),R=d.data?.results??[],U=R.filter(b=>b.public).length;c.value.blogPosts={total:R.length,public:U,draft:R.length-U},x.value=R.slice(0,5);const X=dt.data?.results??[],B=pt.data?.results??[];q.value=X,c.value.compos=X.length,c.value.compoEntries=B.length,A.value=B.slice(0,5);const N=new Map;B.forEach(b=>{N.set(b.compo,(N.get(b.compo)??0)+1)}),Y.value=N;const Z=mt.data?.results??[],H=vt.data?.results??[];K.value=Z,c.value.competitions=Z.length,c.value.competitionParticipants=H.length;const D=new Map;H.forEach(b=>{D.set(b.competition,(D.get(b.competition)??0)+1)}),G.value=D;const J=ft.data?.results??[],gt=J.filter(b=>b.time_paid).length;c.value.transactions={total:J.length,paid:gt};const Q=bt.data?.results??[],_t=Q.filter(b=>b.status===0).length;c.value.voteCodeRequests={total:Q.length,pending:_t}}catch(u){console.error("Failed to load dashboard data:",u)}finally{o.value=!1}}return Vt(j),wt(()=>p.eventId,j),(f,u)=>(n(),l(Wt,{key:`dashboard-${m.eventId}`,breadcrumbs:rt.value},{default:e(()=>[o.value?(n(),l(I,{key:0,class:"justify-center my-8"},{default:e(()=>[a(kt,{indeterminate:"",size:"64"})]),_:1})):(n(),k(L,{key:1},[a(I,{class:"mb-4"},{default:e(()=>[a(_,{cols:"12"},{default:e(()=>[a(F,null,{default:e(()=>[a(O,{class:"d-flex align-center"},{default:e(()=>[a(t(M),{icon:t(Et),class:"mr-2"},null,8,["icon"]),E(" "+y(v.value?.name??t(s)("MainView.noEvent"))+" ",1),v.value?.archived?(n(),l(st,{key:0,class:"ml-2",color:"grey",size:"small"},{default:e(()=>[E(y(t(s)("MainView.archived")),1)]),_:1})):g("",!0)]),_:1}),a(S,null,{default:e(()=>[z("div",null,[z("span",ne,y(t(s)("MainView.eventDate"))+":",1),E(" "+y(v.value?t(h)(v.value.date,"short"):"-"),1)]),v.value?(n(),k("div",oe,[z("span",ie,y(t(s)("MainView.countdown"))+":",1),a(se,{date:v.value.date,class:"ml-1"},null,8,["date"])])):g("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),a(I,{class:"mb-4"},{default:e(()=>[t(i).canView(t(C).BLOG_ENTRY)?(n(),l(_,{key:0,cols:"12",sm:"6",lg:""},{default:e(()=>[a(P,{icon:t(Mt),value:c.value.blogPosts.total,label:t(s)("MainView.stats.blogPosts"),subtitle:`${c.value.blogPosts.public} ${t(s)("MainView.stats.public")} / ${c.value.blogPosts.draft} ${t(s)("MainView.stats.draft")}`,color:"blue",clickable:"",onClick:u[0]||(u[0]=d=>t(r).push({name:"blog",params:{eventId:m.eventId}}))},null,8,["icon","value","label","subtitle"])]),_:1})):g("",!0),t(i).canView(t(C).ENTRY)?(n(),l(_,{key:1,cols:"12",sm:"6",lg:""},{default:e(()=>[a(P,{icon:t(Pt),value:c.value.compoEntries,label:t(s)("MainView.stats.compoEntries"),subtitle:`${c.value.compos} ${t(s)("MainView.stats.compos")}`,color:"green",clickable:"",onClick:u[1]||(u[1]=d=>t(r).push({name:"entries",params:{eventId:m.eventId}}))},null,8,["icon","value","label","subtitle"])]),_:1})):g("",!0),t(i).canView(t(C).COMPETITION_PARTICIPATION)?(n(),l(_,{key:2,cols:"12",sm:"6",lg:""},{default:e(()=>[a(P,{icon:t(It),value:c.value.competitionParticipants,label:t(s)("MainView.stats.competitionParticipants"),subtitle:`${c.value.competitions} ${t(s)("MainView.stats.competitions")}`,color:"orange",clickable:"",onClick:u[2]||(u[2]=d=>t(r).push({name:"competition-participations",params:{eventId:m.eventId}}))},null,8,["icon","value","label","subtitle"])]),_:1})):g("",!0),t(i).canView(t(C).STORE_TRANSACTION)?(n(),l(_,{key:3,cols:"12",sm:"6",lg:""},{default:e(()=>[a(P,{icon:t(Rt),value:c.value.transactions.total,label:t(s)("MainView.stats.transactions"),subtitle:`${c.value.transactions.paid} ${t(s)("MainView.stats.paid")}`,color:"teal",clickable:"",onClick:u[3]||(u[3]=d=>t(r).push({name:"store-transactions",params:{eventId:m.eventId}}))},null,8,["icon","value","label","subtitle"])]),_:1})):g("",!0),t(i).canView(t(C).VOTE_CODE_REQUEST)?(n(),l(_,{key:4,cols:"12",sm:"6",lg:""},{default:e(()=>[a(P,{icon:t(Tt),value:c.value.voteCodeRequests.pending,label:t(s)("MainView.stats.pendingVoteRequests"),subtitle:`${c.value.voteCodeRequests.total} ${t(s)("MainView.stats.totalRequests")}`,color:"pink",clickable:"",onClick:u[4]||(u[4]=d=>t(r).push({name:"vote-code-requests",params:{eventId:m.eventId}}))},null,8,["icon","value","label","subtitle"])]),_:1})):g("",!0)]),_:1}),a(I,{class:"mb-4"},{default:e(()=>[t(i).canView(t(C).COMPO)?(n(),l(_,{key:0,cols:"12",md:"6"},{default:e(()=>[a(ae,{compos:q.value,"entry-counts":Y.value},null,8,["compos","entry-counts"])]),_:1})):g("",!0),t(i).canView(t(C).COMPETITION)?(n(),l(_,{key:1,cols:"12",md:"6"},{default:e(()=>[a(ee,{competitions:K.value,"participant-counts":G.value},null,8,["competitions","participant-counts"])]),_:1})):g("",!0)]),_:1}),a(I,{class:"mb-4"},{default:e(()=>[t(i).canView(t(C).BLOG_ENTRY)?(n(),l(_,{key:0,cols:"12",md:"6"},{default:e(()=>[a(F,null,{default:e(()=>[a(O,null,{default:e(()=>[a(t(M),{icon:t($t),class:"mr-2"},null,8,["icon"]),E(" "+y(t(s)("MainView.recentActivity.blogPosts")),1)]),_:1}),a(S,null,{default:e(()=>[x.value.length>0?(n(),l(W,{key:0,density:"compact"},{default:e(()=>[(n(!0),k(L,null,tt(x.value,d=>(n(),l(et,{key:d.id,title:d.title,subtitle:t(h)(d.date,"long")},{prepend:e(()=>[a(t(M),{icon:d.public?t(At):t(qt),class:xt(d.public?"text-green mr-3":"text-grey mr-3"),size:"sm"},null,8,["icon","class"])]),_:2},1032,["title","subtitle"]))),128))]),_:1})):(n(),k("div",le,y(t(s)("MainView.recentActivity.noRecentPosts")),1))]),_:1})]),_:1})]),_:1})):g("",!0),t(i).canView(t(C).ENTRY)?(n(),l(_,{key:1,cols:"12",md:"6"},{default:e(()=>[a(F,null,{default:e(()=>[a(O,null,{default:e(()=>[a(t(M),{icon:t(Bt),class:"mr-2"},null,8,["icon"]),E(" "+y(t(s)("MainView.recentActivity.compoEntries")),1)]),_:1}),a(S,null,{default:e(()=>[A.value.length>0?(n(),l(W,{key:0,density:"compact"},{default:e(()=>[(n(!0),k(L,null,tt(A.value,d=>(n(),l(et,{key:d.id,title:d.name,subtitle:ut(d.compo)},{prepend:e(()=>[a(t(M),{icon:t(Nt),size:"sm",class:"mr-3"},null,8,["icon"])]),_:1},8,["title","subtitle"]))),128))]),_:1})):(n(),k("div",ce,y(t(s)("MainView.recentActivity.noRecentEntries")),1))]),_:1})]),_:1})]),_:1})):g("",!0)]),_:1})],64))]),_:1},8,["breadcrumbs"]))}});export{ge as default};
//# sourceMappingURL=MainView-BpAlnVCa.js.map
