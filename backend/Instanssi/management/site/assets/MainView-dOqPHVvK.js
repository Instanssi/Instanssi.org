import{d as A,a as N,b as l,g as u,j as t,ds as ut,w as a,e as s,G as k,dC as dt,b4 as Q,i as P,t as w,u as pt,o as mt,Z as vt,A as ft,c as M,F as B,p as q,ar as D,k as T,dD as gt,K as _,B as L,f as S,P as m,dE as yt,dF as bt,dG as _t,dH as Ct,dI as wt,dJ as ht,aB as U,r as j,aj as X,Y as Vt,bW as Et,dr as kt,dK as Mt,dL as Pt,q as It,s as V,z as Tt,a0 as Rt,af as Ot,ao as At,aF as Nt,bl as $t,bX as xt,bw as Ft}from"./index-CY4kEXQX.js";import{C as H,B as Bt,a as qt,p as J,L as Dt,b as W,_ as tt,c as Lt,A as St,P as zt,d as R}from"./StatCard.vue_vue_type_script_setup_true_lang-1sZ3pSM8.js";import{A as Kt}from"./datetime-DsxOZgAd.js";import{X as Z}from"./classApi-bnmGQydb.js";import{V as C,_ as Yt}from"./LayoutBase.vue_vue_type_script_setup_true_lang-mBpG7FYr.js";import{V as O}from"./VRow-Dt2mDaW0.js";import{p as Gt}from"./parseInt-DjOfejfT.js";import"./VContainer-DyZfstE_.js";const Ut=A({__name:"CompetitionParticipantsChart",props:{competitions:{},participantCounts:{}},setup(f){H.register(Bt,qt,J,Dt,W);const p=f,{t:v}=N(),o={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}},h=k(()=>({labels:p.competitions.map(i=>i.name),datasets:[{label:v("MainView.stats.participants"),data:p.competitions.map(i=>p.participantCounts.get(i.id)??0),backgroundColor:"#2196F3"}]}));return(i,r)=>(l(),u(tt,{title:t(v)("MainView.charts.competitionParticipants"),icon:t(ut),"has-data":h.value.labels.length>0,"no-data-text":t(v)("MainView.charts.noData")},{default:a(()=>[s(t(Lt),{data:h.value,options:o},null,8,["data"])]),_:1},8,["title","icon","has-data","no-data-text"]))}}),jt=A({__name:"EntriesPerCompoChart",props:{compos:{},entryCounts:{}},setup(f){H.register(St,J,W);const p=f,{t:v}=N(),o=["#4CAF50","#2196F3","#FF9800","#9C27B0","#E91E63","#00BCD4","#FFEB3B","#795548","#607D8B","#F44336"],h={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right"}}},i=k(()=>({labels:p.compos.map(r=>r.name),datasets:[{data:p.compos.map(r=>p.entryCounts.get(r.id)??0),backgroundColor:o.slice(0,p.compos.length)}]}));return(r,g)=>(l(),u(tt,{title:t(v)("MainView.charts.entriesPerCompo"),icon:t(dt),"has-data":i.value.labels.length>0,"no-data-text":t(v)("MainView.charts.noData")},{default:a(()=>[s(t(zt),{data:i.value,options:h},null,8,["data"])]),_:1},8,["title","icon","has-data","no-data-text"]))}}),Xt=A({__name:"EventCountdown",props:{date:{}},setup(f){const p=f,{t:v}=N(),o=k(()=>{const r=Z.PlainDate.from(p.date),g=Z.Now.zonedDateTimeISO(Kt).toPlainDate();return r.since(g).days}),h=k(()=>{const r=o.value;return r>0?v("MainView.daysUntil",{days:r}):r===0?v("MainView.today"):v("MainView.daysAgo",{days:Math.abs(r)})}),i=k(()=>{const r=o.value;return r>7?"green":r>0?"orange":r===0?"red":"grey"});return(r,g)=>(l(),u(Q,{color:i.value,size:"small"},{default:a(()=>[P(w(h.value),1)]),_:1},8,["color"]))}}),Zt={class:"text-grey"},Qt={key:0,class:"mt-2"},Ht={class:"text-grey"},Jt={key:1,class:"text-center text-grey py-4"},Wt={key:1,class:"text-center text-grey py-4"},ce=A({__name:"MainView",props:{eventId:{}},setup(f){const p=pt(),v=f,{t:o,d:h}=N(),i=It(),r=V(!0),g=V(null),et=k(()=>Gt(v.eventId,10)),at=k(()=>[{title:g.value?.name??"...",to:{name:"dashboard",params:{eventId:v.eventId}}},{title:o("MainView.title"),disabled:!0}]),d=V({blogPosts:{total:0,public:0,draft:0},compoEntries:0,compos:0,competitionParticipants:0,competitions:0,transactions:{total:0,paid:0},voteCodeRequests:{total:0,pending:0}}),$=V([]),x=V([]),F=V([]),z=V([]),K=V(new Map),Y=V(new Map);function st(c){return F.value.find(e=>e.id===c)?.name??o("MainView.unknown")}async function nt(c){try{const e=await Tt({path:{id:c}});g.value=e.data??null}catch(e){console.error("Failed to load event:",e)}}async function ot(c){if(i.canView(m.BLOG_ENTRY))try{const n=(await Rt({query:{event:c,limit:1e3}})).data?.results??[],y=n.filter(b=>b.public).length;d.value.blogPosts={total:n.length,public:y,draft:n.length-y},$.value=n.slice(0,5)}catch(e){console.error("Failed to load blog posts:",e)}}async function it(c){if(!(!i.canView(m.COMPO)&&!i.canView(m.ENTRY)))try{const[e,n]=await Promise.all([Ot({path:{event_pk:c},query:{limit:1e3}}),At({path:{event_pk:c},query:{limit:1e3}})]),y=e.data?.results??[],b=n.data?.results??[];F.value=y,d.value.compos=y.length,d.value.compoEntries=b.length,x.value=b.slice(0,5);const E=new Map;for(const I of b)E.set(I.compo,(E.get(I.compo)??0)+1);K.value=E}catch(e){console.error("Failed to load compos/entries:",e)}}async function lt(c){if(!(!i.canView(m.COMPETITION)&&!i.canView(m.COMPETITION_PARTICIPATION)))try{const[e,n]=await Promise.all([Nt({path:{event_pk:c},query:{limit:1e3}}),$t({path:{event_pk:c},query:{limit:1e3}})]),y=e.data?.results??[],b=n.data?.results??[];z.value=y,d.value.competitions=y.length,d.value.competitionParticipants=b.length;const E=new Map;for(const I of b)E.set(I.competition,(E.get(I.competition)??0)+1);Y.value=E}catch(e){console.error("Failed to load competitions/participants:",e)}}async function ct(c){if(i.canView(m.STORE_TRANSACTION))try{const n=(await xt({path:{event_pk:c},query:{limit:1e3}})).data?.results??[],y=n.filter(b=>b.time_paid).length;d.value.transactions={total:n.length,paid:y}}catch(e){console.error("Failed to load transactions:",e)}}async function rt(c){if(i.canView(m.VOTE_CODE_REQUEST))try{const n=(await Ft({path:{event_pk:c},query:{limit:1e3}})).data?.results??[],y=n.filter(b=>b.status===0).length;d.value.voteCodeRequests={total:n.length,pending:y}}catch(e){console.error("Failed to load vote code requests:",e)}}async function G(){r.value=!0;const c=et.value;await nt(c),await Promise.all([ot(c),it(c),lt(c),ct(c),rt(c)]),r.value=!1}return mt(G),vt(()=>v.eventId,G),(c,e)=>(l(),u(Yt,{key:`dashboard-${f.eventId}`,breadcrumbs:at.value},{default:a(()=>[r.value?(l(),u(O,{key:0,class:"justify-center my-8"},{default:a(()=>[s(ft,{indeterminate:"",size:"64"})]),_:1})):(l(),M(B,{key:1},[s(O,{class:"mb-4"},{default:a(()=>[s(C,{cols:"12"},{default:a(()=>[s(q,null,{default:a(()=>[s(D,{class:"d-flex align-center"},{default:a(()=>[s(t(T),{icon:t(gt),class:"mr-2"},null,8,["icon"]),P(" "+w(g.value?.name??t(o)("MainView.noEvent"))+" ",1),g.value?.archived?(l(),u(Q,{key:0,class:"ml-2",color:"grey",size:"small"},{default:a(()=>[P(w(t(o)("MainView.archived")),1)]),_:1})):_("",!0)]),_:1}),s(L,null,{default:a(()=>[S("div",null,[S("span",Zt,w(t(o)("MainView.eventDate"))+":",1),P(" "+w(g.value?t(h)(g.value.date,"short"):"-"),1)]),g.value?(l(),M("div",Qt,[S("span",Ht,w(t(o)("MainView.countdown"))+":",1),s(Xt,{date:g.value.date,class:"ml-1"},null,8,["date"])])):_("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),s(O,{class:"mb-4"},{default:a(()=>[t(i).canView(t(m).BLOG_ENTRY)?(l(),u(C,{key:0,cols:"12",sm:"6",lg:""},{default:a(()=>[s(R,{icon:t(yt),value:d.value.blogPosts.total,label:t(o)("MainView.stats.blogPosts"),subtitle:`${d.value.blogPosts.public} ${t(o)("MainView.stats.public")} / ${d.value.blogPosts.draft} ${t(o)("MainView.stats.draft")}`,color:"blue",clickable:"",onClick:e[0]||(e[0]=n=>t(p).push({name:"blog",params:{eventId:f.eventId}}))},null,8,["icon","value","label","subtitle"])]),_:1})):_("",!0),t(i).canView(t(m).ENTRY)?(l(),u(C,{key:1,cols:"12",sm:"6",lg:""},{default:a(()=>[s(R,{icon:t(bt),value:d.value.compoEntries,label:t(o)("MainView.stats.compoEntries"),subtitle:`${d.value.compos} ${t(o)("MainView.stats.compos")}`,color:"green",clickable:"",onClick:e[1]||(e[1]=n=>t(p).push({name:"entries",params:{eventId:f.eventId}}))},null,8,["icon","value","label","subtitle"])]),_:1})):_("",!0),t(i).canView(t(m).COMPETITION_PARTICIPATION)?(l(),u(C,{key:2,cols:"12",sm:"6",lg:""},{default:a(()=>[s(R,{icon:t(_t),value:d.value.competitionParticipants,label:t(o)("MainView.stats.competitionParticipants"),subtitle:`${d.value.competitions} ${t(o)("MainView.stats.competitions")}`,color:"orange",clickable:"",onClick:e[2]||(e[2]=n=>t(p).push({name:"competition-participations",params:{eventId:f.eventId}}))},null,8,["icon","value","label","subtitle"])]),_:1})):_("",!0),t(i).canView(t(m).STORE_TRANSACTION)?(l(),u(C,{key:3,cols:"12",sm:"6",lg:""},{default:a(()=>[s(R,{icon:t(Ct),value:d.value.transactions.total,label:t(o)("MainView.stats.transactions"),subtitle:`${d.value.transactions.paid} ${t(o)("MainView.stats.paid")}`,color:"teal",clickable:"",onClick:e[3]||(e[3]=n=>t(p).push({name:"store-transactions",params:{eventId:f.eventId}}))},null,8,["icon","value","label","subtitle"])]),_:1})):_("",!0),t(i).canView(t(m).VOTE_CODE_REQUEST)?(l(),u(C,{key:4,cols:"12",sm:"6",lg:""},{default:a(()=>[s(R,{icon:t(wt),value:d.value.voteCodeRequests.pending,label:t(o)("MainView.stats.pendingVoteRequests"),subtitle:`${d.value.voteCodeRequests.total} ${t(o)("MainView.stats.totalRequests")}`,color:"pink",clickable:"",onClick:e[4]||(e[4]=n=>t(p).push({name:"vote-code-requests",params:{eventId:f.eventId}}))},null,8,["icon","value","label","subtitle"])]),_:1})):_("",!0)]),_:1}),s(O,{class:"mb-4"},{default:a(()=>[t(i).canView(t(m).COMPO)?(l(),u(C,{key:0,cols:"12",md:"6"},{default:a(()=>[s(jt,{compos:F.value,"entry-counts":K.value},null,8,["compos","entry-counts"])]),_:1})):_("",!0),t(i).canView(t(m).COMPETITION)?(l(),u(C,{key:1,cols:"12",md:"6"},{default:a(()=>[s(Ut,{competitions:z.value,"participant-counts":Y.value},null,8,["competitions","participant-counts"])]),_:1})):_("",!0)]),_:1}),s(O,{class:"mb-4"},{default:a(()=>[t(i).canView(t(m).BLOG_ENTRY)?(l(),u(C,{key:0,cols:"12",md:"6"},{default:a(()=>[s(q,null,{default:a(()=>[s(D,null,{default:a(()=>[s(t(T),{icon:t(ht),class:"mr-2"},null,8,["icon"]),P(" "+w(t(o)("MainView.recentActivity.blogPosts")),1)]),_:1}),s(L,null,{default:a(()=>[$.value.length>0?(l(),u(U,{key:0,density:"compact"},{default:a(()=>[(l(!0),M(B,null,j($.value,n=>(l(),u(X,{key:n.id,title:n.title,subtitle:t(h)(n.date,"long")},{prepend:a(()=>[s(t(T),{icon:n.public?t(Et):t(kt),class:Vt(n.public?"text-green mr-3":"text-grey mr-3"),size:"sm"},null,8,["icon","class"])]),_:2},1032,["title","subtitle"]))),128))]),_:1})):(l(),M("div",Jt,w(t(o)("MainView.recentActivity.noRecentPosts")),1))]),_:1})]),_:1})]),_:1})):_("",!0),t(i).canView(t(m).ENTRY)?(l(),u(C,{key:1,cols:"12",md:"6"},{default:a(()=>[s(q,null,{default:a(()=>[s(D,null,{default:a(()=>[s(t(T),{icon:t(Mt),class:"mr-2"},null,8,["icon"]),P(" "+w(t(o)("MainView.recentActivity.compoEntries")),1)]),_:1}),s(L,null,{default:a(()=>[x.value.length>0?(l(),u(U,{key:0,density:"compact"},{default:a(()=>[(l(!0),M(B,null,j(x.value,n=>(l(),u(X,{key:n.id,title:n.name,subtitle:st(n.compo)},{prepend:a(()=>[s(t(T),{icon:t(Pt),size:"sm",class:"mr-3"},null,8,["icon"])]),_:1},8,["title","subtitle"]))),128))]),_:1})):(l(),M("div",Wt,w(t(o)("MainView.recentActivity.noRecentEntries")),1))]),_:1})]),_:1})]),_:1})):_("",!0)]),_:1})],64))]),_:1},8,["breadcrumbs"]))}});export{ce as default};
//# sourceMappingURL=MainView-dOqPHVvK.js.map
