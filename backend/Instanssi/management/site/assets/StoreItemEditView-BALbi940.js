import{d as Ee,a as we,u as xe,v as ke,H as Fe,I as Me,bA as Te,bB as Pe,o as Ae,bC as Oe,X as Ce,b as u,g as p,w as r,e as t,A as Ue,p as re,B as ie,l as he,j as e,i as c,t as d,m as v,c as F,K as w,F as se,aB as Be,r as De,aj as Ke,bD as Ne,P as oe,V as M,k as z,as as Re,J as $e,C as He,D as je,q as Ge,s as V,G as X,bE as Le,bF as qe,E as ze}from"./index-CY4kEXQX.js";import{c as Xe,f as Je,a as T,d as J,g as x,u as Qe,b as n,V as We}from"./index.esm-gAaR2kR-.js";import{F as y}from"./FormSection-BH9YHR1S.js";import{I as Ye}from"./ImageUploadField-BeSxmz0x.js";import{V as m,_ as Ze}from"./LayoutBase.vue_vue_type_script_setup_true_lang-mBpG7FYr.js";import{_ as Q}from"./ToggleSwitch.vue_vue_type_script_setup_true_lang-CJWaY2Li.js";import{t as ne,g as ea,p as aa}from"./formdata-Umo5Cp2Q.js";import{h as ue,g as ta}from"./http-h2SUVdDm.js";import{p as P}from"./parseInt-DjOfejfT.js";import{V as A}from"./VRow-Dt2mDaW0.js";import"./VContainer-DyZfstE_.js";import"./VSwitch-DOWmaHjD.js";const la={key:0,class:"text-error text-caption mb-4"},ra={key:1,class:"text-grey text-body-2 mb-4"},ga=Ee({__name:"StoreItemEditView",props:{eventId:{},id:{}},setup(de){const W={name:"name",description:"description",price:"price",max:"max",max_per_order:"maxPerOrder",sort_index:"sortIndex",discount_amount:"discountAmount",discount_percentage:"discountPercentage",available:"available",is_ticket:"isTicket",is_secret:"isSecret",secret_key:"secretKey",imagefile_original:"imageFile"},f=de,{t:l}=we(),me=xe(),b=ke(),{getEventById:ce}=ze(),Y=Ge(),ve=Fe(Me),O=V(!1),C=V(!1),U=V(!1),Z=V(""),g=X(()=>P(f.eventId,10)),_=X(()=>f.id!==void 0),ee=V(null),I=V([]),S=V(""),fe=X(()=>{const i=[{title:ce(g.value)?.name??"...",to:{name:"dashboard",params:{eventId:f.eventId}}},{title:l("StoreItemsView.title"),to:{name:"store-items",params:{eventId:f.eventId}}}];return _.value?i.push({title:Z.value||"...",disabled:!0}):i.push({title:l("Breadcrumbs.newStoreItem"),disabled:!0}),i}),be=Xe({name:T().required().min(1).max(255),description:T(),price:T().required(),max:x().required().min(0),maxPerOrder:x().nullable().min(1),sortIndex:x().nullable(),discountAmount:x().nullable().min(-1),discountPercentage:x().nullable().min(0).max(100),available:J(),isTicket:J(),isSecret:J(),secretKey:T(),imageFile:Je().nullable()}),{handleSubmit:pe,setValues:Ve,setErrors:ae,meta:ge}=Qe({validationSchema:be,initialValues:{name:"",description:"",price:"0.00",max:0,maxPerOrder:null,sortIndex:0,discountAmount:-1,discountPercentage:0,available:!0,isTicket:!1,isSecret:!1,secretKey:"",imageFile:void 0}}),h=n("name"),k=n("description"),B=n("price"),D=n("max"),K=n("maxPerOrder"),N=n("sortIndex"),R=n("discountAmount"),$=n("discountPercentage"),H=n("available"),j=n("isTicket"),E=n("isSecret"),G=n("secretKey"),L=n("imageFile"),te=pe(async i=>{C.value=!0;let a;_.value?a=await Se(P(f.id,10),i):a=await Ie(i),C.value=!1,a&&q()});function le(i,a){const o=a?ea:aa;return{name:i.name,description:i.description||"",price:i.price,max:i.max,max_per_order:i.maxPerOrder,sort_index:i.sortIndex??0,discount_amount:i.discountAmount??-1,discount_percentage:i.discountPercentage??0,available:i.available,is_ticket:i.isTicket,is_secret:i.isSecret,secret_key:i.secretKey||"",imagefile_original:o(i.imageFile)}}async function Ie(i){const a=le(i,!0);try{return await Te({path:{event_pk:g.value},body:a,bodySerializer:()=>ne(a)}),b.success(l("StoreItemEditView.createSuccess")),!0}catch(o){ue(o,ae,b,l("StoreItemEditView.createFailure"),W)}return!1}async function Se(i,a){const o=le(a,!1);try{return await Pe({path:{event_pk:g.value,id:i},body:o,bodySerializer:()=>ne(o)}),b.success(l("StoreItemEditView.editSuccess")),!0}catch(s){ue(s,ae,b,l("StoreItemEditView.editFailure"),W)}return!1}async function ye(){if(!(!S.value.trim()||!_.value)){U.value=!0;try{const i=await Le({path:{event_pk:g.value},body:{item:P(f.id,10),name:S.value.trim()}});I.value.push(i.data),S.value=""}catch(i){b.error(l("StoreItemEditView.variants.createFailure")),console.error(i)}finally{U.value=!1}}}async function _e(i){const a=l("StoreItemEditView.variants.deleteConfirm",i);await ve.value.ifConfirmed(a,async()=>{try{await qe({path:{event_pk:g.value,id:i.id}}),I.value=I.value.filter(o=>o.id!==i.id),b.success(l("StoreItemEditView.variants.deleteSuccess"))}catch(o){b.error(ta(o,l("StoreItemEditView.variants.deleteFailure"))),console.error(o)}})}function q(){me.push({name:"store-items",params:{eventId:f.eventId}})}return Ae(async()=>{if(_.value){O.value=!0;try{const a=(await Oe({path:{event_pk:g.value,id:P(f.id,10)}})).data;Z.value=a.name,ee.value=a.imagefile_thumbnail_url??null,I.value=a.variants??[],Ve({name:a.name,description:a.description??"",price:a.price,max:a.max,maxPerOrder:a.max_per_order??null,sortIndex:a.sort_index??0,discountAmount:a.discount_amount??-1,discountPercentage:a.discount_percentage??0,available:a.available??!0,isTicket:a.is_ticket??!1,isSecret:a.is_secret??!1,secretKey:a.secret_key??""})}catch(i){b.error(l("StoreItemEditView.loadFailure")),console.error(i),q()}finally{O.value=!1}}}),(i,a)=>{const o=Ce("VuetifyTiptap");return u(),p(Ze,{breadcrumbs:fe.value},{default:r(()=>[O.value?(u(),p(m,{key:0,class:"d-flex justify-center my-8"},{default:r(()=>[t(Ue,{indeterminate:"",size:"64"})]),_:1})):(u(),p(m,{key:1},{default:r(()=>[t(re,null,{default:r(()=>[t(ie,null,{default:r(()=>[t(We,{onSubmit:he(e(te),["prevent"])},{default:r(()=>[t(y,null,{default:r(()=>[c(d(e(l)("StoreItemEditView.sections.basicInfo")),1)]),_:1}),t(v,{modelValue:e(h).value.value,"onUpdate:modelValue":a[0]||(a[0]=s=>e(h).value.value=s),"error-messages":e(h).errorMessage.value,variant:"outlined",label:e(l)("StoreItemEditView.labels.name")+" *"},null,8,["modelValue","error-messages","label"]),t(o,{modelValue:e(k).value.value,"onUpdate:modelValue":a[1]||(a[1]=s=>e(k).value.value=s)},null,8,["modelValue"]),e(k).errorMessage.value?(u(),F("div",la,d(e(k).errorMessage.value),1)):w("",!0),t(y,null,{default:r(()=>[c(d(e(l)("StoreItemEditView.sections.image")),1)]),_:1}),t(Ye,{modelValue:e(L).value.value,"onUpdate:modelValue":a[2]||(a[2]=s=>e(L).value.value=s),"current-image-url":ee.value,label:e(l)("StoreItemEditView.labels.imagefile"),"error-message":e(L).errorMessage.value},null,8,["modelValue","current-image-url","label","error-message"]),t(y,null,{default:r(()=>[c(d(e(l)("StoreItemEditView.sections.pricing")),1)]),_:1}),t(A,null,{default:r(()=>[t(m,{cols:"12",md:"4"},{default:r(()=>[t(v,{modelValue:e(B).value.value,"onUpdate:modelValue":a[3]||(a[3]=s=>e(B).value.value=s),"error-messages":e(B).errorMessage.value,variant:"outlined",label:e(l)("StoreItemEditView.labels.price")+" *",type:"number",step:"0.01",min:"0",suffix:"EUR"},null,8,["modelValue","error-messages","label"])]),_:1}),t(m,{cols:"12",md:"4"},{default:r(()=>[t(v,{modelValue:e(R).value.value,"onUpdate:modelValue":a[4]||(a[4]=s=>e(R).value.value=s),modelModifiers:{number:!0},"error-messages":e(R).errorMessage.value,variant:"outlined",label:e(l)("StoreItemEditView.labels.discountAmount"),type:"number",min:"-1"},null,8,["modelValue","error-messages","label"])]),_:1}),t(m,{cols:"12",md:"4"},{default:r(()=>[t(v,{modelValue:e($).value.value,"onUpdate:modelValue":a[5]||(a[5]=s=>e($).value.value=s),modelModifiers:{number:!0},"error-messages":e($).errorMessage.value,variant:"outlined",label:e(l)("StoreItemEditView.labels.discountPercentage"),type:"number",min:"0",max:"100",suffix:"%"},null,8,["modelValue","error-messages","label"])]),_:1})]),_:1}),t(y,null,{default:r(()=>[c(d(e(l)("StoreItemEditView.sections.availability")),1)]),_:1}),t(A,null,{default:r(()=>[t(m,{cols:"12",md:"4"},{default:r(()=>[t(v,{modelValue:e(D).value.value,"onUpdate:modelValue":a[6]||(a[6]=s=>e(D).value.value=s),modelModifiers:{number:!0},"error-messages":e(D).errorMessage.value,variant:"outlined",label:e(l)("StoreItemEditView.labels.max")+" *",type:"number",min:"0"},null,8,["modelValue","error-messages","label"])]),_:1}),t(m,{cols:"12",md:"4"},{default:r(()=>[t(v,{modelValue:e(K).value.value,"onUpdate:modelValue":a[7]||(a[7]=s=>e(K).value.value=s),modelModifiers:{number:!0},"error-messages":e(K).errorMessage.value,variant:"outlined",label:e(l)("StoreItemEditView.labels.maxPerOrder"),type:"number",min:"1"},null,8,["modelValue","error-messages","label"])]),_:1}),t(m,{cols:"12",md:"4"},{default:r(()=>[t(v,{modelValue:e(N).value.value,"onUpdate:modelValue":a[8]||(a[8]=s=>e(N).value.value=s),modelModifiers:{number:!0},"error-messages":e(N).errorMessage.value,variant:"outlined",label:e(l)("StoreItemEditView.labels.sortIndex"),type:"number"},null,8,["modelValue","error-messages","label"])]),_:1})]),_:1}),t(y,null,{default:r(()=>[c(d(e(l)("StoreItemEditView.sections.visibility")),1)]),_:1}),t(Q,{modelValue:e(H).value.value,"onUpdate:modelValue":a[9]||(a[9]=s=>e(H).value.value=s),"error-message":e(H).errorMessage.value,"label-on":e(l)("StoreItemEditView.labels.availableOn"),"label-off":e(l)("StoreItemEditView.labels.availableOff"),"hint-on":e(l)("StoreItemEditView.labels.availableHintOn"),"hint-off":e(l)("StoreItemEditView.labels.availableHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"]),t(Q,{modelValue:e(j).value.value,"onUpdate:modelValue":a[10]||(a[10]=s=>e(j).value.value=s),"error-message":e(j).errorMessage.value,"label-on":e(l)("StoreItemEditView.labels.isTicketOn"),"label-off":e(l)("StoreItemEditView.labels.isTicketOff"),"hint-on":e(l)("StoreItemEditView.labels.isTicketHintOn"),"hint-off":e(l)("StoreItemEditView.labels.isTicketHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"]),t(A,{align:"center"},{default:r(()=>[t(m,{cols:"12",md:e(E).value.value?6:12},{default:r(()=>[t(Q,{modelValue:e(E).value.value,"onUpdate:modelValue":a[11]||(a[11]=s=>e(E).value.value=s),"error-message":e(E).errorMessage.value,"label-on":e(l)("StoreItemEditView.labels.isSecretOn"),"label-off":e(l)("StoreItemEditView.labels.isSecretOff"),"hint-on":e(l)("StoreItemEditView.labels.isSecretHintOn"),"hint-off":e(l)("StoreItemEditView.labels.isSecretHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"])]),_:1},8,["md"]),e(E).value.value?(u(),p(m,{key:0,cols:"12",md:"6"},{default:r(()=>[t(v,{modelValue:e(G).value.value,"onUpdate:modelValue":a[12]||(a[12]=s=>e(G).value.value=s),"error-messages":e(G).errorMessage.value,variant:"outlined",label:e(l)("StoreItemEditView.labels.secretKey"),"hide-details":"auto"},null,8,["modelValue","error-messages","label"])]),_:1})):w("",!0)]),_:1}),_.value?(u(),F(se,{key:1},[t(y,null,{default:r(()=>[c(d(e(l)("StoreItemEditView.sections.variants")),1)]),_:1}),t(re,{variant:"outlined",class:"mb-4"},{default:r(()=>[t(ie,null,{default:r(()=>[I.value.length>0?(u(),p(Be,{key:0,density:"compact"},{default:r(()=>[(u(!0),F(se,null,De(I.value,s=>(u(),p(Ke,{key:s.id},{append:r(()=>[e(Y).canDelete(e(oe).STORE_ITEM_VARIANT)?(u(),p(M,{key:0,icon:"",variant:"text",color:"red",size:"small",onClick:ia=>_e(s)},{default:r(()=>[t(e(z),{icon:e(Re)},null,8,["icon"])]),_:1},8,["onClick"])):w("",!0)]),default:r(()=>[t(Ne,null,{default:r(()=>[c(d(s.name),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(u(),F("div",ra,d(e(l)("StoreItemEditView.variants.noVariants")),1)),e(Y).canAdd(e(oe).STORE_ITEM_VARIANT)?(u(),p(A,{key:2,align:"center",class:"mt-2"},{default:r(()=>[t(m,{cols:"auto",class:"flex-grow-1"},{default:r(()=>[t(v,{modelValue:S.value,"onUpdate:modelValue":a[13]||(a[13]=s=>S.value=s),variant:"outlined",density:"compact",label:e(l)("StoreItemEditView.variants.name"),"hide-details":""},null,8,["modelValue","label"])]),_:1}),t(m,{cols:"auto"},{default:r(()=>[t(M,{color:"primary",disabled:!S.value.trim(),loading:U.value,onClick:ye},{prepend:r(()=>[t(e(z),{icon:e($e)},null,8,["icon"])]),default:r(()=>[c(" "+d(e(l)("StoreItemEditView.variants.addVariant")),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1})):w("",!0)]),_:1})]),_:1})],64)):w("",!0)]),_:1},8,["onSubmit"])]),_:1}),t(He,{class:"justify-end"},{default:r(()=>[t(M,{variant:"text",onClick:q},{default:r(()=>[c(d(e(l)("General.cancel")),1)]),_:1}),t(M,{variant:"elevated",color:"primary",loading:C.value,disabled:!e(ge).valid,onClick:e(te)},{prepend:r(()=>[t(e(z),{icon:e(je)},null,8,["icon"])]),default:r(()=>[c(" "+d(e(l)("General.save")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1}))]),_:1},8,["breadcrumbs"])}}});export{ga as default};
//# sourceMappingURL=StoreItemEditView-BALbi940.js.map
