import{d as Ee,a as we,u as xe,v as ke,J as Fe,K as Me,bG as Te,bH as Pe,o as Oe,bI as Ae,a9 as Ce,b as n,g as v,w as r,e as t,A as Ue,p as ie,B as se,l as he,j as e,i as c,t as d,m as f,c as F,D as y,F as oe,aL as Ke,r as Be,at as De,bJ as $e,P as ne,V as M,k as z,aC as He,L as Le,C as Ne,E as Re,G as Ge,q as je,s as V,I as J,bK as qe,bL as ze,H as Je}from"./index-DXU74lGt.js";import{c as Xe,f as Qe,a as T,d as X,g as x,u as We,b as u}from"./index.esm-DWTrtXO7.js";import{_ as Ye}from"./AuditLogButton.vue_vue_type_script_setup_true_lang-5kFykphF.js";import{F as E}from"./FormSection-ByskKXOp.js";import{I as Ze}from"./ImageUploadField-B2rhKaF2.js";import{V as m,_ as ea}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D4jd1chv.js";import{_ as Q}from"./ToggleSwitch.vue_vue_type_script_setup_true_lang-p7genbiO.js";import{t as ue,g as aa,p as ta}from"./formdata-BXUVcBgf.js";import{h as de,g as la}from"./http-BTZWMaMN.js";import{p as P}from"./parseInt-Bzw_2rWL.js";import{V as ra}from"./VForm-C430u1Uz.js";import{V as O}from"./VRow-B94Tto0H.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-WkXOSlqa.js";import"./useAuditLogUtils-BqNOieoY.js";import"./DateTimeCell.vue_vue_type_script_setup_true_lang-BMnBYvTq.js";import"./datetime-Dz9fjSvq.js";import"./VDataTableServer-CMLVDy59.js";import"./VDataTable-Jd7io3gq.js";import"./VContainer-BfWqa_tJ.js";import"./VSwitch-DB1fJMny.js";const ia={key:0,class:"text-error text-caption mb-4"},sa={key:1,class:"text-grey text-body-2 mb-4"},Ma=Ee({__name:"StoreItemEditView",props:{eventId:{},id:{}},setup(W){const Y={name:"name",description:"description",price:"price",max:"max",max_per_order:"maxPerOrder",sort_index:"sortIndex",discount_amount:"discountAmount",discount_percentage:"discountPercentage",available:"available",is_ticket:"isTicket",is_secret:"isSecret",secret_key:"secretKey",imagefile_original:"imageFile"},p=W,{t:l}=we(),me=xe(),b=ke(),{getEventById:ce}=Je(),Z=je(),ve=Fe(Me),A=V(!1),C=V(!1),U=V(!1),ee=V(""),g=J(()=>P(p.eventId,10)),I=J(()=>p.id!==void 0),ae=V(null),S=V([]),_=V(""),fe=J(()=>{const i=[{title:ce(g.value)?.name??"...",to:{name:"dashboard",params:{eventId:p.eventId}}},{title:l("StoreItemsView.title"),to:{name:"store-items",params:{eventId:p.eventId}}}];return I.value?i.push({title:ee.value||"...",disabled:!0}):i.push({title:l("Breadcrumbs.newStoreItem"),disabled:!0}),i}),pe=Xe({name:T().required().min(1).max(255),description:T(),price:T().required(),max:x().required().min(0),maxPerOrder:x().nullable().min(1),sortIndex:x().nullable(),discountAmount:x().nullable().min(-1),discountPercentage:x().nullable().min(0).max(100),available:X(),isTicket:X(),isSecret:X(),secretKey:T(),imageFile:Qe().nullable()}),{handleSubmit:be,setValues:Ve,setErrors:te,meta:ge}=We({validationSchema:pe,initialValues:{name:"",description:"",price:"0.00",max:0,maxPerOrder:null,sortIndex:0,discountAmount:-1,discountPercentage:0,available:!0,isTicket:!1,isSecret:!1,secretKey:"",imageFile:void 0}}),h=u("name"),k=u("description"),K=u("price"),B=u("max"),D=u("maxPerOrder"),$=u("sortIndex"),H=u("discountAmount"),L=u("discountPercentage"),N=u("available"),R=u("isTicket"),w=u("isSecret"),G=u("secretKey"),j=u("imageFile"),le=be(async i=>{C.value=!0;let a;I.value?a=await Se(P(p.id,10),i):a=await Ie(i),C.value=!1,a&&q()});function re(i,a){const o=a?aa:ta;return{name:i.name,description:i.description||"",price:i.price,max:i.max,max_per_order:i.maxPerOrder,sort_index:i.sortIndex??0,discount_amount:i.discountAmount??-1,discount_percentage:i.discountPercentage??0,available:i.available,is_ticket:i.isTicket,is_secret:i.isSecret,secret_key:i.secretKey||"",imagefile_original:o(i.imageFile)}}async function Ie(i){const a=re(i,!0);try{return await Te({path:{event_pk:g.value},body:a,bodySerializer:()=>ue(a)}),b.success(l("StoreItemEditView.createSuccess")),!0}catch(o){de(o,te,b,l("StoreItemEditView.createFailure"),Y)}return!1}async function Se(i,a){const o=re(a,!1);try{return await Pe({path:{event_pk:g.value,id:i},body:o,bodySerializer:()=>ue(o)}),b.success(l("StoreItemEditView.editSuccess")),!0}catch(s){de(s,te,b,l("StoreItemEditView.editFailure"),Y)}return!1}async function _e(){if(!(!_.value.trim()||!I.value)){U.value=!0;try{const i=await qe({path:{event_pk:g.value},body:{item:P(p.id,10),name:_.value.trim()}});S.value.push(i.data),_.value=""}catch(i){b.error(l("StoreItemEditView.variants.createFailure")),console.error(i)}finally{U.value=!1}}}async function ye(i){const a=l("StoreItemEditView.variants.deleteConfirm",i);await ve.value.ifConfirmed(a,async()=>{try{await ze({path:{event_pk:g.value,id:i.id}}),S.value=S.value.filter(o=>o.id!==i.id),b.success(l("StoreItemEditView.variants.deleteSuccess"))}catch(o){b.error(la(o,l("StoreItemEditView.variants.deleteFailure"))),console.error(o)}})}function q(){me.push({name:"store-items",params:{eventId:p.eventId}})}return Oe(async()=>{if(I.value){A.value=!0;try{const a=(await Ae({path:{event_pk:g.value,id:P(p.id,10)}})).data;ee.value=a.name,ae.value=a.imagefile_thumbnail_url??null,S.value=a.variants??[],Ve({name:a.name,description:a.description??"",price:a.price,max:a.max,maxPerOrder:a.max_per_order??null,sortIndex:a.sort_index??0,discountAmount:a.discount_amount??-1,discountPercentage:a.discount_percentage??0,available:a.available??!0,isTicket:a.is_ticket??!1,isSecret:a.is_secret??!1,secretKey:a.secret_key??""})}catch(i){b.error(l("StoreItemEditView.loadFailure")),console.error(i),q()}finally{A.value=!1}}}),(i,a)=>{const o=Ce("VuetifyTiptap");return n(),v(ea,{breadcrumbs:fe.value},{default:r(()=>[A.value?(n(),v(m,{key:0,class:"d-flex justify-center my-8"},{default:r(()=>[t(Ue,{indeterminate:"",size:"64"})]),_:1})):(n(),v(m,{key:1},{default:r(()=>[t(ie,null,{default:r(()=>[t(se,null,{default:r(()=>[t(ra,{onSubmit:he(e(le),["prevent"])},{default:r(()=>[t(E,null,{default:r(()=>[c(d(e(l)("StoreItemEditView.sections.basicInfo")),1)]),_:1}),t(f,{modelValue:e(h).value.value,"onUpdate:modelValue":a[0]||(a[0]=s=>e(h).value.value=s),"error-messages":e(h).errorMessage.value,variant:"outlined",label:e(l)("StoreItemEditView.labels.name")+" *"},null,8,["modelValue","error-messages","label"]),t(o,{modelValue:e(k).value.value,"onUpdate:modelValue":a[1]||(a[1]=s=>e(k).value.value=s)},null,8,["modelValue"]),e(k).errorMessage.value?(n(),F("div",ia,d(e(k).errorMessage.value),1)):y("",!0),t(E,null,{default:r(()=>[c(d(e(l)("StoreItemEditView.sections.image")),1)]),_:1}),t(Ze,{modelValue:e(j).value.value,"onUpdate:modelValue":a[2]||(a[2]=s=>e(j).value.value=s),"current-image-url":ae.value,label:e(l)("StoreItemEditView.labels.imagefile"),"error-message":e(j).errorMessage.value},null,8,["modelValue","current-image-url","label","error-message"]),t(E,null,{default:r(()=>[c(d(e(l)("StoreItemEditView.sections.pricing")),1)]),_:1}),t(O,null,{default:r(()=>[t(m,{cols:"12",md:"4"},{default:r(()=>[t(f,{modelValue:e(K).value.value,"onUpdate:modelValue":a[3]||(a[3]=s=>e(K).value.value=s),"error-messages":e(K).errorMessage.value,variant:"outlined",label:e(l)("StoreItemEditView.labels.price")+" *",type:"number",step:"0.01",min:"0",suffix:"EUR"},null,8,["modelValue","error-messages","label"])]),_:1}),t(m,{cols:"12",md:"4"},{default:r(()=>[t(f,{modelValue:e(H).value.value,"onUpdate:modelValue":a[4]||(a[4]=s=>e(H).value.value=s),modelModifiers:{number:!0},"error-messages":e(H).errorMessage.value,variant:"outlined",label:e(l)("StoreItemEditView.labels.discountAmount"),type:"number",min:"-1"},null,8,["modelValue","error-messages","label"])]),_:1}),t(m,{cols:"12",md:"4"},{default:r(()=>[t(f,{modelValue:e(L).value.value,"onUpdate:modelValue":a[5]||(a[5]=s=>e(L).value.value=s),modelModifiers:{number:!0},"error-messages":e(L).errorMessage.value,variant:"outlined",label:e(l)("StoreItemEditView.labels.discountPercentage"),type:"number",min:"0",max:"100",suffix:"%"},null,8,["modelValue","error-messages","label"])]),_:1})]),_:1}),t(E,null,{default:r(()=>[c(d(e(l)("StoreItemEditView.sections.availability")),1)]),_:1}),t(O,null,{default:r(()=>[t(m,{cols:"12",md:"4"},{default:r(()=>[t(f,{modelValue:e(B).value.value,"onUpdate:modelValue":a[6]||(a[6]=s=>e(B).value.value=s),modelModifiers:{number:!0},"error-messages":e(B).errorMessage.value,variant:"outlined",label:e(l)("StoreItemEditView.labels.max")+" *",type:"number",min:"0"},null,8,["modelValue","error-messages","label"])]),_:1}),t(m,{cols:"12",md:"4"},{default:r(()=>[t(f,{modelValue:e(D).value.value,"onUpdate:modelValue":a[7]||(a[7]=s=>e(D).value.value=s),modelModifiers:{number:!0},"error-messages":e(D).errorMessage.value,variant:"outlined",label:e(l)("StoreItemEditView.labels.maxPerOrder"),type:"number",min:"1"},null,8,["modelValue","error-messages","label"])]),_:1}),t(m,{cols:"12",md:"4"},{default:r(()=>[t(f,{modelValue:e($).value.value,"onUpdate:modelValue":a[8]||(a[8]=s=>e($).value.value=s),modelModifiers:{number:!0},"error-messages":e($).errorMessage.value,variant:"outlined",label:e(l)("StoreItemEditView.labels.sortIndex"),type:"number"},null,8,["modelValue","error-messages","label"])]),_:1})]),_:1}),t(E,null,{default:r(()=>[c(d(e(l)("StoreItemEditView.sections.visibility")),1)]),_:1}),t(Q,{modelValue:e(N).value.value,"onUpdate:modelValue":a[9]||(a[9]=s=>e(N).value.value=s),"error-message":e(N).errorMessage.value,"label-on":e(l)("StoreItemEditView.labels.availableOn"),"label-off":e(l)("StoreItemEditView.labels.availableOff"),"hint-on":e(l)("StoreItemEditView.labels.availableHintOn"),"hint-off":e(l)("StoreItemEditView.labels.availableHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"]),t(Q,{modelValue:e(R).value.value,"onUpdate:modelValue":a[10]||(a[10]=s=>e(R).value.value=s),"error-message":e(R).errorMessage.value,"label-on":e(l)("StoreItemEditView.labels.isTicketOn"),"label-off":e(l)("StoreItemEditView.labels.isTicketOff"),"hint-on":e(l)("StoreItemEditView.labels.isTicketHintOn"),"hint-off":e(l)("StoreItemEditView.labels.isTicketHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"]),t(O,{align:"center"},{default:r(()=>[t(m,{cols:"12",md:e(w).value.value?6:12},{default:r(()=>[t(Q,{modelValue:e(w).value.value,"onUpdate:modelValue":a[11]||(a[11]=s=>e(w).value.value=s),"error-message":e(w).errorMessage.value,"label-on":e(l)("StoreItemEditView.labels.isSecretOn"),"label-off":e(l)("StoreItemEditView.labels.isSecretOff"),"hint-on":e(l)("StoreItemEditView.labels.isSecretHintOn"),"hint-off":e(l)("StoreItemEditView.labels.isSecretHintOff")},null,8,["modelValue","error-message","label-on","label-off","hint-on","hint-off"])]),_:1},8,["md"]),e(w).value.value?(n(),v(m,{key:0,cols:"12",md:"6"},{default:r(()=>[t(f,{modelValue:e(G).value.value,"onUpdate:modelValue":a[12]||(a[12]=s=>e(G).value.value=s),"error-messages":e(G).errorMessage.value,variant:"outlined",label:e(l)("StoreItemEditView.labels.secretKey"),"hide-details":"auto"},null,8,["modelValue","error-messages","label"])]),_:1})):y("",!0)]),_:1}),I.value?(n(),F(oe,{key:1},[t(E,null,{default:r(()=>[c(d(e(l)("StoreItemEditView.sections.variants")),1)]),_:1}),t(ie,{variant:"outlined",class:"mb-4"},{default:r(()=>[t(se,null,{default:r(()=>[S.value.length>0?(n(),v(Ke,{key:0,density:"compact"},{default:r(()=>[(n(!0),F(oe,null,Be(S.value,s=>(n(),v(De,{key:s.id},{append:r(()=>[e(Z).canDelete(e(ne).STORE_ITEM_VARIANT)?(n(),v(M,{key:0,icon:"",variant:"text",color:"red",size:"small",onClick:oa=>ye(s)},{default:r(()=>[t(e(z),{icon:e(He)},null,8,["icon"])]),_:1},8,["onClick"])):y("",!0)]),default:r(()=>[t($e,null,{default:r(()=>[c(d(s.name),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(n(),F("div",sa,d(e(l)("StoreItemEditView.variants.noVariants")),1)),e(Z).canAdd(e(ne).STORE_ITEM_VARIANT)?(n(),v(O,{key:2,align:"center",class:"mt-2"},{default:r(()=>[t(m,{cols:"auto",class:"flex-grow-1"},{default:r(()=>[t(f,{modelValue:_.value,"onUpdate:modelValue":a[13]||(a[13]=s=>_.value=s),variant:"outlined",density:"compact",label:e(l)("StoreItemEditView.variants.name"),"hide-details":""},null,8,["modelValue","label"])]),_:1}),t(m,{cols:"auto"},{default:r(()=>[t(M,{color:"primary",disabled:!_.value.trim(),loading:U.value,onClick:_e},{prepend:r(()=>[t(e(z),{icon:e(Le)},null,8,["icon"])]),default:r(()=>[c(" "+d(e(l)("StoreItemEditView.variants.addVariant")),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1})):y("",!0)]),_:1})]),_:1})],64)):y("",!0)]),_:1},8,["onSubmit"])]),_:1}),t(Ne,null,{default:r(()=>[I.value?(n(),v(Ye,{key:0,"app-label":"store",model:"storeitem","object-pk":W.id},null,8,["object-pk"])):y("",!0),t(Re),t(M,{variant:"text",onClick:q},{default:r(()=>[c(d(e(l)("General.cancel")),1)]),_:1}),t(M,{variant:"elevated",color:"primary",loading:C.value,disabled:!e(ge).valid,onClick:e(le)},{prepend:r(()=>[t(e(z),{icon:e(Ge)},null,8,["icon"])]),default:r(()=>[c(" "+d(e(l)("General.save")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1}))]),_:1},8,["breadcrumbs"])}}});export{Ma as default};
//# sourceMappingURL=StoreItemEditView-C2EjmGCz.js.map
