import{d as j,a as q,u as G,H as K,I as z,v as H,b as w,g as y,w as a,e as l,j as s,P as v,V as J,i as S,t as k,k as Q,J as W,K as X,m as Y,q as Z,G as x,s as n,bx as ee,by as te,E as ae}from"./index-BSHMv_df.js";import{_ as E}from"./BooleanIcon.vue_vue_type_script_setup_true_lang-COcceYO8.js";import{I as se}from"./ImageCell-yz-yO6nd.js";import{V as T,_ as le}from"./LayoutBase.vue_vue_type_script_setup_true_lang-C8aKWyeJ.js";import{_ as oe}from"./PriceCell.vue_vue_type_script_setup_true_lang-B8eOis0Q.js";import{_ as ie}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-DouyropJ.js";import{d as ne,V as re,g as me}from"./query_tools-Co6bP9h2.js";import{g as ue}from"./http-BZkoYM_m.js";import{V as D}from"./VRow-BUBfmFS3.js";import{p as de}from"./parseInt-3OpbdfxQ.js";import"./VContainer--EpXOfw5.js";import"./VDataTable-CpUosGjF.js";import"./filter-C6Uu0LOB.js";const ke=j({__name:"StoreItemsView",props:{eventId:{}},setup(C){const f=C,{t}=q(),I=G(),A=K(z),m=H(),u=Z(),{getEventById:P}=ae(),r=x(()=>de(f.eventId,10)),d=n(!1),$=x(()=>[{title:P(r.value)?.name??"...",to:{name:"dashboard",params:{eventId:f.eventId}}},{title:t("StoreItemsView.title"),disabled:!0}]),_=[25,50,100],b=n(_[0]),g=n(0),F=n(1),V=n([]),c=n(""),p=n(null),R=[{title:t("StoreItemsView.headers.id"),sortable:!0,key:"id"},{title:t("StoreItemsView.headers.image"),sortable:!1,key:"imagefile_thumbnail_url",width:60},{title:t("StoreItemsView.headers.name"),sortable:!0,key:"name"},{title:t("StoreItemsView.headers.price"),sortable:!0,key:"price"},{title:t("StoreItemsView.headers.available"),sortable:!1,key:"num_available"},{title:t("StoreItemsView.headers.max"),sortable:!0,key:"max"},{title:t("StoreItemsView.headers.isAvailable"),sortable:!1,key:"available"},{title:t("StoreItemsView.headers.isTicket"),sortable:!1,key:"is_ticket"},{title:t("StoreItemsView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function B(){p.value&&h(p.value)}async function h(i){d.value=!0,p.value=i;try{const o=await te({path:{event_pk:r.value},query:me(i)});V.value=o.data.results,g.value=o.data.count}catch(o){m.error(t("StoreItemsView.loadFailure")),console.error(o)}finally{d.value=!1}}const L=ne(h,250);async function M(i){const o=t("StoreItemsView.confirmDelete",i);await A.value.ifConfirmed(o,async()=>{try{await ee({path:{event_pk:r.value,id:i.id}}),m.success(t("StoreItemsView.deleteSuccess")),B()}catch(e){m.error(ue(e,t("StoreItemsView.deleteFailure"))),console.error(e)}})}function O(i){I.push({name:"store-items-edit",params:{eventId:r.value,id:i}})}function U(){I.push({name:"store-items-new",params:{eventId:r.value}})}return(i,o)=>(w(),y(le,{key:`store-items-${r.value}`,breadcrumbs:$.value},{default:a(()=>[l(T,null,{default:a(()=>[l(D,null,{default:a(()=>[s(u).canAdd(s(v).STORE_ITEM)?(w(),y(J,{key:0,onClick:U},{prepend:a(()=>[l(s(Q),{icon:s(W)},null,8,["icon"])]),default:a(()=>[S(" "+k(s(t)("StoreItemsView.newItem")),1)]),_:1})):X("",!0),l(Y,{modelValue:c.value,"onUpdate:modelValue":o[0]||(o[0]=e=>c.value=e),variant:"outlined",density:"compact",label:s(t)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),l(T,null,{default:a(()=>[l(D,null,{default:a(()=>[l(re,{"items-per-page":b.value,"onUpdate:itemsPerPage":o[1]||(o[1]=e=>b.value=e),class:"elevation-1 primary","item-value":"id",density:"compact",headers:R,items:V.value,"items-length":g.value,loading:d.value,search:c.value,page:F.value,"items-per-page-options":_,"no-data-text":s(t)("StoreItemsView.noItemsFound"),"loading-text":s(t)("StoreItemsView.loadingItems"),"onUpdate:options":s(L)},{"item.imagefile_thumbnail_url":a(({item:e})=>[l(se,{url:e.imagefile_thumbnail_url},null,8,["url"])]),"item.price":a(({item:e})=>[l(oe,{value:e.price},null,8,["value"])]),"item.num_available":a(({item:e})=>[S(k(e.num_available),1)]),"item.available":a(({item:e})=>[l(E,{value:e.available},null,8,["value"])]),"item.is_ticket":a(({item:e})=>[l(E,{value:e.is_ticket},null,8,["value"])]),"item.actions":a(({item:e})=>[l(ie,{"can-edit":s(u).canChange(s(v).STORE_ITEM),"can-delete":s(u).canDelete(s(v).STORE_ITEM),onEdit:N=>O(e.id),onDelete:N=>M(e)},null,8,["can-edit","can-delete","onEdit","onDelete"])]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{ke as default};
//# sourceMappingURL=StoreItemsView-B6plmBVC.js.map
