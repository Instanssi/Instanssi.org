import{d as q,a as K,u as z,J as G,K as H,v as J,U as Q,b as y,g as S,w as a,e as o,j as s,P as f,V as W,i as k,t as x,k as X,L as Y,D as Z,m as ee,q as te,I as E,s as n,bD as ae,bE as se,H as oe}from"./index-DXU74lGt.js";import{_ as D}from"./BooleanIcon.vue_vue_type_script_setup_true_lang-CqjGGkAi.js";import{I as le}from"./ImageCell-DJVG8mod.js";import{V as T,_ as ie}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D4jd1chv.js";import{_ as re}from"./PriceCell.vue_vue_type_script_setup_true_lang-C0E14iwW.js";import{_ as ne}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-CUVfxWfg.js";import{g as me}from"./query_tools-BInV9OzK.js";import{g as ue}from"./http-BTZWMaMN.js";import{d as de}from"./debounce-CQ84CrOG.js";import{V as P}from"./VRow-B94Tto0H.js";import{V as ce}from"./VDataTableServer-CMLVDy59.js";import{p as pe}from"./parseInt-Bzw_2rWL.js";import"./VContainer-BfWqa_tJ.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-WkXOSlqa.js";import"./useAuditLogUtils-BqNOieoY.js";import"./DateTimeCell.vue_vue_type_script_setup_true_lang-BMnBYvTq.js";import"./datetime-Dz9fjSvq.js";import"./VDataTable-Jd7io3gq.js";const Ae=q({__name:"StoreItemsView",props:{eventId:{}},setup(C){const I=C,{t}=K(),g=z(),A=G(H),u=J(),d=te(),{getEventById:$}=oe(),r=E(()=>pe(I.eventId,10)),c=n(!1),B=E(()=>[{title:$(r.value)?.name??"...",to:{name:"dashboard",params:{eventId:I.eventId}}},{title:t("StoreItemsView.title"),disabled:!0}]),b=[25,50,100],p=n(b[0]),_=n(0),L=n(1),h=n([]),m=n(""),v=n(null),F=[{title:t("StoreItemsView.headers.id"),sortable:!0,key:"id"},{title:t("StoreItemsView.headers.image"),sortable:!1,key:"imagefile_thumbnail_url",width:60},{title:t("StoreItemsView.headers.name"),sortable:!0,key:"name"},{title:t("StoreItemsView.headers.price"),sortable:!0,key:"price"},{title:t("StoreItemsView.headers.available"),sortable:!1,key:"num_available"},{title:t("StoreItemsView.headers.max"),sortable:!0,key:"max"},{title:t("StoreItemsView.headers.isAvailable"),sortable:!1,key:"available"},{title:t("StoreItemsView.headers.isTicket"),sortable:!1,key:"is_ticket"},{title:t("StoreItemsView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function R(){v.value&&V(v.value)}async function V(i){c.value=!0,v.value=i;try{const l=await se({path:{event_pk:r.value},query:me(i)});h.value=l.data.results,_.value=l.data.count}catch(l){u.error(t("StoreItemsView.loadFailure")),console.error(l)}finally{c.value=!1}}const w=de(V,250);function U(){m.value="",w({page:1,itemsPerPage:p.value??25,sortBy:[],groupBy:[],search:""})}Q(r,U);async function M(i){const l=t("StoreItemsView.confirmDelete",i);await A.value.ifConfirmed(l,async()=>{try{await ae({path:{event_pk:r.value,id:i.id}}),u.success(t("StoreItemsView.deleteSuccess")),R()}catch(e){u.error(ue(e,t("StoreItemsView.deleteFailure"))),console.error(e)}})}function O(i){g.push({name:"store-items-edit",params:{eventId:r.value,id:i}})}function j(){g.push({name:"store-items-new",params:{eventId:r.value}})}return(i,l)=>(y(),S(ie,{key:`store-items-${r.value}`,breadcrumbs:B.value},{default:a(()=>[o(T,null,{default:a(()=>[o(P,null,{default:a(()=>[s(d).canAdd(s(f).STORE_ITEM)?(y(),S(W,{key:0,color:"primary",onClick:j},{prepend:a(()=>[o(s(X),{icon:s(Y)},null,8,["icon"])]),default:a(()=>[k(" "+x(s(t)("StoreItemsView.newItem")),1)]),_:1})):Z("",!0),o(ee,{modelValue:m.value,"onUpdate:modelValue":l[0]||(l[0]=e=>m.value=e),variant:"outlined",density:"compact",label:s(t)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),o(T,null,{default:a(()=>[o(P,null,{default:a(()=>[o(ce,{"items-per-page":p.value,"onUpdate:itemsPerPage":l[1]||(l[1]=e=>p.value=e),class:"elevation-1 primary","item-value":"id",density:"compact",headers:F,items:h.value,"items-length":_.value,loading:c.value,search:m.value,page:L.value,"items-per-page-options":b,"no-data-text":s(t)("StoreItemsView.noItemsFound"),"loading-text":s(t)("StoreItemsView.loadingItems"),"onUpdate:options":s(w)},{"item.imagefile_thumbnail_url":a(({item:e})=>[o(le,{url:e.imagefile_thumbnail_url},null,8,["url"])]),"item.price":a(({item:e})=>[o(re,{value:e.price},null,8,["value"])]),"item.num_available":a(({item:e})=>[k(x(e.num_available),1)]),"item.available":a(({item:e})=>[o(D,{value:e.available},null,8,["value"])]),"item.is_ticket":a(({item:e})=>[o(D,{value:e.is_ticket},null,8,["value"])]),"item.actions":a(({item:e})=>[o(ne,{"can-edit":s(d).canChange(s(f).STORE_ITEM),"can-delete":s(d).canDelete(s(f).STORE_ITEM),"audit-log":{appLabel:"store",model:"storeitem",objectPk:e.id},onEdit:N=>O(e.id),onDelete:N=>M(e)},null,8,["can-edit","can-delete","audit-log","onEdit","onDelete"])]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Ae as default};
//# sourceMappingURL=StoreItemsView-Bq_BpOj2.js.map
