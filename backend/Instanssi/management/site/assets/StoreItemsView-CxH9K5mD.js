import{d as H,a as J,u as Q,J as W,K as X,v as Y,L as x,b as T,g as O,w as o,e as i,j as e,P as V,V as Z,i as B,t as E,k as ee,M as te,D as ae,m as le,N as y,O as g,q as se,I as A,s as p,bL as ie,bM as oe,H as re}from"./index-CQkWvXOv.js";import{_ as D}from"./BooleanIcon.vue_vue_type_script_setup_true_lang-BUZkEwsX.js";import{I as ne}from"./ImageCell-BlQ2k2ZF.js";import{V as F,_ as ue}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D5aCeQDf.js";import{_ as me}from"./PriceCell.vue_vue_type_script_setup_true_lang-FibLybm5.js";import{_ as de}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-DepTf6Bi.js";import{u as ce,d as pe}from"./useTableState-CutuDm2i.js";import{g as ve}from"./query_tools-BInV9OzK.js";import{g as fe}from"./http-CET7UDul.js";import{V as P}from"./VRow-CXIXhuhq.js";import{V as be}from"./VDataTableServer-C6tuZDKn.js";import{p as Ie}from"./parseInt-BJ5A4_3y.js";import"./VContainer-DqJ8gu3P.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-1MnYozFL.js";import"./useAuditLogUtils-BdjF9k7b.js";import"./DateTimeCell.vue_vue_type_script_setup_true_lang-DaLynL44.js";import"./datetime-Dz9fjSvq.js";import"./VDataTable-f5_9vewM.js";const Ue=H({__name:"StoreItemsView",props:{eventId:{}},setup(C){const w=C,{t}=J(),S=Q(),U=W(X),v=Y(),f=se(),{getEventById:L}=re(),n=A(()=>Ie(w.eventId,10)),b=p(!1),$=A(()=>[{title:L(n.value)?.name??"...",to:{name:"dashboard",params:{eventId:w.eventId}}},{title:t("StoreItemsView.title"),disabled:!0}]),l=ce({filterKeys:["available","is_ticket","is_secret"]}),_=p(0),h=p([]),c=p(null),u=l.useBooleanFilter("available"),m=l.useBooleanFilter("is_ticket"),d=l.useBooleanFilter("is_secret"),M=[{title:t("StoreItemsView.headers.id"),sortable:!0,key:"id"},{title:t("StoreItemsView.headers.image"),sortable:!1,key:"imagefile_thumbnail_url",width:60},{title:t("StoreItemsView.headers.name"),sortable:!0,key:"name"},{title:t("StoreItemsView.headers.price"),sortable:!0,key:"price"},{title:t("StoreItemsView.headers.available"),sortable:!1,key:"num_available"},{title:t("StoreItemsView.headers.max"),sortable:!0,key:"max"},{title:t("StoreItemsView.headers.isAvailable"),sortable:!1,key:"available"},{title:t("StoreItemsView.headers.isTicket"),sortable:!1,key:"is_ticket"},{title:t("StoreItemsView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function R(){c.value&&k(c.value)}async function k(r){b.value=!0,c.value=r;try{const s=await oe({path:{event_pk:n.value},query:{...ve(r),...u.value!==null?{available:u.value}:{},...m.value!==null?{is_ticket:m.value}:{},...d.value!==null?{is_secret:d.value}:{}}});h.value=s.data.results,_.value=s.data.count}catch(s){v.error(t("StoreItemsView.loadFailure")),console.error(s)}finally{b.value=!1}}const I=pe(k,250);x([u,m,d],()=>{c.value&&I({...c.value,page:1})});function N(r){l.onOptionsUpdate(r),I(r)}function j(){l.setFilter("available",null),l.setFilter("is_ticket",null),l.setFilter("is_secret",null),l.search.value="",l.page.value=1,I({page:1,itemsPerPage:l.perPage.value??25,sortBy:[],groupBy:[],search:""})}x(n,j);async function K(r){const s=t("StoreItemsView.confirmDelete",r);await U.value.ifConfirmed(s,async()=>{try{await ie({path:{event_pk:n.value,id:r.id}}),v.success(t("StoreItemsView.deleteSuccess")),R()}catch(a){v.error(fe(a,t("StoreItemsView.deleteFailure"))),console.error(a)}})}function q(r){S.push({name:"store-items-edit",params:{eventId:n.value,id:r}})}function z(){S.push({name:"store-items-new",params:{eventId:n.value}})}return(r,s)=>(T(),O(ue,{key:`store-items-${n.value}`,breadcrumbs:$.value},{default:o(()=>[i(F,null,{default:o(()=>[i(P,null,{default:o(()=>[e(f).canAdd(e(V).STORE_ITEM)?(T(),O(Z,{key:0,color:"primary",onClick:z},{prepend:o(()=>[i(e(ee),{icon:e(te)},null,8,["icon"])]),default:o(()=>[B(" "+E(e(t)("StoreItemsView.newItem")),1)]),_:1})):ae("",!0),i(le,{modelValue:e(l).search.value,"onUpdate:modelValue":s[0]||(s[0]=a=>e(l).search.value=a),variant:"outlined",density:"compact",label:e(t)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"]),i(y,{modelValue:e(u),"onUpdate:modelValue":s[1]||(s[1]=a=>g(u)?u.value=a:null),items:[{title:e(t)("StoreItemsView.allAvailability"),value:null},{title:e(t)("StoreItemsView.inStockOnly"),value:!0},{title:e(t)("StoreItemsView.outOfStockOnly"),value:!1}],variant:"outlined",density:"compact",label:e(t)("StoreItemsView.filterByAvailability"),style:{"max-width":"180px"},class:"ma-0 pa-0 ml-4"},null,8,["modelValue","items","label"]),i(y,{modelValue:e(m),"onUpdate:modelValue":s[2]||(s[2]=a=>g(m)?m.value=a:null),items:[{title:e(t)("StoreItemsView.allTypes"),value:null},{title:e(t)("StoreItemsView.ticketsOnly"),value:!0},{title:e(t)("StoreItemsView.nonTicketsOnly"),value:!1}],variant:"outlined",density:"compact",label:e(t)("StoreItemsView.filterByType"),style:{"max-width":"180px"},class:"ma-0 pa-0 ml-4"},null,8,["modelValue","items","label"]),i(y,{modelValue:e(d),"onUpdate:modelValue":s[3]||(s[3]=a=>g(d)?d.value=a:null),items:[{title:e(t)("StoreItemsView.allVisibility"),value:null},{title:e(t)("StoreItemsView.secretOnly"),value:!0},{title:e(t)("StoreItemsView.publicOnly"),value:!1}],variant:"outlined",density:"compact",label:e(t)("StoreItemsView.filterByVisibility"),style:{"max-width":"180px"},class:"ma-0 pa-0 ml-4"},null,8,["modelValue","items","label"])]),_:1})]),_:1}),i(F,null,{default:o(()=>[i(P,null,{default:o(()=>[i(be,{"items-per-page":e(l).perPage.value,"onUpdate:itemsPerPage":s[4]||(s[4]=a=>e(l).perPage.value=a),"sort-by":e(l).sortByArray.value,class:"elevation-1 primary","item-value":"id",density:"compact",headers:M,items:h.value,"items-length":_.value,loading:b.value,search:e(l).search.value,page:e(l).page.value,"items-per-page-options":e(l).pageSizeOptions,"no-data-text":e(t)("StoreItemsView.noItemsFound"),"loading-text":e(t)("StoreItemsView.loadingItems"),"onUpdate:options":N},{"item.imagefile_thumbnail_url":o(({item:a})=>[i(ne,{url:a.imagefile_thumbnail_url},null,8,["url"])]),"item.price":o(({item:a})=>[i(me,{value:a.price},null,8,["value"])]),"item.num_available":o(({item:a})=>[B(E(a.num_available),1)]),"item.available":o(({item:a})=>[i(D,{value:a.available},null,8,["value"])]),"item.is_ticket":o(({item:a})=>[i(D,{value:a.is_ticket},null,8,["value"])]),"item.actions":o(({item:a})=>[i(de,{"can-edit":e(f).canChange(e(V).STORE_ITEM),"can-delete":e(f).canDelete(e(V).STORE_ITEM),"audit-log":{appLabel:"store",model:"storeitem",objectPk:a.id},onEdit:G=>q(a.id),onDelete:G=>K(a)},null,8,["can-edit","can-delete","audit-log","onEdit","onDelete"])]),_:1},8,["items-per-page","sort-by","items","items-length","loading","search","page","items-per-page-options","no-data-text","loading-text"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Ue as default};
//# sourceMappingURL=StoreItemsView-CxH9K5mD.js.map
