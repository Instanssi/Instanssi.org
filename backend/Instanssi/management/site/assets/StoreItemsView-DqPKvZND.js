import{d as q,a as G,u as K,H as z,I as H,v as J,Z,b as y,g as S,w as a,e as l,j as s,P as f,V as Q,i as k,t as x,k as W,J as X,K as Y,m as ee,q as te,G as E,s as n,bx as ae,by as se,E as le}from"./index-qrfwdmHz.js";import{_ as T}from"./BooleanIcon.vue_vue_type_script_setup_true_lang-BztPFn-1.js";import{I as oe}from"./ImageCell-C0IQi5no.js";import{V as D,_ as ie}from"./LayoutBase.vue_vue_type_script_setup_true_lang-Cgp8Musd.js";import{_ as re}from"./PriceCell.vue_vue_type_script_setup_true_lang-BtBLjvrW.js";import{_ as ne}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-B6FHDr2a.js";import{d as me,V as ue,g as ce}from"./query_tools-Ch1hnqwl.js";import{g as de}from"./http-Cqy_sGiB.js";import{V as P}from"./VRow-EkiCBxID.js";import{p as pe}from"./parseInt-CGa1F4cm.js";import"./VContainer-e74dHNZG.js";import"./VDataTable-BIkGv4dg.js";import"./filter-50Rnsb7m.js";const Ee=q({__name:"StoreItemsView",props:{eventId:{}},setup(C){const I=C,{t}=G(),g=K(),A=z(H),u=J(),c=te(),{getEventById:$}=le(),r=E(()=>pe(I.eventId,10)),d=n(!1),B=E(()=>[{title:$(r.value)?.name??"...",to:{name:"dashboard",params:{eventId:I.eventId}}},{title:t("StoreItemsView.title"),disabled:!0}]),_=[25,50,100],p=n(_[0]),b=n(0),F=n(1),h=n([]),m=n(""),v=n(null),R=[{title:t("StoreItemsView.headers.id"),sortable:!0,key:"id"},{title:t("StoreItemsView.headers.image"),sortable:!1,key:"imagefile_thumbnail_url",width:60},{title:t("StoreItemsView.headers.name"),sortable:!0,key:"name"},{title:t("StoreItemsView.headers.price"),sortable:!0,key:"price"},{title:t("StoreItemsView.headers.available"),sortable:!1,key:"num_available"},{title:t("StoreItemsView.headers.max"),sortable:!0,key:"max"},{title:t("StoreItemsView.headers.isAvailable"),sortable:!1,key:"available"},{title:t("StoreItemsView.headers.isTicket"),sortable:!1,key:"is_ticket"},{title:t("StoreItemsView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function L(){v.value&&V(v.value)}async function V(i){d.value=!0,v.value=i;try{const o=await se({path:{event_pk:r.value},query:ce(i)});h.value=o.data.results,b.value=o.data.count}catch(o){u.error(t("StoreItemsView.loadFailure")),console.error(o)}finally{d.value=!1}}const w=me(V,250);function M(){m.value="",w({page:1,itemsPerPage:p.value??25,sortBy:[],groupBy:[],search:""})}Z(r,M);async function O(i){const o=t("StoreItemsView.confirmDelete",i);await A.value.ifConfirmed(o,async()=>{try{await ae({path:{event_pk:r.value,id:i.id}}),u.success(t("StoreItemsView.deleteSuccess")),L()}catch(e){u.error(de(e,t("StoreItemsView.deleteFailure"))),console.error(e)}})}function U(i){g.push({name:"store-items-edit",params:{eventId:r.value,id:i}})}function N(){g.push({name:"store-items-new",params:{eventId:r.value}})}return(i,o)=>(y(),S(ie,{key:`store-items-${r.value}`,breadcrumbs:B.value},{default:a(()=>[l(D,null,{default:a(()=>[l(P,null,{default:a(()=>[s(c).canAdd(s(f).STORE_ITEM)?(y(),S(Q,{key:0,onClick:N},{prepend:a(()=>[l(s(W),{icon:s(X)},null,8,["icon"])]),default:a(()=>[k(" "+x(s(t)("StoreItemsView.newItem")),1)]),_:1})):Y("",!0),l(ee,{modelValue:m.value,"onUpdate:modelValue":o[0]||(o[0]=e=>m.value=e),variant:"outlined",density:"compact",label:s(t)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),l(D,null,{default:a(()=>[l(P,null,{default:a(()=>[l(ue,{"items-per-page":p.value,"onUpdate:itemsPerPage":o[1]||(o[1]=e=>p.value=e),class:"elevation-1 primary","item-value":"id",density:"compact",headers:R,items:h.value,"items-length":b.value,loading:d.value,search:m.value,page:F.value,"items-per-page-options":_,"no-data-text":s(t)("StoreItemsView.noItemsFound"),"loading-text":s(t)("StoreItemsView.loadingItems"),"onUpdate:options":s(w)},{"item.imagefile_thumbnail_url":a(({item:e})=>[l(oe,{url:e.imagefile_thumbnail_url},null,8,["url"])]),"item.price":a(({item:e})=>[l(re,{value:e.price},null,8,["value"])]),"item.num_available":a(({item:e})=>[k(x(e.num_available),1)]),"item.available":a(({item:e})=>[l(T,{value:e.available},null,8,["value"])]),"item.is_ticket":a(({item:e})=>[l(T,{value:e.is_ticket},null,8,["value"])]),"item.actions":a(({item:e})=>[l(ne,{"can-edit":s(c).canChange(s(f).STORE_ITEM),"can-delete":s(c).canDelete(s(f).STORE_ITEM),onEdit:j=>U(e.id),onDelete:j=>O(e)},null,8,["can-edit","can-delete","onEdit","onDelete"])]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Ee as default};
//# sourceMappingURL=StoreItemsView-DqPKvZND.js.map
