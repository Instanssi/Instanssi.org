import{d as $,a as A,b as h,g as b,j as u,w as n,e as r,I as c,v as ee,o as te,A as ae,c6 as se,c7 as re,p as ne,aB as oe,i as L,t as B,E as ie,B as le,c as ue,s as T,bE as ce,c1 as me,c5 as de,H as pe}from"./index-DXU74lGt.js";import{C as O,B as z,a as H,p as Z,L as j,b as K,_ as X,c as Q,d as M}from"./StatCard.vue_vue_type_script_setup_true_lang-WdALf28p.js";import{X as k,A as fe}from"./datetime-Dz9fjSvq.js";import{_ as ve,d as ye}from"./spreadsheet-ad3MpNLb.js";import{V as _,_ as Se}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D4jd1chv.js";import{V as E}from"./VRow-B94Tto0H.js";import{a as _e}from"./VDataTable-Jd7io3gq.js";import{p as he}from"./parseInt-Bzw_2rWL.js";import"./VContainer-BfWqa_tJ.js";const ge=$({__name:"SalesByHourChart",props:{paidTimes:{}},setup(w){O.register(z,H,Z,j,K);const d=w,{t:s}=A(),p={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}},f=c(()=>{if(d.paidTimes.length===0)return{labels:[],datasets:[]};const o=new Array(24).fill(0);for(const l of d.paidTimes){const v=l.hour;o[v]++}const i=[],m=[];for(let l=0;l<24;l++)i.push(`${l.toString().padStart(2,"0")}:00`),m.push(o[l]);return{labels:i,datasets:[{label:s("StoreSummaryView.charts.salesCount"),data:m,backgroundColor:"#2196F3"}]}});return(o,i)=>(h(),b(X,{title:u(s)("StoreSummaryView.charts.salesByHour"),"has-data":f.value.labels.length>0,"no-data-text":u(s)("StoreSummaryView.charts.noData")},{default:n(()=>[r(u(Q),{data:f.value,options:p},null,8,["data"])]),_:1},8,["title","has-data","no-data-text"]))}}),be=$({__name:"SalesPerDayChart",props:{paidTimes:{}},setup(w){O.register(z,H,Z,j,K);const d=w,{t:s}=A(),p={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}},f=c(()=>{if(d.paidTimes.length===0)return{labels:[],datasets:[]};const o=new Map;for(const y of d.paidTimes){const D=y.toPlainDate().toString();o.set(D,(o.get(D)??0)+1)}const i=Array.from(o.keys()).sort();if(i.length===0)return{labels:[],datasets:[]};const m=[],l=[],v=i[0],V=i[i.length-1];if(!v||!V)return{labels:[],datasets:[]};let g=k.PlainDate.from(v);const C=k.PlainDate.from(V);for(;k.PlainDate.compare(g,C)<=0;){const y=g.toString();m.push(y),l.push(o.get(y)??0),g=g.add({days:1})}return{labels:m,datasets:[{label:s("StoreSummaryView.charts.salesCount"),data:l,backgroundColor:"#4CAF50"}]}});return(o,i)=>(h(),b(X,{title:u(s)("StoreSummaryView.charts.salesPerDay"),"has-data":f.value.labels.length>0,"no-data-text":u(s)("StoreSummaryView.charts.noData")},{default:n(()=>[r(u(Q),{data:f.value,options:p},null,8,["data"])]),_:1},8,["title","has-data","no-data-text"]))}}),we={key:1,class:"text-grey text-center py-8"},$e=$({__name:"StoreSummaryView",props:{eventId:{}},setup(w){const d=w,{t:s}=A(),p=ee(),{getEventById:f}=pe(),o=c(()=>he(d.eventId,10)),i=T(!1),m=T(!1),l=T([]),v=T([]),V=T([]),g=c(()=>[{title:f(o.value)?.name??"...",to:{name:"dashboard",params:{eventId:d.eventId}}},{title:s("StoreSummaryView.title"),disabled:!0}]),C=[{title:s("StoreSummaryView.headers.item"),key:"item",sortable:!0},{title:s("StoreSummaryView.headers.variant"),key:"variant",sortable:!0},{title:s("StoreSummaryView.headers.quantity"),key:"quantity",sortable:!0,align:"end"},{title:s("StoreSummaryView.headers.revenue"),key:"revenue",sortable:!0,align:"end"}],y=c(()=>v.value.filter(t=>t.is_paid&&t.time_paid).sort((t,e)=>{const a=t.time_paid?new Date(t.time_paid).getTime():0,I=e.time_paid?new Date(e.time_paid).getTime():0;return a-I})),D=c(()=>new Set(y.value.map(t=>t.id))),F=c(()=>V.value.filter(t=>D.value.has(t.transaction))),U=c(()=>{const t=new Map;for(const e of y.value)if(e.time_paid){const a=k.Instant.from(e.time_paid);t.set(e.id,a.toZonedDateTimeISO(fe))}return t}),R=c(()=>{const t=[];for(const e of F.value){const a=U.value.get(e.transaction);a&&t.push(a)}return t}),x=c(()=>{const t=new Map;for(const e of F.value){const a=G(e.item),I=J(e.item,e.variant),S=`${e.item}-${e.variant??"null"}`;t.has(S)||t.set(S,{item:a,variant:I,quantity:0,revenue:0});const N=t.get(S);N.quantity+=1,N.revenue+=parseFloat(e.purchase_price)}return Array.from(t.values()).sort((e,a)=>e.item.localeCompare(a.item))}),q=c(()=>x.value.reduce((t,e)=>t+e.quantity,0)),P=c(()=>x.value.reduce((t,e)=>t+e.revenue,0));function G(t){return l.value.find(a=>a.id===t)?.name??`#${t}`}function J(t,e){if(!e)return"-";const a=l.value.find(S=>S.id===t);return a?a.variants?.find(S=>S.id===e)?.name??`#${e}`:`#${e}`}async function W(){i.value=!0;try{const[t,e,a]=await Promise.all([ce({path:{event_pk:o.value},query:{limit:1e3}}),me({path:{event_pk:o.value},query:{limit:1e4}}),de({path:{event_pk:o.value},query:{limit:1e4}})]);l.value=t.data.results,v.value=e.data.results,V.value=a.data.results}catch(t){p.error(s("StoreSummaryView.loadFailure")),console.error(t)}finally{i.value=!1}}function Y(t){m.value=!0;try{const e=[["Item","Variant","Quantity Sold","Revenue (EUR)"]];for(const a of x.value)e.push([a.item,a.variant,a.quantity,a.revenue.toFixed(2)]);e.push([]),e.push(["TOTAL","",q.value,P.value.toFixed(2)]),ye(e,"instanssi_sales_summary",t,"Sales Summary"),p.success(s("StoreSummaryView.exportSuccess"))}catch(e){p.error(s("StoreSummaryView.exportFailure")),console.error(e)}finally{m.value=!1}}return te(W),(t,e)=>(h(),b(Se,{key:`store-summary-${o.value}`,breadcrumbs:g.value},{default:n(()=>[i.value?(h(),b(_,{key:0,class:"d-flex justify-center my-8"},{default:n(()=>[r(ae,{indeterminate:"",size:"64"})]),_:1})):(h(),b(_,{key:1},{default:n(()=>[r(E,{class:"mb-4"},{default:n(()=>[r(_,{cols:"12",sm:"6"},{default:n(()=>[r(M,{icon:u(se),value:q.value,label:u(s)("StoreSummaryView.totals.totalItems"),color:"primary"},null,8,["icon","value","label"])]),_:1}),r(_,{cols:"12",sm:"6"},{default:n(()=>[r(M,{icon:u(re),value:`${P.value.toFixed(2)} €`,label:u(s)("StoreSummaryView.totals.totalRevenue"),color:"success"},null,8,["icon","value","label"])]),_:1})]),_:1}),r(E,{class:"mb-4"},{default:n(()=>[r(_,{cols:"12",md:"6"},{default:n(()=>[r(be,{"paid-times":R.value},null,8,["paid-times"])]),_:1}),r(_,{cols:"12",md:"6"},{default:n(()=>[r(ge,{"paid-times":R.value},null,8,["paid-times"])]),_:1})]),_:1}),r(E,null,{default:n(()=>[r(_,{cols:"12"},{default:n(()=>[r(ne,null,{default:n(()=>[r(oe,{class:"d-flex align-center"},{default:n(()=>[L(B(u(s)("StoreSummaryView.title"))+" ",1),r(ie),r(ve,{label:u(s)("StoreSummaryView.export"),loading:m.value,size:"small",onExport:Y},null,8,["label","loading"])]),_:1}),r(le,null,{default:n(()=>[x.value.length>0?(h(),b(_e,{key:0,headers:C,items:x.value,density:"compact",class:"elevation-0","items-per-page":-1,"hide-default-footer":""},{"item.revenue":n(({item:a})=>[L(B(a.revenue.toFixed(2))+" € ",1)]),_:1},8,["items"])):(h(),ue("div",we,B(u(s)("StoreSummaryView.noSalesFound")),1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))]),_:1},8,["breadcrumbs"]))}});export{$e as default};
//# sourceMappingURL=StoreSummaryView-CY7btgj5.js.map
