import{d as E,a as A,b as V,g as C,j as l,w as n,e as r,I as c,v as Y,cd as ee,ce as te,p as ae,aD as se,i as P,t as $,E as re,B as ne,c as oe,s as I,bM as ie,c7 as le,cc as ue,H as ce}from"./index-CQkWvXOv.js";import{C as M,B as O,a as H,p as Z,L as z,b as K,_ as X,c as j,d as L,e as me}from"./StatCard.vue_vue_type_script_setup_true_lang-Dj0FEt_9.js";import{X as k,A as de}from"./datetime-Dz9fjSvq.js";import{_ as pe,d as fe}from"./spreadsheet-B6MwOGQk.js";import{V as h,_ as ve}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D5aCeQDf.js";import{V as B}from"./VRow-CXIXhuhq.js";import{a as ye}from"./VDataTable-f5_9vewM.js";import{p as _e}from"./parseInt-BJ5A4_3y.js";import"./VContainer-DqJ8gu3P.js";const Se=E({__name:"SalesByHourChart",props:{paidTimes:{}},setup(g){M.register(O,H,Z,z,K);const d=g,{t:s}=A(),p={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}},f=c(()=>{if(d.paidTimes.length===0)return{labels:[],datasets:[]};const o=new Array(24).fill(0);for(const u of d.paidTimes){const v=u.hour;o[v]++}const i=[],m=[];for(let u=0;u<24;u++)i.push(`${u.toString().padStart(2,"0")}:00`),m.push(o[u]);return{labels:i,datasets:[{label:s("StoreSummaryView.charts.salesCount"),data:m,backgroundColor:"#2196F3"}]}});return(o,i)=>(V(),C(X,{title:l(s)("StoreSummaryView.charts.salesByHour"),"has-data":f.value.labels.length>0,"no-data-text":l(s)("StoreSummaryView.charts.noData")},{default:n(()=>[r(l(j),{data:f.value,options:p},null,8,["data"])]),_:1},8,["title","has-data","no-data-text"]))}}),he=E({__name:"SalesPerDayChart",props:{paidTimes:{}},setup(g){M.register(O,H,Z,z,K);const d=g,{t:s}=A(),p={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}},f=c(()=>{if(d.paidTimes.length===0)return{labels:[],datasets:[]};const o=new Map;for(const S of d.paidTimes){const w=S.toPlainDate().toString();o.set(w,(o.get(w)??0)+1)}const i=Array.from(o.keys()).sort();if(i.length===0)return{labels:[],datasets:[]};const m=[],u=[],v=i[0],x=i[i.length-1];if(!v||!x)return{labels:[],datasets:[]};let _=k.PlainDate.from(v);const T=k.PlainDate.from(x);for(;k.PlainDate.compare(_,T)<=0;){const S=_.toString();m.push(S),u.push(o.get(S)??0),_=_.add({days:1})}return{labels:m,datasets:[{label:s("StoreSummaryView.charts.salesCount"),data:u,backgroundColor:"#4CAF50"}]}});return(o,i)=>(V(),C(X,{title:l(s)("StoreSummaryView.charts.salesPerDay"),"has-data":f.value.labels.length>0,"no-data-text":l(s)("StoreSummaryView.charts.noData")},{default:n(()=>[r(l(j),{data:f.value,options:p},null,8,["data"])]),_:1},8,["title","has-data","no-data-text"]))}}),ge={key:1,class:"text-grey text-center py-8"},$e=E({__name:"StoreSummaryView",props:{eventId:{}},setup(g){const d=g,{t:s}=A(),p=Y(),{getEventById:f}=ce(),o=c(()=>_e(d.eventId,10)),i=I(!1),m=I([]),u=I([]),v=I([]),x=c(()=>[{title:f(o.value)?.name??"...",to:{name:"dashboard",params:{eventId:d.eventId}}},{title:s("StoreSummaryView.title"),disabled:!0}]),_=[{title:s("StoreSummaryView.headers.item"),key:"item",sortable:!0},{title:s("StoreSummaryView.headers.variant"),key:"variant",sortable:!0},{title:s("StoreSummaryView.headers.quantity"),key:"quantity",sortable:!0,align:"end"},{title:s("StoreSummaryView.headers.revenue"),key:"revenue",sortable:!0,align:"end"}],T=c(()=>u.value.filter(t=>t.is_paid&&t.time_paid).sort((t,e)=>{const a=t.time_paid?new Date(t.time_paid).getTime():0,D=e.time_paid?new Date(e.time_paid).getTime():0;return a-D})),S=c(()=>new Set(T.value.map(t=>t.id))),w=c(()=>v.value.filter(t=>S.value.has(t.transaction))),Q=c(()=>{const t=new Map;for(const e of T.value)if(e.time_paid){const a=k.Instant.from(e.time_paid);t.set(e.id,a.toZonedDateTimeISO(de))}return t}),R=c(()=>{const t=[];for(const e of w.value){const a=Q.value.get(e.transaction);a&&t.push(a)}return t}),b=c(()=>{const t=new Map;for(const e of w.value){const a=U(e.item),D=G(e.item,e.variant),y=`${e.item}-${e.variant??"null"}`;t.has(y)||t.set(y,{item:a,variant:D,quantity:0,revenue:0});const N=t.get(y);N.quantity+=1,N.revenue+=parseFloat(e.purchase_price)}return Array.from(t.values()).sort((e,a)=>e.item.localeCompare(a.item))}),F=c(()=>b.value.reduce((t,e)=>t+e.quantity,0)),q=c(()=>b.value.reduce((t,e)=>t+e.revenue,0));function U(t){return m.value.find(a=>a.id===t)?.name??`#${t}`}function G(t,e){if(!e)return"-";const a=m.value.find(y=>y.id===t);return a?a.variants?.find(y=>y.id===e)?.name??`#${e}`:`#${e}`}async function J(){try{const[t,e,a]=await Promise.all([ie({path:{event_pk:o.value},query:{limit:1e3}}),le({path:{event_pk:o.value},query:{limit:1e4}}),ue({path:{event_pk:o.value},query:{limit:1e4}})]);m.value=t.data.results,u.value=e.data.results,v.value=a.data.results}catch(t){p.error(s("StoreSummaryView.loadFailure")),console.error(t)}}function W(t){i.value=!0;try{const e=[["Item","Variant","Quantity Sold","Revenue (EUR)"]];for(const a of b.value)e.push([a.item,a.variant,a.quantity,a.revenue.toFixed(2)]);e.push([]),e.push(["TOTAL","",F.value,q.value.toFixed(2)]),fe(e,"instanssi_sales_summary",t,"Sales Summary"),p.success(s("StoreSummaryView.exportSuccess"))}catch(e){p.error(s("StoreSummaryView.exportFailure")),console.error(e)}finally{i.value=!1}}return(t,e)=>(V(),C(ve,{key:`store-summary-${o.value}`,breadcrumbs:x.value},{default:n(()=>[r(h,null,{default:n(()=>[r(B,null,{default:n(()=>[r(h,{cols:"12",sm:"6"},{default:n(()=>[r(L,{icon:l(ee),value:F.value,label:l(s)("StoreSummaryView.totals.totalItems"),color:"primary"},null,8,["icon","value","label"])]),_:1}),r(h,{cols:"12",sm:"6"},{default:n(()=>[r(L,{icon:l(te),value:`${q.value.toFixed(2)} €`,label:l(s)("StoreSummaryView.totals.totalRevenue"),color:"success"},null,8,["icon","value","label"])]),_:1})]),_:1}),r(B,{class:"mt-2"},{default:n(()=>[r(h,{cols:"12",md:"6"},{default:n(()=>[r(he,{"paid-times":R.value},null,8,["paid-times"])]),_:1}),r(h,{cols:"12",md:"6"},{default:n(()=>[r(Se,{"paid-times":R.value},null,8,["paid-times"])]),_:1})]),_:1}),r(B,{class:"mt-2"},{default:n(()=>[r(h,{cols:"12"},{default:n(()=>[r(ae,null,{default:n(()=>[r(se,{class:"d-flex align-center"},{default:n(()=>[P($(l(s)("StoreSummaryView.title"))+" ",1),r(re),r(pe,{label:l(s)("StoreSummaryView.export"),loading:i.value,size:"small",onExport:W},null,8,["label","loading"])]),_:1}),r(ne,null,{default:n(()=>[b.value.length>0?(V(),C(ye,{key:0,headers:_,items:b.value,density:"compact",class:"elevation-0","items-per-page":-1,"hide-default-footer":""},{"item.revenue":n(({item:a})=>[P($(a.revenue.toFixed(2))+" € ",1)]),_:1},8,["items"])):(V(),oe("div",ge,$(l(s)("StoreSummaryView.noSalesFound")),1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),r(me,{onRefresh:J})]),_:1},8,["breadcrumbs"]))}});export{$e as default};
//# sourceMappingURL=StoreSummaryView-DP40VYaL.js.map
