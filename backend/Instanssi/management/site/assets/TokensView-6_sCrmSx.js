import{d as N,a as E,v as K,U as q,b as D,g as C,W as H,j as e,X as G,w as o,e as n,m as O,f as z,t as $,l as J,s as c,Y as W,Z as X,i as R,V as F,k as U,$ as Z,_ as Q,J as ee,K as te,P,L as ae,D as B,a0 as oe,q as ne,a1 as se,a2 as ie}from"./index-DXU74lGt.js";import{_ as L}from"./DateTimeCell.vue_vue_type_script_setup_true_lang-BMnBYvTq.js";import{V as I,_ as le}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D4jd1chv.js";import{h as re,g as ce}from"./http-BTZWMaMN.js";import{V as ue}from"./VForm-C430u1Uz.js";import{V as de}from"./VAlert-4DnKC4aq.js";import{g as pe}from"./query_tools-BInV9OzK.js";import{d as me}from"./debounce-CQ84CrOG.js";import{V as M}from"./VRow-B94Tto0H.js";import{V as ke}from"./VDataTableServer-CMLVDy59.js";import"./datetime-Dz9fjSvq.js";import"./VContainer-BfWqa_tJ.js";import"./VDataTable-Jd7io3gq.js";const fe={class:"text-caption mt-2 text-medium-emphasis"},ge=N({__name:"TokenCreateDialog",props:{visible:{type:Boolean}},emits:["update:visible","created"],setup(_,{emit:s}){const g=_,m=s,{t:a}=E(),d=K(),p=c(void 0),k=c(!1),u=c(""),v=c(""),b=c(""),V={expiry:"expiry"};function w(t){b.value=t.expiry??""}function y(t){const i=T=>T.toString().padStart(2,"0");return`${t.getFullYear()}-${i(t.getMonth()+1)}-${i(t.getDate())}T${i(t.getHours())}:${i(t.getMinutes())}`}function x(){const t=new Date;return t.setDate(t.getDate()+30),y(t)}function h(){v.value=y(new Date),u.value=x(),b.value=""}q(()=>g.visible,async t=>{if(t){for(h();!(!await p.value?.modal()||await S()););m("update:visible",!1)}});async function S(){if(!u.value)return d.error(a("TokenCreateDialog.expiryRequired")),!1;const t=new Date(u.value);if(isNaN(t.getTime()))return d.error(a("TokenCreateDialog.expiryRequired")),!1;k.value=!0;try{const i=await W({body:{expiry:t.toISOString()}});return d.success(a("TokenCreateDialog.createSuccess")),m("created",i.data.token),!0}catch(i){return re(i,w,d,a("TokenCreateDialog.createFailure"),V),!1}finally{k.value=!1}}return(t,i)=>(D(),C(H,{ref_key:"dialog",ref:p,title:e(a)("TokenCreateDialog.title"),width:500,"ok-text":e(a)("TokenCreateDialog.create"),"ok-icon":e(G),loading:k.value},{default:o(()=>[n(ue,{onSubmit:J(S,["prevent"])},{default:o(()=>[n(O,{modelValue:u.value,"onUpdate:modelValue":i[0]||(i[0]=T=>u.value=T),type:"datetime-local",variant:"outlined",label:e(a)("TokenCreateDialog.labels.expiry"),min:v.value,"error-messages":b.value},null,8,["modelValue","label","min","error-messages"]),z("p",fe,$(e(a)("TokenCreateDialog.expiryHint")),1)]),_:1})]),_:1},8,["title","ok-text","ok-icon","loading"]))}}),ve=N({__name:"TokenCreatedDialog",props:{visible:{type:Boolean},token:{}},emits:["update:visible"],setup(_,{emit:s}){const g=_,m=s,{t:a}=E(),d=K(),p=c(void 0);q(()=>g.visible,async u=>{u&&(await p.value?.modal(),m("update:visible",!1))});async function k(){try{await navigator.clipboard.writeText(g.token),d.success(a("TokenCreatedDialog.copySuccess"))}catch(u){d.error(a("TokenCreatedDialog.copyFailure")),console.error(u)}}return(u,v)=>(D(),C(H,{ref_key:"dialog",ref:p,title:e(a)("TokenCreatedDialog.title"),width:600,"ok-text":e(a)("General.ok"),"ok-icon":e(X),"cancel-text":""},{default:o(()=>[n(de,{type:"warning",variant:"tonal",class:"mb-4"},{default:o(()=>[R($(e(a)("TokenCreatedDialog.warning")),1)]),_:1}),n(O,{"model-value":_.token,variant:"outlined",readonly:"",label:e(a)("TokenCreatedDialog.labels.token"),class:"token-field"},{"append-inner":o(()=>[n(F,{variant:"text",size:"small",title:e(a)("TokenCreatedDialog.copyToClipboard"),onClick:k},{default:o(()=>[n(e(U),{icon:e(Z)},null,8,["icon"])]),_:1},8,["title"])]),_:1},8,["model-value","label"])]),_:1},8,["title","ok-text","ok-icon"]))}}),ye=Q(ve,[["__scopeId","data-v-8d680171"]]),Ue=N({__name:"TokensView",setup(_){const{t:s}=E(),g=ee(te),m=K(),a=ne(),d=[{title:s("TokensView.title"),disabled:!0}],p=c(!1),k=[25,50,100],u=c(k[0]),v=c(0),b=c(1),V=c([]),w=c(null),y=c(!1),x=c(!1),h=c(""),S=[{title:s("TokensView.headers.tokenKey"),sortable:!1,key:"token_key"},{title:s("TokensView.headers.created"),sortable:!0,key:"created"},{title:s("TokensView.headers.expiry"),sortable:!0,key:"expiry"},{title:s("TokensView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function t(){w.value&&i(w.value)}async function i(f){p.value=!0,w.value=f;try{const l=await ie({query:pe(f)});V.value=l.data.results,v.value=l.data.count}catch(l){m.error(s("TokensView.loadFailure")),console.error(l)}finally{p.value=!1}}const T=me(i,250);async function j(f){const l=s("TokensView.confirmDelete",{tokenKey:f.token_key});if(await g.value.confirm(l))try{await se({path:{digest:f.pk}}),t(),m.success(s("TokensView.deleteSuccess"))}catch(A){m.error(ce(A,s("TokensView.deleteFailure"))),console.error(A)}}function Y(f){h.value=f,x.value=!0,t()}return(f,l)=>(D(),C(le,{breadcrumbs:d},{default:o(()=>[n(I,null,{default:o(()=>[n(M,null,{default:o(()=>[e(a).canAdd(e(P).AUTH_TOKEN)?(D(),C(F,{key:0,color:"primary",class:"mb-4",onClick:l[0]||(l[0]=r=>y.value=!0)},{prepend:o(()=>[n(e(U),{icon:e(ae)},null,8,["icon"])]),default:o(()=>[R(" "+$(e(s)("TokensView.newToken")),1)]),_:1})):B("",!0)]),_:1})]),_:1}),n(I,null,{default:o(()=>[n(M,null,{default:o(()=>[n(ke,{"items-per-page":u.value,"onUpdate:itemsPerPage":l[1]||(l[1]=r=>u.value=r),class:"elevation-1 primary","item-value":"pk",density:"compact",headers:S,items:V.value,"items-length":v.value,loading:p.value,page:b.value,"items-per-page-options":k,"no-data-text":e(s)("TokensView.noTokensFound"),"loading-text":e(s)("TokensView.loadingTokens"),"onUpdate:options":e(T)},{"item.token_key":o(({item:r})=>[z("code",null,$(r.token_key)+"...",1)]),"item.created":o(({item:r})=>[n(L,{value:r.created},null,8,["value"])]),"item.expiry":o(({item:r})=>[n(L,{value:r.expiry},null,8,["value"])]),"item.actions":o(({item:r})=>[e(a).canDelete(e(P).AUTH_TOKEN)?(D(),C(F,{key:0,variant:"text",color:"error",size:"small",onClick:A=>j(r)},{default:o(()=>[n(e(U),{icon:e(oe)},null,8,["icon"])]),_:1},8,["onClick"])):B("",!0)]),_:1},8,["items-per-page","items","items-length","loading","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1}),n(ge,{visible:y.value,"onUpdate:visible":l[2]||(l[2]=r=>y.value=r),onCreated:Y},null,8,["visible"]),n(ye,{visible:x.value,"onUpdate:visible":l[3]||(l[3]=r=>x.value=r),token:h.value},null,8,["visible","token"])]),_:1}))}});export{Ue as default};
//# sourceMappingURL=TokensView-6_sCrmSx.js.map
