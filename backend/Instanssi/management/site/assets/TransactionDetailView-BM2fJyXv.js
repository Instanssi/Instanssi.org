import{d as se,a as ie,u as oe,v as ce,o as ue,b as c,g as v,w as a,e as l,A as re,p,aD as w,i as r,t,j as n,B as y,f as e,c as d,D as m,a5 as T,F as G,r as H,P as J,V as I,k as F,c8 as de,c9 as _e,aG as me,aE as fe,aF as ve,q as pe,s as h,I as S,ca as we,cb as ye,cc as he,bM as Ve,H as Te}from"./index-CQkWvXOv.js";import{V as f,_ as be}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D5aCeQDf.js";import{V as b}from"./VRow-CXIXhuhq.js";import{V as D,a as De}from"./VDataTable-f5_9vewM.js";import{p as O}from"./parseInt-BJ5A4_3y.js";import"./VContainer-DqJ8gu3P.js";const ge={class:"font-weight-bold"},ke={class:"font-weight-bold"},Ce={key:0},Ie={class:"font-weight-bold"},xe={class:"font-weight-bold"},Ee={key:1},Re={class:"font-weight-bold"},Pe={key:2},ze={class:"font-weight-bold"},Be={class:"font-weight-bold"},Fe={class:"font-weight-bold"},Se={class:"font-weight-bold"},$e={key:0},je={class:"font-weight-bold"},Ne={class:"font-weight-bold"},Le={key:0},qe={class:"font-weight-bold"},Ae={key:1},Me={class:"font-weight-bold"},Ge={key:2},He={class:"font-weight-bold"},Je={key:0},Oe={class:"font-weight-bold"},Ue={class:"font-weight-bold"},Xe={class:"font-weight-bold"},Ke={class:"font-weight-bold"},Qe={key:1},We={class:"font-weight-bold"},Ye={key:1},Ze={key:0,class:"text-grey"},et={key:0,class:"text-grey"},tt={key:0,class:"text-caption"},at={key:1,class:"text-grey"},ut=se({__name:"TransactionDetailView",props:{eventId:{},id:{}},setup(U){const g=U,{t:s,d:X}=ie(),K=oe(),x=ce(),{getEventById:Q}=Te(),$=pe(),E=h(!1),R=h(!1),P=h(null),C=h(!1),j=h(""),k=S(()=>O(g.eventId,10)),N=S(()=>O(g.id,10)),i=h(null),L=h([]),z=h([]),W=S(()=>[{title:Q(k.value)?.name??"...",to:{name:"dashboard",params:{eventId:g.eventId}}},{title:s("TransactionsView.title"),to:{name:"store-transactions",params:{eventId:g.eventId}}},{title:i.value?`#${i.value.id}`:"...",disabled:!0}]),Y=[{title:s("TransactionDetailView.items.name"),key:"item"},{title:s("TransactionDetailView.items.variant"),key:"variant"},{title:s("TransactionDetailView.items.price"),key:"purchase_price"},{title:s("TransactionDetailView.items.key"),key:"key"},{title:s("TransactionDetailView.items.delivered"),key:"is_delivered"}];function V(u){return u?X(new Date(u),"long"):"-"}function Z(u){return z.value.find(o=>o.id===u)?.name??`#${u}`}function ee(u,_){if(!_)return"-";const o=z.value.find(B=>B.id===u);return o?o.variants?.find(B=>B.id===_)?.name??`#${_}`:`#${_}`}function te(u){j.value=u??"",C.value=!0}async function ae(u){const _=i.value?.receipts.find(o=>o.id===u);if(_){P.value=u;try{await we({path:{event_pk:k.value,id:u},body:{subject:_.subject,mail_to:_.mail_to,mail_from:_.mail_from}}),x.success(s("TransactionDetailView.receipts.resendSuccess")),await A()}catch(o){x.error(s("TransactionDetailView.receipts.resendFailure")),console.error(o)}finally{P.value=null}}}function q(){K.push({name:"store-transactions",params:{eventId:g.eventId}})}async function A(){E.value=!0;try{const u=await ye({path:{event_pk:k.value,id:N.value}});i.value=u.data}catch(u){x.error(s("TransactionDetailView.loadFailure")),console.error(u),q()}finally{E.value=!1}}async function le(){R.value=!0;try{const u=await he({path:{event_pk:k.value},query:{transaction:N.value,limit:1e3}});L.value=u.data.results}catch(u){console.error("Failed to load transaction items:",u)}finally{R.value=!1}}async function ne(){try{const u=await Ve({path:{event_pk:k.value},query:{limit:1e3}});z.value=u.data.results}catch(u){console.error("Failed to load store items:",u)}}return ue(async()=>{await Promise.all([A(),ne()]),await le()}),(u,_)=>(c(),v(be,{breadcrumbs:W.value},{default:a(()=>[E.value?(c(),v(f,{key:0,class:"d-flex justify-center my-8"},{default:a(()=>[l(re,{indeterminate:"",size:"64"})]),_:1})):i.value?(c(),v(f,{key:1},{default:a(()=>[l(b,null,{default:a(()=>[l(f,{cols:"12",md:"6"},{default:a(()=>[l(p,null,{default:a(()=>[l(w,null,{default:a(()=>[r(t(n(s)("TransactionDetailView.sections.customer")),1)]),_:1}),l(y,null,{default:a(()=>[l(D,{density:"compact"},{default:a(()=>[e("tbody",null,[e("tr",null,[e("td",ge,t(n(s)("TransactionDetailView.labels.firstname")),1),e("td",null,t(i.value.firstname),1)]),e("tr",null,[e("td",ke,t(n(s)("TransactionDetailView.labels.lastname")),1),e("td",null,t(i.value.lastname),1)]),i.value.company?(c(),d("tr",Ce,[e("td",Ie,t(n(s)("TransactionDetailView.labels.company")),1),e("td",null,t(i.value.company),1)])):m("",!0),e("tr",null,[e("td",xe,t(n(s)("TransactionDetailView.labels.email")),1),e("td",null,t(i.value.email),1)]),i.value.telephone?(c(),d("tr",Ee,[e("td",Re,t(n(s)("TransactionDetailView.labels.telephone")),1),e("td",null,t(i.value.telephone),1)])):m("",!0),i.value.mobile?(c(),d("tr",Pe,[e("td",ze,t(n(s)("TransactionDetailView.labels.mobile")),1),e("td",null,t(i.value.mobile),1)])):m("",!0)])]),_:1})]),_:1})]),_:1})]),_:1}),l(f,{cols:"12",md:"6"},{default:a(()=>[l(p,null,{default:a(()=>[l(w,null,{default:a(()=>[r(t(n(s)("TransactionDetailView.sections.address")),1)]),_:1}),l(y,null,{default:a(()=>[l(D,{density:"compact"},{default:a(()=>[e("tbody",null,[e("tr",null,[e("td",Be,t(n(s)("TransactionDetailView.labels.street")),1),e("td",null,t(i.value.street),1)]),e("tr",null,[e("td",Fe,t(n(s)("TransactionDetailView.labels.postalcode")),1),e("td",null,t(i.value.postalcode),1)]),e("tr",null,[e("td",Se,t(n(s)("TransactionDetailView.labels.city")),1),e("td",null,t(i.value.city),1)]),i.value.country?(c(),d("tr",$e,[e("td",je,t(n(s)("TransactionDetailView.labels.country")),1),e("td",null,t(i.value.country),1)])):m("",!0)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(b,null,{default:a(()=>[l(f,{cols:"12",md:"6"},{default:a(()=>[l(p,null,{default:a(()=>[l(w,null,{default:a(()=>[r(t(n(s)("TransactionDetailView.sections.status")),1)]),_:1}),l(y,null,{default:a(()=>[l(D,{density:"compact"},{default:a(()=>[e("tbody",null,[e("tr",null,[e("td",Ne,t(n(s)("TransactionDetailView.labels.timeCreated")),1),e("td",null,[r(t(V(i.value.time_created))+" ",1),i.value.time_created&&!i.value.time_pending&&!i.value.time_paid&&!i.value.time_cancelled?(c(),v(T,{key:0,color:"grey",size:"small",class:"ml-2"},{default:a(()=>[r(t(n(s)("TransactionsView.statuses.created")),1)]),_:1})):m("",!0)])]),i.value.time_pending?(c(),d("tr",Le,[e("td",qe,t(n(s)("TransactionDetailView.labels.timePending")),1),e("td",null,[r(t(V(i.value.time_pending))+" ",1),l(T,{color:"warning",size:"small",class:"ml-2"},{default:a(()=>[r(t(n(s)("TransactionsView.statuses.pending")),1)]),_:1})])])):m("",!0),i.value.time_paid?(c(),d("tr",Ae,[e("td",Me,t(n(s)("TransactionDetailView.labels.timePaid")),1),e("td",null,[r(t(V(i.value.time_paid))+" ",1),l(T,{color:"success",size:"small",class:"ml-2"},{default:a(()=>[r(t(n(s)("TransactionsView.statuses.paid")),1)]),_:1})])])):m("",!0),i.value.time_cancelled?(c(),d("tr",Ge,[e("td",He,t(n(s)("TransactionDetailView.labels.timeCancelled")),1),e("td",null,[r(t(V(i.value.time_cancelled))+" ",1),l(T,{color:"error",size:"small",class:"ml-2"},{default:a(()=>[r(t(n(s)("TransactionsView.statuses.cancelled")),1)]),_:1})])])):m("",!0)])]),_:1})]),_:1})]),_:1})]),_:1}),l(f,{cols:"12",md:"6"},{default:a(()=>[l(p,null,{default:a(()=>[l(w,null,{default:a(()=>[r(t(n(s)("TransactionDetailView.sections.payment")),1)]),_:1}),l(y,null,{default:a(()=>[l(D,{density:"compact"},{default:a(()=>[e("tbody",null,[i.value.payment_method_name?(c(),d("tr",Je,[e("td",Oe,t(n(s)("TransactionDetailView.labels.paymentMethod")),1),e("td",null,t(i.value.payment_method_name),1)])):m("",!0),e("tr",null,[e("td",Ue,t(n(s)("TransactionDetailView.labels.total")),1),e("td",null,t(i.value.total_price)+" €",1)]),e("tr",null,[e("td",Xe,t(n(s)("TransactionDetailView.labels.key")),1),e("td",null,[e("code",null,t(i.value.key),1)])]),e("tr",null,[e("td",Ke,t(n(s)("TransactionDetailView.labels.token")),1),e("td",null,[e("code",null,t(i.value.token),1)])]),i.value.information?(c(),d("tr",Qe,[e("td",We,t(n(s)("TransactionDetailView.labels.information")),1),e("td",null,t(i.value.information),1)])):m("",!0)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(b,null,{default:a(()=>[l(f,{cols:"12"},{default:a(()=>[l(p,null,{default:a(()=>[l(w,null,{default:a(()=>[r(t(n(s)("TransactionDetailView.sections.items")),1)]),_:1}),l(y,null,{default:a(()=>[l(De,{headers:Y,items:L.value,loading:R.value,density:"compact",class:"elevation-0"},{"item.item":a(({item:o})=>[r(t(Z(o.item)),1)]),"item.variant":a(({item:o})=>[r(t(ee(o.item,o.variant)),1)]),"item.purchase_price":a(({item:o})=>[r(t(o.purchase_price)+" € ",1)]),"item.is_delivered":a(({item:o})=>[o.is_delivered?(c(),v(T,{key:0,color:"success",size:"small"},{default:a(()=>[r(t(V(o.time_delivered)),1)]),_:2},1024)):(c(),d("span",Ye,"-"))]),_:1},8,["items","loading"])]),_:1})]),_:1})]),_:1})]),_:1}),l(b,null,{default:a(()=>[l(f,{cols:"12"},{default:a(()=>[l(p,null,{default:a(()=>[l(w,null,{default:a(()=>[r(t(n(s)("TransactionDetailView.sections.receipts")),1)]),_:1}),l(y,null,{default:a(()=>[i.value.receipts.length===0?(c(),d("div",Ze,t(n(s)("TransactionDetailView.receipts.noReceipts")),1)):(c(),v(D,{key:1,density:"compact"},{default:a(()=>[e("thead",null,[e("tr",null,[e("th",null,t(n(s)("TransactionDetailView.receipts.subject")),1),e("th",null,t(n(s)("TransactionDetailView.receipts.to")),1),e("th",null,t(n(s)("TransactionDetailView.receipts.from")),1),e("th",null,t(n(s)("TransactionDetailView.receipts.sent")),1),_[2]||(_[2]=e("th",null,null,-1))])]),e("tbody",null,[(c(!0),d(G,null,H(i.value.receipts,o=>(c(),d("tr",{key:o.id},[e("td",null,t(o.subject),1),e("td",null,t(o.mail_to),1),e("td",null,t(o.mail_from),1),e("td",null,[l(T,{color:o.is_sent?"success":"grey",size:"small"},{default:a(()=>[r(t(o.is_sent?V(o.sent):n(s)("TransactionDetailView.receipts.notSent")),1)]),_:2},1032,["color"])]),e("td",null,[n($).canView(n(J).RECEIPT)?(c(),v(I,{key:0,size:"small",variant:"text",onClick:M=>te(o.content)},{prepend:a(()=>[l(n(F),{icon:n(de)},null,8,["icon"])]),default:a(()=>[r(" "+t(n(s)("TransactionDetailView.receipts.view")),1)]),_:1},8,["onClick"])):m("",!0),n($).canChange(n(J).RECEIPT)?(c(),v(I,{key:1,size:"small",variant:"text",loading:P.value===o.id,onClick:M=>ae(o.id)},{prepend:a(()=>[l(n(F),{icon:n(_e)},null,8,["icon"])]),default:a(()=>[r(" "+t(n(s)("TransactionDetailView.receipts.resend")),1)]),_:1},8,["loading","onClick"])):m("",!0)])]))),128))])]),_:1})),l(me,{modelValue:C.value,"onUpdate:modelValue":_[1]||(_[1]=o=>C.value=o),"max-width":"800"},{default:a(()=>[l(p,null,{default:a(()=>[l(w,{class:"d-flex justify-space-between align-center"},{default:a(()=>[e("span",null,t(n(s)("TransactionDetailView.receipts.contentTitle")),1),l(I,{icon:"",variant:"text",density:"compact",onClick:_[0]||(_[0]=o=>C.value=!1)},{default:a(()=>[l(n(F),{icon:n(fe)},null,8,["icon"])]),_:1})]),_:1}),l(ve),l(y,{class:"pa-4",style:{"white-space":"pre-wrap","font-family":"monospace"}},{default:a(()=>[r(t(j.value),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(b,null,{default:a(()=>[l(f,{cols:"12"},{default:a(()=>[l(p,null,{default:a(()=>[l(w,null,{default:a(()=>[r(t(n(s)("TransactionDetailView.sections.events")),1)]),_:1}),l(y,null,{default:a(()=>[i.value.events.length===0?(c(),d("div",et,t(n(s)("TransactionDetailView.events.noEvents")),1)):(c(),v(D,{key:1,density:"compact"},{default:a(()=>[e("thead",null,[e("tr",null,[e("th",null,t(n(s)("TransactionDetailView.events.time")),1),e("th",null,t(n(s)("TransactionDetailView.events.message")),1),e("th",null,t(n(s)("TransactionDetailView.events.data")),1)])]),e("tbody",null,[(c(!0),d(G,null,H(i.value.events,o=>(c(),d("tr",{key:o.id},[e("td",null,t(V(o.created)),1),e("td",null,t(o.message),1),e("td",null,[o.data?(c(),d("code",tt,t(JSON.stringify(o.data)),1)):(c(),d("span",at,"-"))])]))),128))])]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),l(b,null,{default:a(()=>[l(f,null,{default:a(()=>[l(I,{variant:"text",onClick:q},{default:a(()=>[r(t(n(s)("General.cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1})):m("",!0)]),_:1},8,["breadcrumbs"]))}});export{ut as default};
//# sourceMappingURL=TransactionDetailView-BM2fJyXv.js.map
