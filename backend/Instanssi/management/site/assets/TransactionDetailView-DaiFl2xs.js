import{d as ee,a as te,u as ae,v as le,o as ne,b as c,g as v,w as a,e as n,A as se,p,ar as w,i as u,t,j as s,B as y,f as e,c as d,K as m,b4 as V,F as $,r as j,P as ie,V as L,k as oe,bY as ce,q as re,s as b,G as z,bZ as ue,b_ as de,b$ as _e,by as me,E as fe}from"./index-qrfwdmHz.js";import{V as f,_ as ve}from"./LayoutBase.vue_vue_type_script_setup_true_lang-Cgp8Musd.js";import{V as T}from"./VRow-EkiCBxID.js";import{V as g,a as he}from"./VDataTable-BIkGv4dg.js";import{p as q}from"./parseInt-CGa1F4cm.js";import"./VContainer-e74dHNZG.js";import"./filter-50Rnsb7m.js";const pe={class:"font-weight-bold"},we={class:"font-weight-bold"},ye={key:0},Ve={class:"font-weight-bold"},be={class:"font-weight-bold"},Te={key:1},ge={class:"font-weight-bold"},De={key:2},ke={class:"font-weight-bold"},Ce={class:"font-weight-bold"},Ie={class:"font-weight-bold"},xe={class:"font-weight-bold"},Ee={key:0},Pe={class:"font-weight-bold"},Re={class:"font-weight-bold"},ze={key:0},Be={class:"font-weight-bold"},Se={key:1},Fe={class:"font-weight-bold"},Ne={key:2},$e={class:"font-weight-bold"},je={key:0},Le={class:"font-weight-bold"},qe={class:"font-weight-bold"},Ae={class:"font-weight-bold"},Ge={class:"font-weight-bold"},Me={key:1},He={class:"font-weight-bold"},Je={key:1},Ke={key:0,class:"text-grey"},Oe={key:0,class:"text-grey"},Ye={key:0,class:"text-caption"},Ze={key:1,class:"text-grey"},lt=ee({__name:"TransactionDetailView",props:{eventId:{},id:{}},setup(A){const D=A,{t:l,d:G}=te(),M=ae(),C=le(),{getEventById:H}=fe(),J=re(),I=b(!1),x=b(!1),E=b(null),k=z(()=>q(D.eventId,10)),B=z(()=>q(D.id,10)),i=b(null),S=b([]),P=b([]),K=z(()=>[{title:H(k.value)?.name??"...",to:{name:"dashboard",params:{eventId:D.eventId}}},{title:l("TransactionsView.title"),to:{name:"store-transactions",params:{eventId:D.eventId}}},{title:i.value?`#${i.value.id}`:"...",disabled:!0}]),O=[{title:l("TransactionDetailView.items.name"),key:"item"},{title:l("TransactionDetailView.items.variant"),key:"variant"},{title:l("TransactionDetailView.items.price"),key:"purchase_price"},{title:l("TransactionDetailView.items.key"),key:"key"},{title:l("TransactionDetailView.items.delivered"),key:"is_delivered"}];function h(r){return r?G(new Date(r),"long"):"-"}function Y(r){return P.value.find(o=>o.id===r)?.name??`#${r}`}function Z(r,_){if(!_)return"-";const o=P.value.find(R=>R.id===r);return o?o.variants?.find(R=>R.id===_)?.name??`#${_}`:`#${_}`}async function Q(r){const _=i.value?.receipts.find(o=>o.id===r);if(_){E.value=r;try{await ue({path:{event_pk:k.value,id:r},body:{subject:_.subject,mail_to:_.mail_to,mail_from:_.mail_from}}),C.success(l("TransactionDetailView.receipts.resendSuccess")),await N()}catch(o){C.error(l("TransactionDetailView.receipts.resendFailure")),console.error(o)}finally{E.value=null}}}function F(){M.push({name:"store-transactions",params:{eventId:D.eventId}})}async function N(){I.value=!0;try{const r=await de({path:{event_pk:k.value,id:B.value}});i.value=r.data}catch(r){C.error(l("TransactionDetailView.loadFailure")),console.error(r),F()}finally{I.value=!1}}async function U(){x.value=!0;try{const r=await _e({path:{event_pk:k.value},query:{transaction:B.value,limit:1e3}});S.value=r.data.results}catch(r){console.error("Failed to load transaction items:",r)}finally{x.value=!1}}async function W(){try{const r=await me({path:{event_pk:k.value},query:{limit:1e3}});P.value=r.data.results}catch(r){console.error("Failed to load store items:",r)}}return ne(async()=>{await Promise.all([N(),W()]),await U()}),(r,_)=>(c(),v(ve,{breadcrumbs:K.value},{default:a(()=>[I.value?(c(),v(f,{key:0,class:"d-flex justify-center my-8"},{default:a(()=>[n(se,{indeterminate:"",size:"64"})]),_:1})):i.value?(c(),v(f,{key:1},{default:a(()=>[n(T,null,{default:a(()=>[n(f,{cols:"12",md:"6"},{default:a(()=>[n(p,null,{default:a(()=>[n(w,null,{default:a(()=>[u(t(s(l)("TransactionDetailView.sections.customer")),1)]),_:1}),n(y,null,{default:a(()=>[n(g,{density:"compact"},{default:a(()=>[e("tbody",null,[e("tr",null,[e("td",pe,t(s(l)("TransactionDetailView.labels.firstname")),1),e("td",null,t(i.value.firstname),1)]),e("tr",null,[e("td",we,t(s(l)("TransactionDetailView.labels.lastname")),1),e("td",null,t(i.value.lastname),1)]),i.value.company?(c(),d("tr",ye,[e("td",Ve,t(s(l)("TransactionDetailView.labels.company")),1),e("td",null,t(i.value.company),1)])):m("",!0),e("tr",null,[e("td",be,t(s(l)("TransactionDetailView.labels.email")),1),e("td",null,t(i.value.email),1)]),i.value.telephone?(c(),d("tr",Te,[e("td",ge,t(s(l)("TransactionDetailView.labels.telephone")),1),e("td",null,t(i.value.telephone),1)])):m("",!0),i.value.mobile?(c(),d("tr",De,[e("td",ke,t(s(l)("TransactionDetailView.labels.mobile")),1),e("td",null,t(i.value.mobile),1)])):m("",!0)])]),_:1})]),_:1})]),_:1})]),_:1}),n(f,{cols:"12",md:"6"},{default:a(()=>[n(p,null,{default:a(()=>[n(w,null,{default:a(()=>[u(t(s(l)("TransactionDetailView.sections.address")),1)]),_:1}),n(y,null,{default:a(()=>[n(g,{density:"compact"},{default:a(()=>[e("tbody",null,[e("tr",null,[e("td",Ce,t(s(l)("TransactionDetailView.labels.street")),1),e("td",null,t(i.value.street),1)]),e("tr",null,[e("td",Ie,t(s(l)("TransactionDetailView.labels.postalcode")),1),e("td",null,t(i.value.postalcode),1)]),e("tr",null,[e("td",xe,t(s(l)("TransactionDetailView.labels.city")),1),e("td",null,t(i.value.city),1)]),i.value.country?(c(),d("tr",Ee,[e("td",Pe,t(s(l)("TransactionDetailView.labels.country")),1),e("td",null,t(i.value.country),1)])):m("",!0)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n(T,null,{default:a(()=>[n(f,{cols:"12",md:"6"},{default:a(()=>[n(p,null,{default:a(()=>[n(w,null,{default:a(()=>[u(t(s(l)("TransactionDetailView.sections.status")),1)]),_:1}),n(y,null,{default:a(()=>[n(g,{density:"compact"},{default:a(()=>[e("tbody",null,[e("tr",null,[e("td",Re,t(s(l)("TransactionDetailView.labels.timeCreated")),1),e("td",null,[u(t(h(i.value.time_created))+" ",1),i.value.time_created&&!i.value.time_pending&&!i.value.time_paid&&!i.value.time_cancelled?(c(),v(V,{key:0,color:"grey",size:"small",class:"ml-2"},{default:a(()=>[u(t(s(l)("TransactionsView.statuses.created")),1)]),_:1})):m("",!0)])]),i.value.time_pending?(c(),d("tr",ze,[e("td",Be,t(s(l)("TransactionDetailView.labels.timePending")),1),e("td",null,[u(t(h(i.value.time_pending))+" ",1),n(V,{color:"warning",size:"small",class:"ml-2"},{default:a(()=>[u(t(s(l)("TransactionsView.statuses.pending")),1)]),_:1})])])):m("",!0),i.value.time_paid?(c(),d("tr",Se,[e("td",Fe,t(s(l)("TransactionDetailView.labels.timePaid")),1),e("td",null,[u(t(h(i.value.time_paid))+" ",1),n(V,{color:"success",size:"small",class:"ml-2"},{default:a(()=>[u(t(s(l)("TransactionsView.statuses.paid")),1)]),_:1})])])):m("",!0),i.value.time_cancelled?(c(),d("tr",Ne,[e("td",$e,t(s(l)("TransactionDetailView.labels.timeCancelled")),1),e("td",null,[u(t(h(i.value.time_cancelled))+" ",1),n(V,{color:"error",size:"small",class:"ml-2"},{default:a(()=>[u(t(s(l)("TransactionsView.statuses.cancelled")),1)]),_:1})])])):m("",!0)])]),_:1})]),_:1})]),_:1})]),_:1}),n(f,{cols:"12",md:"6"},{default:a(()=>[n(p,null,{default:a(()=>[n(w,null,{default:a(()=>[u(t(s(l)("TransactionDetailView.sections.payment")),1)]),_:1}),n(y,null,{default:a(()=>[n(g,{density:"compact"},{default:a(()=>[e("tbody",null,[i.value.payment_method_name?(c(),d("tr",je,[e("td",Le,t(s(l)("TransactionDetailView.labels.paymentMethod")),1),e("td",null,t(i.value.payment_method_name),1)])):m("",!0),e("tr",null,[e("td",qe,t(s(l)("TransactionDetailView.labels.total")),1),e("td",null,t(i.value.total_price)+" €",1)]),e("tr",null,[e("td",Ae,t(s(l)("TransactionDetailView.labels.key")),1),e("td",null,[e("code",null,t(i.value.key),1)])]),e("tr",null,[e("td",Ge,t(s(l)("TransactionDetailView.labels.token")),1),e("td",null,[e("code",null,t(i.value.token),1)])]),i.value.information?(c(),d("tr",Me,[e("td",He,t(s(l)("TransactionDetailView.labels.information")),1),e("td",null,t(i.value.information),1)])):m("",!0)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n(T,null,{default:a(()=>[n(f,{cols:"12"},{default:a(()=>[n(p,null,{default:a(()=>[n(w,null,{default:a(()=>[u(t(s(l)("TransactionDetailView.sections.items")),1)]),_:1}),n(y,null,{default:a(()=>[n(he,{headers:O,items:S.value,loading:x.value,density:"compact",class:"elevation-0"},{"item.item":a(({item:o})=>[u(t(Y(o.item)),1)]),"item.variant":a(({item:o})=>[u(t(Z(o.item,o.variant)),1)]),"item.purchase_price":a(({item:o})=>[u(t(o.purchase_price)+" € ",1)]),"item.is_delivered":a(({item:o})=>[o.is_delivered?(c(),v(V,{key:0,color:"success",size:"small"},{default:a(()=>[u(t(h(o.time_delivered)),1)]),_:2},1024)):(c(),d("span",Je,"-"))]),_:1},8,["items","loading"])]),_:1})]),_:1})]),_:1})]),_:1}),n(T,null,{default:a(()=>[n(f,{cols:"12"},{default:a(()=>[n(p,null,{default:a(()=>[n(w,null,{default:a(()=>[u(t(s(l)("TransactionDetailView.sections.receipts")),1)]),_:1}),n(y,null,{default:a(()=>[i.value.receipts.length===0?(c(),d("div",Ke,t(s(l)("TransactionDetailView.receipts.noReceipts")),1)):(c(),v(g,{key:1,density:"compact"},{default:a(()=>[e("thead",null,[e("tr",null,[e("th",null,t(s(l)("TransactionDetailView.receipts.subject")),1),e("th",null,t(s(l)("TransactionDetailView.receipts.to")),1),e("th",null,t(s(l)("TransactionDetailView.receipts.from")),1),e("th",null,t(s(l)("TransactionDetailView.receipts.sent")),1),_[0]||(_[0]=e("th",null,null,-1))])]),e("tbody",null,[(c(!0),d($,null,j(i.value.receipts,o=>(c(),d("tr",{key:o.id},[e("td",null,t(o.subject),1),e("td",null,t(o.mail_to),1),e("td",null,t(o.mail_from),1),e("td",null,[n(V,{color:o.is_sent?"success":"grey",size:"small"},{default:a(()=>[u(t(o.is_sent?h(o.sent):s(l)("TransactionDetailView.receipts.notSent")),1)]),_:2},1032,["color"])]),e("td",null,[s(J).canChange(s(ie).RECEIPT)?(c(),v(L,{key:0,size:"small",variant:"text",loading:E.value===o.id,onClick:X=>Q(o.id)},{prepend:a(()=>[n(s(oe),{icon:s(ce)},null,8,["icon"])]),default:a(()=>[u(" "+t(s(l)("TransactionDetailView.receipts.resend")),1)]),_:1},8,["loading","onClick"])):m("",!0)])]))),128))])]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),n(T,null,{default:a(()=>[n(f,{cols:"12"},{default:a(()=>[n(p,null,{default:a(()=>[n(w,null,{default:a(()=>[u(t(s(l)("TransactionDetailView.sections.events")),1)]),_:1}),n(y,null,{default:a(()=>[i.value.events.length===0?(c(),d("div",Oe,t(s(l)("TransactionDetailView.events.noEvents")),1)):(c(),v(g,{key:1,density:"compact"},{default:a(()=>[e("thead",null,[e("tr",null,[e("th",null,t(s(l)("TransactionDetailView.events.time")),1),e("th",null,t(s(l)("TransactionDetailView.events.message")),1),e("th",null,t(s(l)("TransactionDetailView.events.data")),1)])]),e("tbody",null,[(c(!0),d($,null,j(i.value.events,o=>(c(),d("tr",{key:o.id},[e("td",null,t(h(o.created)),1),e("td",null,t(o.message),1),e("td",null,[o.data?(c(),d("code",Ye,t(JSON.stringify(o.data)),1)):(c(),d("span",Ze,"-"))])]))),128))])]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),n(T,null,{default:a(()=>[n(f,null,{default:a(()=>[n(L,{variant:"text",onClick:F},{default:a(()=>[u(t(s(l)("General.cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1})):m("",!0)]),_:1},8,["breadcrumbs"]))}});export{lt as default};
//# sourceMappingURL=TransactionDetailView-DaiFl2xs.js.map
