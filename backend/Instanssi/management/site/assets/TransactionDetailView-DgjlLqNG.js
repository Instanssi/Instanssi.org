import{d as ee,a as te,u as ae,v as le,o as ne,b as c,g as v,w as a,e as n,A as se,p,aB as w,i as u,t,j as s,B as y,f as e,c as d,D as m,a4 as V,F as j,r as $,P as ie,V as L,k as oe,c2 as ce,q as re,s as b,I as R,c3 as ue,c4 as de,c5 as _e,bE as me,H as fe}from"./index-DXU74lGt.js";import{V as f,_ as ve}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D4jd1chv.js";import{V as T}from"./VRow-B94Tto0H.js";import{V as g,a as he}from"./VDataTable-Jd7io3gq.js";import{p as q}from"./parseInt-Bzw_2rWL.js";import"./VContainer-BfWqa_tJ.js";const pe={class:"font-weight-bold"},we={class:"font-weight-bold"},ye={key:0},Ve={class:"font-weight-bold"},be={class:"font-weight-bold"},Te={key:1},ge={class:"font-weight-bold"},De={key:2},ke={class:"font-weight-bold"},Ie={class:"font-weight-bold"},Ce={class:"font-weight-bold"},xe={class:"font-weight-bold"},Ee={key:0},Be={class:"font-weight-bold"},Pe={class:"font-weight-bold"},Re={key:0},ze={class:"font-weight-bold"},Se={key:1},Fe={class:"font-weight-bold"},Ne={key:2},je={class:"font-weight-bold"},$e={key:0},Le={class:"font-weight-bold"},qe={class:"font-weight-bold"},Ae={class:"font-weight-bold"},He={class:"font-weight-bold"},Me={key:1},Ge={class:"font-weight-bold"},Je={key:1},Oe={key:0,class:"text-grey"},Ke={key:0,class:"text-grey"},Qe={key:0,class:"text-caption"},Ue={key:1,class:"text-grey"},at=ee({__name:"TransactionDetailView",props:{eventId:{},id:{}},setup(A){const D=A,{t:l,d:H}=te(),M=ae(),I=le(),{getEventById:G}=fe(),J=re(),C=b(!1),x=b(!1),E=b(null),k=R(()=>q(D.eventId,10)),z=R(()=>q(D.id,10)),i=b(null),S=b([]),B=b([]),O=R(()=>[{title:G(k.value)?.name??"...",to:{name:"dashboard",params:{eventId:D.eventId}}},{title:l("TransactionsView.title"),to:{name:"store-transactions",params:{eventId:D.eventId}}},{title:i.value?`#${i.value.id}`:"...",disabled:!0}]),K=[{title:l("TransactionDetailView.items.name"),key:"item"},{title:l("TransactionDetailView.items.variant"),key:"variant"},{title:l("TransactionDetailView.items.price"),key:"purchase_price"},{title:l("TransactionDetailView.items.key"),key:"key"},{title:l("TransactionDetailView.items.delivered"),key:"is_delivered"}];function h(r){return r?H(new Date(r),"long"):"-"}function Q(r){return B.value.find(o=>o.id===r)?.name??`#${r}`}function U(r,_){if(!_)return"-";const o=B.value.find(P=>P.id===r);return o?o.variants?.find(P=>P.id===_)?.name??`#${_}`:`#${_}`}async function W(r){const _=i.value?.receipts.find(o=>o.id===r);if(_){E.value=r;try{await ue({path:{event_pk:k.value,id:r},body:{subject:_.subject,mail_to:_.mail_to,mail_from:_.mail_from}}),I.success(l("TransactionDetailView.receipts.resendSuccess")),await N()}catch(o){I.error(l("TransactionDetailView.receipts.resendFailure")),console.error(o)}finally{E.value=null}}}function F(){M.push({name:"store-transactions",params:{eventId:D.eventId}})}async function N(){C.value=!0;try{const r=await de({path:{event_pk:k.value,id:z.value}});i.value=r.data}catch(r){I.error(l("TransactionDetailView.loadFailure")),console.error(r),F()}finally{C.value=!1}}async function X(){x.value=!0;try{const r=await _e({path:{event_pk:k.value},query:{transaction:z.value,limit:1e3}});S.value=r.data.results}catch(r){console.error("Failed to load transaction items:",r)}finally{x.value=!1}}async function Y(){try{const r=await me({path:{event_pk:k.value},query:{limit:1e3}});B.value=r.data.results}catch(r){console.error("Failed to load store items:",r)}}return ne(async()=>{await Promise.all([N(),Y()]),await X()}),(r,_)=>(c(),v(ve,{breadcrumbs:O.value},{default:a(()=>[C.value?(c(),v(f,{key:0,class:"d-flex justify-center my-8"},{default:a(()=>[n(se,{indeterminate:"",size:"64"})]),_:1})):i.value?(c(),v(f,{key:1},{default:a(()=>[n(T,null,{default:a(()=>[n(f,{cols:"12",md:"6"},{default:a(()=>[n(p,null,{default:a(()=>[n(w,null,{default:a(()=>[u(t(s(l)("TransactionDetailView.sections.customer")),1)]),_:1}),n(y,null,{default:a(()=>[n(g,{density:"compact"},{default:a(()=>[e("tbody",null,[e("tr",null,[e("td",pe,t(s(l)("TransactionDetailView.labels.firstname")),1),e("td",null,t(i.value.firstname),1)]),e("tr",null,[e("td",we,t(s(l)("TransactionDetailView.labels.lastname")),1),e("td",null,t(i.value.lastname),1)]),i.value.company?(c(),d("tr",ye,[e("td",Ve,t(s(l)("TransactionDetailView.labels.company")),1),e("td",null,t(i.value.company),1)])):m("",!0),e("tr",null,[e("td",be,t(s(l)("TransactionDetailView.labels.email")),1),e("td",null,t(i.value.email),1)]),i.value.telephone?(c(),d("tr",Te,[e("td",ge,t(s(l)("TransactionDetailView.labels.telephone")),1),e("td",null,t(i.value.telephone),1)])):m("",!0),i.value.mobile?(c(),d("tr",De,[e("td",ke,t(s(l)("TransactionDetailView.labels.mobile")),1),e("td",null,t(i.value.mobile),1)])):m("",!0)])]),_:1})]),_:1})]),_:1})]),_:1}),n(f,{cols:"12",md:"6"},{default:a(()=>[n(p,null,{default:a(()=>[n(w,null,{default:a(()=>[u(t(s(l)("TransactionDetailView.sections.address")),1)]),_:1}),n(y,null,{default:a(()=>[n(g,{density:"compact"},{default:a(()=>[e("tbody",null,[e("tr",null,[e("td",Ie,t(s(l)("TransactionDetailView.labels.street")),1),e("td",null,t(i.value.street),1)]),e("tr",null,[e("td",Ce,t(s(l)("TransactionDetailView.labels.postalcode")),1),e("td",null,t(i.value.postalcode),1)]),e("tr",null,[e("td",xe,t(s(l)("TransactionDetailView.labels.city")),1),e("td",null,t(i.value.city),1)]),i.value.country?(c(),d("tr",Ee,[e("td",Be,t(s(l)("TransactionDetailView.labels.country")),1),e("td",null,t(i.value.country),1)])):m("",!0)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n(T,null,{default:a(()=>[n(f,{cols:"12",md:"6"},{default:a(()=>[n(p,null,{default:a(()=>[n(w,null,{default:a(()=>[u(t(s(l)("TransactionDetailView.sections.status")),1)]),_:1}),n(y,null,{default:a(()=>[n(g,{density:"compact"},{default:a(()=>[e("tbody",null,[e("tr",null,[e("td",Pe,t(s(l)("TransactionDetailView.labels.timeCreated")),1),e("td",null,[u(t(h(i.value.time_created))+" ",1),i.value.time_created&&!i.value.time_pending&&!i.value.time_paid&&!i.value.time_cancelled?(c(),v(V,{key:0,color:"grey",size:"small",class:"ml-2"},{default:a(()=>[u(t(s(l)("TransactionsView.statuses.created")),1)]),_:1})):m("",!0)])]),i.value.time_pending?(c(),d("tr",Re,[e("td",ze,t(s(l)("TransactionDetailView.labels.timePending")),1),e("td",null,[u(t(h(i.value.time_pending))+" ",1),n(V,{color:"warning",size:"small",class:"ml-2"},{default:a(()=>[u(t(s(l)("TransactionsView.statuses.pending")),1)]),_:1})])])):m("",!0),i.value.time_paid?(c(),d("tr",Se,[e("td",Fe,t(s(l)("TransactionDetailView.labels.timePaid")),1),e("td",null,[u(t(h(i.value.time_paid))+" ",1),n(V,{color:"success",size:"small",class:"ml-2"},{default:a(()=>[u(t(s(l)("TransactionsView.statuses.paid")),1)]),_:1})])])):m("",!0),i.value.time_cancelled?(c(),d("tr",Ne,[e("td",je,t(s(l)("TransactionDetailView.labels.timeCancelled")),1),e("td",null,[u(t(h(i.value.time_cancelled))+" ",1),n(V,{color:"error",size:"small",class:"ml-2"},{default:a(()=>[u(t(s(l)("TransactionsView.statuses.cancelled")),1)]),_:1})])])):m("",!0)])]),_:1})]),_:1})]),_:1})]),_:1}),n(f,{cols:"12",md:"6"},{default:a(()=>[n(p,null,{default:a(()=>[n(w,null,{default:a(()=>[u(t(s(l)("TransactionDetailView.sections.payment")),1)]),_:1}),n(y,null,{default:a(()=>[n(g,{density:"compact"},{default:a(()=>[e("tbody",null,[i.value.payment_method_name?(c(),d("tr",$e,[e("td",Le,t(s(l)("TransactionDetailView.labels.paymentMethod")),1),e("td",null,t(i.value.payment_method_name),1)])):m("",!0),e("tr",null,[e("td",qe,t(s(l)("TransactionDetailView.labels.total")),1),e("td",null,t(i.value.total_price)+" €",1)]),e("tr",null,[e("td",Ae,t(s(l)("TransactionDetailView.labels.key")),1),e("td",null,[e("code",null,t(i.value.key),1)])]),e("tr",null,[e("td",He,t(s(l)("TransactionDetailView.labels.token")),1),e("td",null,[e("code",null,t(i.value.token),1)])]),i.value.information?(c(),d("tr",Me,[e("td",Ge,t(s(l)("TransactionDetailView.labels.information")),1),e("td",null,t(i.value.information),1)])):m("",!0)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n(T,null,{default:a(()=>[n(f,{cols:"12"},{default:a(()=>[n(p,null,{default:a(()=>[n(w,null,{default:a(()=>[u(t(s(l)("TransactionDetailView.sections.items")),1)]),_:1}),n(y,null,{default:a(()=>[n(he,{headers:K,items:S.value,loading:x.value,density:"compact",class:"elevation-0"},{"item.item":a(({item:o})=>[u(t(Q(o.item)),1)]),"item.variant":a(({item:o})=>[u(t(U(o.item,o.variant)),1)]),"item.purchase_price":a(({item:o})=>[u(t(o.purchase_price)+" € ",1)]),"item.is_delivered":a(({item:o})=>[o.is_delivered?(c(),v(V,{key:0,color:"success",size:"small"},{default:a(()=>[u(t(h(o.time_delivered)),1)]),_:2},1024)):(c(),d("span",Je,"-"))]),_:1},8,["items","loading"])]),_:1})]),_:1})]),_:1})]),_:1}),n(T,null,{default:a(()=>[n(f,{cols:"12"},{default:a(()=>[n(p,null,{default:a(()=>[n(w,null,{default:a(()=>[u(t(s(l)("TransactionDetailView.sections.receipts")),1)]),_:1}),n(y,null,{default:a(()=>[i.value.receipts.length===0?(c(),d("div",Oe,t(s(l)("TransactionDetailView.receipts.noReceipts")),1)):(c(),v(g,{key:1,density:"compact"},{default:a(()=>[e("thead",null,[e("tr",null,[e("th",null,t(s(l)("TransactionDetailView.receipts.subject")),1),e("th",null,t(s(l)("TransactionDetailView.receipts.to")),1),e("th",null,t(s(l)("TransactionDetailView.receipts.from")),1),e("th",null,t(s(l)("TransactionDetailView.receipts.sent")),1),_[0]||(_[0]=e("th",null,null,-1))])]),e("tbody",null,[(c(!0),d(j,null,$(i.value.receipts,o=>(c(),d("tr",{key:o.id},[e("td",null,t(o.subject),1),e("td",null,t(o.mail_to),1),e("td",null,t(o.mail_from),1),e("td",null,[n(V,{color:o.is_sent?"success":"grey",size:"small"},{default:a(()=>[u(t(o.is_sent?h(o.sent):s(l)("TransactionDetailView.receipts.notSent")),1)]),_:2},1032,["color"])]),e("td",null,[s(J).canChange(s(ie).RECEIPT)?(c(),v(L,{key:0,size:"small",variant:"text",loading:E.value===o.id,onClick:Z=>W(o.id)},{prepend:a(()=>[n(s(oe),{icon:s(ce)},null,8,["icon"])]),default:a(()=>[u(" "+t(s(l)("TransactionDetailView.receipts.resend")),1)]),_:1},8,["loading","onClick"])):m("",!0)])]))),128))])]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),n(T,null,{default:a(()=>[n(f,{cols:"12"},{default:a(()=>[n(p,null,{default:a(()=>[n(w,null,{default:a(()=>[u(t(s(l)("TransactionDetailView.sections.events")),1)]),_:1}),n(y,null,{default:a(()=>[i.value.events.length===0?(c(),d("div",Ke,t(s(l)("TransactionDetailView.events.noEvents")),1)):(c(),v(g,{key:1,density:"compact"},{default:a(()=>[e("thead",null,[e("tr",null,[e("th",null,t(s(l)("TransactionDetailView.events.time")),1),e("th",null,t(s(l)("TransactionDetailView.events.message")),1),e("th",null,t(s(l)("TransactionDetailView.events.data")),1)])]),e("tbody",null,[(c(!0),d(j,null,$(i.value.events,o=>(c(),d("tr",{key:o.id},[e("td",null,t(h(o.created)),1),e("td",null,t(o.message),1),e("td",null,[o.data?(c(),d("code",Qe,t(JSON.stringify(o.data)),1)):(c(),d("span",Ue,"-"))])]))),128))])]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),n(T,null,{default:a(()=>[n(f,null,{default:a(()=>[n(L,{variant:"text",onClick:F},{default:a(()=>[u(t(s(l)("General.cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1})):m("",!0)]),_:1},8,["breadcrumbs"]))}});export{at as default};
//# sourceMappingURL=TransactionDetailView-DgjlLqNG.js.map
