import{d as ee,a as te,v as ae,Z as N,o as se,b as ne,g as ie,w as l,e as o,j as p,a2 as oe,m as re,i as L,t as D,G as w,s as r,by as B,bX as le,b$ as F,E as me}from"./index-CY4kEXQX.js";import{_ as ce}from"./BooleanIcon.vue_vue_type_script_setup_true_lang-DXbGa2AH.js";import{_ as ue,d as de}from"./spreadsheet-B7JNMGa3.js";import{V as q,_ as pe}from"./LayoutBase.vue_vue_type_script_setup_true_lang-mBpG7FYr.js";import{_ as ve}from"./PriceCell.vue_vue_type_script_setup_true_lang-ZuN5Uun4.js";import{d as fe,V as ye,g as _e}from"./query_tools-D1ttn1y9.js";import{V as U}from"./VRow-Dt2mDaW0.js";import{p as ge}from"./parseInt-DjOfejfT.js";import"./VContainer-DyZfstE_.js";import"./VDataTable-K-Y489M6.js";import"./filter-B_C-txEo.js";const Ee=ee({__name:"TransactionItemsView",props:{eventId:{}},setup(M){const T=M,{t:s}=te(),y=ae(),{getEventById:R}=me(),m=w(()=>ge(T.eventId,10)),_=r(!1),g=r(!1),O=w(()=>[{title:R(m.value)?.name??"...",to:{name:"dashboard",params:{eventId:T.eventId}}},{title:s("TransactionItemsView.title"),disabled:!0}]),x=[25,50,100],I=r(x[0]),k=r(0),A=r(1),P=r([]),v=r([]),f=r(""),c=r(null),V=r(null),G=[{title:s("TransactionItemsView.headers.id"),sortable:!0,key:"id"},{title:s("TransactionItemsView.headers.transactionId"),sortable:!0,key:"transaction"},{title:s("TransactionItemsView.headers.item"),sortable:!1,key:"item"},{title:s("TransactionItemsView.headers.variant"),sortable:!1,key:"variant"},{title:s("TransactionItemsView.headers.price"),sortable:!0,key:"purchase_price"},{title:s("TransactionItemsView.headers.key"),sortable:!1,key:"key"},{title:s("TransactionItemsView.headers.delivered"),sortable:!1,key:"is_delivered"}],j=w(()=>[{title:s("TransactionItemsView.allItems"),value:null},...v.value.map(n=>({title:n.name,value:n.id}))]);function z(n){return v.value.find(a=>a.id===n)?.name??`#${n}`}function X(n,t){if(!t)return"-";const a=v.value.find(u=>u.id===n);return a?a.variants?.find(u=>u.id===t)?.name??`#${t}`:`#${t}`}async function S(){try{const n=await B({path:{event_pk:m.value},query:{limit:1e3}});v.value=n.data.results}catch(n){console.error("Failed to load store items:",n)}}async function Y(n){_.value=!0,V.value=n;try{const t=await F({path:{event_pk:m.value},query:{..._e(n),...c.value?{item:c.value}:{}}});P.value=t.data.results,k.value=t.data.count}catch(t){y.error(s("TransactionItemsView.loadFailure")),console.error(t)}finally{_.value=!1}}const h=fe(Y,250);N(c,()=>{V.value&&h(V.value)});function Z(){c.value=null,f.value="",S(),h({page:1,itemsPerPage:I.value??25,sortBy:[],groupBy:[],search:""})}N(m,Z);async function H(n){g.value=!0;try{const[t,a,$]=await Promise.all([B({path:{event_pk:m.value},query:{limit:1e3}}),le({path:{event_pk:m.value},query:{limit:1e4}}),F({path:{event_pk:m.value},query:{limit:1e4}})]),u=t.data.results,J=a.data.results,K=$.data.results,C=new Map;for(const i of J)C.set(i.id,i);const Q=i=>u.find(d=>d.id===i)?.name??`#${i}`,W=(i,e)=>{if(!e)return"";const d=u.find(b=>b.id===i);return d?d.variants?.find(b=>b.id===e)?.name??`#${e}`:`#${e}`},E=[["Item ID","Product","Variant","Purchase Price","Original Price","Delivered","Delivery Time","Transaction ID","First Name","Last Name","Company","Email","Telephone","Mobile","Street","Postal Code","City","Country","Status","Created","Paid","Total Price"]];for(const i of K){const e=C.get(i.transaction),d=e?.is_paid?"Paid":e?.is_cancelled?"Cancelled":e?.is_pending?"Pending":"Created";E.push([i.id,Q(i.item),W(i.item,i.variant),i.purchase_price,i.original_price,i.is_delivered?"Yes":"No",i.time_delivered??"",e?.id??"",e?.firstname??"",e?.lastname??"",e?.company??"",e?.email??"",e?.telephone??"",e?.mobile??"",e?.street??"",e?.postalcode??"",e?.city??"",e?.country??"",d,e?.time_created??"",e?.time_paid??"",e?.total_price??""])}de(E,"instanssi_transaction_items",n,"Transaction Items"),y.success(s("TransactionItemsView.exportSuccess"))}catch(t){y.error(s("TransactionItemsView.exportFailure")),console.error(t)}finally{g.value=!1}}return se(()=>{S()}),(n,t)=>(ne(),ie(pe,{key:`transaction-items-${m.value}`,breadcrumbs:O.value},{default:l(()=>[o(q,null,{default:l(()=>[o(U,null,{default:l(()=>[o(ue,{label:p(s)("TransactionItemsView.export"),loading:g.value,onExport:H},null,8,["label","loading"]),o(oe,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=a=>c.value=a),items:j.value,variant:"outlined",density:"compact",label:p(s)("TransactionItemsView.filterByItem"),style:{"max-width":"300px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","items","label"]),o(re,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=a=>f.value=a),variant:"outlined",density:"compact",label:p(s)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),o(q,null,{default:l(()=>[o(U,null,{default:l(()=>[o(ye,{"items-per-page":I.value,"onUpdate:itemsPerPage":t[2]||(t[2]=a=>I.value=a),class:"elevation-1 primary","item-value":"id",density:"compact",headers:G,items:P.value,"items-length":k.value,loading:_.value,search:f.value,page:A.value,"items-per-page-options":x,"no-data-text":p(s)("TransactionItemsView.noItemsFound"),"loading-text":p(s)("TransactionItemsView.loadingItems"),"onUpdate:options":p(h)},{"item.item":l(({item:a})=>[L(D(z(a.item)),1)]),"item.variant":l(({item:a})=>[L(D(X(a.item,a.variant)),1)]),"item.purchase_price":l(({item:a})=>[o(ve,{value:a.purchase_price},null,8,["value"])]),"item.is_delivered":l(({item:a})=>[o(ce,{value:a.is_delivered},null,8,["value"])]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Ee as default};
//# sourceMappingURL=TransactionItemsView-BsmlBdrW.js.map
