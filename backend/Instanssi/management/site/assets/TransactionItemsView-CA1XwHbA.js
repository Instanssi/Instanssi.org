import{d as W,a as Z,v as ee,a1 as te,o as ae,b as se,g as ne,w as l,e as o,j as u,a2 as ie,m as oe,i as E,t as N,G as b,s as r,by as L,bX as re,b$ as D,E as le}from"./index-BSHMv_df.js";import{_ as me}from"./BooleanIcon.vue_vue_type_script_setup_true_lang-COcceYO8.js";import{_ as ce,d as de}from"./spreadsheet-BhwIOQCz.js";import{V as F,_ as ue}from"./LayoutBase.vue_vue_type_script_setup_true_lang-C8aKWyeJ.js";import{_ as pe}from"./PriceCell.vue_vue_type_script_setup_true_lang-B8eOis0Q.js";import{d as ve,V as fe,g as _e}from"./query_tools-Co6bP9h2.js";import{V as q}from"./VRow-BUBfmFS3.js";import{p as ye}from"./parseInt-3OpbdfxQ.js";import"./VContainer--EpXOfw5.js";import"./VDataTable-CpUosGjF.js";import"./filter-C6Uu0LOB.js";const Ce=W({__name:"TransactionItemsView",props:{eventId:{}},setup(U){const h=U,{t:s}=Z(),f=ee(),{getEventById:B}=le(),m=b(()=>ye(h.eventId,10)),_=r(!1),y=r(!1),M=b(()=>[{title:B(m.value)?.name??"...",to:{name:"dashboard",params:{eventId:h.eventId}}},{title:s("TransactionItemsView.title"),disabled:!0}]),w=[25,50,100],T=r(w[0]),x=r(0),R=r(1),k=r([]),v=r([]),I=r(""),p=r(null),V=r(null),O=[{title:s("TransactionItemsView.headers.id"),sortable:!0,key:"id"},{title:s("TransactionItemsView.headers.transactionId"),sortable:!0,key:"transaction"},{title:s("TransactionItemsView.headers.item"),sortable:!1,key:"item"},{title:s("TransactionItemsView.headers.variant"),sortable:!1,key:"variant"},{title:s("TransactionItemsView.headers.price"),sortable:!0,key:"purchase_price"},{title:s("TransactionItemsView.headers.key"),sortable:!1,key:"key"},{title:s("TransactionItemsView.headers.delivered"),sortable:!1,key:"is_delivered"}],A=b(()=>[{title:s("TransactionItemsView.allItems"),value:null},...v.value.map(n=>({title:n.name,value:n.id}))]);function G(n){return v.value.find(a=>a.id===n)?.name??`#${n}`}function j(n,t){if(!t)return"-";const a=v.value.find(c=>c.id===n);return a?a.variants?.find(c=>c.id===t)?.name??`#${t}`:`#${t}`}async function z(){try{const n=await L({path:{event_pk:m.value},query:{limit:1e3}});v.value=n.data.results}catch(n){console.error("Failed to load store items:",n)}}async function X(n){_.value=!0,V.value=n;try{const t=await D({path:{event_pk:m.value},query:{..._e(n),...p.value?{item:p.value}:{}}});k.value=t.data.results,x.value=t.data.count}catch(t){f.error(s("TransactionItemsView.loadFailure")),console.error(t)}finally{_.value=!1}}const P=ve(X,250);te(p,()=>{V.value&&P(V.value)});async function Y(n){y.value=!0;try{const[t,a,S]=await Promise.all([L({path:{event_pk:m.value},query:{limit:1e3}}),re({path:{event_pk:m.value},query:{limit:1e4}}),D({path:{event_pk:m.value},query:{limit:1e4}})]),c=t.data.results,H=a.data.results,J=S.data.results,$=new Map;for(const i of H)$.set(i.id,i);const K=i=>c.find(d=>d.id===i)?.name??`#${i}`,Q=(i,e)=>{if(!e)return"";const d=c.find(g=>g.id===i);return d?d.variants?.find(g=>g.id===e)?.name??`#${e}`:`#${e}`},C=[["Item ID","Product","Variant","Purchase Price","Original Price","Delivered","Delivery Time","Transaction ID","First Name","Last Name","Company","Email","Telephone","Mobile","Street","Postal Code","City","Country","Status","Created","Paid","Total Price"]];for(const i of J){const e=$.get(i.transaction),d=e?.is_paid?"Paid":e?.is_cancelled?"Cancelled":e?.is_pending?"Pending":"Created";C.push([i.id,K(i.item),Q(i.item,i.variant),i.purchase_price,i.original_price,i.is_delivered?"Yes":"No",i.time_delivered??"",e?.id??"",e?.firstname??"",e?.lastname??"",e?.company??"",e?.email??"",e?.telephone??"",e?.mobile??"",e?.street??"",e?.postalcode??"",e?.city??"",e?.country??"",d,e?.time_created??"",e?.time_paid??"",e?.total_price??""])}de(C,"instanssi_transaction_items",n,"Transaction Items"),f.success(s("TransactionItemsView.exportSuccess"))}catch(t){f.error(s("TransactionItemsView.exportFailure")),console.error(t)}finally{y.value=!1}}return ae(()=>{z()}),(n,t)=>(se(),ne(ue,{key:`transaction-items-${m.value}`,breadcrumbs:M.value},{default:l(()=>[o(F,null,{default:l(()=>[o(q,null,{default:l(()=>[o(ce,{label:u(s)("TransactionItemsView.export"),loading:y.value,onExport:Y},null,8,["label","loading"]),o(ie,{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=a=>p.value=a),items:A.value,variant:"outlined",density:"compact",label:u(s)("TransactionItemsView.filterByItem"),style:{"max-width":"300px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","items","label"]),o(oe,{modelValue:I.value,"onUpdate:modelValue":t[1]||(t[1]=a=>I.value=a),variant:"outlined",density:"compact",label:u(s)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),o(F,null,{default:l(()=>[o(q,null,{default:l(()=>[o(fe,{"items-per-page":T.value,"onUpdate:itemsPerPage":t[2]||(t[2]=a=>T.value=a),class:"elevation-1 primary","item-value":"id",density:"compact",headers:O,items:k.value,"items-length":x.value,loading:_.value,search:I.value,page:R.value,"items-per-page-options":w,"no-data-text":u(s)("TransactionItemsView.noItemsFound"),"loading-text":u(s)("TransactionItemsView.loadingItems"),"onUpdate:options":u(P)},{"item.item":l(({item:a})=>[E(N(G(a.item)),1)]),"item.variant":l(({item:a})=>[E(N(j(a.item,a.variant)),1)]),"item.purchase_price":l(({item:a})=>[o(pe,{value:a.purchase_price},null,8,["value"])]),"item.is_delivered":l(({item:a})=>[o(me,{value:a.is_delivered},null,8,["value"])]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Ce as default};
//# sourceMappingURL=TransactionItemsView-CA1XwHbA.js.map
