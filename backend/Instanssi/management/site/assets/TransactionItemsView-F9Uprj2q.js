import{d as X,a as Z,v as ee,L as $,o as te,b as ae,g as se,w as m,e as l,j as o,N as ie,m as ne,i as C,t as E,I as y,s as v,bM as L,c7 as re,cc as F,H as oe}from"./index-CQkWvXOv.js";import{_ as le}from"./BooleanIcon.vue_vue_type_script_setup_true_lang-BUZkEwsX.js";import{_ as me,d as ce}from"./spreadsheet-B6MwOGQk.js";import{V as B,_ as ue}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D5aCeQDf.js";import{_ as de}from"./PriceCell.vue_vue_type_script_setup_true_lang-FibLybm5.js";import{u as pe,d as ve}from"./useTableState-CutuDm2i.js";import{g as fe}from"./query_tools-BInV9OzK.js";import{V as D}from"./VRow-CXIXhuhq.js";import{V as ye}from"./VDataTableServer-C6tuZDKn.js";import{p as ge}from"./parseInt-BJ5A4_3y.js";import"./VContainer-DqJ8gu3P.js";import"./VDataTable-f5_9vewM.js";const Ce=X({__name:"TransactionItemsView",props:{eventId:{}},setup(U){const T=U,{t:i}=Z(),g=ee(),{getEventById:q}=oe(),c=y(()=>ge(T.eventId,10)),_=v(!1),I=v(!1),M=y(()=>[{title:q(c.value)?.name??"...",to:{name:"dashboard",params:{eventId:T.eventId}}},{title:i("TransactionItemsView.title"),disabled:!0}]),r=pe({filterKeys:["item"]}),w=v(0),x=v([]),f=v([]),b=v(null),u=y({get:()=>r.getFilterAsNumber("item"),set:t=>{r.setFilter("item",t),r.resetPage()}}),O=[{title:i("TransactionItemsView.headers.id"),sortable:!0,key:"id"},{title:i("TransactionItemsView.headers.transactionId"),sortable:!0,key:"transaction"},{title:i("TransactionItemsView.headers.item"),sortable:!0,key:"item"},{title:i("TransactionItemsView.headers.variant"),sortable:!1,key:"variant"},{title:i("TransactionItemsView.headers.price"),sortable:!0,key:"purchase_price"},{title:i("TransactionItemsView.headers.key"),sortable:!1,key:"key"},{title:i("TransactionItemsView.headers.delivered"),sortable:!1,key:"is_delivered"}],A=y(()=>[{title:i("TransactionItemsView.allItems"),value:null},...f.value.map(t=>({title:t.name,value:t.id}))]);function R(t){return f.value.find(s=>s.id===t)?.name??`#${t}`}function j(t,a){if(!a)return"-";const s=f.value.find(d=>d.id===t);return s?s.variants?.find(d=>d.id===a)?.name??`#${a}`:`#${a}`}async function P(){try{const t=await L({path:{event_pk:c.value},query:{limit:1e3}});f.value=t.data.results}catch(t){console.error("Failed to load store items:",t)}}async function z(t){_.value=!0,b.value=t;try{const a=await F({path:{event_pk:c.value},query:{...fe(t),...u.value?{item:u.value}:{}}});x.value=a.data.results,w.value=a.data.count}catch(a){g.error(i("TransactionItemsView.loadFailure")),console.error(a)}finally{_.value=!1}}const h=ve(z,250);function G(t){r.onOptionsUpdate(t),h(t)}$(u,()=>{b.value&&h({...b.value,page:1})});function H(){u.value=null,r.search.value="",r.page.value=1,P(),h({page:1,itemsPerPage:r.perPage.value??25,sortBy:[],groupBy:[],search:""})}$(c,H);async function K(t){I.value=!0;try{const[a,s,k]=await Promise.all([L({path:{event_pk:c.value},query:{limit:1e3}}),re({path:{event_pk:c.value},query:{limit:1e4}}),F({path:{event_pk:c.value},query:{limit:1e4}})]),d=a.data.results,Y=s.data.results,J=k.data.results,S=new Map;for(const n of Y)S.set(n.id,n);const Q=n=>d.find(p=>p.id===n)?.name??`#${n}`,W=(n,e)=>{if(!e)return"";const p=d.find(V=>V.id===n);return p?p.variants?.find(V=>V.id===e)?.name??`#${e}`:`#${e}`},N=[["Item ID","Product","Variant","Purchase Price","Original Price","Delivered","Delivery Time","Transaction ID","First Name","Last Name","Company","Email","Telephone","Mobile","Street","Postal Code","City","Country","Status","Created","Paid","Total Price"]];for(const n of J){const e=S.get(n.transaction),p=e?.is_paid?"Paid":e?.is_cancelled?"Cancelled":e?.is_pending?"Pending":"Created";N.push([n.id,Q(n.item),W(n.item,n.variant),n.purchase_price,n.original_price,n.is_delivered?"Yes":"No",n.time_delivered??"",e?.id??"",e?.firstname??"",e?.lastname??"",e?.company??"",e?.email??"",e?.telephone??"",e?.mobile??"",e?.street??"",e?.postalcode??"",e?.city??"",e?.country??"",p,e?.time_created??"",e?.time_paid??"",e?.total_price??""])}ce(N,"instanssi_transaction_items",t,"Transaction Items"),g.success(i("TransactionItemsView.exportSuccess"))}catch(a){g.error(i("TransactionItemsView.exportFailure")),console.error(a)}finally{I.value=!1}}return te(()=>{P()}),(t,a)=>(ae(),se(ue,{key:`transaction-items-${c.value}`,breadcrumbs:M.value},{default:m(()=>[l(B,null,{default:m(()=>[l(D,null,{default:m(()=>[l(me,{label:o(i)("TransactionItemsView.export"),loading:I.value,onExport:K},null,8,["label","loading"]),l(ie,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=s=>u.value=s),items:A.value,variant:"outlined",density:"compact",label:o(i)("TransactionItemsView.filterByItem"),style:{"max-width":"300px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","items","label"]),l(ne,{modelValue:o(r).search.value,"onUpdate:modelValue":a[1]||(a[1]=s=>o(r).search.value=s),variant:"outlined",density:"compact",label:o(i)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),l(B,null,{default:m(()=>[l(D,null,{default:m(()=>[l(ye,{"items-per-page":o(r).perPage.value,"onUpdate:itemsPerPage":a[2]||(a[2]=s=>o(r).perPage.value=s),"sort-by":o(r).sortByArray.value,class:"elevation-1 primary","item-value":"id",density:"compact",headers:O,items:x.value,"items-length":w.value,loading:_.value,search:o(r).search.value,page:o(r).page.value,"items-per-page-options":o(r).pageSizeOptions,"no-data-text":o(i)("TransactionItemsView.noItemsFound"),"loading-text":o(i)("TransactionItemsView.loadingItems"),"onUpdate:options":G},{"item.item":m(({item:s})=>[C(E(R(s.item)),1)]),"item.variant":m(({item:s})=>[C(E(j(s.item,s.variant)),1)]),"item.purchase_price":m(({item:s})=>[l(de,{value:s.purchase_price},null,8,["value"])]),"item.is_delivered":m(({item:s})=>[l(le,{value:s.is_delivered},null,8,["value"])]),_:1},8,["items-per-page","sort-by","items","items-length","loading","search","page","items-per-page-options","no-data-text","loading-text"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Ce as default};
//# sourceMappingURL=TransactionItemsView-F9Uprj2q.js.map
