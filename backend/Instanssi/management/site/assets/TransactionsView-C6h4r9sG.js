import{d as L,a as R,u as O,v as q,U as z,b as _,g as V,w as s,e as n,m as G,j as o,P as j,V as H,i as T,t as w,k as J,c0 as K,D as M,a4 as Q,q as W,I as y,s as i,c1 as X,H as Y}from"./index-DXU74lGt.js";import{_ as Z}from"./DateTimeCell.vue_vue_type_script_setup_true_lang-BMnBYvTq.js";import{V as h,_ as ee}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D4jd1chv.js";import{_ as ae}from"./PriceCell.vue_vue_type_script_setup_true_lang-C0E14iwW.js";import{g as te}from"./query_tools-BInV9OzK.js";import{d as se}from"./debounce-CQ84CrOG.js";import{V as b}from"./VRow-B94Tto0H.js";import{V as ne}from"./VDataTableServer-CMLVDy59.js";import{p as re}from"./parseInt-Bzw_2rWL.js";import"./datetime-Dz9fjSvq.js";import"./VContainer-BfWqa_tJ.js";import"./VDataTable-Jd7io3gq.js";const Te=L({__name:"TransactionsView",props:{eventId:{}},setup(k){const m=k,{t:e}=R(),x=O(),I=q(),C=W(),{getEventById:P}=Y(),l=y(()=>re(m.eventId,10)),c=i(!1),S=y(()=>[{title:P(l.value)?.name??"...",to:{name:"dashboard",params:{eventId:m.eventId}}},{title:e("TransactionsView.title"),disabled:!0}]),p=[25,50,100],d=i(p[0]),f=i(0),A=i(1),v=i([]),u=i(""),B=i(null),N=[{title:e("TransactionsView.headers.id"),sortable:!0,key:"id"},{title:e("TransactionsView.headers.fullName"),sortable:!0,key:"full_name"},{title:e("TransactionsView.headers.email"),sortable:!0,key:"email"},{title:e("TransactionsView.headers.created"),sortable:!0,key:"time_created"},{title:e("TransactionsView.headers.status"),sortable:!1,key:"status"},{title:e("TransactionsView.headers.total"),sortable:!1,key:"total_price"},{title:e("TransactionsView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function E(a){return a.is_paid?"success":a.is_cancelled?"error":a.is_pending?"warning":"grey"}function U(a){return a.is_paid?e("TransactionsView.statuses.paid"):a.is_cancelled?e("TransactionsView.statuses.cancelled"):a.is_pending?e("TransactionsView.statuses.pending"):e("TransactionsView.statuses.created")}async function $(a){c.value=!0,B.value=a;try{const r=await X({path:{event_pk:l.value},query:te(a)});v.value=r.data.results,f.value=r.data.count}catch(r){I.error(e("TransactionsView.loadFailure")),console.error(r)}finally{c.value=!1}}const g=se($,250);function D(){u.value="",g({page:1,itemsPerPage:d.value??25,sortBy:[],groupBy:[],search:""})}z(l,D);function F(a){x.push({name:"store-transaction-detail",params:{eventId:l.value,id:a}})}return(a,r)=>(_(),V(ee,{key:`transactions-${l.value}`,breadcrumbs:S.value},{default:s(()=>[n(h,null,{default:s(()=>[n(b,null,{default:s(()=>[n(G,{modelValue:u.value,"onUpdate:modelValue":r[0]||(r[0]=t=>u.value=t),variant:"outlined",density:"compact",label:o(e)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),n(h,null,{default:s(()=>[n(b,null,{default:s(()=>[n(ne,{"items-per-page":d.value,"onUpdate:itemsPerPage":r[1]||(r[1]=t=>d.value=t),class:"elevation-1 primary","item-value":"id",density:"compact",headers:N,items:v.value,"items-length":f.value,loading:c.value,search:u.value,page:A.value,"items-per-page-options":p,"no-data-text":o(e)("TransactionsView.noTransactionsFound"),"loading-text":o(e)("TransactionsView.loadingTransactions"),"onUpdate:options":o(g)},{"item.time_created":s(({item:t})=>[n(Z,{value:t.time_created},null,8,["value"])]),"item.status":s(({item:t})=>[n(Q,{color:E(t),size:"small",variant:"flat"},{default:s(()=>[T(w(U(t)),1)]),_:2},1032,["color"])]),"item.total_price":s(({item:t})=>[n(ae,{value:t.total_price},null,8,["value"])]),"item.actions":s(({item:t})=>[o(C).canView(o(j).STORE_TRANSACTION)?(_(),V(H,{key:0,density:"compact",variant:"text",onClick:oe=>F(t.id)},{prepend:s(()=>[n(o(J),{icon:o(K)},null,8,["icon"])]),default:s(()=>[T(" "+w(o(e)("General.view")),1)]),_:1},8,["onClick"])):M("",!0)]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Te as default};
//# sourceMappingURL=TransactionsView-C6h4r9sG.js.map
