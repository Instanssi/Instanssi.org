{"version":3,"file":"TransactionsView-CQr0_GJh.js","sources":["../../../../../admin/src/components/table/LongTextCell.vue","../../../../../admin/src/views/store/TransactionsView.vue"],"sourcesContent":["<template>\n    <div v-if=\"value\" class=\"long-text-cell\">\n        <v-btn\n            icon\n            variant=\"text\"\n            density=\"compact\"\n            size=\"small\"\n            :title=\"t('LongTextCell.clickToView')\"\n            @click=\"showDialog = true\"\n        >\n            <FontAwesomeIcon :icon=\"faFileLines\" />\n        </v-btn>\n\n        <v-dialog v-model=\"showDialog\" max-width=\"600\">\n            <v-card>\n                <v-card-title class=\"d-flex justify-space-between align-center\">\n                    <span>{{ title ?? t(\"LongTextCell.dialogTitle\") }}</span>\n                    <v-btn icon variant=\"text\" density=\"compact\" @click=\"showDialog = false\">\n                        <FontAwesomeIcon :icon=\"faXmark\" />\n                    </v-btn>\n                </v-card-title>\n                <v-divider />\n                <v-card-text class=\"pa-4\" style=\"white-space: pre-wrap\">{{ value }}</v-card-text>\n            </v-card>\n        </v-dialog>\n    </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { faFileLines, faXmark } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/vue-fontawesome\";\nimport { ref } from \"vue\";\nimport { useI18n } from \"vue-i18n\";\n\ndefineProps<{\n    value: string | null | undefined;\n    title?: string;\n}>();\n\nconst { t } = useI18n();\nconst showDialog = ref(false);\n</script>\n\n<style scoped>\n.long-text-cell {\n    display: flex;\n    align-items: center;\n}\n</style>\n","<template>\n    <LayoutBase :key=\"`transactions-${eventId}`\" :breadcrumbs=\"breadcrumbs\">\n        <v-col>\n            <v-row>\n                <v-text-field\n                    v-model=\"tableState.search.value\"\n                    variant=\"outlined\"\n                    density=\"compact\"\n                    :label=\"t('General.search')\"\n                    style=\"max-width: 400px\"\n                    class=\"ma-0 pa-0\"\n                    clearable\n                />\n            </v-row>\n        </v-col>\n        <v-col>\n            <v-row>\n                <v-data-table-server\n                    v-model:items-per-page=\"tableState.perPage.value\"\n                    :sort-by=\"tableState.sortByArray.value\"\n                    class=\"elevation-1 primary\"\n                    item-value=\"id\"\n                    density=\"compact\"\n                    :headers=\"headers\"\n                    :items=\"transactions\"\n                    :items-length=\"totalItems\"\n                    :loading=\"loading\"\n                    :search=\"tableState.search.value\"\n                    :page=\"tableState.page.value\"\n                    :items-per-page-options=\"tableState.pageSizeOptions\"\n                    :no-data-text=\"t('TransactionsView.noTransactionsFound')\"\n                    :loading-text=\"t('TransactionsView.loadingTransactions')\"\n                    @update:options=\"onTableOptionsUpdate\"\n                >\n                    <template #item.time_created=\"{ item }\">\n                        <DateTimeCell :value=\"item.time_created\" />\n                    </template>\n                    <template #item.status=\"{ item }\">\n                        <v-chip :color=\"getStatusColor(item)\" size=\"small\" variant=\"flat\">\n                            {{ getStatusText(item) }}\n                        </v-chip>\n                    </template>\n                    <template #item.total_price=\"{ item }\">\n                        <PriceCell :value=\"item.total_price\" />\n                    </template>\n                    <template #item.information=\"{ item }\">\n                        <LongTextCell\n                            :value=\"item.information\"\n                            :title=\"t('TransactionsView.headers.informationDialogTitle')\"\n                        />\n                    </template>\n                    <template #item.actions=\"{ item }\">\n                        <TableActionButtons\n                            :can-view=\"auth.canView(PermissionTarget.STORE_TRANSACTION)\"\n                            :can-edit=\"false\"\n                            :can-delete=\"false\"\n                            @view=\"viewDetails(item.id)\"\n                        />\n                    </template>\n                </v-data-table-server>\n            </v-row>\n        </v-col>\n    </LayoutBase>\n</template>\n\n<script setup lang=\"ts\">\nimport { debounce, parseInt } from \"lodash-es\";\nimport { type Ref, computed, ref, watch } from \"vue\";\nimport { useI18n } from \"vue-i18n\";\nimport { useRouter } from \"vue-router\";\nimport { useToast } from \"vue-toastification\";\nimport type { VDataTable } from \"vuetify/components\";\n\nimport * as api from \"@/api\";\nimport type { StoreTransaction } from \"@/api\";\nimport DateTimeCell from \"@/components/table/DateTimeCell.vue\";\nimport LayoutBase, { type BreadcrumbItem } from \"@/components/layout/LayoutBase.vue\";\nimport LongTextCell from \"@/components/table/LongTextCell.vue\";\nimport PriceCell from \"@/components/table/PriceCell.vue\";\nimport TableActionButtons from \"@/components/table/TableActionButtons.vue\";\nimport { useTableState } from \"@/composables/useTableState\";\nimport { PermissionTarget, useAuth } from \"@/services/auth\";\nimport { useEvents } from \"@/services/events\";\nimport { type LoadArgs, getLoadArgs } from \"@/services/utils/query_tools\";\n\ntype ReadonlyHeaders = VDataTable[\"$props\"][\"headers\"];\n\nconst props = defineProps<{ eventId: string }>();\nconst { t } = useI18n();\nconst router = useRouter();\nconst toast = useToast();\nconst auth = useAuth();\nconst { getEventById } = useEvents();\nconst eventId = computed(() => parseInt(props.eventId, 10));\nconst loading = ref(false);\n\nconst breadcrumbs = computed<BreadcrumbItem[]>(() => [\n    {\n        title: getEventById(eventId.value)?.name ?? \"...\",\n        to: { name: \"dashboard\", params: { eventId: props.eventId } },\n    },\n    { title: t(\"TransactionsView.title\"), disabled: true },\n]);\n\nconst tableState = useTableState();\nconst totalItems = ref(0);\nconst transactions: Ref<StoreTransaction[]> = ref([]);\nconst lastLoadArgs: Ref<LoadArgs | null> = ref(null);\n\nconst headers: ReadonlyHeaders = [\n    {\n        title: t(\"TransactionsView.headers.id\"),\n        sortable: true,\n        key: \"id\",\n    },\n    {\n        title: t(\"TransactionsView.headers.fullName\"),\n        sortable: false,\n        key: \"full_name\",\n    },\n    {\n        title: t(\"TransactionsView.headers.email\"),\n        sortable: true,\n        key: \"email\",\n    },\n    {\n        title: t(\"TransactionsView.headers.created\"),\n        sortable: true,\n        key: \"time_created\",\n    },\n    {\n        title: t(\"TransactionsView.headers.status\"),\n        sortable: false,\n        key: \"status\",\n    },\n    {\n        title: t(\"TransactionsView.headers.total\"),\n        sortable: false,\n        key: \"total_price\",\n    },\n    {\n        title: t(\"TransactionsView.headers.information\"),\n        sortable: false,\n        key: \"information\",\n    },\n    {\n        title: t(\"TransactionsView.headers.actions\"),\n        sortable: false,\n        key: \"actions\",\n        align: \"end\",\n    },\n];\n\nfunction getStatusColor(transaction: StoreTransaction): string {\n    if (transaction.is_paid) return \"success\";\n    if (transaction.is_cancelled) return \"error\";\n    if (transaction.is_pending) return \"warning\";\n    return \"grey\";\n}\n\nfunction getStatusText(transaction: StoreTransaction): string {\n    if (transaction.is_paid) return t(\"TransactionsView.statuses.paid\");\n    if (transaction.is_cancelled) return t(\"TransactionsView.statuses.cancelled\");\n    if (transaction.is_pending) return t(\"TransactionsView.statuses.pending\");\n    return t(\"TransactionsView.statuses.created\");\n}\n\nasync function load(args: LoadArgs) {\n    loading.value = true;\n    lastLoadArgs.value = args;\n    try {\n        const response = await api.adminEventStoreTransactionsList({\n            path: { event_pk: eventId.value },\n            query: getLoadArgs(args),\n        });\n        transactions.value = response.data!.results;\n        totalItems.value = response.data!.count;\n    } catch (e) {\n        toast.error(t(\"TransactionsView.loadFailure\"));\n        console.error(e);\n    } finally {\n        loading.value = false;\n    }\n}\n\nconst debouncedLoad = debounce(load, 250);\n\nfunction onTableOptionsUpdate(args: LoadArgs) {\n    tableState.onOptionsUpdate(args);\n    debouncedLoad(args);\n}\n\nfunction refresh() {\n    tableState.search.value = \"\";\n    tableState.page.value = 1;\n    debouncedLoad({\n        page: 1,\n        itemsPerPage: tableState.perPage.value ?? 25,\n        sortBy: [],\n        groupBy: [] as never,\n        search: \"\",\n    });\n}\n\n// Reload when event changes\nwatch(eventId, refresh);\n\nfunction viewDetails(id: number): void {\n    router.push({ name: \"store-transaction-detail\", params: { eventId: eventId.value, id } });\n}\n</script>\n"],"names":["t","useI18n","showDialog","ref","__props","_openBlock","_createElementBlock","_hoisted_1","_createVNode","_component_v_btn","_unref","FontAwesomeIcon","faFileLines","_component_v_dialog","$event","_component_v_card","_component_v_card_title","_createElementVNode","_toDisplayString","faXmark","_component_v_divider","_component_v_card_text","props","router","useRouter","toast","useToast","auth","useAuth","getEventById","useEvents","eventId","computed","parseInt","loading","breadcrumbs","tableState","useTableState","totalItems","transactions","lastLoadArgs","headers","getStatusColor","transaction","getStatusText","load","args","response","api.adminEventStoreTransactionsList","getLoadArgs","e","debouncedLoad","debounce","onTableOptionsUpdate","refresh","watch","viewDetails","id","_createBlock","LayoutBase","_component_v_col","_component_v_row","_component_v_text_field","_component_v_data_table_server","_withCtx","item","DateTimeCell","_component_v_chip","_createTextVNode","PriceCell","LongTextCell","TableActionButtons","PermissionTarget"],"mappings":"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"}