{"version":3,"file":"TransactionsView-Cl1Db8WQ.js","sources":["../../../../../admin/src/views/store/TransactionsView.vue"],"sourcesContent":["<template>\n    <LayoutBase :key=\"`transactions-${eventId}`\" :breadcrumbs=\"breadcrumbs\">\n        <v-col>\n            <v-row>\n                <v-text-field\n                    v-model=\"search\"\n                    variant=\"outlined\"\n                    density=\"compact\"\n                    :label=\"t('General.search')\"\n                    style=\"max-width: 400px\"\n                    class=\"ma-0 pa-0\"\n                    clearable\n                />\n            </v-row>\n        </v-col>\n        <v-col>\n            <v-row>\n                <v-data-table-server\n                    v-model:items-per-page=\"perPage\"\n                    class=\"elevation-1 primary\"\n                    item-value=\"id\"\n                    density=\"compact\"\n                    :headers=\"headers\"\n                    :items=\"transactions\"\n                    :items-length=\"totalItems\"\n                    :loading=\"loading\"\n                    :search=\"search\"\n                    :page=\"currentPage\"\n                    :items-per-page-options=\"pageSizeOptions\"\n                    :no-data-text=\"t('TransactionsView.noTransactionsFound')\"\n                    :loading-text=\"t('TransactionsView.loadingTransactions')\"\n                    @update:options=\"debouncedLoad\"\n                >\n                    <template #item.time_created=\"{ item }\">\n                        <DateTimeCell :value=\"item.time_created\" />\n                    </template>\n                    <template #item.status=\"{ item }\">\n                        <v-chip :color=\"getStatusColor(item)\" size=\"small\" variant=\"flat\">\n                            {{ getStatusText(item) }}\n                        </v-chip>\n                    </template>\n                    <template #item.total_price=\"{ item }\">\n                        <PriceCell :value=\"item.total_price\" />\n                    </template>\n                    <template #item.actions=\"{ item }\">\n                        <v-btn\n                            v-if=\"auth.canView(PermissionTarget.STORE_TRANSACTION)\"\n                            density=\"compact\"\n                            variant=\"text\"\n                            @click=\"viewDetails(item.id)\"\n                        >\n                            <template #prepend>\n                                <FontAwesomeIcon :icon=\"faEye\" />\n                            </template>\n                            {{ t(\"General.view\") }}\n                        </v-btn>\n                    </template>\n                </v-data-table-server>\n            </v-row>\n        </v-col>\n    </LayoutBase>\n</template>\n\n<script setup lang=\"ts\">\nimport { faEye } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/vue-fontawesome\";\nimport { debounce, parseInt } from \"lodash-es\";\nimport { type Ref, computed, ref, watch } from \"vue\";\nimport { useI18n } from \"vue-i18n\";\nimport { useRouter } from \"vue-router\";\nimport { useToast } from \"vue-toastification\";\nimport type { VDataTable } from \"vuetify/components\";\n\nimport * as api from \"@/api\";\nimport type { StoreTransaction } from \"@/api\";\nimport DateTimeCell from \"@/components/table/DateTimeCell.vue\";\nimport LayoutBase, { type BreadcrumbItem } from \"@/components/layout/LayoutBase.vue\";\nimport PriceCell from \"@/components/table/PriceCell.vue\";\nimport { PermissionTarget, useAuth } from \"@/services/auth\";\nimport { useEvents } from \"@/services/events\";\nimport { type LoadArgs, getLoadArgs } from \"@/services/utils/query_tools\";\n\ntype ReadonlyHeaders = VDataTable[\"$props\"][\"headers\"];\n\nconst props = defineProps<{ eventId: string }>();\nconst { t } = useI18n();\nconst router = useRouter();\nconst toast = useToast();\nconst auth = useAuth();\nconst { getEventById } = useEvents();\nconst eventId = computed(() => parseInt(props.eventId, 10));\nconst loading = ref(false);\n\nconst breadcrumbs = computed<BreadcrumbItem[]>(() => [\n    {\n        title: getEventById(eventId.value)?.name ?? \"...\",\n        to: { name: \"dashboard\", params: { eventId: props.eventId } },\n    },\n    { title: t(\"TransactionsView.title\"), disabled: true },\n]);\nconst pageSizeOptions = [25, 50, 100];\nconst perPage = ref(pageSizeOptions[0]);\nconst totalItems = ref(0);\nconst currentPage = ref(1);\nconst transactions: Ref<StoreTransaction[]> = ref([]);\nconst search = ref(\"\");\nconst lastLoadArgs: Ref<LoadArgs | null> = ref(null);\n\nconst headers: ReadonlyHeaders = [\n    {\n        title: t(\"TransactionsView.headers.id\"),\n        sortable: true,\n        key: \"id\",\n    },\n    {\n        title: t(\"TransactionsView.headers.fullName\"),\n        sortable: true,\n        key: \"full_name\",\n    },\n    {\n        title: t(\"TransactionsView.headers.email\"),\n        sortable: true,\n        key: \"email\",\n    },\n    {\n        title: t(\"TransactionsView.headers.created\"),\n        sortable: true,\n        key: \"time_created\",\n    },\n    {\n        title: t(\"TransactionsView.headers.status\"),\n        sortable: false,\n        key: \"status\",\n    },\n    {\n        title: t(\"TransactionsView.headers.total\"),\n        sortable: false,\n        key: \"total_price\",\n    },\n    {\n        title: t(\"TransactionsView.headers.actions\"),\n        sortable: false,\n        key: \"actions\",\n        align: \"end\",\n    },\n];\n\nfunction getStatusColor(transaction: StoreTransaction): string {\n    if (transaction.is_paid) return \"success\";\n    if (transaction.is_cancelled) return \"error\";\n    if (transaction.is_pending) return \"warning\";\n    return \"grey\";\n}\n\nfunction getStatusText(transaction: StoreTransaction): string {\n    if (transaction.is_paid) return t(\"TransactionsView.statuses.paid\");\n    if (transaction.is_cancelled) return t(\"TransactionsView.statuses.cancelled\");\n    if (transaction.is_pending) return t(\"TransactionsView.statuses.pending\");\n    return t(\"TransactionsView.statuses.created\");\n}\n\nasync function load(args: LoadArgs) {\n    loading.value = true;\n    lastLoadArgs.value = args;\n    try {\n        const response = await api.adminEventStoreTransactionsList({\n            path: { event_pk: eventId.value },\n            query: getLoadArgs(args),\n        });\n        transactions.value = response.data!.results;\n        totalItems.value = response.data!.count;\n    } catch (e) {\n        toast.error(t(\"TransactionsView.loadFailure\"));\n        console.error(e);\n    } finally {\n        loading.value = false;\n    }\n}\n\nconst debouncedLoad = debounce(load, 250);\n\nfunction refresh() {\n    search.value = \"\";\n    debouncedLoad({\n        page: 1,\n        itemsPerPage: perPage.value ?? 25,\n        sortBy: [],\n        groupBy: [] as never,\n        search: \"\",\n    });\n}\n\n// Reload when event changes\nwatch(eventId, refresh);\n\nfunction viewDetails(id: number): void {\n    router.push({ name: \"store-transaction-detail\", params: { eventId: eventId.value, id } });\n}\n</script>\n"],"names":["props","__props","t","useI18n","router","useRouter","toast","useToast","auth","useAuth","getEventById","useEvents","eventId","computed","parseInt","loading","ref","breadcrumbs","pageSizeOptions","perPage","totalItems","currentPage","transactions","search","lastLoadArgs","headers","getStatusColor","transaction","getStatusText","load","args","response","api.adminEventStoreTransactionsList","getLoadArgs","e","debouncedLoad","debounce","refresh","watch","viewDetails","id","_createBlock","LayoutBase","_createVNode","_component_v_col","_component_v_row","_component_v_text_field","$event","_unref","_component_v_data_table_server","_withCtx","item","DateTimeCell","_component_v_chip","_createTextVNode","_toDisplayString","PriceCell","PermissionTarget","_component_v_btn","FontAwesomeIcon","faEye"],"mappings":"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"}