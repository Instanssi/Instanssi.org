import{d as U,a as D,u as G,v as O,Z as q,b as _,g as V,w as s,e as n,m as z,j as o,P as j,V as K,i as T,t as w,k as W,bW as X,K as Z,b4 as H,q as J,G as b,s as i,bX as M,E as Q}from"./index-qrfwdmHz.js";import{_ as Y}from"./DateTimeCell.vue_vue_type_script_setup_true_lang-DEE2ektI.js";import{V as y,_ as ee}from"./LayoutBase.vue_vue_type_script_setup_true_lang-Cgp8Musd.js";import{_ as ae}from"./PriceCell.vue_vue_type_script_setup_true_lang-BtBLjvrW.js";import{d as te,V as se,g as ne}from"./query_tools-Ch1hnqwl.js";import{V as h}from"./VRow-EkiCBxID.js";import{p as re}from"./parseInt-CGa1F4cm.js";import"./datetime-DsxOZgAd.js";import"./classApi-bnmGQydb.js";import"./VContainer-e74dHNZG.js";import"./VDataTable-BIkGv4dg.js";import"./filter-50Rnsb7m.js";const Te=U({__name:"TransactionsView",props:{eventId:{}},setup(k){const m=k,{t:e}=D(),x=G(),I=O(),C=J(),{getEventById:P}=Q(),l=b(()=>re(m.eventId,10)),c=i(!1),S=b(()=>[{title:P(l.value)?.name??"...",to:{name:"dashboard",params:{eventId:m.eventId}}},{title:e("TransactionsView.title"),disabled:!0}]),p=[25,50,100],d=i(p[0]),v=i(0),A=i(1),f=i([]),u=i(""),B=i(null),E=[{title:e("TransactionsView.headers.id"),sortable:!0,key:"id"},{title:e("TransactionsView.headers.fullName"),sortable:!0,key:"full_name"},{title:e("TransactionsView.headers.email"),sortable:!0,key:"email"},{title:e("TransactionsView.headers.created"),sortable:!0,key:"time_created"},{title:e("TransactionsView.headers.status"),sortable:!1,key:"status"},{title:e("TransactionsView.headers.total"),sortable:!1,key:"total_price"},{title:e("TransactionsView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function N(a){return a.is_paid?"success":a.is_cancelled?"error":a.is_pending?"warning":"grey"}function $(a){return a.is_paid?e("TransactionsView.statuses.paid"):a.is_cancelled?e("TransactionsView.statuses.cancelled"):a.is_pending?e("TransactionsView.statuses.pending"):e("TransactionsView.statuses.created")}async function F(a){c.value=!0,B.value=a;try{const r=await M({path:{event_pk:l.value},query:ne(a)});f.value=r.data.results,v.value=r.data.count}catch(r){I.error(e("TransactionsView.loadFailure")),console.error(r)}finally{c.value=!1}}const g=te(F,250);function L(){u.value="",g({page:1,itemsPerPage:d.value??25,sortBy:[],groupBy:[],search:""})}q(l,L);function R(a){x.push({name:"store-transaction-detail",params:{eventId:l.value,id:a}})}return(a,r)=>(_(),V(ee,{key:`transactions-${l.value}`,breadcrumbs:S.value},{default:s(()=>[n(y,null,{default:s(()=>[n(h,null,{default:s(()=>[n(z,{modelValue:u.value,"onUpdate:modelValue":r[0]||(r[0]=t=>u.value=t),variant:"outlined",density:"compact",label:o(e)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),n(y,null,{default:s(()=>[n(h,null,{default:s(()=>[n(se,{"items-per-page":d.value,"onUpdate:itemsPerPage":r[1]||(r[1]=t=>d.value=t),class:"elevation-1 primary","item-value":"id",density:"compact",headers:E,items:f.value,"items-length":v.value,loading:c.value,search:u.value,page:A.value,"items-per-page-options":p,"no-data-text":o(e)("TransactionsView.noTransactionsFound"),"loading-text":o(e)("TransactionsView.loadingTransactions"),"onUpdate:options":o(g)},{"item.time_created":s(({item:t})=>[n(Y,{value:t.time_created},null,8,["value"])]),"item.status":s(({item:t})=>[n(H,{color:N(t),size:"small",variant:"flat"},{default:s(()=>[T(w($(t)),1)]),_:2},1032,["color"])]),"item.total_price":s(({item:t})=>[n(ae,{value:t.total_price},null,8,["value"])]),"item.actions":s(({item:t})=>[o(C).canView(o(j).STORE_TRANSACTION)?(_(),V(K,{key:0,density:"compact",variant:"text",onClick:oe=>R(t.id)},{prepend:s(()=>[n(o(W),{icon:o(X)},null,8,["icon"])]),default:s(()=>[T(" "+w(o(e)("General.view")),1)]),_:1},8,["onClick"])):Z("",!0)]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Te as default};
//# sourceMappingURL=TransactionsView-D56tr4-X.js.map
