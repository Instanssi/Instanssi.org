import{d as K,a as O,u as Q,v as W,al as X,am as Y,o as Z,an as ee,b as c,g as p,w as l,e as r,A as ae,p as te,B as ie,l as re,j as t,C as se,D as le,E as oe,V as k,i as C,t as S,k as ne,G as de,s as m,I as w,H as ue}from"./index-DXU74lGt.js";import{c as ce,f as pe,a as me,u as fe,b as x}from"./index.esm-DWTrtXO7.js";import{_ as ve}from"./AuditLogButton.vue_vue_type_script_setup_true_lang-5kFykphF.js";import{F as Ve}from"./FileUploadField-IUZ2yZIA.js";import{V as B,_ as be}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D4jd1chv.js";import{g as A,t as D,p as ye}from"./formdata-BXUVcBgf.js";import{h as M}from"./http-BTZWMaMN.js";import{p as F}from"./parseInt-Bzw_2rWL.js";import{V as _e}from"./VForm-C430u1Uz.js";import{V as we}from"./VTextarea-DeKWRVbT.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-WkXOSlqa.js";import"./useAuditLogUtils-BqNOieoY.js";import"./DateTimeCell.vue_vue_type_script_setup_true_lang-BMnBYvTq.js";import"./datetime-Dz9fjSvq.js";import"./VDataTableServer-CMLVDy59.js";import"./VDataTable-Jd7io3gq.js";import"./VContainer-BfWqa_tJ.js";const $e=K({__name:"UploadEditView",props:{eventId:{},id:{}},setup(j){const U={description:"description",file:"file"},o=j,{t:i}=O(),G=Q(),n=W(),{getEventById:P}=ue(),f=m(!1),v=m(!1),E=m(""),u=w(()=>F(o.eventId,10)),d=w(()=>o.id!==void 0),V=m(null),$=w(()=>{const e=[{title:P(u.value)?.name??"...",to:{name:"dashboard",params:{eventId:o.eventId}}},{title:i("UploadsView.title"),to:{name:"uploads",params:{eventId:o.eventId}}}];return d.value?e.push({title:E.value||"...",disabled:!0}):e.push({title:i("Breadcrumbs.newUpload"),disabled:!0}),e}),q=ce({description:me().max(255),file:pe().nullable().test("file-required",i("UploadEditView.fileRequired"),e=>V.value?!0:!!A(e))}),{handleSubmit:N,setValues:R,setErrors:I,meta:T}=fe({validationSchema:q,initialValues:{description:"",file:void 0}}),b=x("description"),y=x("file");function z(e){try{return new URL(e).pathname.split("/").pop()||e}catch{return e}}const g=N(async e=>{v.value=!0;let a;d.value?a=await H(F(o.id,10),e):a=await L(e),v.value=!1,a&&_()});function h(e,a){const s=a?A:ye;return{description:e.description||"",file:s(e.file)}}async function L(e){const a=h(e,!0);if(!a.file)return!1;try{return await X({path:{event_pk:u.value},body:a,bodySerializer:()=>D(a)}),n.success(i("UploadEditView.createSuccess")),!0}catch(s){M(s,I,n,i("UploadEditView.createFailure"),U)}return!1}async function H(e,a){const s=h(a,!1);try{return await Y({path:{event_pk:u.value,id:e},body:s,bodySerializer:()=>D(s)}),n.success(i("UploadEditView.editSuccess")),!0}catch(J){M(J,I,n,i("UploadEditView.editFailure"),U)}return!1}function _(){G.push({name:"uploads",params:{eventId:o.eventId}})}return Z(async()=>{if(d.value){f.value=!0;try{const a=(await ee({path:{event_pk:u.value,id:F(o.id,10)}})).data;E.value=a.description||z(a.file),V.value=a.file,R({description:a.description??""})}catch(e){n.error(i("UploadEditView.loadFailure")),console.error(e),_()}finally{f.value=!1}}}),(e,a)=>(c(),p(be,{breadcrumbs:$.value},{default:l(()=>[f.value?(c(),p(B,{key:0,class:"d-flex justify-center my-8"},{default:l(()=>[r(ae,{indeterminate:"",size:"64"})]),_:1})):(c(),p(B,{key:1},{default:l(()=>[r(te,null,{default:l(()=>[r(ie,null,{default:l(()=>[r(_e,{onSubmit:re(t(g),["prevent"])},{default:l(()=>[r(Ve,{modelValue:t(y).value.value,"onUpdate:modelValue":a[0]||(a[0]=s=>t(y).value.value=s),"current-file-url":V.value,label:t(i)("UploadEditView.labels.file"),"error-message":t(y).errorMessage.value,required:!d.value},null,8,["modelValue","current-file-url","label","error-message","required"]),r(we,{modelValue:t(b).value.value,"onUpdate:modelValue":a[1]||(a[1]=s=>t(b).value.value=s),"error-messages":t(b).errorMessage.value,variant:"outlined",label:t(i)("UploadEditView.labels.description"),rows:"3"},null,8,["modelValue","error-messages","label"])]),_:1},8,["onSubmit"])]),_:1}),r(se,{class:"justify-end"},{default:l(()=>[d.value?(c(),p(ve,{key:0,"app-label":"admin_upload",model:"uploadedfile","object-pk":o.id},null,8,["object-pk"])):le("",!0),r(oe),r(k,{variant:"text",onClick:_},{default:l(()=>[C(S(t(i)("General.cancel")),1)]),_:1}),r(k,{variant:"elevated",color:"primary",loading:v.value,disabled:!t(T).valid,onClick:t(g)},{prepend:l(()=>[r(t(ne),{icon:t(de)},null,8,["icon"])]),default:l(()=>[C(" "+S(t(i)("General.save")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1}))]),_:1},8,["breadcrumbs"]))}});export{$e as default};
//# sourceMappingURL=UploadEditView-BJEypmhL.js.map
