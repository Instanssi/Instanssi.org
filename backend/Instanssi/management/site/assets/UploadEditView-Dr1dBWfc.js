import{d as K,a as O,u as Q,v as W,ab as X,ac as Y,o as Z,ad as ee,b as y,g as w,w as l,e as r,A as ae,p as te,B as se,l as ie,j as t,C as le,V as k,i as C,t as x,k as re,D as oe,s as c,G as F,E as ne}from"./index-CY4kEXQX.js";import{c as de,f as ue,a as ce,u as pe,b as S,V as me}from"./index.esm-gAaR2kR-.js";import{F as fe}from"./FileUploadField-C3L6P4Bl.js";import{V as B,_ as ve}from"./LayoutBase.vue_vue_type_script_setup_true_lang-mBpG7FYr.js";import{g as A,t as D,p as Ve}from"./formdata-Umo5Cp2Q.js";import{h as M}from"./http-h2SUVdDm.js";import{p as U}from"./parseInt-DjOfejfT.js";import{V as be}from"./VTextarea-CUku_Nvp.js";import"./VContainer-DyZfstE_.js";const ke=K({__name:"UploadEditView",props:{eventId:{},id:{}},setup(G){const E={description:"description",file:"file"},o=G,{t:s}=O(),P=Q(),n=W(),{getEventById:q}=ne(),p=c(!1),m=c(!1),_=c(""),d=F(()=>U(o.eventId,10)),u=F(()=>o.id!==void 0),f=c(null),R=F(()=>{const e=[{title:q(d.value)?.name??"...",to:{name:"dashboard",params:{eventId:o.eventId}}},{title:s("UploadsView.title"),to:{name:"uploads",params:{eventId:o.eventId}}}];return u.value?e.push({title:_.value||"...",disabled:!0}):e.push({title:s("Breadcrumbs.newUpload"),disabled:!0}),e}),T=de({description:ce().max(255),file:ue().nullable().test("file-required",s("UploadEditView.fileRequired"),e=>f.value?!0:!!A(e))}),{handleSubmit:$,setValues:j,setErrors:g,meta:z}=pe({validationSchema:T,initialValues:{description:"",file:void 0}}),v=S("description"),V=S("file");function N(e){try{return new URL(e).pathname.split("/").pop()||e}catch{return e}}const I=$(async e=>{m.value=!0;let a;u.value?a=await H(U(o.id,10),e):a=await L(e),m.value=!1,a&&b()});function h(e,a){const i=a?A:Ve;return{description:e.description||"",file:i(e.file)}}async function L(e){const a=h(e,!0);if(!a.file)return!1;try{return await X({path:{event_pk:d.value},body:a,bodySerializer:()=>D(a)}),n.success(s("UploadEditView.createSuccess")),!0}catch(i){M(i,g,n,s("UploadEditView.createFailure"),E)}return!1}async function H(e,a){const i=h(a,!1);try{return await Y({path:{event_pk:d.value,id:e},body:i,bodySerializer:()=>D(i)}),n.success(s("UploadEditView.editSuccess")),!0}catch(J){M(J,g,n,s("UploadEditView.editFailure"),E)}return!1}function b(){P.push({name:"uploads",params:{eventId:o.eventId}})}return Z(async()=>{if(u.value){p.value=!0;try{const a=(await ee({path:{event_pk:d.value,id:U(o.id,10)}})).data;_.value=a.description||N(a.file),f.value=a.file,j({description:a.description??""})}catch(e){n.error(s("UploadEditView.loadFailure")),console.error(e),b()}finally{p.value=!1}}}),(e,a)=>(y(),w(ve,{breadcrumbs:R.value},{default:l(()=>[p.value?(y(),w(B,{key:0,class:"d-flex justify-center my-8"},{default:l(()=>[r(ae,{indeterminate:"",size:"64"})]),_:1})):(y(),w(B,{key:1},{default:l(()=>[r(te,null,{default:l(()=>[r(se,null,{default:l(()=>[r(me,{onSubmit:ie(t(I),["prevent"])},{default:l(()=>[r(fe,{modelValue:t(V).value.value,"onUpdate:modelValue":a[0]||(a[0]=i=>t(V).value.value=i),"current-file-url":f.value,label:t(s)("UploadEditView.labels.file"),"error-message":t(V).errorMessage.value,required:!u.value},null,8,["modelValue","current-file-url","label","error-message","required"]),r(be,{modelValue:t(v).value.value,"onUpdate:modelValue":a[1]||(a[1]=i=>t(v).value.value=i),"error-messages":t(v).errorMessage.value,variant:"outlined",label:t(s)("UploadEditView.labels.description"),rows:"3"},null,8,["modelValue","error-messages","label"])]),_:1},8,["onSubmit"])]),_:1}),r(le,{class:"justify-end"},{default:l(()=>[r(k,{variant:"text",onClick:b},{default:l(()=>[C(x(t(s)("General.cancel")),1)]),_:1}),r(k,{variant:"elevated",color:"primary",loading:m.value,disabled:!t(z).valid,onClick:t(I)},{prepend:l(()=>[r(t(re),{icon:t(oe)},null,8,["icon"])]),default:l(()=>[C(" "+x(t(s)("General.save")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1}))]),_:1},8,["breadcrumbs"]))}});export{ke as default};
//# sourceMappingURL=UploadEditView-Dr1dBWfc.js.map
