import{d as N,a as q,u as z,J as K,K as R,v as G,L as H,b,g as _,w as i,e as n,j as e,P as f,V as I,i as J,t as Q,k as D,M as W,D as X,m as Y,a1 as Z,q as ee,I as k,s as p,ak as ae,al as te,H as oe}from"./index-CQkWvXOv.js";import{V as x,_ as se}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D5aCeQDf.js";import{M as le,g as ne}from"./MediaCell-DVuUxSBK.js";import{_ as ie}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-DepTf6Bi.js";import{u as re,d as de}from"./useTableState-CutuDm2i.js";import{g as pe}from"./query_tools-BInV9OzK.js";import{g as ue}from"./http-CET7UDul.js";import{V as P}from"./VRow-CXIXhuhq.js";import{V as ce}from"./VDataTableServer-C6tuZDKn.js";import{p as me}from"./parseInt-BJ5A4_3y.js";import"./VContainer-DqJ8gu3P.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-1MnYozFL.js";import"./useAuditLogUtils-BdjF9k7b.js";import"./DateTimeCell.vue_vue_type_script_setup_true_lang-DaLynL44.js";import"./datetime-Dz9fjSvq.js";import"./VDataTable-f5_9vewM.js";const Fe=N({__name:"UploadsView",props:{eventId:{}},setup(E){const v=E,{t:a}=q(),g=z(),F=K(R),d=G(),u=ee(),{getEventById:L}=oe(),r=k(()=>me(v.eventId,10)),c=p(!1),C=k(()=>[{title:L(r.value)?.name??"...",to:{name:"dashboard",params:{eventId:v.eventId}}},{title:a("UploadsView.title"),disabled:!0}]),s=re(),y=p(0),U=p([]),m=p(null),A=[{title:a("UploadsView.headers.id"),sortable:!0,key:"id"},{title:a("UploadsView.headers.file"),sortable:!1,key:"file"},{title:a("UploadsView.headers.description"),sortable:!1,key:"description"},{title:a("UploadsView.headers.actions"),sortable:!1,key:"actions",align:"end"}];async function T(t){try{await navigator.clipboard.writeText(t),d.success(a("UploadsView.copySuccess"))}catch{d.error(a("UploadsView.copyFailure"))}}function B(){m.value&&V(m.value)}async function V(t){c.value=!0,m.value=t;try{const l=await te({path:{event_pk:r.value},query:{...pe(t)}});U.value=l.data.results,y.value=l.data.count}catch(l){d.error(a("UploadsView.loadFailure")),console.error(l)}finally{c.value=!1}}const h=de(V,250);function S(t){s.onOptionsUpdate(t),h(t)}function O(){s.search.value="",s.page.value=1,h({page:1,itemsPerPage:s.perPage.value??25,sortBy:[],groupBy:[],search:""})}H(r,O);async function $(t){const l=a("UploadsView.confirmDelete",{description:t.description||ne(t.file)||t.file});await F.value.ifConfirmed(l,async()=>{try{await ae({path:{event_pk:r.value,id:t.id}}),d.success(a("UploadsView.deleteSuccess")),B()}catch(o){d.error(ue(o,a("UploadsView.deleteFailure"))),console.error(o)}})}function M(t){g.push({name:"uploads-edit",params:{eventId:r.value,id:t}})}function j(){g.push({name:"uploads-new",params:{eventId:r.value}})}return(t,l)=>(b(),_(se,{key:`uploads-${r.value}`,breadcrumbs:C.value},{default:i(()=>[n(x,null,{default:i(()=>[n(P,null,{default:i(()=>[e(u).canAdd(e(f).UPLOADED_FILE)?(b(),_(I,{key:0,color:"primary",onClick:j},{prepend:i(()=>[n(e(D),{icon:e(W)},null,8,["icon"])]),default:i(()=>[J(" "+Q(e(a)("UploadsView.newUpload")),1)]),_:1})):X("",!0),n(Y,{modelValue:e(s).search.value,"onUpdate:modelValue":l[0]||(l[0]=o=>e(s).search.value=o),variant:"outlined",density:"compact",label:e(a)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),n(x,null,{default:i(()=>[n(P,null,{default:i(()=>[n(ce,{"items-per-page":e(s).perPage.value,"onUpdate:itemsPerPage":l[1]||(l[1]=o=>e(s).perPage.value=o),"sort-by":e(s).sortByArray.value,class:"elevation-1 primary","item-value":"id",density:"compact",headers:A,items:U.value,"items-length":y.value,loading:c.value,search:e(s).search.value,page:e(s).page.value,"items-per-page-options":e(s).pageSizeOptions,"no-data-text":e(a)("UploadsView.noUploadsFound"),"loading-text":e(a)("UploadsView.loadingUploads"),"onUpdate:options":S},{"item.file":i(({item:o})=>[n(le,{url:o.file},null,8,["url"])]),"item.actions":i(({item:o})=>[n(I,{icon:"",variant:"text",size:"small",title:e(a)("UploadsView.headers.file"),onClick:w=>T(o.file)},{default:i(()=>[n(e(D),{icon:e(Z)},null,8,["icon"])]),_:1},8,["title","onClick"]),n(ie,{"can-edit":e(u).canChange(e(f).UPLOADED_FILE),"can-delete":e(u).canDelete(e(f).UPLOADED_FILE),"audit-log":{appLabel:"admin_upload",model:"uploadedfile",objectPk:o.id},onEdit:w=>M(o.id),onDelete:w=>$(o)},null,8,["can-edit","can-delete","audit-log","onEdit","onDelete"])]),_:1},8,["items-per-page","sort-by","items","items-length","loading","search","page","items-per-page-options","no-data-text","loading-text"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Fe as default};
//# sourceMappingURL=UploadsView-B-m9I019.js.map
