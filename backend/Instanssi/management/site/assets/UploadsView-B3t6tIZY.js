import{d as q,a as z,u as G,H as K,I as R,v as H,b,g as I,w as n,e as l,j as a,P as f,V as D,i as J,t as Q,k,J as W,K as X,m as Y,a8 as Z,q as ee,G as x,s as i,a9 as ae,aa as te,E as se}from"./index-BSHMv_df.js";import{V as E,_ as oe}from"./LayoutBase.vue_vue_type_script_setup_true_lang-C8aKWyeJ.js";import{M as le,g as ne}from"./MediaCell-xXvaknan.js";import{_ as ie}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-DouyropJ.js";import{d as re,V as de,g as ce}from"./query_tools-Co6bP9h2.js";import{g as ue}from"./http-BZkoYM_m.js";import{V as F}from"./VRow-BUBfmFS3.js";import{p as pe}from"./parseInt-3OpbdfxQ.js";import"./VContainer--EpXOfw5.js";import"./VDataTable-CpUosGjF.js";import"./filter-C6Uu0LOB.js";const Ie=q({__name:"UploadsView",props:{eventId:{}},setup(C){const v=C,{t:e}=z(),g=G(),L=K(R),d=H(),c=ee(),{getEventById:P}=se(),r=x(()=>pe(v.eventId,10)),u=i(!1),A=x(()=>[{title:P(r.value)?.name??"...",to:{name:"dashboard",params:{eventId:v.eventId}}},{title:e("UploadsView.title"),disabled:!0}]),V=[25,50,100],U=i(V[0]),w=i(0),T=i(1),y=i([]),p=i(""),m=i(null),$=[{title:e("UploadsView.headers.id"),sortable:!0,key:"id"},{title:e("UploadsView.headers.file"),sortable:!1,key:"file"},{title:e("UploadsView.headers.description"),sortable:!1,key:"description"},{title:e("UploadsView.headers.actions"),sortable:!1,key:"actions",align:"end"}];async function S(t){try{await navigator.clipboard.writeText(t),d.success(e("UploadsView.copySuccess"))}catch{d.error(e("UploadsView.copyFailure"))}}function B(){m.value&&h(m.value)}async function h(t){u.value=!0,m.value=t;try{const o=await te({path:{event_pk:r.value},query:{...ce(t)}});y.value=o.data.results,w.value=o.data.count}catch(o){d.error(e("UploadsView.loadFailure")),console.error(o)}finally{u.value=!1}}const O=re(h,250);async function M(t){const o=e("UploadsView.confirmDelete",{description:t.description||ne(t.file)||t.file});await L.value.ifConfirmed(o,async()=>{try{await ae({path:{event_pk:r.value,id:t.id}}),d.success(e("UploadsView.deleteSuccess")),B()}catch(s){d.error(ue(s,e("UploadsView.deleteFailure"))),console.error(s)}})}function N(t){g.push({name:"uploads-edit",params:{eventId:r.value,id:t}})}function j(){g.push({name:"uploads-new",params:{eventId:r.value}})}return(t,o)=>(b(),I(oe,{key:`uploads-${r.value}`,breadcrumbs:A.value},{default:n(()=>[l(E,null,{default:n(()=>[l(F,null,{default:n(()=>[a(c).canAdd(a(f).UPLOADED_FILE)?(b(),I(D,{key:0,onClick:j},{prepend:n(()=>[l(a(k),{icon:a(W)},null,8,["icon"])]),default:n(()=>[J(" "+Q(a(e)("UploadsView.newUpload")),1)]),_:1})):X("",!0),l(Y,{modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=s=>p.value=s),variant:"outlined",density:"compact",label:a(e)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),l(E,null,{default:n(()=>[l(F,null,{default:n(()=>[l(de,{"items-per-page":U.value,"onUpdate:itemsPerPage":o[1]||(o[1]=s=>U.value=s),class:"elevation-1 primary","item-value":"id",density:"compact",headers:$,items:y.value,"items-length":w.value,loading:u.value,search:p.value,page:T.value,"items-per-page-options":V,"no-data-text":a(e)("UploadsView.noUploadsFound"),"loading-text":a(e)("UploadsView.loadingUploads"),"onUpdate:options":a(O)},{"item.file":n(({item:s})=>[l(le,{url:s.file},null,8,["url"])]),"item.actions":n(({item:s})=>[l(D,{icon:"",variant:"text",size:"small",title:a(e)("UploadsView.headers.file"),onClick:_=>S(s.file)},{default:n(()=>[l(a(k),{icon:a(Z)},null,8,["icon"])]),_:1},8,["title","onClick"]),l(ie,{"can-edit":a(c).canChange(a(f).UPLOADED_FILE),"can-delete":a(c).canDelete(a(f).UPLOADED_FILE),onEdit:_=>N(s.id),onDelete:_=>M(s)},null,8,["can-edit","can-delete","onEdit","onDelete"])]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Ie as default};
//# sourceMappingURL=UploadsView-B3t6tIZY.js.map
