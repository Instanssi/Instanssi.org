import{d as z,a as G,u as K,H as R,I as H,v as J,Z,b as I,g as D,w as n,e as l,j as a,P as v,V as k,i as Q,t as W,k as x,J as X,K as Y,m as ee,a8 as ae,q as te,G as E,s as r,a9 as se,aa as oe,E as le}from"./index-CY4kEXQX.js";import{V as F,_ as ne}from"./LayoutBase.vue_vue_type_script_setup_true_lang-mBpG7FYr.js";import{M as ie,g as re}from"./MediaCell-Du1wneMy.js";import{_ as de}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-CU2jcJ7N.js";import{d as ce,V as ue,g as pe}from"./query_tools-D1ttn1y9.js";import{g as me}from"./http-h2SUVdDm.js";import{V as P}from"./VRow-Dt2mDaW0.js";import{p as fe}from"./parseInt-DjOfejfT.js";import"./VContainer-DyZfstE_.js";import"./VDataTable-K-Y489M6.js";import"./filter-B_C-txEo.js";const ke=z({__name:"UploadsView",props:{eventId:{}},setup(C){const g=C,{t:e}=G(),V=K(),L=R(H),d=J(),u=te(),{getEventById:A}=le(),i=E(()=>fe(g.eventId,10)),p=r(!1),B=E(()=>[{title:A(i.value)?.name??"...",to:{name:"dashboard",params:{eventId:g.eventId}}},{title:e("UploadsView.title"),disabled:!0}]),U=[25,50,100],m=r(U[0]),w=r(0),T=r(1),y=r([]),c=r(""),f=r(null),$=[{title:e("UploadsView.headers.id"),sortable:!0,key:"id"},{title:e("UploadsView.headers.file"),sortable:!1,key:"file"},{title:e("UploadsView.headers.description"),sortable:!1,key:"description"},{title:e("UploadsView.headers.actions"),sortable:!1,key:"actions",align:"end"}];async function S(t){try{await navigator.clipboard.writeText(t),d.success(e("UploadsView.copySuccess"))}catch{d.error(e("UploadsView.copyFailure"))}}function O(){f.value&&h(f.value)}async function h(t){p.value=!0,f.value=t;try{const o=await oe({path:{event_pk:i.value},query:{...pe(t)}});y.value=o.data.results,w.value=o.data.count}catch(o){d.error(e("UploadsView.loadFailure")),console.error(o)}finally{p.value=!1}}const _=ce(h,250);function M(){c.value="",_({page:1,itemsPerPage:m.value??25,sortBy:[],groupBy:[],search:""})}Z(i,M);async function N(t){const o=e("UploadsView.confirmDelete",{description:t.description||re(t.file)||t.file});await L.value.ifConfirmed(o,async()=>{try{await se({path:{event_pk:i.value,id:t.id}}),d.success(e("UploadsView.deleteSuccess")),O()}catch(s){d.error(me(s,e("UploadsView.deleteFailure"))),console.error(s)}})}function j(t){V.push({name:"uploads-edit",params:{eventId:i.value,id:t}})}function q(){V.push({name:"uploads-new",params:{eventId:i.value}})}return(t,o)=>(I(),D(ne,{key:`uploads-${i.value}`,breadcrumbs:B.value},{default:n(()=>[l(F,null,{default:n(()=>[l(P,null,{default:n(()=>[a(u).canAdd(a(v).UPLOADED_FILE)?(I(),D(k,{key:0,onClick:q},{prepend:n(()=>[l(a(x),{icon:a(X)},null,8,["icon"])]),default:n(()=>[Q(" "+W(a(e)("UploadsView.newUpload")),1)]),_:1})):Y("",!0),l(ee,{modelValue:c.value,"onUpdate:modelValue":o[0]||(o[0]=s=>c.value=s),variant:"outlined",density:"compact",label:a(e)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),l(F,null,{default:n(()=>[l(P,null,{default:n(()=>[l(ue,{"items-per-page":m.value,"onUpdate:itemsPerPage":o[1]||(o[1]=s=>m.value=s),class:"elevation-1 primary","item-value":"id",density:"compact",headers:$,items:y.value,"items-length":w.value,loading:p.value,search:c.value,page:T.value,"items-per-page-options":U,"no-data-text":a(e)("UploadsView.noUploadsFound"),"loading-text":a(e)("UploadsView.loadingUploads"),"onUpdate:options":a(_)},{"item.file":n(({item:s})=>[l(ie,{url:s.file},null,8,["url"])]),"item.actions":n(({item:s})=>[l(k,{icon:"",variant:"text",size:"small",title:a(e)("UploadsView.headers.file"),onClick:b=>S(s.file)},{default:n(()=>[l(a(x),{icon:a(ae)},null,8,["icon"])]),_:1},8,["title","onClick"]),l(de,{"can-edit":a(u).canChange(a(v).UPLOADED_FILE),"can-delete":a(u).canDelete(a(v).UPLOADED_FILE),onEdit:b=>j(s.id),onDelete:b=>N(s)},null,8,["can-edit","can-delete","onEdit","onDelete"])]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{ke as default};
//# sourceMappingURL=UploadsView-CExeZrzo.js.map
