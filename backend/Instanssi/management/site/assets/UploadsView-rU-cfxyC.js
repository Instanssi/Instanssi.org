import{d as z,a as K,u as R,J as G,K as H,v as J,U as Q,b as I,g as D,w as n,e as l,j as a,P as v,V as k,i as W,t as X,k as x,L as Y,D as Z,m as ee,$ as ae,q as te,I as E,s as r,aj as oe,ak as se,H as le}from"./index-DXU74lGt.js";import{V as F,_ as ne}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D4jd1chv.js";import{M as ie,g as re}from"./MediaCell-DW8EQos6.js";import{_ as de}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-CUVfxWfg.js";import{g as ce}from"./query_tools-BInV9OzK.js";import{g as ue}from"./http-BTZWMaMN.js";import{d as pe}from"./debounce-CQ84CrOG.js";import{V as P}from"./VRow-B94Tto0H.js";import{V as me}from"./VDataTableServer-CMLVDy59.js";import{p as fe}from"./parseInt-Bzw_2rWL.js";import"./VContainer-BfWqa_tJ.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-WkXOSlqa.js";import"./useAuditLogUtils-BqNOieoY.js";import"./DateTimeCell.vue_vue_type_script_setup_true_lang-BMnBYvTq.js";import"./datetime-Dz9fjSvq.js";import"./VDataTable-Jd7io3gq.js";const Le=z({__name:"UploadsView",props:{eventId:{}},setup(L){const g=L,{t:e}=K(),U=R(),C=G(H),d=J(),u=te(),{getEventById:A}=le(),i=E(()=>fe(g.eventId,10)),p=r(!1),$=E(()=>[{title:A(i.value)?.name??"...",to:{name:"dashboard",params:{eventId:g.eventId}}},{title:e("UploadsView.title"),disabled:!0}]),V=[25,50,100],m=r(V[0]),y=r(0),B=r(1),w=r([]),c=r(""),f=r(null),T=[{title:e("UploadsView.headers.id"),sortable:!0,key:"id"},{title:e("UploadsView.headers.file"),sortable:!1,key:"file"},{title:e("UploadsView.headers.description"),sortable:!1,key:"description"},{title:e("UploadsView.headers.actions"),sortable:!1,key:"actions",align:"end"}];async function S(o){try{await navigator.clipboard.writeText(o),d.success(e("UploadsView.copySuccess"))}catch{d.error(e("UploadsView.copyFailure"))}}function j(){f.value&&h(f.value)}async function h(o){p.value=!0,f.value=o;try{const s=await se({path:{event_pk:i.value},query:{...ce(o)}});w.value=s.data.results,y.value=s.data.count}catch(s){d.error(e("UploadsView.loadFailure")),console.error(s)}finally{p.value=!1}}const b=pe(h,250);function O(){c.value="",b({page:1,itemsPerPage:m.value??25,sortBy:[],groupBy:[],search:""})}Q(i,O);async function M(o){const s=e("UploadsView.confirmDelete",{description:o.description||re(o.file)||o.file});await C.value.ifConfirmed(s,async()=>{try{await oe({path:{event_pk:i.value,id:o.id}}),d.success(e("UploadsView.deleteSuccess")),j()}catch(t){d.error(ue(t,e("UploadsView.deleteFailure"))),console.error(t)}})}function N(o){U.push({name:"uploads-edit",params:{eventId:i.value,id:o}})}function q(){U.push({name:"uploads-new",params:{eventId:i.value}})}return(o,s)=>(I(),D(ne,{key:`uploads-${i.value}`,breadcrumbs:$.value},{default:n(()=>[l(F,null,{default:n(()=>[l(P,null,{default:n(()=>[a(u).canAdd(a(v).UPLOADED_FILE)?(I(),D(k,{key:0,color:"primary",onClick:q},{prepend:n(()=>[l(a(x),{icon:a(Y)},null,8,["icon"])]),default:n(()=>[W(" "+X(a(e)("UploadsView.newUpload")),1)]),_:1})):Z("",!0),l(ee,{modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=t=>c.value=t),variant:"outlined",density:"compact",label:a(e)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),l(F,null,{default:n(()=>[l(P,null,{default:n(()=>[l(me,{"items-per-page":m.value,"onUpdate:itemsPerPage":s[1]||(s[1]=t=>m.value=t),class:"elevation-1 primary","item-value":"id",density:"compact",headers:T,items:w.value,"items-length":y.value,loading:p.value,search:c.value,page:B.value,"items-per-page-options":V,"no-data-text":a(e)("UploadsView.noUploadsFound"),"loading-text":a(e)("UploadsView.loadingUploads"),"onUpdate:options":a(b)},{"item.file":n(({item:t})=>[l(ie,{url:t.file},null,8,["url"])]),"item.actions":n(({item:t})=>[l(k,{icon:"",variant:"text",size:"small",title:a(e)("UploadsView.headers.file"),onClick:_=>S(t.file)},{default:n(()=>[l(a(x),{icon:a(ae)},null,8,["icon"])]),_:1},8,["title","onClick"]),l(de,{"can-edit":a(u).canChange(a(v).UPLOADED_FILE),"can-delete":a(u).canDelete(a(v).UPLOADED_FILE),"audit-log":{appLabel:"admin_upload",model:"uploadedfile",objectPk:t.id},onEdit:_=>N(t.id),onDelete:_=>M(t)},null,8,["can-edit","can-delete","audit-log","onEdit","onDelete"])]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Le as default};
//# sourceMappingURL=UploadsView-rU-cfxyC.js.map
