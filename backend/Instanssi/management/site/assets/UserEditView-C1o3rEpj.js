import{d as H,a as W,u as X,v as Y,N as Z,O as ee,o as ae,Q as se,b as c,g as v,w as i,e as r,A as le,p as te,B as re,l as ie,j as a,m as u,K as oe,C as ne,V as I,i as M,t as S,k as ue,D as me,s as f,G as D,E as de}from"./index-BSHMv_df.js";import{c as ce,d as ve,a as p,u as fe,b as m,V as pe}from"./index.esm-71TeWLhH.js";import{V as B,_ as be}from"./LayoutBase.vue_vue_type_script_setup_true_lang-C8aKWyeJ.js";import{h}from"./http-BZkoYM_m.js";import{p as P}from"./parseInt-3OpbdfxQ.js";import{V as Ve}from"./VSwitch-DkiL1OKS.js";import"./VContainer--EpXOfw5.js";const De=H({__name:"UserEditView",props:{id:{}},setup(T){const C={username:"username",email:"email",first_name:"firstName",last_name:"lastName",is_active:"isActive"},b=T,{t:l,d:j}=W(),G=X(),o=Y(),{getLatestEvent:$}=de(),V=f(!1),g=f(!1),k=f(""),U=f(""),n=D(()=>b.id!==void 0),L=D(()=>d.value.value?l("UserDialog.labels.isActive"):l("UserDialog.labels.isNotActive")),q=D(()=>{const s=$(),e=[{title:s?.name??"...",to:s?{name:"dashboard",params:{eventId:s.id}}:void 0},{title:l("UsersView.title"),to:{name:"users"}}];return n.value?e.push({title:k.value||"...",disabled:!0}):e.push({title:l("UserEditView.newTitle"),disabled:!0}),e}),J=ce({firstName:p().min(0).max(150),lastName:p().min(0).max(150),username:p().required().min(1).max(150),email:p().email().required().min(1).max(254),isActive:ve()}),{handleSubmit:R,setValues:z,setErrors:x,meta:K}=fe({validationSchema:J,initialValues:{firstName:"",lastName:"",username:"",email:"",isActive:!0}}),N=m("firstName"),y=m("lastName"),_=m("username"),A=m("email"),d=m("isActive"),E=R(async s=>{g.value=!0;let e;n.value?e=await Q(P(b.id,10),s):e=await O(s),g.value=!1,e&&w()});function F(s){return{first_name:s.firstName,last_name:s.lastName,email:s.email,username:s.username,is_active:s.isActive}}async function O(s){try{return await Z({body:F(s)}),o.success(l("UserDialog.createSuccess")),!0}catch(e){h(e,x,o,l("UserDialog.createFailure"),C)}return!1}async function Q(s,e){try{return await ee({path:{id:s},body:F(e)}),o.success(l("UserDialog.editSuccess")),!0}catch(t){h(t,x,o,l("UserDialog.editFailure"),C)}return!1}function w(){G.push({name:"users"})}return ae(async()=>{if(n.value){V.value=!0;try{const e=(await se({path:{id:P(b.id,10)}})).data;k.value=e.username,U.value=j(e.date_joined,"long"),z({firstName:e.first_name??"",lastName:e.last_name??"",email:e.email??"",username:e.username,isActive:e.is_active??!0})}catch(s){o.error(l("UserEditView.loadFailure")),console.error(s),w()}finally{V.value=!1}}}),(s,e)=>(c(),v(be,{breadcrumbs:q.value},{default:i(()=>[V.value?(c(),v(B,{key:0,class:"d-flex justify-center my-8"},{default:i(()=>[r(le,{indeterminate:"",size:"64"})]),_:1})):(c(),v(B,{key:1},{default:i(()=>[r(te,null,{default:i(()=>[r(re,null,{default:i(()=>[r(pe,{onSubmit:ie(a(E),["prevent"])},{default:i(()=>[r(u,{modelValue:a(_).value.value,"onUpdate:modelValue":e[0]||(e[0]=t=>a(_).value.value=t),"error-messages":a(_).errorMessage.value,variant:"outlined",readonly:n.value,label:a(l)("UserDialog.labels.userName")+" *"},null,8,["modelValue","error-messages","readonly","label"]),n.value?(c(),v(u,{key:0,modelValue:U.value,"onUpdate:modelValue":e[1]||(e[1]=t=>U.value=t),variant:"outlined",readonly:"",label:a(l)("UserDialog.labels.dateJoined")},null,8,["modelValue","label"])):oe("",!0),r(u,{modelValue:a(A).value.value,"onUpdate:modelValue":e[2]||(e[2]=t=>a(A).value.value=t),"error-messages":a(A).errorMessage.value,variant:"outlined",label:a(l)("UserDialog.labels.email")+" *"},null,8,["modelValue","error-messages","label"]),r(u,{modelValue:a(N).value.value,"onUpdate:modelValue":e[3]||(e[3]=t=>a(N).value.value=t),"error-messages":a(N).errorMessage.value,variant:"outlined",label:a(l)("UserDialog.labels.firstName")},null,8,["modelValue","error-messages","label"]),r(u,{modelValue:a(y).value.value,"onUpdate:modelValue":e[4]||(e[4]=t=>a(y).value.value=t),"error-messages":a(y).errorMessage.value,variant:"outlined",label:a(l)("UserDialog.labels.lastName")},null,8,["modelValue","error-messages","label"]),r(Ve,{modelValue:a(d).value.value,"onUpdate:modelValue":e[5]||(e[5]=t=>a(d).value.value=t),"error-messages":a(d).errorMessage.value,label:L.value},null,8,["modelValue","error-messages","label"])]),_:1},8,["onSubmit"])]),_:1}),r(ne,{class:"justify-end"},{default:i(()=>[r(I,{variant:"text",onClick:w},{default:i(()=>[M(S(a(l)("General.cancel")),1)]),_:1}),r(I,{variant:"elevated",color:"primary",loading:g.value,disabled:!a(K).valid,onClick:a(E)},{prepend:i(()=>[r(a(ue),{icon:a(me)},null,8,["icon"])]),default:i(()=>[M(" "+S(a(l)("General.save")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1}))]),_:1},8,["breadcrumbs"]))}});export{De as default};
//# sourceMappingURL=UserEditView-C1o3rEpj.js.map
