import{d as H,a as K,u as W,v as X,O as Y,Q as Z,o as ee,R as ae,b as c,g as v,w as i,e as r,A as se,p as le,B as te,l as re,j as a,m as n,D as ie,C as oe,V as M,i as S,t as E,k as ue,G as ne,s as f,I as D}from"./index-DXU74lGt.js";import{c as me,d as de,a as p,u as ce,b as m}from"./index.esm-DWTrtXO7.js";import{V as B,_ as ve}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D4jd1chv.js";import{h as P}from"./http-BTZWMaMN.js";import{p as T}from"./parseInt-Bzw_2rWL.js";import{V as fe}from"./VForm-C430u1Uz.js";import{V as pe}from"./VSwitch-DB1fJMny.js";import"./VContainer-BfWqa_tJ.js";const we=H({__name:"UserEditView",props:{id:{}},setup(h){const C={username:"username",email:"email",first_name:"firstName",last_name:"lastName",is_active:"isActive"},V=h,{t:l,d:j}=K(),G=W(),o=X(),b=f(!1),g=f(!1),k=f(""),U=f(""),u=D(()=>V.id!==void 0),$=D(()=>d.value.value?l("UserDialog.labels.isActive"):l("UserDialog.labels.isNotActive")),R=D(()=>{const s=[{title:l("UsersView.title"),to:{name:"users"}}];return u.value?s.push({title:k.value||"...",disabled:!0}):s.push({title:l("UserEditView.newTitle"),disabled:!0}),s}),q=me({firstName:p().min(0).max(150),lastName:p().min(0).max(150),username:p().required().min(1).max(150),email:p().email().required().min(1).max(254),isActive:de()}),{handleSubmit:J,setValues:L,setErrors:x,meta:z}=ce({validationSchema:q,initialValues:{firstName:"",lastName:"",username:"",email:"",isActive:!0}}),y=m("firstName"),N=m("lastName"),_=m("username"),A=m("email"),d=m("isActive"),F=J(async s=>{g.value=!0;let e;u.value?e=await Q(T(V.id,10),s):e=await O(s),g.value=!1,e&&w()});function I(s){return{first_name:s.firstName,last_name:s.lastName,email:s.email,username:s.username,is_active:s.isActive}}async function O(s){try{return await Y({body:I(s)}),o.success(l("UserDialog.createSuccess")),!0}catch(e){P(e,x,o,l("UserDialog.createFailure"),C)}return!1}async function Q(s,e){try{return await Z({path:{id:s},body:I(e)}),o.success(l("UserDialog.editSuccess")),!0}catch(t){P(t,x,o,l("UserDialog.editFailure"),C)}return!1}function w(){G.push({name:"users"})}return ee(async()=>{if(u.value){b.value=!0;try{const e=(await ae({path:{id:T(V.id,10)}})).data;k.value=e.username,U.value=j(e.date_joined,"long"),L({firstName:e.first_name??"",lastName:e.last_name??"",email:e.email??"",username:e.username,isActive:e.is_active??!0})}catch(s){o.error(l("UserEditView.loadFailure")),console.error(s),w()}finally{b.value=!1}}}),(s,e)=>(c(),v(ve,{breadcrumbs:R.value},{default:i(()=>[b.value?(c(),v(B,{key:0,class:"d-flex justify-center my-8"},{default:i(()=>[r(se,{indeterminate:"",size:"64"})]),_:1})):(c(),v(B,{key:1},{default:i(()=>[r(le,null,{default:i(()=>[r(te,null,{default:i(()=>[r(fe,{onSubmit:re(a(F),["prevent"])},{default:i(()=>[r(n,{modelValue:a(_).value.value,"onUpdate:modelValue":e[0]||(e[0]=t=>a(_).value.value=t),"error-messages":a(_).errorMessage.value,variant:"outlined",readonly:u.value,label:a(l)("UserDialog.labels.userName")+" *"},null,8,["modelValue","error-messages","readonly","label"]),u.value?(c(),v(n,{key:0,modelValue:U.value,"onUpdate:modelValue":e[1]||(e[1]=t=>U.value=t),variant:"outlined",readonly:"",label:a(l)("UserDialog.labels.dateJoined")},null,8,["modelValue","label"])):ie("",!0),r(n,{modelValue:a(A).value.value,"onUpdate:modelValue":e[2]||(e[2]=t=>a(A).value.value=t),"error-messages":a(A).errorMessage.value,variant:"outlined",label:a(l)("UserDialog.labels.email")+" *"},null,8,["modelValue","error-messages","label"]),r(n,{modelValue:a(y).value.value,"onUpdate:modelValue":e[3]||(e[3]=t=>a(y).value.value=t),"error-messages":a(y).errorMessage.value,variant:"outlined",label:a(l)("UserDialog.labels.firstName")},null,8,["modelValue","error-messages","label"]),r(n,{modelValue:a(N).value.value,"onUpdate:modelValue":e[4]||(e[4]=t=>a(N).value.value=t),"error-messages":a(N).errorMessage.value,variant:"outlined",label:a(l)("UserDialog.labels.lastName")},null,8,["modelValue","error-messages","label"]),r(pe,{modelValue:a(d).value.value,"onUpdate:modelValue":e[5]||(e[5]=t=>a(d).value.value=t),"error-messages":a(d).errorMessage.value,label:$.value},null,8,["modelValue","error-messages","label"])]),_:1},8,["onSubmit"])]),_:1}),r(oe,{class:"justify-end"},{default:i(()=>[r(M,{variant:"text",onClick:w},{default:i(()=>[S(E(a(l)("General.cancel")),1)]),_:1}),r(M,{variant:"elevated",color:"primary",loading:g.value,disabled:!a(z).valid,onClick:a(F)},{prepend:i(()=>[r(a(ue),{icon:a(ne)},null,8,["icon"])]),default:i(()=>[S(" "+E(a(l)("General.save")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1}))]),_:1},8,["breadcrumbs"]))}});export{we as default};
//# sourceMappingURL=UserEditView-DAraVkan.js.map
