{"version":3,"file":"UserEditView-fUuyGrtr.js","sources":["../../../../../admin/src/views/users/UserEditView.vue"],"sourcesContent":["<template>\n    <LayoutBase :breadcrumbs=\"breadcrumbs\">\n        <v-col v-if=\"loading\" class=\"d-flex justify-center my-8\">\n            <v-progress-circular indeterminate size=\"64\" />\n        </v-col>\n        <v-col v-else>\n            <v-card>\n                <v-card-text>\n                    <v-form @submit.prevent=\"submit\">\n                        <v-text-field\n                            v-model=\"username.value.value\"\n                            :error-messages=\"username.errorMessage.value\"\n                            variant=\"outlined\"\n                            :readonly=\"isEditMode\"\n                            :label=\"t('UserDialog.labels.userName') + ' *'\"\n                        />\n                        <v-text-field\n                            v-if=\"isEditMode\"\n                            v-model=\"dateJoined\"\n                            variant=\"outlined\"\n                            readonly\n                            :label=\"t('UserDialog.labels.dateJoined')\"\n                        />\n                        <v-text-field\n                            v-model=\"email.value.value\"\n                            :error-messages=\"email.errorMessage.value\"\n                            variant=\"outlined\"\n                            :label=\"t('UserDialog.labels.email') + ' *'\"\n                        />\n                        <v-text-field\n                            v-model=\"firstName.value.value\"\n                            :error-messages=\"firstName.errorMessage.value\"\n                            variant=\"outlined\"\n                            :label=\"t('UserDialog.labels.firstName')\"\n                        />\n                        <v-text-field\n                            v-model=\"lastName.value.value\"\n                            :error-messages=\"lastName.errorMessage.value\"\n                            variant=\"outlined\"\n                            :label=\"t('UserDialog.labels.lastName')\"\n                        />\n                        <v-switch\n                            v-model=\"isActive.value.value\"\n                            :error-messages=\"isActive.errorMessage.value\"\n                            :label=\"isActiveLabel\"\n                        />\n                    </v-form>\n                </v-card-text>\n                <v-card-actions class=\"justify-end\">\n                    <v-btn variant=\"text\" @click=\"goBack\">\n                        {{ t(\"General.cancel\") }}\n                    </v-btn>\n                    <v-btn\n                        variant=\"elevated\"\n                        color=\"primary\"\n                        :loading=\"saving\"\n                        :disabled=\"!meta.valid\"\n                        @click=\"submit\"\n                    >\n                        <template #prepend>\n                            <FontAwesomeIcon :icon=\"faSave\" />\n                        </template>\n                        {{ t(\"General.save\") }}\n                    </v-btn>\n                </v-card-actions>\n            </v-card>\n        </v-col>\n    </LayoutBase>\n</template>\n\n<script setup lang=\"ts\">\nimport { faFloppyDisk as faSave } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/vue-fontawesome\";\nimport { parseInt } from \"lodash-es\";\nimport { type GenericObject, useField, useForm } from \"vee-validate\";\nimport { computed, onMounted, ref } from \"vue\";\nimport { useI18n } from \"vue-i18n\";\nimport { useRouter } from \"vue-router\";\nimport { useToast } from \"vue-toastification\";\nimport { boolean as yupBoolean, object as yupObject, string as yupString } from \"yup\";\n\nimport * as api from \"@/api\";\nimport LayoutBase, { type BreadcrumbItem } from \"@/components/layout/LayoutBase.vue\";\nimport { handleApiError, type FieldMapping } from \"@/utils/http\";\n\n/** Maps API field names (snake_case) to form field names (camelCase) */\nconst API_FIELD_MAPPING: FieldMapping = {\n    username: \"username\",\n    email: \"email\",\n    first_name: \"firstName\",\n    last_name: \"lastName\",\n    is_active: \"isActive\",\n};\n\nconst props = defineProps<{\n    id?: string;\n}>();\n\nconst { t, d } = useI18n();\nconst router = useRouter();\nconst toast = useToast();\n\nconst loading = ref(false);\nconst saving = ref(false);\nconst userName = ref<string>(\"\");\nconst dateJoined = ref<string>(\"\");\nconst isEditMode = computed(() => props.id !== undefined);\n\nconst isActiveLabel = computed(() =>\n    isActive.value.value ? t(\"UserDialog.labels.isActive\") : t(\"UserDialog.labels.isNotActive\")\n);\n\nconst breadcrumbs = computed<BreadcrumbItem[]>(() => {\n    const items: BreadcrumbItem[] = [{ title: t(\"UsersView.title\"), to: { name: \"users\" } }];\n    if (isEditMode.value) {\n        items.push({ title: userName.value || \"...\", disabled: true });\n    } else {\n        items.push({ title: t(\"UserEditView.newTitle\"), disabled: true });\n    }\n    return items;\n});\n\n// Form validation\nconst validationSchema = yupObject({\n    firstName: yupString().min(0).max(150),\n    lastName: yupString().min(0).max(150),\n    username: yupString().required().min(1).max(150),\n    email: yupString().email().required().min(1).max(254),\n    isActive: yupBoolean(),\n});\nconst { handleSubmit, setValues, setErrors, meta } = useForm({\n    validationSchema,\n    initialValues: {\n        firstName: \"\",\n        lastName: \"\",\n        username: \"\",\n        email: \"\",\n        isActive: true,\n    },\n});\nconst firstName = useField<string>(\"firstName\");\nconst lastName = useField<string>(\"lastName\");\nconst username = useField<string>(\"username\");\nconst email = useField<string>(\"email\");\nconst isActive = useField<boolean>(\"isActive\");\n\nconst submit = handleSubmit(async (values) => {\n    saving.value = true;\n    let ok: boolean;\n    if (isEditMode.value) {\n        ok = await editItem(parseInt(props.id!, 10), values);\n    } else {\n        ok = await createItem(values);\n    }\n    saving.value = false;\n    if (ok) {\n        goBack();\n    }\n});\n\nfunction buildBody(values: GenericObject) {\n    return {\n        first_name: values.firstName,\n        last_name: values.lastName,\n        email: values.email,\n        username: values.username,\n        is_active: values.isActive,\n    };\n}\n\nasync function createItem(values: GenericObject) {\n    try {\n        await api.adminUsersCreate({\n            body: buildBody(values),\n        });\n        toast.success(t(\"UserDialog.createSuccess\"));\n        return true;\n    } catch (e) {\n        handleApiError(e, setErrors, toast, t(\"UserDialog.createFailure\"), API_FIELD_MAPPING);\n    }\n    return false;\n}\n\nasync function editItem(itemId: number, values: GenericObject) {\n    try {\n        await api.adminUsersPartialUpdate({\n            path: { id: itemId },\n            body: buildBody(values),\n        });\n        toast.success(t(\"UserDialog.editSuccess\"));\n        return true;\n    } catch (e) {\n        handleApiError(e, setErrors, toast, t(\"UserDialog.editFailure\"), API_FIELD_MAPPING);\n    }\n    return false;\n}\n\nfunction goBack() {\n    router.push({ name: \"users\" });\n}\n\nonMounted(async () => {\n    if (isEditMode.value) {\n        loading.value = true;\n        try {\n            const response = await api.adminUsersRetrieve({\n                path: { id: parseInt(props.id!, 10) },\n            });\n            const item = response.data!;\n            userName.value = item.username;\n            dateJoined.value = d(item.date_joined, \"long\");\n            setValues({\n                firstName: item.first_name ?? \"\",\n                lastName: item.last_name ?? \"\",\n                email: item.email ?? \"\",\n                username: item.username,\n                isActive: item.is_active ?? true,\n            });\n        } catch (e) {\n            toast.error(t(\"UserEditView.loadFailure\"));\n            console.error(e);\n            goBack();\n        } finally {\n            loading.value = false;\n        }\n    }\n});\n</script>\n"],"names":["API_FIELD_MAPPING","props","__props","t","d","useI18n","router","useRouter","toast","useToast","loading","ref","saving","userName","dateJoined","isEditMode","computed","isActiveLabel","isActive","breadcrumbs","items","validationSchema","yupObject","yupString","yupBoolean","handleSubmit","setValues","setErrors","meta","useForm","firstName","useField","lastName","username","email","submit","values","ok","editItem","parseInt","createItem","goBack","buildBody","api.adminUsersCreate","handleApiError","itemId","api.adminUsersPartialUpdate","e","onMounted","item","api.adminUsersRetrieve","_createBlock","LayoutBase","_component_v_col","_createVNode","_component_v_progress_circular","_component_v_card","_component_v_card_text","_component_v_form","_unref","_component_v_text_field","$event","_component_v_switch","_component_v_card_actions","_component_v_btn","FontAwesomeIcon","faSave","_createTextVNode"],"mappings":"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"}