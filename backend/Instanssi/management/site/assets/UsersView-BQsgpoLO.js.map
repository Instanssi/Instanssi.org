{"version":3,"file":"UsersView-BQsgpoLO.js","sources":["../../../../../admin/src/views/users/UsersView.vue"],"sourcesContent":["<template>\n    <LayoutBase :breadcrumbs=\"breadcrumbs\">\n        <v-col>\n            <v-row>\n                <v-btn v-if=\"auth.canAdd(PermissionTarget.USER)\" @click=\"createUser\">\n                    <template #prepend>\n                        <FontAwesomeIcon :icon=\"faPlus\" />\n                    </template>\n                    {{ t(\"UsersView.newUser\") }}\n                </v-btn>\n                <v-text-field\n                    v-model=\"search\"\n                    variant=\"outlined\"\n                    density=\"compact\"\n                    :label=\"t('General.search')\"\n                    style=\"max-width: 400px\"\n                    class=\"ma-0 pa-0 ml-4\"\n                    clearable\n                />\n            </v-row>\n        </v-col>\n        <v-col>\n            <v-row>\n                <v-data-table-server\n                    v-model:items-per-page=\"perPage\"\n                    class=\"elevation-1 primary\"\n                    item-value=\"id\"\n                    density=\"compact\"\n                    :headers=\"headers\"\n                    :items=\"users\"\n                    :items-length=\"totalItems\"\n                    :loading=\"loading\"\n                    :page=\"currentPage\"\n                    :search=\"search\"\n                    :items-per-page-options=\"pageSizeOptions\"\n                    :no-data-text=\"t('UsersView.noUsersFound')\"\n                    :loading-text=\"t('UsersView.loadingUsers')\"\n                    @update:options=\"debouncedLoad\"\n                >\n                    <template #item.is_superuser=\"{ item }\">\n                        <BooleanIcon :value=\"item.is_superuser\" />\n                    </template>\n                    <template #item.is_active=\"{ item }\">\n                        <BooleanIcon :value=\"item.is_active\" />\n                    </template>\n                    <template #item.date_joined=\"{ item }\">\n                        <DateTimeCell :value=\"item.date_joined\" />\n                    </template>\n                    <template #item.actions=\"{ item }\">\n                        <TableActionButtons\n                            :can-edit=\"auth.canChange(PermissionTarget.USER)\"\n                            :can-delete=\"auth.canDelete(PermissionTarget.USER)\"\n                            @edit=\"editUser(item.id)\"\n                            @delete=\"deleteUser(item)\"\n                        />\n                    </template>\n                </v-data-table-server>\n            </v-row>\n        </v-col>\n    </LayoutBase>\n</template>\n\n<script setup lang=\"ts\">\nimport { faPlus } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/vue-fontawesome\";\nimport { debounce } from \"lodash-es\";\nimport { type Ref, computed, inject, ref } from \"vue\";\nimport { useI18n } from \"vue-i18n\";\nimport { useRouter } from \"vue-router\";\nimport { useToast } from \"vue-toastification\";\nimport { type VDataTable, type VDataTableServer } from \"vuetify/components\";\n\nimport * as api from \"@/api\";\nimport type { User } from \"@/api\";\nimport BooleanIcon from \"@/components/table/BooleanIcon.vue\";\nimport DateTimeCell from \"@/components/table/DateTimeCell.vue\";\nimport LayoutBase, { type BreadcrumbItem } from \"@/components/layout/LayoutBase.vue\";\nimport TableActionButtons from \"@/components/table/TableActionButtons.vue\";\nimport { PermissionTarget, useAuth } from \"@/services/auth\";\nimport { useEvents } from \"@/services/events\";\nimport { type LoadArgs, getLoadArgs } from \"@/services/utils/query_tools\";\nimport { confirmDialogKey } from \"@/symbols\";\nimport type { ConfirmDialogType } from \"@/symbols\";\nimport { getApiErrorMessage } from \"@/utils/http\";\n\ntype ReadonlyHeaders = VDataTable[\"$props\"][\"headers\"];\n\nconst { t } = useI18n();\nconst router = useRouter();\nconst confirmDialog: ConfirmDialogType = inject(confirmDialogKey)!;\nconst toast = useToast();\nconst auth = useAuth();\nconst { getLatestEvent } = useEvents();\n\nconst breadcrumbs = computed<BreadcrumbItem[]>(() => {\n    const event = getLatestEvent();\n    return [\n        {\n            title: event?.name ?? \"...\",\n            to: event ? { name: \"dashboard\", params: { eventId: event.id } } : undefined,\n        },\n        { title: t(\"UsersView.title\"), disabled: true },\n    ];\n});\n\nconst loading = ref(false);\nconst pageSizeOptions = [25, 50, 100];\nconst perPage = ref(pageSizeOptions[0]);\nconst totalItems = ref(0);\nconst currentPage = ref(1);\nconst users: Ref<User[]> = ref([]);\nconst search = ref(\"\");\nconst lastLoadArgs: Ref<LoadArgs | null> = ref(null);\nconst headers: ReadonlyHeaders = [\n    {\n        title: t(\"UsersView.headers.id\"),\n        sortable: true,\n        key: \"id\",\n    },\n    {\n        title: t(\"UsersView.headers.userName\"),\n        sortable: false,\n        key: \"username\",\n    },\n    {\n        title: t(\"UsersView.headers.firstName\"),\n        sortable: true,\n        key: \"first_name\",\n    },\n    {\n        title: t(\"UsersView.headers.lastName\"),\n        sortable: true,\n        key: \"last_name\",\n    },\n    {\n        title: t(\"UsersView.headers.email\"),\n        sortable: true,\n        key: \"email\",\n    },\n    {\n        title: t(\"UsersView.headers.superuser\"),\n        sortable: false,\n        key: \"is_superuser\",\n    },\n    {\n        title: t(\"UsersView.headers.active\"),\n        sortable: false,\n        key: \"is_active\",\n    },\n    {\n        title: t(\"UsersView.headers.dateJoined\"),\n        sortable: false,\n        key: \"date_joined\",\n    },\n    {\n        title: t(\"UsersView.headers.actions\"),\n        sortable: false,\n        key: \"actions\",\n        align: \"end\",\n    },\n];\n\nfunction flushData() {\n    if (lastLoadArgs.value) {\n        load(lastLoadArgs.value);\n    }\n}\n\nasync function load(args: LoadArgs) {\n    loading.value = true;\n    lastLoadArgs.value = args;\n    try {\n        const response = await api.adminUsersList({ query: getLoadArgs(args) });\n        users.value = response.data!.results;\n        totalItems.value = response.data!.count;\n    } catch (e) {\n        toast.error(t(\"UsersView.loadFailure\"));\n        console.error(e);\n    } finally {\n        loading.value = false;\n    }\n}\n\nconst debouncedLoad = debounce(load, 250); // Don't murderate the server API\n\nasync function deleteUser(item: User): Promise<void> {\n    const text = t(\"UsersView.confirmDelete\", item);\n    const ok = await confirmDialog.value!.confirm(text);\n    if (ok) {\n        try {\n            await api.adminUsersDestroy({ path: { id: item.id } });\n            flushData();\n            toast.success(t(\"UsersView.deleteSuccess\"));\n        } catch (e) {\n            toast.error(getApiErrorMessage(e, t(\"UsersView.deleteFailure\")));\n            console.error(e);\n        }\n    }\n}\n\nfunction editUser(id: number): void {\n    router.push({ name: \"users-edit\", params: { id } });\n}\n\nfunction createUser(): void {\n    router.push({ name: \"users-new\" });\n}\n</script>\n"],"names":["t","useI18n","router","useRouter","confirmDialog","inject","confirmDialogKey","toast","useToast","auth","useAuth","getLatestEvent","useEvents","breadcrumbs","computed","event","loading","ref","pageSizeOptions","perPage","totalItems","currentPage","users","search","lastLoadArgs","headers","flushData","load","args","response","api.adminUsersList","getLoadArgs","e","debouncedLoad","debounce","deleteUser","item","text","api.adminUsersDestroy","getApiErrorMessage","editUser","id","createUser","_createBlock","LayoutBase","_createVNode","_component_v_col","_component_v_row","_unref","PermissionTarget","_component_v_btn","FontAwesomeIcon","faPlus","_createTextVNode","_component_v_text_field","$event","_component_v_data_table_server","_withCtx","BooleanIcon","DateTimeCell","TableActionButtons"],"mappings":"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"}