import{d as R,a as $,u as j,J as I,K as L,v as K,L as q,b,g as h,w as o,e as l,j as e,P as V,V as J,i as M,t as z,k as G,M as W,D as X,m as H,N as k,O as x,q as Q,s as c,W as Y,X as Z}from"./index-CQkWvXOv.js";import{_ as S}from"./BooleanIcon.vue_vue_type_script_setup_true_lang-BUZkEwsX.js";import{_ as ee}from"./DateTimeCell.vue_vue_type_script_setup_true_lang-DaLynL44.js";import{V as D,_ as ae}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D5aCeQDf.js";import{_ as se}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-DepTf6Bi.js";import{u as te,d as le}from"./useTableState-CutuDm2i.js";import{g as ie}from"./query_tools-BInV9OzK.js";import{g as re}from"./http-CET7UDul.js";import{V as T}from"./VRow-CXIXhuhq.js";import{V as oe}from"./VDataTableServer-C6tuZDKn.js";import"./datetime-Dz9fjSvq.js";import"./VContainer-DqJ8gu3P.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-1MnYozFL.js";import"./useAuditLogUtils-BdjF9k7b.js";import"./VDataTable-f5_9vewM.js";const ke=R({__name:"UsersView",setup(ne){const{t:a}=$(),U=j(),A=I(L),p=K(),f=Q(),B=[{title:a("UsersView.title"),disabled:!0}],i=te({filterKeys:["is_active","is_staff"]}),v=c(!1),n=i.useBooleanFilter("is_active"),u=i.useBooleanFilter("is_staff"),y=c(0),w=c([]),d=c(null),O=[{title:a("UsersView.headers.id"),sortable:!0,key:"id"},{title:a("UsersView.headers.userName"),sortable:!0,key:"username"},{title:a("UsersView.headers.firstName"),sortable:!0,key:"first_name"},{title:a("UsersView.headers.lastName"),sortable:!0,key:"last_name"},{title:a("UsersView.headers.email"),sortable:!0,key:"email"},{title:a("UsersView.headers.superuser"),sortable:!1,key:"is_superuser"},{title:a("UsersView.headers.active"),sortable:!1,key:"is_active"},{title:a("UsersView.headers.dateJoined"),sortable:!0,key:"date_joined"},{title:a("UsersView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function F(){d.value&&_(d.value)}async function _(r){v.value=!0,d.value=r;try{const t=await Z({query:{...ie(r),...n.value!==null?{is_active:n.value}:{},...u.value!==null?{is_staff:u.value}:{}}});w.value=t.data.results,y.value=t.data.count}catch(t){p.error(a("UsersView.loadFailure")),console.error(t)}finally{v.value=!1}}q([n,u],()=>{d.value&&g({...d.value,page:1})});const g=le(_,250);function N(r){i.onOptionsUpdate(r),g(r)}async function P(r){const t=a("UsersView.confirmDelete",r);if(await A.value.confirm(t))try{await Y({path:{id:r.id}}),F(),p.success(a("UsersView.deleteSuccess"))}catch(m){p.error(re(m,a("UsersView.deleteFailure"))),console.error(m)}}function C(r){U.push({name:"users-edit",params:{id:r}})}function E(){U.push({name:"users-new"})}return(r,t)=>(b(),h(ae,{breadcrumbs:B},{default:o(()=>[l(D,null,{default:o(()=>[l(T,null,{default:o(()=>[e(f).canAdd(e(V).USER)?(b(),h(J,{key:0,color:"primary",onClick:E},{prepend:o(()=>[l(e(G),{icon:e(W)},null,8,["icon"])]),default:o(()=>[M(" "+z(e(a)("UsersView.newUser")),1)]),_:1})):X("",!0),l(H,{modelValue:e(i).search.value,"onUpdate:modelValue":t[0]||(t[0]=s=>e(i).search.value=s),variant:"outlined",density:"compact",label:e(a)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"]),l(k,{modelValue:e(n),"onUpdate:modelValue":t[1]||(t[1]=s=>x(n)?n.value=s:null),items:[{title:e(a)("UsersView.allStatuses"),value:null},{title:e(a)("UsersView.activeOnly"),value:!0},{title:e(a)("UsersView.inactiveOnly"),value:!1}],variant:"outlined",density:"compact",label:e(a)("UsersView.filterByStatus"),style:{"max-width":"200px"},class:"ma-0 pa-0 ml-4"},null,8,["modelValue","items","label"]),l(k,{modelValue:e(u),"onUpdate:modelValue":t[2]||(t[2]=s=>x(u)?u.value=s:null),items:[{title:e(a)("UsersView.allTypes"),value:null},{title:e(a)("UsersView.staffOnly"),value:!0},{title:e(a)("UsersView.regularOnly"),value:!1}],variant:"outlined",density:"compact",label:e(a)("UsersView.filterByType"),style:{"max-width":"200px"},class:"ma-0 pa-0 ml-4"},null,8,["modelValue","items","label"])]),_:1})]),_:1}),l(D,null,{default:o(()=>[l(T,null,{default:o(()=>[l(oe,{"items-per-page":e(i).perPage.value,"onUpdate:itemsPerPage":t[3]||(t[3]=s=>e(i).perPage.value=s),"sort-by":e(i).sortByArray.value,class:"elevation-1 primary","item-value":"id",density:"compact",headers:O,items:w.value,"items-length":y.value,loading:v.value,page:e(i).page.value,search:e(i).search.value,"items-per-page-options":e(i).pageSizeOptions,"no-data-text":e(a)("UsersView.noUsersFound"),"loading-text":e(a)("UsersView.loadingUsers"),"onUpdate:options":N},{"item.is_superuser":o(({item:s})=>[l(S,{value:s.is_superuser},null,8,["value"])]),"item.is_active":o(({item:s})=>[l(S,{value:s.is_active},null,8,["value"])]),"item.date_joined":o(({item:s})=>[l(ee,{value:s.date_joined},null,8,["value"])]),"item.actions":o(({item:s})=>[l(se,{"can-edit":e(f).canChange(e(V).USER),"can-delete":e(f).canDelete(e(V).USER),onEdit:m=>C(s.id),onDelete:m=>P(s)},null,8,["can-edit","can-delete","onEdit","onDelete"])]),_:1},8,["items-per-page","sort-by","items","items-length","loading","page","search","items-per-page-options","no-data-text","loading-text"])]),_:1})]),_:1})]),_:1}))}});export{ke as default};
//# sourceMappingURL=UsersView-DTb1H_Fr.js.map
