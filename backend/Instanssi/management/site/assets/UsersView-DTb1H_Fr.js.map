{"version":3,"file":"UsersView-DTb1H_Fr.js","sources":["../../../../../admin/src/views/users/UsersView.vue"],"sourcesContent":["<template>\n    <LayoutBase :breadcrumbs=\"breadcrumbs\">\n        <v-col>\n            <v-row>\n                <v-btn\n                    v-if=\"auth.canAdd(PermissionTarget.USER)\"\n                    color=\"primary\"\n                    @click=\"createUser\"\n                >\n                    <template #prepend>\n                        <FontAwesomeIcon :icon=\"faPlus\" />\n                    </template>\n                    {{ t(\"UsersView.newUser\") }}\n                </v-btn>\n                <v-text-field\n                    v-model=\"tableState.search.value\"\n                    variant=\"outlined\"\n                    density=\"compact\"\n                    :label=\"t('General.search')\"\n                    style=\"max-width: 400px\"\n                    class=\"ma-0 pa-0 ml-4\"\n                    clearable\n                />\n                <v-select\n                    v-model=\"filterIsActive\"\n                    :items=\"[\n                        { title: t('UsersView.allStatuses'), value: null },\n                        { title: t('UsersView.activeOnly'), value: true },\n                        { title: t('UsersView.inactiveOnly'), value: false },\n                    ]\"\n                    variant=\"outlined\"\n                    density=\"compact\"\n                    :label=\"t('UsersView.filterByStatus')\"\n                    style=\"max-width: 200px\"\n                    class=\"ma-0 pa-0 ml-4\"\n                />\n                <v-select\n                    v-model=\"filterIsStaff\"\n                    :items=\"[\n                        { title: t('UsersView.allTypes'), value: null },\n                        { title: t('UsersView.staffOnly'), value: true },\n                        { title: t('UsersView.regularOnly'), value: false },\n                    ]\"\n                    variant=\"outlined\"\n                    density=\"compact\"\n                    :label=\"t('UsersView.filterByType')\"\n                    style=\"max-width: 200px\"\n                    class=\"ma-0 pa-0 ml-4\"\n                />\n            </v-row>\n        </v-col>\n        <v-col>\n            <v-row>\n                <v-data-table-server\n                    v-model:items-per-page=\"tableState.perPage.value\"\n                    :sort-by=\"tableState.sortByArray.value\"\n                    class=\"elevation-1 primary\"\n                    item-value=\"id\"\n                    density=\"compact\"\n                    :headers=\"headers\"\n                    :items=\"users\"\n                    :items-length=\"totalItems\"\n                    :loading=\"loading\"\n                    :page=\"tableState.page.value\"\n                    :search=\"tableState.search.value\"\n                    :items-per-page-options=\"tableState.pageSizeOptions\"\n                    :no-data-text=\"t('UsersView.noUsersFound')\"\n                    :loading-text=\"t('UsersView.loadingUsers')\"\n                    @update:options=\"onTableOptionsUpdate\"\n                >\n                    <template #item.is_superuser=\"{ item }\">\n                        <BooleanIcon :value=\"item.is_superuser\" />\n                    </template>\n                    <template #item.is_active=\"{ item }\">\n                        <BooleanIcon :value=\"item.is_active\" />\n                    </template>\n                    <template #item.date_joined=\"{ item }\">\n                        <DateTimeCell :value=\"item.date_joined\" />\n                    </template>\n                    <template #item.actions=\"{ item }\">\n                        <TableActionButtons\n                            :can-edit=\"auth.canChange(PermissionTarget.USER)\"\n                            :can-delete=\"auth.canDelete(PermissionTarget.USER)\"\n                            @edit=\"editUser(item.id)\"\n                            @delete=\"deleteUser(item)\"\n                        />\n                    </template>\n                </v-data-table-server>\n            </v-row>\n        </v-col>\n    </LayoutBase>\n</template>\n\n<script setup lang=\"ts\">\nimport { faPlus } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/vue-fontawesome\";\nimport { debounce } from \"lodash-es\";\nimport { type Ref, inject, ref, watch } from \"vue\";\nimport { useI18n } from \"vue-i18n\";\nimport { useRouter } from \"vue-router\";\nimport { useToast } from \"vue-toastification\";\nimport type { VDataTable } from \"vuetify/components\";\n\nimport * as api from \"@/api\";\nimport type { User } from \"@/api\";\nimport BooleanIcon from \"@/components/table/BooleanIcon.vue\";\nimport DateTimeCell from \"@/components/table/DateTimeCell.vue\";\nimport LayoutBase, { type BreadcrumbItem } from \"@/components/layout/LayoutBase.vue\";\nimport TableActionButtons from \"@/components/table/TableActionButtons.vue\";\nimport { useTableState } from \"@/composables/useTableState\";\nimport { PermissionTarget, useAuth } from \"@/services/auth\";\nimport { type LoadArgs, getLoadArgs } from \"@/services/utils/query_tools\";\nimport { confirmDialogKey } from \"@/symbols\";\nimport type { ConfirmDialogType } from \"@/symbols\";\nimport { getApiErrorMessage } from \"@/utils/http\";\n\ntype ReadonlyHeaders = VDataTable[\"$props\"][\"headers\"];\n\nconst { t } = useI18n();\nconst router = useRouter();\nconst confirmDialog: ConfirmDialogType = inject(confirmDialogKey)!;\nconst toast = useToast();\nconst auth = useAuth();\n\nconst breadcrumbs: BreadcrumbItem[] = [{ title: t(\"UsersView.title\"), disabled: true }];\n\nconst tableState = useTableState({ filterKeys: [\"is_active\", \"is_staff\"] });\nconst loading = ref(false);\n\nconst filterIsActive = tableState.useBooleanFilter(\"is_active\");\nconst filterIsStaff = tableState.useBooleanFilter(\"is_staff\");\nconst totalItems = ref(0);\nconst users: Ref<User[]> = ref([]);\nconst lastLoadArgs: Ref<LoadArgs | null> = ref(null);\nconst headers: ReadonlyHeaders = [\n    {\n        title: t(\"UsersView.headers.id\"),\n        sortable: true,\n        key: \"id\",\n    },\n    {\n        title: t(\"UsersView.headers.userName\"),\n        sortable: true,\n        key: \"username\",\n    },\n    {\n        title: t(\"UsersView.headers.firstName\"),\n        sortable: true,\n        key: \"first_name\",\n    },\n    {\n        title: t(\"UsersView.headers.lastName\"),\n        sortable: true,\n        key: \"last_name\",\n    },\n    {\n        title: t(\"UsersView.headers.email\"),\n        sortable: true,\n        key: \"email\",\n    },\n    {\n        title: t(\"UsersView.headers.superuser\"),\n        sortable: false,\n        key: \"is_superuser\",\n    },\n    {\n        title: t(\"UsersView.headers.active\"),\n        sortable: false,\n        key: \"is_active\",\n    },\n    {\n        title: t(\"UsersView.headers.dateJoined\"),\n        sortable: true,\n        key: \"date_joined\",\n    },\n    {\n        title: t(\"UsersView.headers.actions\"),\n        sortable: false,\n        key: \"actions\",\n        align: \"end\",\n    },\n];\n\nfunction flushData() {\n    if (lastLoadArgs.value) {\n        load(lastLoadArgs.value);\n    }\n}\n\nasync function load(args: LoadArgs) {\n    loading.value = true;\n    lastLoadArgs.value = args;\n    try {\n        const response = await api.adminUsersList({\n            query: {\n                ...getLoadArgs(args),\n                ...(filterIsActive.value !== null ? { is_active: filterIsActive.value } : {}),\n                ...(filterIsStaff.value !== null ? { is_staff: filterIsStaff.value } : {}),\n            },\n        });\n        users.value = response.data!.results;\n        totalItems.value = response.data!.count;\n    } catch (e) {\n        toast.error(t(\"UsersView.loadFailure\"));\n        console.error(e);\n    } finally {\n        loading.value = false;\n    }\n}\n\n// Reload when filters change\nwatch([filterIsActive, filterIsStaff], () => {\n    if (lastLoadArgs.value) {\n        debouncedLoad({ ...lastLoadArgs.value, page: 1 });\n    }\n});\n\nconst debouncedLoad = debounce(load, 250);\n\nfunction onTableOptionsUpdate(args: LoadArgs) {\n    tableState.onOptionsUpdate(args);\n    debouncedLoad(args);\n}\n\nasync function deleteUser(item: User): Promise<void> {\n    const text = t(\"UsersView.confirmDelete\", item);\n    const ok = await confirmDialog.value!.confirm(text);\n    if (ok) {\n        try {\n            await api.adminUsersDestroy({ path: { id: item.id } });\n            flushData();\n            toast.success(t(\"UsersView.deleteSuccess\"));\n        } catch (e) {\n            toast.error(getApiErrorMessage(e, t(\"UsersView.deleteFailure\")));\n            console.error(e);\n        }\n    }\n}\n\nfunction editUser(id: number): void {\n    router.push({ name: \"users-edit\", params: { id } });\n}\n\nfunction createUser(): void {\n    router.push({ name: \"users-new\" });\n}\n</script>\n"],"names":["t","useI18n","router","useRouter","confirmDialog","inject","confirmDialogKey","toast","useToast","auth","useAuth","breadcrumbs","tableState","useTableState","loading","ref","filterIsActive","filterIsStaff","totalItems","users","lastLoadArgs","headers","flushData","load","args","response","api.adminUsersList","getLoadArgs","e","watch","debouncedLoad","debounce","onTableOptionsUpdate","deleteUser","item","text","api.adminUsersDestroy","getApiErrorMessage","editUser","id","createUser","_createBlock","LayoutBase","_createVNode","_component_v_col","_component_v_row","_unref","PermissionTarget","_component_v_btn","FontAwesomeIcon","faPlus","_createTextVNode","_component_v_text_field","$event","_component_v_select","_component_v_data_table_server","_withCtx","BooleanIcon","DateTimeCell","TableActionButtons"],"mappings":"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"}