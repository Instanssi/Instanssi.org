import{d as L,a as K,p as z,K as J,L as O,b as f,g as V,w as o,e as n,k as U,j as e,B as N,n as i,v as X,x as H,y as Q,c as W,P as M,V as R,h as F,t as B,z as A,A as Y,C as Z,D as ee,F as ae,m as se,M as te,N as le,O as re}from"./index-Bw0yMgdj.js";import{V as E,_ as oe}from"./LayoutBase.vue_vue_type_script_setup_true_lang-CTqqdACI.js";import{c as ne,a as C,e as ie,u as ue,b as w,V as de}from"./index.esm-T7wGarnX.js";import{_ as me,d as ce,V as fe,g as ve}from"./query_tools-CXLLEqHw.js";import{s as ge}from"./sleep-mAKpSMLY.js";import{a as q}from"./VRow-urfWNQ1b.js";const pe=L({__name:"UserDialog",setup(G,{expose:l}){const y=i(),{t:r}=K(),v=z(),u=i(0),d=i(!1),_=ne({first_name:C().min(0).max(150),last_name:C().min(0).max(150),date_joined:ie(),username:C().required().min(1).max(150),email:C().email().required().min(1).max(254)}),{handleSubmit:k,setTouched:x,resetForm:D,setValues:h}=ue({validationSchema:_}),g=w("first_name"),m=w("last_name"),p=w("date_joined"),b=w("username"),c=w("email"),S=X(()=>u.value===void 0),j=k(async s=>{let a;d.value=!0,u.value!==void 0?a=await $(u.value,s):a=await P(s),await ge(250),d.value=!1,a&&y.value?.setResult(!0)});async function P(s){try{return await J({body:{first_name:s.first_name,last_name:s.last_name,email:s.email,username:s.username}}),v.success(r("UserDialog.createSuccess")),!0}catch(a){v.error(r("UserDialog.createFailure")),console.error(a)}return!1}async function $(s,a){try{return await O({path:{id:s},body:{first_name:a.first_name,last_name:a.last_name,email:a.email,username:a.username}}),v.success(r("UserDialog.editSuccess")),!0}catch(t){v.error(r("UserDialog.editFailure")),console.error(t)}return!1}async function T(s=void 0){return s!==void 0?(u.value=s.id,h({first_name:s.first_name??"",last_name:s.last_name??"",email:s.email,date_joined:s.date_joined,username:s.username})):(u.value=void 0,D(),x(!1)),await y.value?.modal()??!1}return l({modal:T}),(s,a)=>(f(),V(me,{ref_key:"dialog",ref:y,title:e(r)("UserDialog.title"),"ok-text":e(r)("General.save"),"ok-icon":"fas fa-floppy-disk",width:1e3,loading:d.value,onSubmit:e(j)},{default:o(()=>[n(de,null,{default:o(()=>[n(U,{modelValue:e(b).value.value,"onUpdate:modelValue":a[0]||(a[0]=t=>e(b).value.value=t),"error-messages":e(b).errorMessage.value,variant:"outlined",readonly:!S.value,label:e(r)("UserDialog.labels.userName")},null,8,["modelValue","error-messages","readonly","label"]),S.value?N("",!0):(f(),V(U,{key:0,modelValue:e(p).value.value,"onUpdate:modelValue":a[1]||(a[1]=t=>e(p).value.value=t),"error-messages":e(p).errorMessage.value,variant:"outlined",readonly:"",label:e(r)("UserDialog.labels.dateJoined")},null,8,["modelValue","error-messages","label"])),n(U,{modelValue:e(c).value.value,"onUpdate:modelValue":a[2]||(a[2]=t=>e(c).value.value=t),"error-messages":e(c).errorMessage.value,variant:"outlined",label:e(r)("UserDialog.labels.email")},null,8,["modelValue","error-messages","label"]),n(U,{modelValue:e(g).value.value,"onUpdate:modelValue":a[3]||(a[3]=t=>e(g).value.value=t),"error-messages":e(g).errorMessage.value,variant:"outlined",label:e(r)("UserDialog.labels.firstName")},null,8,["modelValue","error-messages","label"]),n(U,{modelValue:e(m).value.value,"onUpdate:modelValue":a[4]||(a[4]=t=>e(m).value.value=t),"error-messages":e(m).errorMessage.value,variant:"outlined",label:e(r)("UserDialog.labels.lastName")},null,8,["modelValue","error-messages","label"])]),_:1})]),_:1},8,["title","ok-text","loading","onSubmit"]))}}),ke=L({__name:"UsersView",setup(G){const{t:l,d:y}=K(),r=i(void 0),v=H(Q),u=z(),d=se(),_=i(!1),k=[25,50,100],x=i(k[0]),D=i(0),h=i(1),g=i([]),m=i(""),p=i(0),b=[{title:l("UsersView.headers.id"),sortable:!0,key:"id"},{title:l("UsersView.headers.userName"),sortable:!1,key:"username"},{title:l("UsersView.headers.firstName"),sortable:!0,key:"first_name"},{title:l("UsersView.headers.lastName"),sortable:!0,key:"last_name"},{title:l("UsersView.headers.email"),sortable:!0,key:"email"},{title:l("UsersView.headers.dateJoined"),sortable:!1,key:"date_joined"},{title:l("UsersView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function c(){p.value+=1}async function S(s){_.value=!0;try{const a=await re({query:ve(s)});g.value=a.data.results,D.value=a.data.count}catch(a){u.error(l("UsersView.loadFailure")),console.error(a)}finally{_.value=!1}}const j=ce(S,250);async function P(s){const a=l("UsersView.confirmDelete",s);if(await v.value.confirm(a))try{await te({path:{id:s.id}}),c(),u.success(l("UsersView.deleteSuccess"))}catch(I){u.error(l("UsersView.deleteFailure")),console.error(I)}}async function $(s){const a=await le({path:{id:s}});await r.value.modal(a.data)&&c()}async function T(){await r.value.modal()&&(h.value=1,c())}return(s,a)=>(f(),W(ae,null,[n(oe,{title:e(l)("UsersView.title")},{default:o(()=>[n(E,null,{default:o(()=>[n(q,null,{default:o(()=>[e(d).canAdd(e(M).USER)?(f(),V(R,{key:0,onClick:T},{prepend:o(()=>[n(e(A),{icon:e(Y)},null,8,["icon"])]),default:o(()=>[F(" "+B(e(l)("UsersView.newUser")),1)]),_:1})):N("",!0),n(U,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=t=>m.value=t),variant:"outlined",density:"compact",label:e(l)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),n(E,null,{default:o(()=>[n(q,null,{default:o(()=>[(f(),V(fe,{key:`blog-table-${p.value}`,"items-per-page":x.value,"onUpdate:itemsPerPage":a[1]||(a[1]=t=>x.value=t),class:"elevation-1 primary","item-value":"id",density:"compact",headers:b,items:g.value,"items-length":D.value,loading:_.value,page:h.value,search:m.value,"items-per-page-options":k,"no-data-text":e(l)("UsersView.noUsersFound"),"loading-text":e(l)("UsersView.loadingUsers"),"onUpdate:options":e(j)},{"item.date_joined":o(({item:t})=>[F(B(e(y)(t.date_joined,"long")),1)]),"item.actions":o(({item:t})=>[e(d).canDelete(e(M).USER)?(f(),V(R,{key:0,density:"compact",variant:"text",color:"red",onClick:I=>P(t)},{prepend:o(()=>[n(e(A),{icon:e(Z)},null,8,["icon"])]),default:o(()=>[a[2]||(a[2]=F(" Delete ",-1))]),_:1},8,["onClick"])):N("",!0),e(d).canChange(e(M).USER)?(f(),V(R,{key:1,density:"compact",variant:"text",onClick:I=>$(t.id)},{prepend:o(()=>[n(e(A),{icon:e(ee)},null,8,["icon"])]),default:o(()=>[a[3]||(a[3]=F(" Edit ",-1))]),_:1},8,["onClick"])):N("",!0)]),_:1},8,["items-per-page","items","items-length","loading","page","search","no-data-text","loading-text","onUpdate:options"]))]),_:1})]),_:1})]),_:1},8,["title"]),n(pe,{ref_key:"dialog",ref:r},null,512)],64))}});export{ke as default};
//# sourceMappingURL=UsersView-mAHXCCZC.js.map
