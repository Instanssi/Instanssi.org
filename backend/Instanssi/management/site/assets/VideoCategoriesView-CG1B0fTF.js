import{d as H,a as S,u as j,J as N,K as Y,v as q,U as K,b,g as k,w as i,e as r,j as e,P as v,V as z,i as J,t as M,k as Q,L as W,D as X,m as Z,q as ee,I as E,s as l,c9 as ae,ca as te,H as oe}from"./index-DXU74lGt.js";import{V as I,_ as se}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D4jd1chv.js";import{_ as ie}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-CUVfxWfg.js";import{g as re}from"./query_tools-BInV9OzK.js";import{g as ne}from"./http-BTZWMaMN.js";import{d as le}from"./debounce-CQ84CrOG.js";import{V as D}from"./VRow-B94Tto0H.js";import{V as de}from"./VDataTableServer-CMLVDy59.js";import{p as ce}from"./parseInt-Bzw_2rWL.js";import"./VContainer-BfWqa_tJ.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-WkXOSlqa.js";import"./useAuditLogUtils-BqNOieoY.js";import"./DateTimeCell.vue_vue_type_script_setup_true_lang-BMnBYvTq.js";import"./datetime-Dz9fjSvq.js";import"./VDataTable-Jd7io3gq.js";const Ie=H({__name:"VideoCategoriesView",props:{eventId:{}},setup(x){const V=x,{t:a}=S(),f=j(),A=N(Y),c=q(),u=ee(),{getEventById:T}=oe(),n=E(()=>ce(V.eventId,10)),m=l(!1),O=E(()=>[{title:T(n.value)?.name??"...",to:{name:"dashboard",params:{eventId:V.eventId}}},{title:a("VideoCategoriesView.title"),disabled:!0}]),C=[25,50,100],p=l(C[0]),y=l(0),P=l(1),h=l([]),d=l(""),g=l(null),R=[{title:a("VideoCategoriesView.headers.id"),sortable:!0,key:"id"},{title:a("VideoCategoriesView.headers.name"),sortable:!0,key:"name"},{title:a("VideoCategoriesView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function B(){g.value&&w(g.value)}async function w(s){m.value=!0,g.value=s;try{const t=await te({path:{event_pk:n.value},query:re(s)});h.value=t.data.results,y.value=t.data.count}catch(t){c.error(a("VideoCategoriesView.loadFailure")),console.error(t)}finally{m.value=!1}}const _=le(w,250);function L(){d.value="",_({page:1,itemsPerPage:p.value??25,sortBy:[],groupBy:[],search:""})}K(n,L);async function F(s){const t=a("VideoCategoriesView.confirmDelete",s);await A.value.ifConfirmed(t,async()=>{try{await ae({path:{event_pk:n.value,id:s.id}}),c.success(a("VideoCategoriesView.deleteSuccess")),B()}catch(o){c.error(ne(o,a("VideoCategoriesView.deleteFailure"))),console.error(o)}})}function U(s){f.push({name:"arkisto-categories-edit",params:{eventId:n.value,id:s}})}function $(){f.push({name:"arkisto-categories-new",params:{eventId:n.value}})}return(s,t)=>(b(),k(se,{key:`video-categories-${n.value}`,breadcrumbs:O.value},{default:i(()=>[r(I,null,{default:i(()=>[r(D,null,{default:i(()=>[e(u).canAdd(e(v).OTHER_VIDEO_CATEGORY)?(b(),k(z,{key:0,color:"primary",onClick:$},{prepend:i(()=>[r(e(Q),{icon:e(W)},null,8,["icon"])]),default:i(()=>[J(" "+M(e(a)("VideoCategoriesView.newCategory")),1)]),_:1})):X("",!0),r(Z,{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=o=>d.value=o),variant:"outlined",density:"compact",label:e(a)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),r(I,null,{default:i(()=>[r(D,null,{default:i(()=>[r(de,{"items-per-page":p.value,"onUpdate:itemsPerPage":t[1]||(t[1]=o=>p.value=o),class:"elevation-1 primary","item-value":"id",density:"compact",headers:R,items:h.value,"items-length":y.value,loading:m.value,search:d.value,page:P.value,"items-per-page-options":C,"no-data-text":e(a)("VideoCategoriesView.noCategoriesFound"),"loading-text":e(a)("VideoCategoriesView.loadingCategories"),"onUpdate:options":e(_)},{"item.actions":i(({item:o})=>[r(ie,{"can-edit":e(u).canChange(e(v).OTHER_VIDEO_CATEGORY),"can-delete":e(u).canDelete(e(v).OTHER_VIDEO_CATEGORY),"audit-log":{appLabel:"arkisto",model:"othervideocategory",objectPk:o.id},onEdit:G=>U(o.id),onDelete:G=>F(o)},null,8,["can-edit","can-delete","audit-log","onEdit","onDelete"])]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Ie as default};
//# sourceMappingURL=VideoCategoriesView-CG1B0fTF.js.map
