import{d as U,a as $,u as G,J as H,K as j,v as N,L as Y,b,g as w,w as r,e as n,j as e,P as g,V as q,i as K,t as M,k as z,M as J,D as Q,m as W,q as X,I as _,s as d,cg as Z,ch as ee,H as ae}from"./index-CQkWvXOv.js";import{V as k,_ as te}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D5aCeQDf.js";import{_ as oe}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-DepTf6Bi.js";import{u as se,d as ie}from"./useTableState-CutuDm2i.js";import{g as re}from"./query_tools-BInV9OzK.js";import{g as ne}from"./http-CET7UDul.js";import{V as E}from"./VRow-CXIXhuhq.js";import{V as le}from"./VDataTableServer-C6tuZDKn.js";import{p as de}from"./parseInt-BJ5A4_3y.js";import"./VContainer-DqJ8gu3P.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-1MnYozFL.js";import"./useAuditLogUtils-BdjF9k7b.js";import"./DateTimeCell.vue_vue_type_script_setup_true_lang-DaLynL44.js";import"./datetime-Dz9fjSvq.js";import"./VDataTable-f5_9vewM.js";const Ee=U({__name:"VideoCategoriesView",props:{eventId:{}},setup(I){const v=I,{t:a}=$(),V=G(),D=H(j),u=N(),c=X(),{getEventById:T}=ae(),l=_(()=>de(v.eventId,10)),p=d(!1),x=_(()=>[{title:T(l.value)?.name??"...",to:{name:"dashboard",params:{eventId:v.eventId}}},{title:a("VideoCategoriesView.title"),disabled:!0}]),t=se(),f=d(0),y=d([]),m=d(null),A=[{title:a("VideoCategoriesView.headers.id"),sortable:!0,key:"id"},{title:a("VideoCategoriesView.headers.name"),sortable:!0,key:"name"},{title:a("VideoCategoriesView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function O(){m.value&&C(m.value)}async function C(o){p.value=!0,m.value=o;try{const s=await ee({path:{event_pk:l.value},query:re(o)});y.value=s.data.results,f.value=s.data.count}catch(s){u.error(a("VideoCategoriesView.loadFailure")),console.error(s)}finally{p.value=!1}}const h=ie(C,250);function P(o){t.onOptionsUpdate(o),h(o)}function R(){t.search.value="",t.page.value=1,h({page:1,itemsPerPage:t.perPage.value??25,sortBy:[],groupBy:[],search:""})}Y(l,R);async function B(o){const s=a("VideoCategoriesView.confirmDelete",o);await D.value.ifConfirmed(s,async()=>{try{await Z({path:{event_pk:l.value,id:o.id}}),u.success(a("VideoCategoriesView.deleteSuccess")),O()}catch(i){u.error(ne(i,a("VideoCategoriesView.deleteFailure"))),console.error(i)}})}function L(o){V.push({name:"arkisto-categories-edit",params:{eventId:l.value,id:o}})}function S(){V.push({name:"arkisto-categories-new",params:{eventId:l.value}})}return(o,s)=>(b(),w(te,{key:`video-categories-${l.value}`,breadcrumbs:x.value},{default:r(()=>[n(k,null,{default:r(()=>[n(E,null,{default:r(()=>[e(c).canAdd(e(g).OTHER_VIDEO_CATEGORY)?(b(),w(q,{key:0,color:"primary",onClick:S},{prepend:r(()=>[n(e(z),{icon:e(J)},null,8,["icon"])]),default:r(()=>[K(" "+M(e(a)("VideoCategoriesView.newCategory")),1)]),_:1})):Q("",!0),n(W,{modelValue:e(t).search.value,"onUpdate:modelValue":s[0]||(s[0]=i=>e(t).search.value=i),variant:"outlined",density:"compact",label:e(a)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),n(k,null,{default:r(()=>[n(E,null,{default:r(()=>[n(le,{"items-per-page":e(t).perPage.value,"onUpdate:itemsPerPage":s[1]||(s[1]=i=>e(t).perPage.value=i),"sort-by":e(t).sortByArray.value,class:"elevation-1 primary","item-value":"id",density:"compact",headers:A,items:y.value,"items-length":f.value,loading:p.value,search:e(t).search.value,page:e(t).page.value,"items-per-page-options":e(t).pageSizeOptions,"no-data-text":e(a)("VideoCategoriesView.noCategoriesFound"),"loading-text":e(a)("VideoCategoriesView.loadingCategories"),"onUpdate:options":P},{"item.actions":r(({item:i})=>[n(oe,{"can-edit":e(c).canChange(e(g).OTHER_VIDEO_CATEGORY),"can-delete":e(c).canDelete(e(g).OTHER_VIDEO_CATEGORY),"audit-log":{appLabel:"arkisto",model:"othervideocategory",objectPk:i.id},onEdit:F=>L(i.id),onDelete:F=>B(i)},null,8,["can-edit","can-delete","audit-log","onEdit","onDelete"])]),_:1},8,["items-per-page","sort-by","items","items-length","loading","search","page","items-per-page-options","no-data-text","loading-text"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Ee as default};
//# sourceMappingURL=VideoCategoriesView-DrOfAine.js.map
