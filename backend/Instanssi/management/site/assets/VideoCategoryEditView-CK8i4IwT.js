import{d as R,a as U,u as q,v as z,cb as H,cc as L,o as J,cd as K,b as u,g as c,w as o,e as r,A as O,p as Q,B as W,l as X,j as t,m as Y,C as Z,D as ee,E as ae,V as I,i as h,t as F,k as te,G as se,s as y,I as g,H as oe}from"./index-DXU74lGt.js";import{c as re,a as ie,u as ne,b as le}from"./index.esm-DWTrtXO7.js";import{_ as de}from"./AuditLogButton.vue_vue_type_script_setup_true_lang-5kFykphF.js";import{V as x,_ as ue}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D4jd1chv.js";import{h as A}from"./http-BTZWMaMN.js";import{p as b}from"./parseInt-Bzw_2rWL.js";import{V as ce}from"./VForm-C430u1Uz.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-WkXOSlqa.js";import"./useAuditLogUtils-BqNOieoY.js";import"./DateTimeCell.vue_vue_type_script_setup_true_lang-BMnBYvTq.js";import"./datetime-Dz9fjSvq.js";import"./VDataTableServer-CMLVDy59.js";import"./VDataTable-Jd7io3gq.js";import"./VContainer-BfWqa_tJ.js";const he=R({__name:"VideoCategoryEditView",props:{eventId:{},id:{}},setup(B){const C={name:"name"},i=B,{t:s}=U(),S=q(),n=z(),{getEventById:j}=oe(),m=y(!1),p=y(!1),_=y(""),l=g(()=>b(i.eventId,10)),d=g(()=>i.id!==void 0),M=g(()=>{const e=[{title:j(l.value)?.name??"...",to:{name:"dashboard",params:{eventId:i.eventId}}},{title:s("VideoCategoriesView.title"),to:{name:"arkisto-categories",params:{eventId:i.eventId}}}];return d.value?e.push({title:_.value||"...",disabled:!0}):e.push({title:s("Breadcrumbs.newVideoCategory"),disabled:!0}),e}),N=re({name:ie().required().min(1).max(64)}),{handleSubmit:P,setValues:D,setErrors:k,meta:G}=ne({validationSchema:N,initialValues:{name:""}}),v=le("name"),w=P(async e=>{p.value=!0;let a;d.value?a=await $(b(i.id,10),e):a=await T(e),p.value=!1,a&&f()});function E(e){return{name:e.name}}async function T(e){try{return await H({path:{event_pk:l.value},body:E(e)}),n.success(s("VideoCategoryEditView.createSuccess")),!0}catch(a){A(a,k,n,s("VideoCategoryEditView.createFailure"),C)}return!1}async function $(e,a){try{return await L({path:{event_pk:l.value,id:e},body:E(a)}),n.success(s("VideoCategoryEditView.editSuccess")),!0}catch(V){A(V,k,n,s("VideoCategoryEditView.editFailure"),C)}return!1}function f(){S.push({name:"arkisto-categories",params:{eventId:i.eventId}})}return J(async()=>{if(d.value){m.value=!0;try{const a=(await K({path:{event_pk:l.value,id:b(i.id,10)}})).data;_.value=a.name,D({name:a.name})}catch(e){n.error(s("VideoCategoryEditView.loadFailure")),console.error(e),f()}finally{m.value=!1}}}),(e,a)=>(u(),c(ue,{breadcrumbs:M.value},{default:o(()=>[m.value?(u(),c(x,{key:0,class:"d-flex justify-center my-8"},{default:o(()=>[r(O,{indeterminate:"",size:"64"})]),_:1})):(u(),c(x,{key:1},{default:o(()=>[r(Q,null,{default:o(()=>[r(W,null,{default:o(()=>[r(ce,{onSubmit:X(t(w),["prevent"])},{default:o(()=>[r(Y,{modelValue:t(v).value.value,"onUpdate:modelValue":a[0]||(a[0]=V=>t(v).value.value=V),"error-messages":t(v).errorMessage.value,variant:"outlined",label:t(s)("VideoCategoryEditView.labels.name")+" *"},null,8,["modelValue","error-messages","label"])]),_:1},8,["onSubmit"])]),_:1}),r(Z,{class:"justify-end"},{default:o(()=>[d.value?(u(),c(de,{key:0,"app-label":"arkisto",model:"othervideocategory","object-pk":i.id},null,8,["object-pk"])):ee("",!0),r(ae),r(I,{variant:"text",onClick:f},{default:o(()=>[h(F(t(s)("General.cancel")),1)]),_:1}),r(I,{variant:"elevated",color:"primary",loading:p.value,disabled:!t(G).valid,onClick:t(w)},{prepend:o(()=>[r(t(te),{icon:t(se)},null,8,["icon"])]),default:o(()=>[h(" "+F(t(s)("General.save")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1}))]),_:1},8,["breadcrumbs"]))}});export{he as default};
//# sourceMappingURL=VideoCategoryEditView-CK8i4IwT.js.map
