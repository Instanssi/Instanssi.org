{"version":3,"file":"VideoCategoryEditView-CK8i4IwT.js","sources":["../../../../../admin/src/views/arkisto/VideoCategoryEditView.vue"],"sourcesContent":["<template>\n    <LayoutBase :breadcrumbs=\"breadcrumbs\">\n        <v-col v-if=\"loading\" class=\"d-flex justify-center my-8\">\n            <v-progress-circular indeterminate size=\"64\" />\n        </v-col>\n        <v-col v-else>\n            <v-card>\n                <v-card-text>\n                    <v-form @submit.prevent=\"submit\">\n                        <v-text-field\n                            v-model=\"name.value.value\"\n                            :error-messages=\"name.errorMessage.value\"\n                            variant=\"outlined\"\n                            :label=\"t('VideoCategoryEditView.labels.name') + ' *'\"\n                        />\n                    </v-form>\n                </v-card-text>\n                <v-card-actions class=\"justify-end\">\n                    <AuditLogButton\n                        v-if=\"isEditMode\"\n                        app-label=\"arkisto\"\n                        model=\"othervideocategory\"\n                        :object-pk=\"props.id\"\n                    />\n                    <v-spacer />\n                    <v-btn variant=\"text\" @click=\"goBack\">\n                        {{ t(\"General.cancel\") }}\n                    </v-btn>\n                    <v-btn\n                        variant=\"elevated\"\n                        color=\"primary\"\n                        :loading=\"saving\"\n                        :disabled=\"!meta.valid\"\n                        @click=\"submit\"\n                    >\n                        <template #prepend>\n                            <FontAwesomeIcon :icon=\"faSave\" />\n                        </template>\n                        {{ t(\"General.save\") }}\n                    </v-btn>\n                </v-card-actions>\n            </v-card>\n        </v-col>\n    </LayoutBase>\n</template>\n\n<script setup lang=\"ts\">\nimport { faFloppyDisk as faSave } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/vue-fontawesome\";\nimport { parseInt } from \"lodash-es\";\nimport { type GenericObject, useField, useForm } from \"vee-validate\";\nimport { computed, onMounted, ref } from \"vue\";\nimport { useI18n } from \"vue-i18n\";\nimport { useRouter } from \"vue-router\";\nimport { useToast } from \"vue-toastification\";\nimport { object as yupObject, string as yupString } from \"yup\";\n\nimport * as api from \"@/api\";\nimport AuditLogButton from \"@/components/auditlog/AuditLogButton.vue\";\nimport LayoutBase, { type BreadcrumbItem } from \"@/components/layout/LayoutBase.vue\";\nimport { useEvents } from \"@/services/events\";\nimport { handleApiError, type FieldMapping } from \"@/utils/http\";\n\n/** Maps API field names (snake_case) to form field names (camelCase) */\nconst API_FIELD_MAPPING: FieldMapping = {\n    name: \"name\",\n};\n\nconst props = defineProps<{\n    eventId: string;\n    id?: string;\n}>();\n\nconst { t } = useI18n();\nconst router = useRouter();\nconst toast = useToast();\nconst { getEventById } = useEvents();\n\nconst loading = ref(false);\nconst saving = ref(false);\nconst categoryName = ref<string>(\"\");\nconst eventId = computed(() => parseInt(props.eventId, 10));\nconst isEditMode = computed(() => props.id !== undefined);\n\nconst breadcrumbs = computed<BreadcrumbItem[]>(() => {\n    const items: BreadcrumbItem[] = [\n        {\n            title: getEventById(eventId.value)?.name ?? \"...\",\n            to: { name: \"dashboard\", params: { eventId: props.eventId } },\n        },\n        {\n            title: t(\"VideoCategoriesView.title\"),\n            to: { name: \"arkisto-categories\", params: { eventId: props.eventId } },\n        },\n    ];\n    if (isEditMode.value) {\n        items.push({ title: categoryName.value || \"...\", disabled: true });\n    } else {\n        items.push({ title: t(\"Breadcrumbs.newVideoCategory\"), disabled: true });\n    }\n    return items;\n});\n\n// Form validation\nconst validationSchema = yupObject({\n    name: yupString().required().min(1).max(64),\n});\n\nconst { handleSubmit, setValues, setErrors, meta } = useForm({\n    validationSchema,\n    initialValues: {\n        name: \"\",\n    },\n});\n\nconst name = useField<string>(\"name\");\n\nconst submit = handleSubmit(async (values) => {\n    saving.value = true;\n    let ok: boolean;\n    if (isEditMode.value) {\n        ok = await editCategory(parseInt(props.id!, 10), values);\n    } else {\n        ok = await createCategory(values);\n    }\n    saving.value = false;\n    if (ok) {\n        goBack();\n    }\n});\n\nfunction buildBody(values: GenericObject) {\n    return {\n        name: values.name,\n    };\n}\n\nasync function createCategory(values: GenericObject) {\n    try {\n        await api.adminEventArkistoVideoCategoriesCreate({\n            path: { event_pk: eventId.value },\n            body: buildBody(values),\n        });\n        toast.success(t(\"VideoCategoryEditView.createSuccess\"));\n        return true;\n    } catch (e) {\n        handleApiError(\n            e,\n            setErrors,\n            toast,\n            t(\"VideoCategoryEditView.createFailure\"),\n            API_FIELD_MAPPING\n        );\n    }\n    return false;\n}\n\nasync function editCategory(categoryId: number, values: GenericObject) {\n    try {\n        await api.adminEventArkistoVideoCategoriesPartialUpdate({\n            path: { event_pk: eventId.value, id: categoryId },\n            body: buildBody(values),\n        });\n        toast.success(t(\"VideoCategoryEditView.editSuccess\"));\n        return true;\n    } catch (e) {\n        handleApiError(\n            e,\n            setErrors,\n            toast,\n            t(\"VideoCategoryEditView.editFailure\"),\n            API_FIELD_MAPPING\n        );\n    }\n    return false;\n}\n\nfunction goBack() {\n    router.push({ name: \"arkisto-categories\", params: { eventId: props.eventId } });\n}\n\nonMounted(async () => {\n    if (isEditMode.value) {\n        loading.value = true;\n        try {\n            const response = await api.adminEventArkistoVideoCategoriesRetrieve({\n                path: { event_pk: eventId.value, id: parseInt(props.id!, 10) },\n            });\n            const category = response.data!;\n            categoryName.value = category.name;\n            setValues({\n                name: category.name,\n            });\n        } catch (e) {\n            toast.error(t(\"VideoCategoryEditView.loadFailure\"));\n            console.error(e);\n            goBack();\n        } finally {\n            loading.value = false;\n        }\n    }\n});\n</script>\n"],"names":["API_FIELD_MAPPING","props","__props","t","useI18n","router","useRouter","toast","useToast","getEventById","useEvents","loading","ref","saving","categoryName","eventId","computed","parseInt","isEditMode","breadcrumbs","items","validationSchema","yupObject","yupString","handleSubmit","setValues","setErrors","meta","useForm","name","useField","submit","values","ok","editCategory","createCategory","goBack","buildBody","api.adminEventArkistoVideoCategoriesCreate","e","handleApiError","categoryId","api.adminEventArkistoVideoCategoriesPartialUpdate","onMounted","category","api.adminEventArkistoVideoCategoriesRetrieve","_createBlock","LayoutBase","_component_v_col","_createVNode","_component_v_progress_circular","_component_v_card","_component_v_card_text","_component_v_form","_unref","_component_v_text_field","$event","_component_v_card_actions","AuditLogButton","_component_v_spacer","_component_v_btn","FontAwesomeIcon","faSave","_createTextVNode"],"mappings":"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"}