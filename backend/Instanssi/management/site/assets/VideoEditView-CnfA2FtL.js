import{d as Q,a as W,u as X,v as ee,cR as ae,cS as te,o as oe,cT as se,b as k,g as I,w as r,e as s,A as re,p as ie,B as le,l as ne,j as a,i as d,t as c,a2 as ue,m as B,C as de,V as T,k as ce,D as me,s as m,G as v,c5 as ve,E as pe}from"./index-CY4kEXQX.js";import{c as Ve,a as h,g as be,u as ye,b as p,V as fe}from"./index.esm-gAaR2kR-.js";import{F as D}from"./FormSection-BH9YHR1S.js";import{V as P,_ as ge}from"./LayoutBase.vue_vue_type_script_setup_true_lang-mBpG7FYr.js";import{h as $}from"./http-h2SUVdDm.js";import{p as U}from"./parseInt-DjOfejfT.js";import{V as we}from"./VTextarea-CUku_Nvp.js";import"./VContainer-DyZfstE_.js";const Ae=Q({__name:"VideoEditView",props:{eventId:{},id:{}},setup(q){const C={category:"category",name:"name",description:"description",youtube_url:"youtubeUrl"},l=q,{t:o}=W(),G=X(),n=ee(),{getEventById:N}=pe(),V=m(!1),b=m(!1),F=m(""),u=v(()=>U(l.eventId,10)),y=v(()=>l.id!==void 0),A=m([]),R=v(()=>A.value.map(e=>({title:e.name,value:e.id}))),j=v(()=>{const e=[{title:N(u.value)?.name??"...",to:{name:"dashboard",params:{eventId:l.eventId}}},{title:o("VideosView.title"),to:{name:"arkisto-videos",params:{eventId:l.eventId}}}];return y.value?e.push({title:F.value||"...",disabled:!0}):e.push({title:o("Breadcrumbs.newVideo"),disabled:!0}),e});function z(e){return e?[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/|youtube\.com\/v\/)[a-zA-Z0-9_-]{11}/,/^[a-zA-Z0-9_-]{11}$/].some(i=>i.test(e)):!1}const L=Ve({category:be().required().min(1),name:h().required().min(1).max(64),description:h(),youtubeUrl:h().required().test("youtube-url","Invalid YouTube URL or video ID",e=>z(e??""))}),{handleSubmit:Y,setValues:Z,setErrors:x,meta:H}=ye({validationSchema:L,initialValues:{category:null,name:"",description:"",youtubeUrl:""}}),f=p("category"),g=p("name"),w=p("description"),E=p("youtubeUrl"),S=Y(async e=>{b.value=!0;let t;y.value?t=await J(U(l.id,10),e):t=await O(e),b.value=!1,t&&_()});function M(e){return{category:e.category,name:e.name,description:e.description||"",youtube_url:e.youtubeUrl}}async function O(e){try{return await ae({path:{event_pk:u.value},body:M(e)}),n.success(o("VideoEditView.createSuccess")),!0}catch(t){$(t,x,n,o("VideoEditView.createFailure"),C)}return!1}async function J(e,t){try{return await te({path:{event_pk:u.value,id:e},body:M(t)}),n.success(o("VideoEditView.editSuccess")),!0}catch(i){$(i,x,n,o("VideoEditView.editFailure"),C)}return!1}async function K(){try{const e=await ve({path:{event_pk:u.value},query:{limit:100}});A.value=e.data.results}catch(e){console.error("Failed to load categories:",e)}}function _(){G.push({name:"arkisto-videos",params:{eventId:l.eventId}})}return oe(async()=>{if(await K(),y.value){V.value=!0;try{const t=(await se({path:{event_pk:u.value,id:U(l.id,10)}})).data;F.value=t.name,Z({category:t.category,name:t.name,description:t.description??"",youtubeUrl:t.youtube_url??""})}catch(e){n.error(o("VideoEditView.loadFailure")),console.error(e),_()}finally{V.value=!1}}}),(e,t)=>(k(),I(ge,{breadcrumbs:j.value},{default:r(()=>[V.value?(k(),I(P,{key:0,class:"d-flex justify-center my-8"},{default:r(()=>[s(re,{indeterminate:"",size:"64"})]),_:1})):(k(),I(P,{key:1},{default:r(()=>[s(ie,null,{default:r(()=>[s(le,null,{default:r(()=>[s(fe,{onSubmit:ne(a(S),["prevent"])},{default:r(()=>[s(D,null,{default:r(()=>[d(c(a(o)("VideoEditView.sections.basicInfo")),1)]),_:1}),s(ue,{modelValue:a(f).value.value,"onUpdate:modelValue":t[0]||(t[0]=i=>a(f).value.value=i),modelModifiers:{number:!0},"error-messages":a(f).errorMessage.value,items:R.value,variant:"outlined",label:a(o)("VideoEditView.labels.category")+" *"},null,8,["modelValue","error-messages","items","label"]),s(B,{modelValue:a(g).value.value,"onUpdate:modelValue":t[1]||(t[1]=i=>a(g).value.value=i),"error-messages":a(g).errorMessage.value,variant:"outlined",label:a(o)("VideoEditView.labels.name")+" *"},null,8,["modelValue","error-messages","label"]),s(we,{modelValue:a(w).value.value,"onUpdate:modelValue":t[2]||(t[2]=i=>a(w).value.value=i),"error-messages":a(w).errorMessage.value,variant:"outlined",label:a(o)("VideoEditView.labels.description"),rows:"4"},null,8,["modelValue","error-messages","label"]),s(D,null,{default:r(()=>[d(c(a(o)("VideoEditView.sections.youtube")),1)]),_:1}),s(B,{modelValue:a(E).value.value,"onUpdate:modelValue":t[3]||(t[3]=i=>a(E).value.value=i),"error-messages":a(E).errorMessage.value,variant:"outlined",label:a(o)("VideoEditView.labels.youtubeUrl")+" *",hint:a(o)("VideoEditView.labels.youtubeUrlHint"),"persistent-hint":"",class:"mb-4"},null,8,["modelValue","error-messages","label","hint"])]),_:1},8,["onSubmit"])]),_:1}),s(de,{class:"justify-end"},{default:r(()=>[s(T,{variant:"text",onClick:_},{default:r(()=>[d(c(a(o)("General.cancel")),1)]),_:1}),s(T,{variant:"elevated",color:"primary",loading:b.value,disabled:!a(H).valid,onClick:a(S)},{prepend:r(()=>[s(a(ce),{icon:a(me)},null,8,["icon"])]),default:r(()=>[d(" "+c(a(o)("General.save")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1}))]),_:1},8,["breadcrumbs"]))}});export{Ae as default};
//# sourceMappingURL=VideoEditView-CnfA2FtL.js.map
