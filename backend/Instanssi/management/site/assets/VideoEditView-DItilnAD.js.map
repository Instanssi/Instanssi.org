{"version":3,"file":"VideoEditView-DItilnAD.js","sources":["../../../../../admin/src/views/arkisto/VideoEditView.vue"],"sourcesContent":["<template>\n    <LayoutBase :breadcrumbs=\"breadcrumbs\">\n        <v-col v-if=\"loading\" class=\"d-flex justify-center my-8\">\n            <v-progress-circular indeterminate size=\"64\" />\n        </v-col>\n        <v-col v-else>\n            <v-card>\n                <v-card-text>\n                    <v-form @submit.prevent=\"submit\">\n                        <FormSection>\n                            {{ t(\"VideoEditView.sections.basicInfo\") }}\n                        </FormSection>\n                        <v-select\n                            v-model.number=\"category.value.value\"\n                            :error-messages=\"category.errorMessage.value\"\n                            :items=\"categoryOptions\"\n                            variant=\"outlined\"\n                            :label=\"t('VideoEditView.labels.category') + ' *'\"\n                        />\n                        <v-text-field\n                            v-model=\"name.value.value\"\n                            :error-messages=\"name.errorMessage.value\"\n                            variant=\"outlined\"\n                            :label=\"t('VideoEditView.labels.name') + ' *'\"\n                        />\n                        <v-textarea\n                            v-model=\"description.value.value\"\n                            :error-messages=\"description.errorMessage.value\"\n                            variant=\"outlined\"\n                            :label=\"t('VideoEditView.labels.description')\"\n                            rows=\"4\"\n                        />\n\n                        <FormSection>\n                            {{ t(\"VideoEditView.sections.youtube\") }}\n                        </FormSection>\n                        <v-text-field\n                            v-model=\"youtubeUrl.value.value\"\n                            :error-messages=\"youtubeUrl.errorMessage.value\"\n                            variant=\"outlined\"\n                            :label=\"t('VideoEditView.labels.youtubeUrl') + ' *'\"\n                            :hint=\"t('VideoEditView.labels.youtubeUrlHint')\"\n                            persistent-hint\n                            class=\"mb-4\"\n                        />\n                    </v-form>\n                </v-card-text>\n                <v-card-actions class=\"justify-end\">\n                    <v-btn variant=\"text\" @click=\"goBack\">\n                        {{ t(\"General.cancel\") }}\n                    </v-btn>\n                    <v-btn\n                        variant=\"elevated\"\n                        color=\"primary\"\n                        :loading=\"saving\"\n                        :disabled=\"!meta.valid\"\n                        @click=\"submit\"\n                    >\n                        <template #prepend>\n                            <FontAwesomeIcon :icon=\"faSave\" />\n                        </template>\n                        {{ t(\"General.save\") }}\n                    </v-btn>\n                </v-card-actions>\n            </v-card>\n        </v-col>\n    </LayoutBase>\n</template>\n\n<script setup lang=\"ts\">\nimport { faFloppyDisk as faSave } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/vue-fontawesome\";\nimport { parseInt } from \"lodash-es\";\nimport { type GenericObject, useField, useForm } from \"vee-validate\";\nimport { type Ref, computed, onMounted, ref } from \"vue\";\nimport { useI18n } from \"vue-i18n\";\nimport { useRouter } from \"vue-router\";\nimport { useToast } from \"vue-toastification\";\nimport { number as yupNumber, object as yupObject, string as yupString } from \"yup\";\n\nimport * as api from \"@/api\";\nimport type { OtherVideoCategory } from \"@/api\";\nimport FormSection from \"@/components/form/FormSection.vue\";\nimport LayoutBase, { type BreadcrumbItem } from \"@/components/layout/LayoutBase.vue\";\nimport { useEvents } from \"@/services/events\";\nimport { handleApiError, type FieldMapping } from \"@/utils/http\";\n\n/** Maps API field names (snake_case) to form field names (camelCase) */\nconst API_FIELD_MAPPING: FieldMapping = {\n    category: \"category\",\n    name: \"name\",\n    description: \"description\",\n    youtube_url: \"youtubeUrl\",\n};\n\nconst props = defineProps<{\n    eventId: string;\n    id?: string;\n}>();\n\nconst { t } = useI18n();\nconst router = useRouter();\nconst toast = useToast();\nconst { getEventById } = useEvents();\n\nconst loading = ref(false);\nconst saving = ref(false);\nconst videoName = ref<string>(\"\");\nconst eventId = computed(() => parseInt(props.eventId, 10));\nconst isEditMode = computed(() => props.id !== undefined);\nconst categories: Ref<OtherVideoCategory[]> = ref([]);\n\nconst categoryOptions = computed(() =>\n    categories.value.map((c) => ({ title: c.name, value: c.id }))\n);\n\nconst breadcrumbs = computed<BreadcrumbItem[]>(() => {\n    const items: BreadcrumbItem[] = [\n        {\n            title: getEventById(eventId.value)?.name ?? \"...\",\n            to: { name: \"dashboard\", params: { eventId: props.eventId } },\n        },\n        {\n            title: t(\"VideosView.title\"),\n            to: { name: \"arkisto-videos\", params: { eventId: props.eventId } },\n        },\n    ];\n    if (isEditMode.value) {\n        items.push({ title: videoName.value || \"...\", disabled: true });\n    } else {\n        items.push({ title: t(\"Breadcrumbs.newVideo\"), disabled: true });\n    }\n    return items;\n});\n\n/**\n * Check if value looks like a YouTube URL or video ID\n */\nfunction isValidYoutubeInput(value: string): boolean {\n    if (!value) return false;\n    // Accept YouTube URLs or direct 11-char video IDs\n    const patterns = [\n        /(?:youtube\\.com\\/watch\\?v=|youtu\\.be\\/|youtube\\.com\\/embed\\/|youtube\\.com\\/v\\/)[a-zA-Z0-9_-]{11}/,\n        /^[a-zA-Z0-9_-]{11}$/,\n    ];\n    return patterns.some((pattern) => pattern.test(value));\n}\n\n// Form validation\nconst validationSchema = yupObject({\n    category: yupNumber().required().min(1),\n    name: yupString().required().min(1).max(64),\n    description: yupString(),\n    youtubeUrl: yupString()\n        .required()\n        .test(\"youtube-url\", \"Invalid YouTube URL or video ID\", (value) =>\n            isValidYoutubeInput(value ?? \"\")\n        ),\n});\n\nconst { handleSubmit, setValues, setErrors, meta } = useForm({\n    validationSchema,\n    initialValues: {\n        category: null as number | null,\n        name: \"\",\n        description: \"\",\n        youtubeUrl: \"\",\n    },\n});\n\nconst category = useField<number | null>(\"category\");\nconst name = useField<string>(\"name\");\nconst description = useField<string>(\"description\");\nconst youtubeUrl = useField<string>(\"youtubeUrl\");\n\nconst submit = handleSubmit(async (values) => {\n    saving.value = true;\n    let ok: boolean;\n    if (isEditMode.value) {\n        ok = await editVideo(parseInt(props.id!, 10), values);\n    } else {\n        ok = await createVideo(values);\n    }\n    saving.value = false;\n    if (ok) {\n        goBack();\n    }\n});\n\nfunction buildBody(values: GenericObject) {\n    return {\n        category: values.category,\n        name: values.name,\n        description: values.description || \"\",\n        youtube_url: values.youtubeUrl,\n    };\n}\n\nasync function createVideo(values: GenericObject) {\n    try {\n        await api.adminEventArkistoVideosCreate({\n            path: { event_pk: eventId.value },\n            body: buildBody(values),\n        });\n        toast.success(t(\"VideoEditView.createSuccess\"));\n        return true;\n    } catch (e) {\n        handleApiError(e, setErrors, toast, t(\"VideoEditView.createFailure\"), API_FIELD_MAPPING);\n    }\n    return false;\n}\n\nasync function editVideo(videoId: number, values: GenericObject) {\n    try {\n        await api.adminEventArkistoVideosPartialUpdate({\n            path: { event_pk: eventId.value, id: videoId },\n            body: buildBody(values),\n        });\n        toast.success(t(\"VideoEditView.editSuccess\"));\n        return true;\n    } catch (e) {\n        handleApiError(e, setErrors, toast, t(\"VideoEditView.editFailure\"), API_FIELD_MAPPING);\n    }\n    return false;\n}\n\nasync function loadCategories() {\n    try {\n        const response = await api.adminEventArkistoVideoCategoriesList({\n            path: { event_pk: eventId.value },\n            query: { limit: 100 },\n        });\n        categories.value = response.data!.results;\n    } catch (e) {\n        console.error(\"Failed to load categories:\", e);\n    }\n}\n\nfunction goBack() {\n    router.push({ name: \"arkisto-videos\", params: { eventId: props.eventId } });\n}\n\nonMounted(async () => {\n    await loadCategories();\n\n    if (isEditMode.value) {\n        loading.value = true;\n        try {\n            const response = await api.adminEventArkistoVideosRetrieve({\n                path: { event_pk: eventId.value, id: parseInt(props.id!, 10) },\n            });\n            const video = response.data!;\n            videoName.value = video.name;\n            setValues({\n                category: video.category,\n                name: video.name,\n                description: video.description ?? \"\",\n                youtubeUrl: video.youtube_url ?? \"\",\n            });\n        } catch (e) {\n            toast.error(t(\"VideoEditView.loadFailure\"));\n            console.error(e);\n            goBack();\n        } finally {\n            loading.value = false;\n        }\n    }\n});\n</script>\n"],"names":["API_FIELD_MAPPING","props","__props","t","useI18n","router","useRouter","toast","useToast","getEventById","useEvents","loading","ref","saving","videoName","eventId","computed","parseInt","isEditMode","categories","categoryOptions","c","breadcrumbs","items","isValidYoutubeInput","value","pattern","validationSchema","yupObject","yupNumber","yupString","handleSubmit","setValues","setErrors","meta","useForm","category","useField","name","description","youtubeUrl","submit","values","ok","editVideo","createVideo","goBack","buildBody","api.adminEventArkistoVideosCreate","e","handleApiError","videoId","api.adminEventArkistoVideosPartialUpdate","loadCategories","response","api.adminEventArkistoVideoCategoriesList","onMounted","video","api.adminEventArkistoVideosRetrieve","_createBlock","LayoutBase","_component_v_col","_createVNode","_component_v_progress_circular","_component_v_card","_component_v_card_text","_component_v_form","_unref","FormSection","_component_v_select","$event","_component_v_text_field","_component_v_textarea","_component_v_card_actions","_component_v_btn","FontAwesomeIcon","faSave","_createTextVNode"],"mappings":"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"}