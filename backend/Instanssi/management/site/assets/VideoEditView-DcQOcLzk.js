import{d as Q,a as W,u as X,v as ee,dw as ae,dx as te,o as oe,dy as se,b as c,g as m,w as r,e as s,A as re,p as ie,B as le,l as ne,j as a,i as p,t as v,a3 as ue,m as B,C as de,D as ce,E as me,V as T,k as pe,G as ve,s as V,I as b,ca as Ve,H as be}from"./index-DXU74lGt.js";import{c as ye,a as h,g as fe,u as ge,b as y}from"./index.esm-DWTrtXO7.js";import{_ as we}from"./AuditLogButton.vue_vue_type_script_setup_true_lang-5kFykphF.js";import{F as $}from"./FormSection-ByskKXOp.js";import{V as j,_ as _e}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D4jd1chv.js";import{h as D}from"./http-BTZWMaMN.js";import{p as C}from"./parseInt-Bzw_2rWL.js";import{V as ke}from"./VForm-C430u1Uz.js";import{V as Ee}from"./VTextarea-DeKWRVbT.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-WkXOSlqa.js";import"./useAuditLogUtils-BqNOieoY.js";import"./DateTimeCell.vue_vue_type_script_setup_true_lang-BMnBYvTq.js";import"./datetime-Dz9fjSvq.js";import"./VDataTableServer-CMLVDy59.js";import"./VDataTable-Jd7io3gq.js";import"./VContainer-BfWqa_tJ.js";const qe=Q({__name:"VideoEditView",props:{eventId:{},id:{}},setup(N){const U={category:"category",name:"name",description:"description",youtube_url:"youtubeUrl"},l=N,{t:o}=W(),P=X(),n=ee(),{getEventById:q}=be(),f=V(!1),g=V(!1),F=V(""),u=b(()=>C(l.eventId,10)),d=b(()=>l.id!==void 0),A=V([]),G=b(()=>A.value.map(e=>({title:e.name,value:e.id}))),z=b(()=>{const e=[{title:q(u.value)?.name??"...",to:{name:"dashboard",params:{eventId:l.eventId}}},{title:o("VideosView.title"),to:{name:"arkisto-videos",params:{eventId:l.eventId}}}];return d.value?e.push({title:F.value||"...",disabled:!0}):e.push({title:o("Breadcrumbs.newVideo"),disabled:!0}),e});function L(e){return e?[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/|youtube\.com\/v\/)[a-zA-Z0-9_-]{11}/,/^[a-zA-Z0-9_-]{11}$/].some(i=>i.test(e)):!1}const R=ye({category:fe().required().min(1),name:h().required().min(1).max(64),description:h(),youtubeUrl:h().required().test("youtube-url","Invalid YouTube URL or video ID",e=>L(e??""))}),{handleSubmit:H,setValues:Y,setErrors:x,meta:Z}=ge({validationSchema:R,initialValues:{category:null,name:"",description:"",youtubeUrl:""}}),w=y("category"),_=y("name"),k=y("description"),E=y("youtubeUrl"),S=H(async e=>{g.value=!0;let t;d.value?t=await J(C(l.id,10),e):t=await O(e),g.value=!1,t&&I()});function M(e){return{category:e.category,name:e.name,description:e.description||"",youtube_url:e.youtubeUrl}}async function O(e){try{return await ae({path:{event_pk:u.value},body:M(e)}),n.success(o("VideoEditView.createSuccess")),!0}catch(t){D(t,x,n,o("VideoEditView.createFailure"),U)}return!1}async function J(e,t){try{return await te({path:{event_pk:u.value,id:e},body:M(t)}),n.success(o("VideoEditView.editSuccess")),!0}catch(i){D(i,x,n,o("VideoEditView.editFailure"),U)}return!1}async function K(){try{const e=await Ve({path:{event_pk:u.value},query:{limit:100}});A.value=e.data.results}catch(e){console.error("Failed to load categories:",e)}}function I(){P.push({name:"arkisto-videos",params:{eventId:l.eventId}})}return oe(async()=>{if(await K(),d.value){f.value=!0;try{const t=(await se({path:{event_pk:u.value,id:C(l.id,10)}})).data;F.value=t.name,Y({category:t.category,name:t.name,description:t.description??"",youtubeUrl:t.youtube_url??""})}catch(e){n.error(o("VideoEditView.loadFailure")),console.error(e),I()}finally{f.value=!1}}}),(e,t)=>(c(),m(_e,{breadcrumbs:z.value},{default:r(()=>[f.value?(c(),m(j,{key:0,class:"d-flex justify-center my-8"},{default:r(()=>[s(re,{indeterminate:"",size:"64"})]),_:1})):(c(),m(j,{key:1},{default:r(()=>[s(ie,null,{default:r(()=>[s(le,null,{default:r(()=>[s(ke,{onSubmit:ne(a(S),["prevent"])},{default:r(()=>[s($,null,{default:r(()=>[p(v(a(o)("VideoEditView.sections.basicInfo")),1)]),_:1}),s(ue,{modelValue:a(w).value.value,"onUpdate:modelValue":t[0]||(t[0]=i=>a(w).value.value=i),modelModifiers:{number:!0},"error-messages":a(w).errorMessage.value,items:G.value,variant:"outlined",label:a(o)("VideoEditView.labels.category")+" *"},null,8,["modelValue","error-messages","items","label"]),s(B,{modelValue:a(_).value.value,"onUpdate:modelValue":t[1]||(t[1]=i=>a(_).value.value=i),"error-messages":a(_).errorMessage.value,variant:"outlined",label:a(o)("VideoEditView.labels.name")+" *"},null,8,["modelValue","error-messages","label"]),s(Ee,{modelValue:a(k).value.value,"onUpdate:modelValue":t[2]||(t[2]=i=>a(k).value.value=i),"error-messages":a(k).errorMessage.value,variant:"outlined",label:a(o)("VideoEditView.labels.description"),rows:"4"},null,8,["modelValue","error-messages","label"]),s($,null,{default:r(()=>[p(v(a(o)("VideoEditView.sections.youtube")),1)]),_:1}),s(B,{modelValue:a(E).value.value,"onUpdate:modelValue":t[3]||(t[3]=i=>a(E).value.value=i),"error-messages":a(E).errorMessage.value,variant:"outlined",label:a(o)("VideoEditView.labels.youtubeUrl")+" *",hint:a(o)("VideoEditView.labels.youtubeUrlHint"),"persistent-hint":"",class:"mb-4"},null,8,["modelValue","error-messages","label","hint"])]),_:1},8,["onSubmit"])]),_:1}),s(de,{class:"justify-end"},{default:r(()=>[d.value?(c(),m(we,{key:0,"app-label":"arkisto",model:"othervideo","object-pk":l.id},null,8,["object-pk"])):ce("",!0),s(me),s(T,{variant:"text",onClick:I},{default:r(()=>[p(v(a(o)("General.cancel")),1)]),_:1}),s(T,{variant:"elevated",color:"primary",loading:g.value,disabled:!a(Z).valid,onClick:a(S)},{prepend:r(()=>[s(a(pe),{icon:a(ve)},null,8,["icon"])]),default:r(()=>[p(" "+v(a(o)("General.save")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1}))]),_:1},8,["breadcrumbs"]))}});export{qe as default};
//# sourceMappingURL=VideoEditView-DcQOcLzk.js.map
