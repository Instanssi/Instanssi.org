import{d as M,b,c as x,f as C,t as h,l as X,D as P,e as l,j as t,dA as Z,k as A,w as n,p as ee,aD as te,V as R,bG as ae,B as oe,aG as se,s as y,I as m,_ as le,a as ne,u as re,J as ie,K as ue,v as de,L as O,o as ce,g as U,P as E,i as L,M as me,N as pe,m as ve,q as fe,ch as ge,dB as Ve,dC as ye,H as be}from"./index-CQkWvXOv.js";import{V as F,_ as he}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D5aCeQDf.js";import{_ as _e}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-DepTf6Bi.js";import{u as we,d as ke}from"./useTableState-CutuDm2i.js";import{g as Ie}from"./query_tools-BInV9OzK.js";import{g as xe}from"./http-CET7UDul.js";import{V as N}from"./VRow-CXIXhuhq.js";import{V as Ce}from"./VDataTableServer-C6tuZDKn.js";import{p as Te}from"./parseInt-BJ5A4_3y.js";import"./VContainer-DqJ8gu3P.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-1MnYozFL.js";import"./useAuditLogUtils-BdjF9k7b.js";import"./DateTimeCell.vue_vue_type_script_setup_true_lang-DaLynL44.js";import"./datetime-Dz9fjSvq.js";import"./VDataTable-f5_9vewM.js";const De={key:0},$e={key:0},Ee=["href"],Pe={class:"video-container"},Ae=["src"],Se={key:1},Be=M({__name:"YoutubeCell",props:{value:{default:null},fallback:{default:"-"}},setup(_){const p=y(!1),o=_;function I(i){try{const e=new URL(i),u=e.searchParams.get("v"),v=e.searchParams.get("start");return{videoId:u,startTime:v?parseInt(v,10):null}}catch{return{videoId:null,startTime:null}}}function T(i){const e=Math.floor(i/3600),u=Math.floor(i%3600/60),v=i%60;return e>0?`${e}:${u.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}`:`${u}:${v.toString().padStart(2,"0")}`}const g=m(()=>o.value?I(o.value):{videoId:null,startTime:null}),c=m(()=>g.value.videoId),f=m(()=>g.value.startTime),d=m(()=>f.value?T(f.value):""),w=m(()=>{if(!c.value)return"";let i=`https://www.youtube.com/embed/${c.value}`;return f.value&&(i+=`?start=${f.value}`),i});return(i,e)=>c.value?(b(),x("span",De,[C("a",{href:"#",onClick:e[0]||(e[0]=X(u=>p.value=!0,["prevent"]))},h(c.value),1),f.value?(b(),x("span",$e," @ "+h(d.value),1)):P("",!0),C("a",{href:_.value,target:"_blank",rel:"noopener",class:"external-link"},[l(t(A),{icon:t(Z)},null,8,["icon"])],8,Ee),l(se,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=u=>p.value=u),"max-width":"800"},{default:n(()=>[l(ee,null,{default:n(()=>[l(te,{class:"d-flex justify-space-between align-center"},{default:n(()=>[C("span",null,h(c.value),1),l(R,{icon:"",variant:"text",onClick:e[1]||(e[1]=u=>p.value=!1)},{default:n(()=>[l(t(A),{icon:t(ae)},null,8,["icon"])]),_:1})]),_:1}),l(oe,{class:"pa-0"},{default:n(()=>[C("div",Pe,[p.value?(b(),x("iframe",{key:0,src:w.value,frameborder:"0",allow:`
                                accelerometer;
                                autoplay;
                                clipboard-write;
                                encrypted-media;
                                gyroscope;
                                picture-in-picture;
                            `,allowfullscreen:""},null,8,Ae)):P("",!0)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])):(b(),x("span",Se,h(_.fallback),1))}}),Oe=le(Be,[["__scopeId","data-v-cdce6d61"]]),We=M({__name:"VideosView",props:{eventId:{}},setup(_){const p=_,{t:o}=ne(),I=re(),T=ie(ue),g=de(),c=fe(),{getEventById:f}=be(),d=m(()=>Te(p.eventId,10)),w=y(!1),i=m(()=>[{title:f(d.value)?.name??"...",to:{name:"dashboard",params:{eventId:p.eventId}}},{title:o("VideosView.title"),disabled:!0}]),e=we({filterKeys:["category"]}),u=y(0),v=y([]),D=y([]),k=y(null),V=m({get:()=>e.getFilterAsNumber("category"),set:a=>{e.setFilter("category",a),e.resetPage()}}),j=[{title:o("VideosView.headers.id"),sortable:!0,key:"id"},{title:o("VideosView.headers.name"),sortable:!0,key:"name"},{title:o("VideosView.headers.category"),sortable:!0,key:"category"},{title:o("VideosView.headers.youtube"),sortable:!1,key:"youtube_url"},{title:o("VideosView.headers.actions"),sortable:!1,key:"actions",align:"end"}],H=m(()=>[{title:o("VideosView.allCategories"),value:null},...D.value.map(a=>({title:a.name,value:a.id}))]);function q(a){return D.value.find(s=>s.id===a)?.name??`#${a}`}function G(){k.value&&B(k.value)}async function S(){try{const a=await ge({path:{event_pk:d.value},query:{limit:100}});D.value=a.data.results}catch(a){console.error("Failed to load categories:",a)}}async function B(a){w.value=!0,k.value=a;try{const r=await ye({path:{event_pk:d.value},query:{...Ie(a),...V.value?{category:V.value}:{}}});v.value=r.data.results,u.value=r.data.count}catch(r){g.error(o("VideosView.loadFailure")),console.error(r)}finally{w.value=!1}}const $=ke(B,250);function K(a){e.onOptionsUpdate(a),$(a)}O(V,()=>{k.value&&$({...k.value,page:1})});function Y(){V.value=null,e.search.value="",e.page.value=1,S(),$({page:1,itemsPerPage:e.perPage.value??25,sortBy:[],groupBy:[],search:""})}O(d,Y);async function z(a){const r=o("VideosView.confirmDelete",a);await T.value.ifConfirmed(r,async()=>{try{await Ve({path:{event_pk:d.value,id:a.id}}),g.success(o("VideosView.deleteSuccess")),G()}catch(s){g.error(xe(s,o("VideosView.deleteFailure"))),console.error(s)}})}function J(a){I.push({name:"arkisto-videos-edit",params:{eventId:d.value,id:a}})}function Q(){I.push({name:"arkisto-videos-new",params:{eventId:d.value}})}return ce(()=>{S()}),(a,r)=>(b(),U(he,{key:`videos-${d.value}`,breadcrumbs:i.value},{default:n(()=>[l(F,null,{default:n(()=>[l(N,null,{default:n(()=>[t(c).canAdd(t(E).OTHER_VIDEO)?(b(),U(R,{key:0,color:"primary",onClick:Q},{prepend:n(()=>[l(t(A),{icon:t(me)},null,8,["icon"])]),default:n(()=>[L(" "+h(t(o)("VideosView.newVideo")),1)]),_:1})):P("",!0),l(pe,{modelValue:V.value,"onUpdate:modelValue":r[0]||(r[0]=s=>V.value=s),items:H.value,variant:"outlined",density:"compact",label:t(o)("VideosView.filterByCategory"),style:{"max-width":"300px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","items","label"]),l(ve,{modelValue:t(e).search.value,"onUpdate:modelValue":r[1]||(r[1]=s=>t(e).search.value=s),variant:"outlined",density:"compact",label:t(o)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),l(F,null,{default:n(()=>[l(N,null,{default:n(()=>[l(Ce,{"items-per-page":t(e).perPage.value,"onUpdate:itemsPerPage":r[2]||(r[2]=s=>t(e).perPage.value=s),"sort-by":t(e).sortByArray.value,class:"elevation-1 primary","item-value":"id",density:"compact",headers:j,items:v.value,"items-length":u.value,loading:w.value,search:t(e).search.value,page:t(e).page.value,"items-per-page-options":t(e).pageSizeOptions,"no-data-text":t(o)("VideosView.noVideosFound"),"loading-text":t(o)("VideosView.loadingVideos"),"onUpdate:options":K},{"item.category":n(({item:s})=>[L(h(q(s.category)),1)]),"item.youtube_url":n(({item:s})=>[l(Oe,{value:s.youtube_url},null,8,["value"])]),"item.actions":n(({item:s})=>[l(_e,{"can-edit":t(c).canChange(t(E).OTHER_VIDEO),"can-delete":t(c).canDelete(t(E).OTHER_VIDEO),"audit-log":{appLabel:"arkisto",model:"othervideo",objectPk:s.id},onEdit:W=>J(s.id),onDelete:W=>z(s)},null,8,["can-edit","can-delete","audit-log","onEdit","onDelete"])]),_:1},8,["items-per-page","sort-by","items","items-length","loading","search","page","items-per-page-options","no-data-text","loading-text"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{We as default};
//# sourceMappingURL=VideosView-C-UwZkj9.js.map
