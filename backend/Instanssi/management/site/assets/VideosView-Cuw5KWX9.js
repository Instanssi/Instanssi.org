import{d as H,b,c as C,f as T,t as _,l as ee,K as S,e as s,j as t,c9 as ae,k as A,w as n,p as te,ar as oe,V as j,br as se,B as le,au as ne,s as c,G as f,_ as re,a as ie,u as ue,H as de,I as ce,v as me,Z as L,o as ve,g as F,P,i as R,J as pe,a2 as fe,m as Ve,q as ge,c5 as ye,ca as be,cb as _e,E as he}from"./index-CY4kEXQX.js";import{V as M,_ as we}from"./LayoutBase.vue_vue_type_script_setup_true_lang-mBpG7FYr.js";import{_ as ke}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-CU2jcJ7N.js";import{d as Ie,V as xe,g as Ce}from"./query_tools-D1ttn1y9.js";import{g as Te}from"./http-h2SUVdDm.js";import{V as N}from"./VRow-Dt2mDaW0.js";import{p as Ee}from"./parseInt-DjOfejfT.js";import"./VContainer-DyZfstE_.js";import"./VDataTable-K-Y489M6.js";import"./filter-B_C-txEo.js";const $e={key:0},De={key:0},Pe=["href"],Se={class:"video-container"},Ae=["src"],Be={key:1},Ue=H({__name:"YoutubeCell",props:{value:{default:null},fallback:{default:"-"}},setup(h){const v=c(!1),e=h;function I(u){try{const l=new URL(u),i=l.searchParams.get("v"),p=l.searchParams.get("start");return{videoId:i,startTime:p?parseInt(p,10):null}}catch{return{videoId:null,startTime:null}}}function E(u){const l=Math.floor(u/3600),i=Math.floor(u%3600/60),p=u%60;return l>0?`${l}:${i.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}`:`${i}:${p.toString().padStart(2,"0")}`}const g=f(()=>e.value?I(e.value):{videoId:null,startTime:null}),m=f(()=>g.value.videoId),V=f(()=>g.value.startTime),d=f(()=>V.value?E(V.value):""),w=f(()=>{if(!m.value)return"";let u=`https://www.youtube.com/embed/${m.value}`;return V.value&&(u+=`?start=${V.value}`),u});return(u,l)=>m.value?(b(),C("span",$e,[T("a",{href:"#",onClick:l[0]||(l[0]=ee(i=>v.value=!0,["prevent"]))},_(m.value),1),V.value?(b(),C("span",De," @ "+_(d.value),1)):S("",!0),T("a",{href:h.value,target:"_blank",rel:"noopener",class:"external-link"},[s(t(A),{icon:t(ae)},null,8,["icon"])],8,Pe),s(ne,{modelValue:v.value,"onUpdate:modelValue":l[2]||(l[2]=i=>v.value=i),"max-width":"800"},{default:n(()=>[s(te,null,{default:n(()=>[s(oe,{class:"d-flex justify-space-between align-center"},{default:n(()=>[T("span",null,_(m.value),1),s(j,{icon:"",variant:"text",onClick:l[1]||(l[1]=i=>v.value=!1)},{default:n(()=>[s(t(A),{icon:t(se)},null,8,["icon"])]),_:1})]),_:1}),s(le,{class:"pa-0"},{default:n(()=>[T("div",Se,[v.value?(b(),C("iframe",{key:0,src:w.value,frameborder:"0",allow:`
                                accelerometer;
                                autoplay;
                                clipboard-write;
                                encrypted-media;
                                gyroscope;
                                picture-in-picture;
                            `,allowfullscreen:""},null,8,Ae)):S("",!0)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])):(b(),C("span",Be,_(h.fallback),1))}}),Oe=re(Ue,[["__scopeId","data-v-cdce6d61"]]),Ke=H({__name:"VideosView",props:{eventId:{}},setup(h){const v=h,{t:e}=ie(),I=ue(),E=de(ce),g=me(),m=ge(),{getEventById:V}=he(),d=f(()=>Ee(v.eventId,10)),w=c(!1),u=f(()=>[{title:V(d.value)?.name??"...",to:{name:"dashboard",params:{eventId:v.eventId}}},{title:e("VideosView.title"),disabled:!0}]),l=[25,50,100],i=c(l[0]),p=c(0),q=c(1),B=c([]),$=c([]),x=c(""),y=c(null),k=c(null),Y=[{title:e("VideosView.headers.id"),sortable:!0,key:"id"},{title:e("VideosView.headers.name"),sortable:!0,key:"name"},{title:e("VideosView.headers.category"),sortable:!1,key:"category"},{title:e("VideosView.headers.youtube"),sortable:!1,key:"youtube_url"},{title:e("VideosView.headers.actions"),sortable:!1,key:"actions",align:"end"}],G=f(()=>[{title:e("VideosView.allCategories"),value:null},...$.value.map(a=>({title:a.name,value:a.id}))]);function K(a){return $.value.find(o=>o.id===a)?.name??`#${a}`}function z(){k.value&&O(k.value)}async function U(){try{const a=await ye({path:{event_pk:d.value},query:{limit:100}});$.value=a.data.results}catch(a){console.error("Failed to load categories:",a)}}async function O(a){w.value=!0,k.value=a;try{const r=await _e({path:{event_pk:d.value},query:{...Ce(a),...y.value?{category:y.value}:{}}});B.value=r.data.results,p.value=r.data.count}catch(r){g.error(e("VideosView.loadFailure")),console.error(r)}finally{w.value=!1}}const D=Ie(O,250);L(y,()=>{k.value&&D(k.value)});function J(){y.value=null,x.value="",U(),D({page:1,itemsPerPage:i.value??25,sortBy:[],groupBy:[],search:""})}L(d,J);async function Z(a){const r=e("VideosView.confirmDelete",a);await E.value.ifConfirmed(r,async()=>{try{await be({path:{event_pk:d.value,id:a.id}}),g.success(e("VideosView.deleteSuccess")),z()}catch(o){g.error(Te(o,e("VideosView.deleteFailure"))),console.error(o)}})}function Q(a){I.push({name:"arkisto-videos-edit",params:{eventId:d.value,id:a}})}function W(){I.push({name:"arkisto-videos-new",params:{eventId:d.value}})}return ve(()=>{U()}),(a,r)=>(b(),F(we,{key:`videos-${d.value}`,breadcrumbs:u.value},{default:n(()=>[s(M,null,{default:n(()=>[s(N,null,{default:n(()=>[t(m).canAdd(t(P).OTHER_VIDEO)?(b(),F(j,{key:0,onClick:W},{prepend:n(()=>[s(t(A),{icon:t(pe)},null,8,["icon"])]),default:n(()=>[R(" "+_(t(e)("VideosView.newVideo")),1)]),_:1})):S("",!0),s(fe,{modelValue:y.value,"onUpdate:modelValue":r[0]||(r[0]=o=>y.value=o),items:G.value,variant:"outlined",density:"compact",label:t(e)("VideosView.filterByCategory"),style:{"max-width":"300px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","items","label"]),s(Ve,{modelValue:x.value,"onUpdate:modelValue":r[1]||(r[1]=o=>x.value=o),variant:"outlined",density:"compact",label:t(e)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),s(M,null,{default:n(()=>[s(N,null,{default:n(()=>[s(xe,{"items-per-page":i.value,"onUpdate:itemsPerPage":r[2]||(r[2]=o=>i.value=o),class:"elevation-1 primary","item-value":"id",density:"compact",headers:Y,items:B.value,"items-length":p.value,loading:w.value,search:x.value,page:q.value,"items-per-page-options":l,"no-data-text":t(e)("VideosView.noVideosFound"),"loading-text":t(e)("VideosView.loadingVideos"),"onUpdate:options":t(D)},{"item.category":n(({item:o})=>[R(_(K(o.category)),1)]),"item.youtube_url":n(({item:o})=>[s(Oe,{value:o.youtube_url},null,8,["value"])]),"item.actions":n(({item:o})=>[s(ke,{"can-edit":t(m).canChange(t(P).OTHER_VIDEO),"can-delete":t(m).canDelete(t(P).OTHER_VIDEO),onEdit:X=>Q(o.id),onDelete:X=>Z(o)},null,8,["can-edit","can-delete","onEdit","onDelete"])]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Ke as default};
//# sourceMappingURL=VideosView-Cuw5KWX9.js.map
