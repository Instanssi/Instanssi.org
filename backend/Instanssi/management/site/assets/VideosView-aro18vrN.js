import{d as j,b,c as C,f as T,t as h,l as ee,D as B,e as s,j as o,dt as te,k as S,w as n,p as ae,aB as oe,V as H,by as se,B as le,aE as ne,s as c,I as f,_ as re,a as ie,u as ue,J as de,K as ce,v as me,U as O,o as ve,g as F,P,i as R,L as pe,a3 as fe,m as Ve,q as ge,ca as ye,du as be,dv as he,H as _e}from"./index-DXU74lGt.js";import{V as M,_ as we}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D4jd1chv.js";import{_ as ke}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-CUVfxWfg.js";import{g as Ie}from"./query_tools-BInV9OzK.js";import{g as xe}from"./http-BTZWMaMN.js";import{d as Ce}from"./debounce-CQ84CrOG.js";import{V as N}from"./VRow-B94Tto0H.js";import{V as Te}from"./VDataTableServer-CMLVDy59.js";import{p as Ee}from"./parseInt-Bzw_2rWL.js";import"./VContainer-BfWqa_tJ.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-WkXOSlqa.js";import"./useAuditLogUtils-BqNOieoY.js";import"./DateTimeCell.vue_vue_type_script_setup_true_lang-BMnBYvTq.js";import"./datetime-Dz9fjSvq.js";import"./VDataTable-Jd7io3gq.js";const $e={key:0},De={key:0},Pe=["href"],Be={class:"video-container"},Se=["src"],Ae={key:1},Ue=j({__name:"YoutubeCell",props:{value:{default:null},fallback:{default:"-"}},setup(_){const v=c(!1),e=_;function I(u){try{const l=new URL(u),i=l.searchParams.get("v"),p=l.searchParams.get("start");return{videoId:i,startTime:p?parseInt(p,10):null}}catch{return{videoId:null,startTime:null}}}function E(u){const l=Math.floor(u/3600),i=Math.floor(u%3600/60),p=u%60;return l>0?`${l}:${i.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}`:`${i}:${p.toString().padStart(2,"0")}`}const g=f(()=>e.value?I(e.value):{videoId:null,startTime:null}),m=f(()=>g.value.videoId),V=f(()=>g.value.startTime),d=f(()=>V.value?E(V.value):""),w=f(()=>{if(!m.value)return"";let u=`https://www.youtube.com/embed/${m.value}`;return V.value&&(u+=`?start=${V.value}`),u});return(u,l)=>m.value?(b(),C("span",$e,[T("a",{href:"#",onClick:l[0]||(l[0]=ee(i=>v.value=!0,["prevent"]))},h(m.value),1),V.value?(b(),C("span",De," @ "+h(d.value),1)):B("",!0),T("a",{href:_.value,target:"_blank",rel:"noopener",class:"external-link"},[s(o(S),{icon:o(te)},null,8,["icon"])],8,Pe),s(ne,{modelValue:v.value,"onUpdate:modelValue":l[2]||(l[2]=i=>v.value=i),"max-width":"800"},{default:n(()=>[s(ae,null,{default:n(()=>[s(oe,{class:"d-flex justify-space-between align-center"},{default:n(()=>[T("span",null,h(m.value),1),s(H,{icon:"",variant:"text",onClick:l[1]||(l[1]=i=>v.value=!1)},{default:n(()=>[s(o(S),{icon:o(se)},null,8,["icon"])]),_:1})]),_:1}),s(le,{class:"pa-0"},{default:n(()=>[T("div",Be,[v.value?(b(),C("iframe",{key:0,src:w.value,frameborder:"0",allow:`
                                accelerometer;
                                autoplay;
                                clipboard-write;
                                encrypted-media;
                                gyroscope;
                                picture-in-picture;
                            `,allowfullscreen:""},null,8,Se)):B("",!0)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])):(b(),C("span",Ae,h(_.fallback),1))}}),Le=re(Ue,[["__scopeId","data-v-cdce6d61"]]),Xe=j({__name:"VideosView",props:{eventId:{}},setup(_){const v=_,{t:e}=ie(),I=ue(),E=de(ce),g=me(),m=ge(),{getEventById:V}=_e(),d=f(()=>Ee(v.eventId,10)),w=c(!1),u=f(()=>[{title:V(d.value)?.name??"...",to:{name:"dashboard",params:{eventId:v.eventId}}},{title:e("VideosView.title"),disabled:!0}]),l=[25,50,100],i=c(l[0]),p=c(0),q=c(1),A=c([]),$=c([]),x=c(""),y=c(null),k=c(null),Y=[{title:e("VideosView.headers.id"),sortable:!0,key:"id"},{title:e("VideosView.headers.name"),sortable:!0,key:"name"},{title:e("VideosView.headers.category"),sortable:!1,key:"category"},{title:e("VideosView.headers.youtube"),sortable:!1,key:"youtube_url"},{title:e("VideosView.headers.actions"),sortable:!1,key:"actions",align:"end"}],K=f(()=>[{title:e("VideosView.allCategories"),value:null},...$.value.map(t=>({title:t.name,value:t.id}))]);function z(t){return $.value.find(a=>a.id===t)?.name??`#${t}`}function G(){k.value&&L(k.value)}async function U(){try{const t=await ye({path:{event_pk:d.value},query:{limit:100}});$.value=t.data.results}catch(t){console.error("Failed to load categories:",t)}}async function L(t){w.value=!0,k.value=t;try{const r=await he({path:{event_pk:d.value},query:{...Ie(t),...y.value?{category:y.value}:{}}});A.value=r.data.results,p.value=r.data.count}catch(r){g.error(e("VideosView.loadFailure")),console.error(r)}finally{w.value=!1}}const D=Ce(L,250);O(y,()=>{k.value&&D(k.value)});function J(){y.value=null,x.value="",U(),D({page:1,itemsPerPage:i.value??25,sortBy:[],groupBy:[],search:""})}O(d,J);async function Q(t){const r=e("VideosView.confirmDelete",t);await E.value.ifConfirmed(r,async()=>{try{await be({path:{event_pk:d.value,id:t.id}}),g.success(e("VideosView.deleteSuccess")),G()}catch(a){g.error(xe(a,e("VideosView.deleteFailure"))),console.error(a)}})}function W(t){I.push({name:"arkisto-videos-edit",params:{eventId:d.value,id:t}})}function X(){I.push({name:"arkisto-videos-new",params:{eventId:d.value}})}return ve(()=>{U()}),(t,r)=>(b(),F(we,{key:`videos-${d.value}`,breadcrumbs:u.value},{default:n(()=>[s(M,null,{default:n(()=>[s(N,null,{default:n(()=>[o(m).canAdd(o(P).OTHER_VIDEO)?(b(),F(H,{key:0,color:"primary",onClick:X},{prepend:n(()=>[s(o(S),{icon:o(pe)},null,8,["icon"])]),default:n(()=>[R(" "+h(o(e)("VideosView.newVideo")),1)]),_:1})):B("",!0),s(fe,{modelValue:y.value,"onUpdate:modelValue":r[0]||(r[0]=a=>y.value=a),items:K.value,variant:"outlined",density:"compact",label:o(e)("VideosView.filterByCategory"),style:{"max-width":"300px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","items","label"]),s(Ve,{modelValue:x.value,"onUpdate:modelValue":r[1]||(r[1]=a=>x.value=a),variant:"outlined",density:"compact",label:o(e)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),s(M,null,{default:n(()=>[s(N,null,{default:n(()=>[s(Te,{"items-per-page":i.value,"onUpdate:itemsPerPage":r[2]||(r[2]=a=>i.value=a),class:"elevation-1 primary","item-value":"id",density:"compact",headers:Y,items:A.value,"items-length":p.value,loading:w.value,search:x.value,page:q.value,"items-per-page-options":l,"no-data-text":o(e)("VideosView.noVideosFound"),"loading-text":o(e)("VideosView.loadingVideos"),"onUpdate:options":o(D)},{"item.category":n(({item:a})=>[R(h(z(a.category)),1)]),"item.youtube_url":n(({item:a})=>[s(Le,{value:a.youtube_url},null,8,["value"])]),"item.actions":n(({item:a})=>[s(ke,{"can-edit":o(m).canChange(o(P).OTHER_VIDEO),"can-delete":o(m).canDelete(o(P).OTHER_VIDEO),"audit-log":{appLabel:"arkisto",model:"othervideo",objectPk:a.id},onEdit:Z=>W(a.id),onDelete:Z=>Q(a)},null,8,["can-edit","can-delete","audit-log","onEdit","onDelete"])]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Xe as default};
//# sourceMappingURL=VideosView-aro18vrN.js.map
