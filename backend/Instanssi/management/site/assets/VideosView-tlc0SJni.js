import{d as M,b as y,c as x,f as C,t as b,l as X,K as S,e as s,j as t,c9 as Z,k as A,w as n,p as ee,ar as ae,V as N,br as te,B as oe,au as se,s as d,G as f,_ as le,a as ne,u as re,H as ie,I as ue,v as de,a1 as ce,o as me,g as O,P as D,i as L,J as ve,a2 as pe,m as fe,q as Ve,c5 as ge,ca as ye,cb as be,E as _e}from"./index-BSHMv_df.js";import{V as F,_ as we}from"./LayoutBase.vue_vue_type_script_setup_true_lang-C8aKWyeJ.js";import{_ as he}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-DouyropJ.js";import{d as ke,V as Ie,g as xe}from"./query_tools-Co6bP9h2.js";import{g as Ce}from"./http-BZkoYM_m.js";import{V as R}from"./VRow-BUBfmFS3.js";import{p as Te}from"./parseInt-3OpbdfxQ.js";import"./VContainer--EpXOfw5.js";import"./VDataTable-CpUosGjF.js";import"./filter-C6Uu0LOB.js";const Ee={key:0},$e={key:0},De=["href"],Se={class:"video-container"},Ae=["src"],Pe={key:1},Ue=M({__name:"YoutubeCell",props:{value:{default:null},fallback:{default:"-"}},setup(_){const v=d(!1),e=_;function I(i){try{const l=new URL(i),u=l.searchParams.get("v"),p=l.searchParams.get("start");return{videoId:u,startTime:p?parseInt(p,10):null}}catch{return{videoId:null,startTime:null}}}function T(i){const l=Math.floor(i/3600),u=Math.floor(i%3600/60),p=i%60;return l>0?`${l}:${u.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}`:`${u}:${p.toString().padStart(2,"0")}`}const g=f(()=>e.value?I(e.value):{videoId:null,startTime:null}),c=f(()=>g.value.videoId),V=f(()=>g.value.startTime),m=f(()=>V.value?T(V.value):""),w=f(()=>{if(!c.value)return"";let i=`https://www.youtube.com/embed/${c.value}`;return V.value&&(i+=`?start=${V.value}`),i});return(i,l)=>c.value?(y(),x("span",Ee,[C("a",{href:"#",onClick:l[0]||(l[0]=X(u=>v.value=!0,["prevent"]))},b(c.value),1),V.value?(y(),x("span",$e," @ "+b(m.value),1)):S("",!0),C("a",{href:_.value,target:"_blank",rel:"noopener",class:"external-link"},[s(t(A),{icon:t(Z)},null,8,["icon"])],8,De),s(se,{modelValue:v.value,"onUpdate:modelValue":l[2]||(l[2]=u=>v.value=u),"max-width":"800"},{default:n(()=>[s(ee,null,{default:n(()=>[s(ae,{class:"d-flex justify-space-between align-center"},{default:n(()=>[C("span",null,b(c.value),1),s(N,{icon:"",variant:"text",onClick:l[1]||(l[1]=u=>v.value=!1)},{default:n(()=>[s(t(A),{icon:t(te)},null,8,["icon"])]),_:1})]),_:1}),s(oe,{class:"pa-0"},{default:n(()=>[C("div",Se,[v.value?(y(),x("iframe",{key:0,src:w.value,frameborder:"0",allow:`
                                accelerometer;
                                autoplay;
                                clipboard-write;
                                encrypted-media;
                                gyroscope;
                                picture-in-picture;
                            `,allowfullscreen:""},null,8,Ae)):S("",!0)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])):(y(),x("span",Pe,b(_.fallback),1))}}),Be=le(Ue,[["__scopeId","data-v-cdce6d61"]]),Ge=M({__name:"VideosView",props:{eventId:{}},setup(_){const v=_,{t:e}=ne(),I=re(),T=ie(ue),g=de(),c=Ve(),{getEventById:V}=_e(),m=f(()=>Te(v.eventId,10)),w=d(!1),i=f(()=>[{title:V(m.value)?.name??"...",to:{name:"dashboard",params:{eventId:v.eventId}}},{title:e("VideosView.title"),disabled:!0}]),l=[25,50,100],u=d(l[0]),p=d(0),H=d(1),P=d([]),E=d([]),$=d(""),h=d(null),k=d(null),j=[{title:e("VideosView.headers.id"),sortable:!0,key:"id"},{title:e("VideosView.headers.name"),sortable:!0,key:"name"},{title:e("VideosView.headers.category"),sortable:!1,key:"category"},{title:e("VideosView.headers.youtube"),sortable:!1,key:"youtube_url"},{title:e("VideosView.headers.actions"),sortable:!1,key:"actions",align:"end"}],q=f(()=>[{title:e("VideosView.allCategories"),value:null},...E.value.map(a=>({title:a.name,value:a.id}))]);function Y(a){return E.value.find(o=>o.id===a)?.name??`#${a}`}function G(){k.value&&U(k.value)}async function K(){try{const a=await ge({path:{event_pk:m.value},query:{limit:100}});E.value=a.data.results}catch(a){console.error("Failed to load categories:",a)}}async function U(a){w.value=!0,k.value=a;try{const r=await be({path:{event_pk:m.value},query:{...xe(a),...h.value?{category:h.value}:{}}});P.value=r.data.results,p.value=r.data.count}catch(r){g.error(e("VideosView.loadFailure")),console.error(r)}finally{w.value=!1}}const B=ke(U,250);ce(h,()=>{k.value&&B(k.value)});async function z(a){const r=e("VideosView.confirmDelete",a);await T.value.ifConfirmed(r,async()=>{try{await ye({path:{event_pk:m.value,id:a.id}}),g.success(e("VideosView.deleteSuccess")),G()}catch(o){g.error(Ce(o,e("VideosView.deleteFailure"))),console.error(o)}})}function J(a){I.push({name:"arkisto-videos-edit",params:{eventId:m.value,id:a}})}function Q(){I.push({name:"arkisto-videos-new",params:{eventId:m.value}})}return me(()=>{K()}),(a,r)=>(y(),O(we,{key:`videos-${m.value}`,breadcrumbs:i.value},{default:n(()=>[s(F,null,{default:n(()=>[s(R,null,{default:n(()=>[t(c).canAdd(t(D).OTHER_VIDEO)?(y(),O(N,{key:0,onClick:Q},{prepend:n(()=>[s(t(A),{icon:t(ve)},null,8,["icon"])]),default:n(()=>[L(" "+b(t(e)("VideosView.newVideo")),1)]),_:1})):S("",!0),s(pe,{modelValue:h.value,"onUpdate:modelValue":r[0]||(r[0]=o=>h.value=o),items:q.value,variant:"outlined",density:"compact",label:t(e)("VideosView.filterByCategory"),style:{"max-width":"300px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","items","label"]),s(fe,{modelValue:$.value,"onUpdate:modelValue":r[1]||(r[1]=o=>$.value=o),variant:"outlined",density:"compact",label:t(e)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0 ml-4",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),s(F,null,{default:n(()=>[s(R,null,{default:n(()=>[s(Ie,{"items-per-page":u.value,"onUpdate:itemsPerPage":r[2]||(r[2]=o=>u.value=o),class:"elevation-1 primary","item-value":"id",density:"compact",headers:j,items:P.value,"items-length":p.value,loading:w.value,search:$.value,page:H.value,"items-per-page-options":l,"no-data-text":t(e)("VideosView.noVideosFound"),"loading-text":t(e)("VideosView.loadingVideos"),"onUpdate:options":t(B)},{"item.category":n(({item:o})=>[L(b(Y(o.category)),1)]),"item.youtube_url":n(({item:o})=>[s(Be,{value:o.youtube_url},null,8,["value"])]),"item.actions":n(({item:o})=>[s(he,{"can-edit":t(c).canChange(t(D).OTHER_VIDEO),"can-delete":t(c).canDelete(t(D).OTHER_VIDEO),onEdit:W=>J(o.id),onDelete:W=>z(o)},null,8,["can-edit","can-delete","onEdit","onDelete"])]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1})]),_:1},8,["breadcrumbs"]))}});export{Ge as default};
//# sourceMappingURL=VideosView-tlc0SJni.js.map
