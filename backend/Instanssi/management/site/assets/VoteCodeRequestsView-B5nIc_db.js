import{d as Q,a as G,v as M,b as m,g as p,w as n,e as l,m as H,j as a,P as w,V as b,k as y,bj as J,K as h,br as W,bs as X,b4 as Y,i as D,t as S,bt as Z,q as ee,G as U,s as r,bu as te,bv as ae,bw as se,E as oe}from"./index-BSHMv_df.js";import{V as O,_ as ne}from"./LayoutBase.vue_vue_type_script_setup_true_lang-C8aKWyeJ.js";import{d as le,V as re,g as ue}from"./query_tools-Co6bP9h2.js";import{g as ie}from"./http-BZkoYM_m.js";import{V as P}from"./VRow-BUBfmFS3.js";import{p as v}from"./parseInt-3OpbdfxQ.js";import"./VContainer--EpXOfw5.js";import"./VDataTable-CpUosGjF.js";import"./filter-C6Uu0LOB.js";const we=Q({__name:"VoteCodeRequestsView",props:{eventId:{}},setup(F){const u=F,{t}=G(),d=M(),V=ee(),{getEventById:$}=oe(),q=U(()=>v(u.eventId,10)),f=r(!1),c=r(null),R=r(void 0),z=U(()=>[{title:$(q.value)?.name??"...",to:{name:"dashboard",params:{eventId:u.eventId}}},{title:t("VoteCodeRequestsView.title"),disabled:!0}]),_=[25,50,100],k=r(_[0]),E=r(0),A=r(1),x=r([]),g=r(""),i=r(null),B=[{title:t("VoteCodeRequestsView.headers.id"),sortable:!0,key:"id"},{title:t("VoteCodeRequestsView.headers.user"),sortable:!1,key:"user"},{title:t("VoteCodeRequestsView.headers.text"),sortable:!1,key:"text"},{title:t("VoteCodeRequestsView.headers.status"),sortable:!0,key:"status"},{title:t("VoteCodeRequestsView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function K(o){switch(o){case 0:return"warning";case 1:return"success";case 2:return"error";default:return"grey"}}function L(o){switch(o){case 0:return t("VoteCodeRequestsView.statuses.pending");case 1:return t("VoteCodeRequestsView.statuses.approved");case 2:return t("VoteCodeRequestsView.statuses.rejected");default:return"Unknown"}}async function C(o){f.value=!0,i.value=o;try{const s=await se({path:{event_pk:v(u.eventId,10)},query:{...ue(o)}});x.value=s.data.results,E.value=s.data.count}catch(s){d.error(t("VoteCodeRequestsView.loadFailure")),console.error(s)}finally{f.value=!1}}async function I(o,s){c.value=o;try{await te({path:{event_pk:v(u.eventId,10),id:o},body:{status:s}}),i.value&&await C(i.value)}catch(e){d.error(t("VoteCodeRequestsView.updateFailure")),console.error(e)}finally{c.value=null}}async function j(o){await R.value?.ifConfirmed(t("VoteCodeRequestsView.confirmDelete"),async()=>{try{await ae({path:{event_pk:v(u.eventId,10),id:o.id}}),d.success(t("VoteCodeRequestsView.deleteSuccess")),i.value&&await C(i.value)}catch(s){d.error(ie(s,t("VoteCodeRequestsView.deleteFailure"))),console.error(s)}})}const N=le(C,250);return(o,s)=>(m(),p(ne,{key:`vote-code-requests-${q.value}`,breadcrumbs:z.value},{default:n(()=>[l(O,null,{default:n(()=>[l(P,null,{default:n(()=>[l(H,{modelValue:g.value,"onUpdate:modelValue":s[0]||(s[0]=e=>g.value=e),variant:"outlined",density:"compact",label:a(t)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),l(O,null,{default:n(()=>[l(P,null,{default:n(()=>[l(re,{"items-per-page":k.value,"onUpdate:itemsPerPage":s[1]||(s[1]=e=>k.value=e),class:"elevation-1 primary","item-value":"id",density:"compact",headers:B,items:x.value,"items-length":E.value,loading:f.value,search:g.value,page:A.value,"items-per-page-options":_,"no-data-text":a(t)("VoteCodeRequestsView.noRequestsFound"),"loading-text":a(t)("VoteCodeRequestsView.loadingRequests"),"onUpdate:options":a(N)},{"item.user":n(({item:e})=>[D(S(e.user),1)]),"item.status":n(({item:e})=>[l(Y,{color:K(e.status??0),size:"small"},{default:n(()=>[D(S(L(e.status??0)),1)]),_:2},1032,["color"])]),"item.actions":n(({item:e})=>[(e.status??0)!==1&&a(V).canChange(a(w).VOTE_CODE_REQUEST)?(m(),p(b,{key:0,color:"success",size:"small",variant:"text",loading:c.value===e.id,onClick:T=>I(e.id,1)},{default:n(()=>[l(a(y),{icon:a(J)},null,8,["icon"])]),_:1},8,["loading","onClick"])):h("",!0),(e.status??0)!==2&&a(V).canChange(a(w).VOTE_CODE_REQUEST)?(m(),p(b,{key:1,color:"error",size:"small",variant:"text",loading:c.value===e.id,onClick:T=>I(e.id,2)},{default:n(()=>[l(a(y),{icon:a(W)},null,8,["icon"])]),_:1},8,["loading","onClick"])):h("",!0),a(V).canDelete(a(w).VOTE_CODE_REQUEST)?(m(),p(b,{key:2,color:"error",size:"small",variant:"text",onClick:T=>j(e)},{default:n(()=>[l(a(y),{icon:a(X)},null,8,["icon"])]),_:1},8,["onClick"])):h("",!0)]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1}),l(Z,{ref_key:"confirmDialog",ref:R},null,512)]),_:1},8,["breadcrumbs"]))}});export{we as default};
//# sourceMappingURL=VoteCodeRequestsView-B5nIc_db.js.map
