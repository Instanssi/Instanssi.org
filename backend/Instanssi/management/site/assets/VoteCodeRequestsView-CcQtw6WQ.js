import{d as G,a as H,v as M,U as Z,b as p,g as v,w as n,e as r,m as J,j as a,P as h,V as q,k as R,Z as W,D as _,by as X,a0 as Y,a4 as ee,i as S,t as U,bz as te,q as ae,I as P,s as l,bA as se,bB as oe,bC as ne,H as re}from"./index-DXU74lGt.js";import{V as B,_ as le}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D4jd1chv.js";import{g as ue}from"./query_tools-BInV9OzK.js";import{g as ie}from"./http-BTZWMaMN.js";import{d as de}from"./debounce-CQ84CrOG.js";import{V as O}from"./VRow-B94Tto0H.js";import{V as ce}from"./VDataTableServer-CMLVDy59.js";import{p as V}from"./parseInt-Bzw_2rWL.js";import"./VContainer-BfWqa_tJ.js";import"./VDataTable-Jd7io3gq.js";const qe=G({__name:"VoteCodeRequestsView",props:{eventId:{}},setup(z){const u=z,{t}=H(),d=M(),f=ae(),{getEventById:A}=re(),g=P(()=>V(u.eventId,10)),C=l(!1),c=l(null),b=l(void 0),F=P(()=>[{title:A(g.value)?.name??"...",to:{name:"dashboard",params:{eventId:u.eventId}}},{title:t("VoteCodeRequestsView.title"),disabled:!0}]),k=[25,50,100],w=l(k[0]),E=l(0),$=l(1),x=l([]),m=l(""),i=l(null),L=[{title:t("VoteCodeRequestsView.headers.id"),sortable:!0,key:"id"},{title:t("VoteCodeRequestsView.headers.user"),sortable:!1,key:"user"},{title:t("VoteCodeRequestsView.headers.text"),sortable:!1,key:"text"},{title:t("VoteCodeRequestsView.headers.status"),sortable:!0,key:"status"},{title:t("VoteCodeRequestsView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function K(o){switch(o){case 0:return"warning";case 1:return"success";case 2:return"error";default:return"grey"}}function N(o){switch(o){case 0:return t("VoteCodeRequestsView.statuses.pending");case 1:return t("VoteCodeRequestsView.statuses.approved");case 2:return t("VoteCodeRequestsView.statuses.rejected");default:return"Unknown"}}async function y(o){C.value=!0,i.value=o;try{const s=await ne({path:{event_pk:V(u.eventId,10)},query:{...ue(o)}});x.value=s.data.results,E.value=s.data.count}catch(s){d.error(t("VoteCodeRequestsView.loadFailure")),console.error(s)}finally{C.value=!1}}async function I(o,s){c.value=o;try{await se({path:{event_pk:V(u.eventId,10),id:o},body:{status:s}}),i.value&&await y(i.value)}catch(e){d.error(t("VoteCodeRequestsView.updateFailure")),console.error(e)}finally{c.value=null}}async function Q(o){await b.value?.ifConfirmed(t("VoteCodeRequestsView.confirmDelete"),async()=>{try{await oe({path:{event_pk:V(u.eventId,10),id:o.id}}),d.success(t("VoteCodeRequestsView.deleteSuccess")),i.value&&await y(i.value)}catch(s){d.error(ie(s,t("VoteCodeRequestsView.deleteFailure"))),console.error(s)}})}const T=de(y,250);function j(){m.value="",T({page:1,itemsPerPage:w.value??25,sortBy:[],groupBy:[],search:""})}return Z(g,j),(o,s)=>(p(),v(le,{key:`vote-code-requests-${g.value}`,breadcrumbs:F.value},{default:n(()=>[r(B,null,{default:n(()=>[r(O,null,{default:n(()=>[r(J,{modelValue:m.value,"onUpdate:modelValue":s[0]||(s[0]=e=>m.value=e),variant:"outlined",density:"compact",label:a(t)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),r(B,null,{default:n(()=>[r(O,null,{default:n(()=>[r(ce,{"items-per-page":w.value,"onUpdate:itemsPerPage":s[1]||(s[1]=e=>w.value=e),class:"elevation-1 primary","item-value":"id",density:"compact",headers:L,items:x.value,"items-length":E.value,loading:C.value,search:m.value,page:$.value,"items-per-page-options":k,"no-data-text":a(t)("VoteCodeRequestsView.noRequestsFound"),"loading-text":a(t)("VoteCodeRequestsView.loadingRequests"),"onUpdate:options":a(T)},{"item.user":n(({item:e})=>[S(U(e.user),1)]),"item.status":n(({item:e})=>[r(ee,{color:K(e.status??0),size:"small"},{default:n(()=>[S(U(N(e.status??0)),1)]),_:2},1032,["color"])]),"item.actions":n(({item:e})=>[(e.status??0)!==1&&a(f).canChange(a(h).VOTE_CODE_REQUEST)?(p(),v(q,{key:0,color:"success",size:"small",variant:"text",loading:c.value===e.id,onClick:D=>I(e.id,1)},{default:n(()=>[r(a(R),{icon:a(W)},null,8,["icon"])]),_:1},8,["loading","onClick"])):_("",!0),(e.status??0)!==2&&a(f).canChange(a(h).VOTE_CODE_REQUEST)?(p(),v(q,{key:1,color:"error",size:"small",variant:"text",loading:c.value===e.id,onClick:D=>I(e.id,2)},{default:n(()=>[r(a(R),{icon:a(X)},null,8,["icon"])]),_:1},8,["loading","onClick"])):_("",!0),a(f).canDelete(a(h).VOTE_CODE_REQUEST)?(p(),v(q,{key:2,color:"error",size:"small",variant:"text",onClick:D=>Q(e)},{default:n(()=>[r(a(R),{icon:a(Y)},null,8,["icon"])]),_:1},8,["onClick"])):_("",!0)]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1}),r(te,{ref_key:"confirmDialog",ref:b},null,512)]),_:1},8,["breadcrumbs"]))}});export{qe as default};
//# sourceMappingURL=VoteCodeRequestsView-CcQtw6WQ.js.map
