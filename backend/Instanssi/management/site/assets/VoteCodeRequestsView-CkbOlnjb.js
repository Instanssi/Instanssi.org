import{d as G,a as M,v as Z,Z as H,b as m,g as v,w as n,e as r,m as J,j as a,P as h,V as b,k as q,bj as W,K as R,br as X,bs as Y,b4 as ee,i as S,t as P,bt as te,q as ae,G as U,s as l,bu as se,bv as oe,bw as ne,E as re}from"./index-qrfwdmHz.js";import{V as O,_ as le}from"./LayoutBase.vue_vue_type_script_setup_true_lang-Cgp8Musd.js";import{d as ue,V as ie,g as de}from"./query_tools-Ch1hnqwl.js";import{g as ce}from"./http-Cqy_sGiB.js";import{V as B}from"./VRow-EkiCBxID.js";import{p as V}from"./parseInt-CGa1F4cm.js";import"./VContainer-e74dHNZG.js";import"./VDataTable-BIkGv4dg.js";import"./filter-50Rnsb7m.js";const he=G({__name:"VoteCodeRequestsView",props:{eventId:{}},setup(F){const u=F,{t}=M(),d=Z(),f=ae(),{getEventById:$}=re(),g=U(()=>V(u.eventId,10)),C=l(!1),c=l(null),_=l(void 0),z=U(()=>[{title:$(g.value)?.name??"...",to:{name:"dashboard",params:{eventId:u.eventId}}},{title:t("VoteCodeRequestsView.title"),disabled:!0}]),k=[25,50,100],w=l(k[0]),E=l(0),A=l(1),x=l([]),p=l(""),i=l(null),K=[{title:t("VoteCodeRequestsView.headers.id"),sortable:!0,key:"id"},{title:t("VoteCodeRequestsView.headers.user"),sortable:!1,key:"user"},{title:t("VoteCodeRequestsView.headers.text"),sortable:!1,key:"text"},{title:t("VoteCodeRequestsView.headers.status"),sortable:!0,key:"status"},{title:t("VoteCodeRequestsView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function L(o){switch(o){case 0:return"warning";case 1:return"success";case 2:return"error";default:return"grey"}}function j(o){switch(o){case 0:return t("VoteCodeRequestsView.statuses.pending");case 1:return t("VoteCodeRequestsView.statuses.approved");case 2:return t("VoteCodeRequestsView.statuses.rejected");default:return"Unknown"}}async function y(o){C.value=!0,i.value=o;try{const s=await ne({path:{event_pk:V(u.eventId,10)},query:{...de(o)}});x.value=s.data.results,E.value=s.data.count}catch(s){d.error(t("VoteCodeRequestsView.loadFailure")),console.error(s)}finally{C.value=!1}}async function I(o,s){c.value=o;try{await se({path:{event_pk:V(u.eventId,10),id:o},body:{status:s}}),i.value&&await y(i.value)}catch(e){d.error(t("VoteCodeRequestsView.updateFailure")),console.error(e)}finally{c.value=null}}async function N(o){await _.value?.ifConfirmed(t("VoteCodeRequestsView.confirmDelete"),async()=>{try{await oe({path:{event_pk:V(u.eventId,10),id:o.id}}),d.success(t("VoteCodeRequestsView.deleteSuccess")),i.value&&await y(i.value)}catch(s){d.error(ce(s,t("VoteCodeRequestsView.deleteFailure"))),console.error(s)}})}const T=ue(y,250);function Q(){p.value="",T({page:1,itemsPerPage:w.value??25,sortBy:[],groupBy:[],search:""})}return H(g,Q),(o,s)=>(m(),v(le,{key:`vote-code-requests-${g.value}`,breadcrumbs:z.value},{default:n(()=>[r(O,null,{default:n(()=>[r(B,null,{default:n(()=>[r(J,{modelValue:p.value,"onUpdate:modelValue":s[0]||(s[0]=e=>p.value=e),variant:"outlined",density:"compact",label:a(t)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),r(O,null,{default:n(()=>[r(B,null,{default:n(()=>[r(ie,{"items-per-page":w.value,"onUpdate:itemsPerPage":s[1]||(s[1]=e=>w.value=e),class:"elevation-1 primary","item-value":"id",density:"compact",headers:K,items:x.value,"items-length":E.value,loading:C.value,search:p.value,page:A.value,"items-per-page-options":k,"no-data-text":a(t)("VoteCodeRequestsView.noRequestsFound"),"loading-text":a(t)("VoteCodeRequestsView.loadingRequests"),"onUpdate:options":a(T)},{"item.user":n(({item:e})=>[S(P(e.user),1)]),"item.status":n(({item:e})=>[r(ee,{color:L(e.status??0),size:"small"},{default:n(()=>[S(P(j(e.status??0)),1)]),_:2},1032,["color"])]),"item.actions":n(({item:e})=>[(e.status??0)!==1&&a(f).canChange(a(h).VOTE_CODE_REQUEST)?(m(),v(b,{key:0,color:"success",size:"small",variant:"text",loading:c.value===e.id,onClick:D=>I(e.id,1)},{default:n(()=>[r(a(q),{icon:a(W)},null,8,["icon"])]),_:1},8,["loading","onClick"])):R("",!0),(e.status??0)!==2&&a(f).canChange(a(h).VOTE_CODE_REQUEST)?(m(),v(b,{key:1,color:"error",size:"small",variant:"text",loading:c.value===e.id,onClick:D=>I(e.id,2)},{default:n(()=>[r(a(q),{icon:a(X)},null,8,["icon"])]),_:1},8,["loading","onClick"])):R("",!0),a(f).canDelete(a(h).VOTE_CODE_REQUEST)?(m(),v(b,{key:2,color:"error",size:"small",variant:"text",onClick:D=>N(e)},{default:n(()=>[r(a(q),{icon:a(Y)},null,8,["icon"])]),_:1},8,["onClick"])):R("",!0)]),_:1},8,["items-per-page","items","items-length","loading","search","page","no-data-text","loading-text","onUpdate:options"])]),_:1})]),_:1}),r(te,{ref_key:"confirmDialog",ref:_},null,512)]),_:1},8,["breadcrumbs"]))}});export{he as default};
//# sourceMappingURL=VoteCodeRequestsView-CkbOlnjb.js.map
