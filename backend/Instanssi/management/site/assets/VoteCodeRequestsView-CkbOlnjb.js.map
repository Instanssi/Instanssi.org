{"version":3,"file":"VoteCodeRequestsView-CkbOlnjb.js","sources":["../../../../../admin/src/views/kompomaatti/VoteCodeRequestsView.vue"],"sourcesContent":["<template>\n    <LayoutBase :key=\"`vote-code-requests-${eventId}`\" :breadcrumbs=\"breadcrumbs\">\n        <v-col>\n            <v-row>\n                <v-text-field\n                    v-model=\"search\"\n                    variant=\"outlined\"\n                    density=\"compact\"\n                    :label=\"t('General.search')\"\n                    style=\"max-width: 400px\"\n                    class=\"ma-0 pa-0\"\n                    clearable\n                />\n            </v-row>\n        </v-col>\n        <v-col>\n            <v-row>\n                <v-data-table-server\n                    v-model:items-per-page=\"perPage\"\n                    class=\"elevation-1 primary\"\n                    item-value=\"id\"\n                    density=\"compact\"\n                    :headers=\"headers\"\n                    :items=\"requests\"\n                    :items-length=\"totalItems\"\n                    :loading=\"loading\"\n                    :search=\"search\"\n                    :page=\"currentPage\"\n                    :items-per-page-options=\"pageSizeOptions\"\n                    :no-data-text=\"t('VoteCodeRequestsView.noRequestsFound')\"\n                    :loading-text=\"t('VoteCodeRequestsView.loadingRequests')\"\n                    @update:options=\"debouncedLoad\"\n                >\n                    <template #item.user=\"{ item }\">\n                        {{ item.user }}\n                    </template>\n                    <template #item.status=\"{ item }\">\n                        <v-chip :color=\"getStatusColor(item.status ?? 0)\" size=\"small\">\n                            {{ getStatusText(item.status ?? 0) }}\n                        </v-chip>\n                    </template>\n                    <template #item.actions=\"{ item }\">\n                        <v-btn\n                            v-if=\"\n                                (item.status ?? 0) !== 1 &&\n                                auth.canChange(PermissionTarget.VOTE_CODE_REQUEST)\n                            \"\n                            color=\"success\"\n                            size=\"small\"\n                            variant=\"text\"\n                            :loading=\"updatingId === item.id\"\n                            @click=\"updateStatus(item.id, 1)\"\n                        >\n                            <FontAwesomeIcon :icon=\"faCheck\" />\n                        </v-btn>\n                        <v-btn\n                            v-if=\"\n                                (item.status ?? 0) !== 2 &&\n                                auth.canChange(PermissionTarget.VOTE_CODE_REQUEST)\n                            \"\n                            color=\"error\"\n                            size=\"small\"\n                            variant=\"text\"\n                            :loading=\"updatingId === item.id\"\n                            @click=\"updateStatus(item.id, 2)\"\n                        >\n                            <FontAwesomeIcon :icon=\"faTimes\" />\n                        </v-btn>\n                        <v-btn\n                            v-if=\"auth.canDelete(PermissionTarget.VOTE_CODE_REQUEST)\"\n                            color=\"error\"\n                            size=\"small\"\n                            variant=\"text\"\n                            @click=\"deleteRequest(item)\"\n                        >\n                            <FontAwesomeIcon :icon=\"faTrash\" />\n                        </v-btn>\n                    </template>\n                </v-data-table-server>\n            </v-row>\n        </v-col>\n        <ConfirmDialog ref=\"confirmDialog\" />\n    </LayoutBase>\n</template>\n\n<script setup lang=\"ts\">\nimport { faCheck, faTimes, faTrash } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/vue-fontawesome\";\nimport { debounce, parseInt } from \"lodash-es\";\nimport { type Ref, computed, ref, watch } from \"vue\";\nimport { useI18n } from \"vue-i18n\";\nimport { useToast } from \"vue-toastification\";\nimport type { VDataTable } from \"vuetify/components\";\n\nimport * as api from \"@/api\";\nimport type { StatusEnum, VoteCodeRequest } from \"@/api\";\nimport ConfirmDialog from \"@/components/dialogs/ConfirmDialog.vue\";\nimport LayoutBase, { type BreadcrumbItem } from \"@/components/layout/LayoutBase.vue\";\nimport { PermissionTarget, useAuth } from \"@/services/auth\";\nimport { useEvents } from \"@/services/events\";\nimport { type LoadArgs, getLoadArgs } from \"@/services/utils/query_tools\";\nimport { getApiErrorMessage } from \"@/utils/http\";\n\ntype ReadonlyHeaders = VDataTable[\"$props\"][\"headers\"];\n\nconst props = defineProps<{ eventId: string }>();\nconst { t } = useI18n();\nconst toast = useToast();\nconst auth = useAuth();\nconst { getEventById } = useEvents();\nconst eventId = computed(() => parseInt(props.eventId, 10));\nconst loading = ref(false);\nconst updatingId = ref<number | null>(null);\nconst confirmDialog: Ref<InstanceType<typeof ConfirmDialog> | undefined> = ref(undefined);\n\nconst breadcrumbs = computed<BreadcrumbItem[]>(() => [\n    {\n        title: getEventById(eventId.value)?.name ?? \"...\",\n        to: { name: \"dashboard\", params: { eventId: props.eventId } },\n    },\n    { title: t(\"VoteCodeRequestsView.title\"), disabled: true },\n]);\nconst pageSizeOptions = [25, 50, 100];\nconst perPage = ref(pageSizeOptions[0]);\nconst totalItems = ref(0);\nconst currentPage = ref(1);\nconst requests: Ref<VoteCodeRequest[]> = ref([]);\nconst search = ref(\"\");\nconst lastLoadArgs = ref<LoadArgs | null>(null);\n\nconst headers: ReadonlyHeaders = [\n    {\n        title: t(\"VoteCodeRequestsView.headers.id\"),\n        sortable: true,\n        key: \"id\",\n    },\n    {\n        title: t(\"VoteCodeRequestsView.headers.user\"),\n        sortable: false,\n        key: \"user\",\n    },\n    {\n        title: t(\"VoteCodeRequestsView.headers.text\"),\n        sortable: false,\n        key: \"text\",\n    },\n    {\n        title: t(\"VoteCodeRequestsView.headers.status\"),\n        sortable: true,\n        key: \"status\",\n    },\n    {\n        title: t(\"VoteCodeRequestsView.headers.actions\"),\n        sortable: false,\n        key: \"actions\",\n        align: \"end\",\n    },\n];\n\nfunction getStatusColor(status: number): string {\n    switch (status) {\n        case 0:\n            return \"warning\";\n        case 1:\n            return \"success\";\n        case 2:\n            return \"error\";\n        default:\n            return \"grey\";\n    }\n}\n\nfunction getStatusText(status: number): string {\n    switch (status) {\n        case 0:\n            return t(\"VoteCodeRequestsView.statuses.pending\");\n        case 1:\n            return t(\"VoteCodeRequestsView.statuses.approved\");\n        case 2:\n            return t(\"VoteCodeRequestsView.statuses.rejected\");\n        default:\n            return \"Unknown\";\n    }\n}\n\nasync function load(args: LoadArgs) {\n    loading.value = true;\n    lastLoadArgs.value = args;\n    try {\n        const response = await api.adminEventKompomaattiVoteCodeRequestsList({\n            path: { event_pk: parseInt(props.eventId, 10) },\n            query: {\n                ...getLoadArgs(args),\n            },\n        });\n        requests.value = response.data!.results;\n        totalItems.value = response.data!.count;\n    } catch (e) {\n        toast.error(t(\"VoteCodeRequestsView.loadFailure\"));\n        console.error(e);\n    } finally {\n        loading.value = false;\n    }\n}\n\nasync function updateStatus(id: number, status: StatusEnum) {\n    updatingId.value = id;\n    try {\n        await api.adminEventKompomaattiVoteCodeRequestsPartialUpdate({\n            path: { event_pk: parseInt(props.eventId, 10), id },\n            body: { status },\n        });\n        if (lastLoadArgs.value) {\n            await load(lastLoadArgs.value);\n        }\n    } catch (e) {\n        toast.error(t(\"VoteCodeRequestsView.updateFailure\"));\n        console.error(e);\n    } finally {\n        updatingId.value = null;\n    }\n}\n\nasync function deleteRequest(item: VoteCodeRequest) {\n    await confirmDialog.value?.ifConfirmed(t(\"VoteCodeRequestsView.confirmDelete\"), async () => {\n        try {\n            await api.adminEventKompomaattiVoteCodeRequestsDestroy({\n                path: { event_pk: parseInt(props.eventId, 10), id: item.id },\n            });\n            toast.success(t(\"VoteCodeRequestsView.deleteSuccess\"));\n            if (lastLoadArgs.value) {\n                await load(lastLoadArgs.value);\n            }\n        } catch (e) {\n            toast.error(getApiErrorMessage(e, t(\"VoteCodeRequestsView.deleteFailure\")));\n            console.error(e);\n        }\n    });\n}\n\nconst debouncedLoad = debounce(load, 250);\n\nfunction refresh() {\n    search.value = \"\";\n    debouncedLoad({\n        page: 1,\n        itemsPerPage: perPage.value ?? 25,\n        sortBy: [],\n        groupBy: [] as never,\n        search: \"\",\n    });\n}\n\n// Reload when event changes\nwatch(eventId, refresh);\n</script>\n"],"names":["props","__props","useI18n","toast","useToast","auth","useAuth","getEventById","useEvents","eventId","computed","parseInt","loading","ref","updatingId","confirmDialog","breadcrumbs","pageSizeOptions","perPage","totalItems","currentPage","requests","search","lastLoadArgs","headers","getStatusColor","status","getStatusText","load","args","response","api.adminEventKompomaattiVoteCodeRequestsList","getLoadArgs","e","updateStatus","id","api.adminEventKompomaattiVoteCodeRequestsPartialUpdate","deleteRequest","item","api.adminEventKompomaattiVoteCodeRequestsDestroy","getApiErrorMessage","debouncedLoad","debounce","refresh","watch","_createBlock","LayoutBase","_createVNode","_component_v_col","_component_v_row","_component_v_text_field","$event","_unref","_component_v_data_table_server","_withCtx","_createTextVNode","_toDisplayString","_component_v_chip","PermissionTarget","_component_v_btn","FontAwesomeIcon","faCheck","faTimes","faTrash","ConfirmDialog"],"mappings":"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"}