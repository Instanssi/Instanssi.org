import{d as N,a as Q,v as G,L as H,b as y,g as b,w as r,e as l,m as J,j as e,P as h,V as I,i as m,t as v,k as T,a0 as M,D,bG as W,a5 as X,bH as Y,q as Z,I as S,s as u,bI as ee,bJ as te,bK as ae,H as se}from"./index-CQkWvXOv.js";import{V as P,_ as oe}from"./LayoutBase.vue_vue_type_script_setup_true_lang-D5aCeQDf.js";import{_ as re}from"./TableActionButtons.vue_vue_type_script_setup_true_lang-DepTf6Bi.js";import{u as ne,d as le}from"./useTableState-CutuDm2i.js";import{g as ue}from"./query_tools-BInV9OzK.js";import{g as ie}from"./http-CET7UDul.js";import{V as U}from"./VRow-CXIXhuhq.js";import{V as de}from"./VDataTableServer-C6tuZDKn.js";import{p as V}from"./parseInt-BJ5A4_3y.js";import"./VContainer-DqJ8gu3P.js";import"./AuditLogDialog.vue_vue_type_script_setup_true_lang-1MnYozFL.js";import"./useAuditLogUtils-BdjF9k7b.js";import"./DateTimeCell.vue_vue_type_script_setup_true_lang-DaLynL44.js";import"./datetime-Dz9fjSvq.js";import"./VDataTable-f5_9vewM.js";const ke=N({__name:"VoteCodeRequestsView",props:{eventId:{}},setup(O){const i=O,{t}=Q(),c=G(),f=Z(),{getEventById:B}=se(),g=S(()=>V(i.eventId,10)),C=u(!1),p=u(null),q=u(void 0),$=S(()=>[{title:B(g.value)?.name??"...",to:{name:"dashboard",params:{eventId:i.eventId}}},{title:t("VoteCodeRequestsView.title"),disabled:!0}]),n=ne(),R=u(0),_=u([]),d=u(null),A=[{title:t("VoteCodeRequestsView.headers.id"),sortable:!0,key:"id"},{title:t("VoteCodeRequestsView.headers.user"),sortable:!0,key:"user"},{title:t("VoteCodeRequestsView.headers.text"),sortable:!1,key:"text"},{title:t("VoteCodeRequestsView.headers.status"),sortable:!0,key:"status"},{title:t("VoteCodeRequestsView.headers.actions"),sortable:!1,key:"actions",align:"end"}];function F(s){switch(s){case 0:return"warning";case 1:return"success";case 2:return"error";default:return"grey"}}function L(s){switch(s){case 0:return t("VoteCodeRequestsView.statuses.pending");case 1:return t("VoteCodeRequestsView.statuses.approved");case 2:return t("VoteCodeRequestsView.statuses.rejected");default:return"Unknown"}}async function w(s){C.value=!0,d.value=s;try{const o=await ae({path:{event_pk:V(i.eventId,10)},query:{...ue(s)}});_.value=o.data.results,R.value=o.data.count}catch(o){c.error(t("VoteCodeRequestsView.loadFailure")),console.error(o)}finally{C.value=!1}}async function k(s,o){p.value=s;try{await ee({path:{event_pk:V(i.eventId,10),id:s},body:{status:o}}),d.value&&await w(d.value)}catch(a){c.error(t("VoteCodeRequestsView.updateFailure")),console.error(a)}finally{p.value=null}}async function j(s){await q.value?.ifConfirmed(t("VoteCodeRequestsView.confirmDelete"),async()=>{try{await te({path:{event_pk:V(i.eventId,10),id:s.id}}),c.success(t("VoteCodeRequestsView.deleteSuccess")),d.value&&await w(d.value)}catch(o){c.error(ie(o,t("VoteCodeRequestsView.deleteFailure"))),console.error(o)}})}const E=le(w,250);function z(s){n.onOptionsUpdate(s),E(s)}function K(){n.search.value="",n.page.value=1,E({page:1,itemsPerPage:n.perPage.value??25,sortBy:[],groupBy:[],search:""})}return H(g,K),(s,o)=>(y(),b(oe,{key:`vote-code-requests-${g.value}`,breadcrumbs:$.value},{default:r(()=>[l(P,null,{default:r(()=>[l(U,null,{default:r(()=>[l(J,{modelValue:e(n).search.value,"onUpdate:modelValue":o[0]||(o[0]=a=>e(n).search.value=a),variant:"outlined",density:"compact",label:e(t)("General.search"),style:{"max-width":"400px"},class:"ma-0 pa-0",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),l(P,null,{default:r(()=>[l(U,null,{default:r(()=>[l(de,{"items-per-page":e(n).perPage.value,"onUpdate:itemsPerPage":o[1]||(o[1]=a=>e(n).perPage.value=a),"sort-by":e(n).sortByArray.value,class:"elevation-1 primary","item-value":"id",density:"compact",headers:A,items:_.value,"items-length":R.value,loading:C.value,search:e(n).search.value,page:e(n).page.value,"items-per-page-options":e(n).pageSizeOptions,"no-data-text":e(t)("VoteCodeRequestsView.noRequestsFound"),"loading-text":e(t)("VoteCodeRequestsView.loadingRequests"),"onUpdate:options":z},{"item.user":r(({item:a})=>[m(v(a.user),1)]),"item.status":r(({item:a})=>[l(X,{color:F(a.status??0),size:"small"},{default:r(()=>[m(v(L(a.status??0)),1)]),_:2},1032,["color"])]),"item.actions":r(({item:a})=>[(a.status??0)!==1&&e(f).canChange(e(h).VOTE_CODE_REQUEST)?(y(),b(I,{key:0,color:"success",size:"small",variant:"text",class:"mr-1",loading:p.value===a.id,onClick:x=>k(a.id,1)},{prepend:r(()=>[l(e(T),{icon:e(M)},null,8,["icon"])]),default:r(()=>[m(" "+v(e(t)("VoteCodeRequestsView.accept")),1)]),_:1},8,["loading","onClick"])):D("",!0),(a.status??0)!==2&&e(f).canChange(e(h).VOTE_CODE_REQUEST)?(y(),b(I,{key:1,color:"error",size:"small",variant:"text",class:"mr-1",loading:p.value===a.id,onClick:x=>k(a.id,2)},{prepend:r(()=>[l(e(T),{icon:e(W)},null,8,["icon"])]),default:r(()=>[m(" "+v(e(t)("VoteCodeRequestsView.reject")),1)]),_:1},8,["loading","onClick"])):D("",!0),l(re,{"can-edit":!1,"can-delete":e(f).canDelete(e(h).VOTE_CODE_REQUEST),"audit-log":{appLabel:"kompomaatti",model:"votecoderequest",objectPk:a.id},onDelete:x=>j(a)},null,8,["can-delete","audit-log","onDelete"])]),_:1},8,["items-per-page","sort-by","items","items-length","loading","search","page","items-per-page-options","no-data-text","loading-text"])]),_:1})]),_:1}),l(Y,{ref_key:"confirmDialog",ref:q},null,512)]),_:1},8,["breadcrumbs"]))}});export{ke as default};
//# sourceMappingURL=VoteCodeRequestsView-DUhWLpGW.js.map
