{"version":3,"file":"VoteCodeRequestsView-DUhWLpGW.js","sources":["../../../../../admin/src/views/kompomaatti/VoteCodeRequestsView.vue"],"sourcesContent":["<template>\n    <LayoutBase :key=\"`vote-code-requests-${eventId}`\" :breadcrumbs=\"breadcrumbs\">\n        <v-col>\n            <v-row>\n                <v-text-field\n                    v-model=\"tableState.search.value\"\n                    variant=\"outlined\"\n                    density=\"compact\"\n                    :label=\"t('General.search')\"\n                    style=\"max-width: 400px\"\n                    class=\"ma-0 pa-0\"\n                    clearable\n                />\n            </v-row>\n        </v-col>\n        <v-col>\n            <v-row>\n                <v-data-table-server\n                    v-model:items-per-page=\"tableState.perPage.value\"\n                    :sort-by=\"tableState.sortByArray.value\"\n                    class=\"elevation-1 primary\"\n                    item-value=\"id\"\n                    density=\"compact\"\n                    :headers=\"headers\"\n                    :items=\"requests\"\n                    :items-length=\"totalItems\"\n                    :loading=\"loading\"\n                    :search=\"tableState.search.value\"\n                    :page=\"tableState.page.value\"\n                    :items-per-page-options=\"tableState.pageSizeOptions\"\n                    :no-data-text=\"t('VoteCodeRequestsView.noRequestsFound')\"\n                    :loading-text=\"t('VoteCodeRequestsView.loadingRequests')\"\n                    @update:options=\"onTableOptionsUpdate\"\n                >\n                    <template #item.user=\"{ item }\">\n                        {{ item.user }}\n                    </template>\n                    <template #item.status=\"{ item }\">\n                        <v-chip :color=\"getStatusColor(item.status ?? 0)\" size=\"small\">\n                            {{ getStatusText(item.status ?? 0) }}\n                        </v-chip>\n                    </template>\n                    <template #item.actions=\"{ item }\">\n                        <v-btn\n                            v-if=\"\n                                (item.status ?? 0) !== 1 &&\n                                auth.canChange(PermissionTarget.VOTE_CODE_REQUEST)\n                            \"\n                            color=\"success\"\n                            size=\"small\"\n                            variant=\"text\"\n                            class=\"mr-1\"\n                            :loading=\"updatingId === item.id\"\n                            @click=\"updateStatus(item.id, 1)\"\n                        >\n                            <template #prepend>\n                                <FontAwesomeIcon :icon=\"faCheck\" />\n                            </template>\n                            {{ t(\"VoteCodeRequestsView.accept\") }}\n                        </v-btn>\n                        <v-btn\n                            v-if=\"\n                                (item.status ?? 0) !== 2 &&\n                                auth.canChange(PermissionTarget.VOTE_CODE_REQUEST)\n                            \"\n                            color=\"error\"\n                            size=\"small\"\n                            variant=\"text\"\n                            class=\"mr-1\"\n                            :loading=\"updatingId === item.id\"\n                            @click=\"updateStatus(item.id, 2)\"\n                        >\n                            <template #prepend>\n                                <FontAwesomeIcon :icon=\"faTimes\" />\n                            </template>\n                            {{ t(\"VoteCodeRequestsView.reject\") }}\n                        </v-btn>\n                        <TableActionButtons\n                            :can-edit=\"false\"\n                            :can-delete=\"auth.canDelete(PermissionTarget.VOTE_CODE_REQUEST)\"\n                            :audit-log=\"{\n                                appLabel: 'kompomaatti',\n                                model: 'votecoderequest',\n                                objectPk: item.id,\n                            }\"\n                            @delete=\"deleteRequest(item)\"\n                        />\n                    </template>\n                </v-data-table-server>\n            </v-row>\n        </v-col>\n        <ConfirmDialog ref=\"confirmDialog\" />\n    </LayoutBase>\n</template>\n\n<script setup lang=\"ts\">\nimport { faCheck, faTimes } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/vue-fontawesome\";\nimport { debounce, parseInt } from \"lodash-es\";\nimport { type Ref, computed, ref, watch } from \"vue\";\nimport { useI18n } from \"vue-i18n\";\nimport { useToast } from \"vue-toastification\";\nimport type { VDataTable } from \"vuetify/components\";\n\nimport * as api from \"@/api\";\nimport type { StatusEnum, VoteCodeRequest } from \"@/api\";\nimport ConfirmDialog from \"@/components/dialogs/ConfirmDialog.vue\";\nimport LayoutBase, { type BreadcrumbItem } from \"@/components/layout/LayoutBase.vue\";\nimport TableActionButtons from \"@/components/table/TableActionButtons.vue\";\nimport { useTableState } from \"@/composables/useTableState\";\nimport { PermissionTarget, useAuth } from \"@/services/auth\";\nimport { useEvents } from \"@/services/events\";\nimport { type LoadArgs, getLoadArgs } from \"@/services/utils/query_tools\";\nimport { getApiErrorMessage } from \"@/utils/http\";\n\ntype ReadonlyHeaders = VDataTable[\"$props\"][\"headers\"];\n\nconst props = defineProps<{ eventId: string }>();\nconst { t } = useI18n();\nconst toast = useToast();\nconst auth = useAuth();\nconst { getEventById } = useEvents();\nconst eventId = computed(() => parseInt(props.eventId, 10));\nconst loading = ref(false);\nconst updatingId = ref<number | null>(null);\nconst confirmDialog: Ref<InstanceType<typeof ConfirmDialog> | undefined> = ref(undefined);\n\nconst breadcrumbs = computed<BreadcrumbItem[]>(() => [\n    {\n        title: getEventById(eventId.value)?.name ?? \"...\",\n        to: { name: \"dashboard\", params: { eventId: props.eventId } },\n    },\n    { title: t(\"VoteCodeRequestsView.title\"), disabled: true },\n]);\n\nconst tableState = useTableState();\nconst totalItems = ref(0);\nconst requests: Ref<VoteCodeRequest[]> = ref([]);\nconst lastLoadArgs = ref<LoadArgs | null>(null);\n\nconst headers: ReadonlyHeaders = [\n    {\n        title: t(\"VoteCodeRequestsView.headers.id\"),\n        sortable: true,\n        key: \"id\",\n    },\n    {\n        title: t(\"VoteCodeRequestsView.headers.user\"),\n        sortable: true,\n        key: \"user\",\n    },\n    {\n        title: t(\"VoteCodeRequestsView.headers.text\"),\n        sortable: false,\n        key: \"text\",\n    },\n    {\n        title: t(\"VoteCodeRequestsView.headers.status\"),\n        sortable: true,\n        key: \"status\",\n    },\n    {\n        title: t(\"VoteCodeRequestsView.headers.actions\"),\n        sortable: false,\n        key: \"actions\",\n        align: \"end\",\n    },\n];\n\nfunction getStatusColor(status: number): string {\n    switch (status) {\n        case 0:\n            return \"warning\";\n        case 1:\n            return \"success\";\n        case 2:\n            return \"error\";\n        default:\n            return \"grey\";\n    }\n}\n\nfunction getStatusText(status: number): string {\n    switch (status) {\n        case 0:\n            return t(\"VoteCodeRequestsView.statuses.pending\");\n        case 1:\n            return t(\"VoteCodeRequestsView.statuses.approved\");\n        case 2:\n            return t(\"VoteCodeRequestsView.statuses.rejected\");\n        default:\n            return \"Unknown\";\n    }\n}\n\nasync function load(args: LoadArgs) {\n    loading.value = true;\n    lastLoadArgs.value = args;\n    try {\n        const response = await api.adminEventKompomaattiVoteCodeRequestsList({\n            path: { event_pk: parseInt(props.eventId, 10) },\n            query: {\n                ...getLoadArgs(args),\n            },\n        });\n        requests.value = response.data!.results;\n        totalItems.value = response.data!.count;\n    } catch (e) {\n        toast.error(t(\"VoteCodeRequestsView.loadFailure\"));\n        console.error(e);\n    } finally {\n        loading.value = false;\n    }\n}\n\nasync function updateStatus(id: number, status: StatusEnum) {\n    updatingId.value = id;\n    try {\n        await api.adminEventKompomaattiVoteCodeRequestsPartialUpdate({\n            path: { event_pk: parseInt(props.eventId, 10), id },\n            body: { status },\n        });\n        if (lastLoadArgs.value) {\n            await load(lastLoadArgs.value);\n        }\n    } catch (e) {\n        toast.error(t(\"VoteCodeRequestsView.updateFailure\"));\n        console.error(e);\n    } finally {\n        updatingId.value = null;\n    }\n}\n\nasync function deleteRequest(item: VoteCodeRequest) {\n    await confirmDialog.value?.ifConfirmed(t(\"VoteCodeRequestsView.confirmDelete\"), async () => {\n        try {\n            await api.adminEventKompomaattiVoteCodeRequestsDestroy({\n                path: { event_pk: parseInt(props.eventId, 10), id: item.id },\n            });\n            toast.success(t(\"VoteCodeRequestsView.deleteSuccess\"));\n            if (lastLoadArgs.value) {\n                await load(lastLoadArgs.value);\n            }\n        } catch (e) {\n            toast.error(getApiErrorMessage(e, t(\"VoteCodeRequestsView.deleteFailure\")));\n            console.error(e);\n        }\n    });\n}\n\nconst debouncedLoad = debounce(load, 250);\n\nfunction onTableOptionsUpdate(args: LoadArgs) {\n    tableState.onOptionsUpdate(args);\n    debouncedLoad(args);\n}\n\nfunction refresh() {\n    tableState.search.value = \"\";\n    tableState.page.value = 1;\n    debouncedLoad({\n        page: 1,\n        itemsPerPage: tableState.perPage.value ?? 25,\n        sortBy: [],\n        groupBy: [] as never,\n        search: \"\",\n    });\n}\n\n// Reload when event changes\nwatch(eventId, refresh);\n</script>\n"],"names":["props","__props","useI18n","toast","useToast","auth","useAuth","getEventById","useEvents","eventId","computed","parseInt","loading","ref","updatingId","confirmDialog","breadcrumbs","tableState","useTableState","totalItems","requests","lastLoadArgs","headers","getStatusColor","status","getStatusText","load","args","response","api.adminEventKompomaattiVoteCodeRequestsList","getLoadArgs","e","updateStatus","id","api.adminEventKompomaattiVoteCodeRequestsPartialUpdate","deleteRequest","item","api.adminEventKompomaattiVoteCodeRequestsDestroy","getApiErrorMessage","debouncedLoad","debounce","onTableOptionsUpdate","refresh","watch","_createBlock","LayoutBase","_createVNode","_component_v_col","_component_v_row","_component_v_text_field","_unref","$event","_component_v_data_table_server","_withCtx","_createTextVNode","_toDisplayString","_component_v_chip","PermissionTarget","_component_v_btn","FontAwesomeIcon","faCheck","faTimes","TableActionButtons","ConfirmDialog"],"mappings":"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"}