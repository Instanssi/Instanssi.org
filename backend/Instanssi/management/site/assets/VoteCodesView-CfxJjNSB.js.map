{"version":3,"file":"VoteCodesView-CfxJjNSB.js","sources":["../../../../../admin/src/views/kompomaatti/VoteCodesView.vue"],"sourcesContent":["<template>\n    <LayoutBase :key=\"`vote-codes-${eventId}`\" :breadcrumbs=\"breadcrumbs\">\n        <v-col>\n            <v-row>\n                <v-data-table-server\n                    v-model:items-per-page=\"tableState.perPage.value\"\n                    :sort-by=\"tableState.sortByArray.value\"\n                    class=\"elevation-1 primary\"\n                    item-value=\"id\"\n                    density=\"compact\"\n                    :headers=\"headers\"\n                    :items=\"voteCodes\"\n                    :items-length=\"totalItems\"\n                    :loading=\"loading\"\n                    :page=\"tableState.page.value\"\n                    :items-per-page-options=\"tableState.pageSizeOptions\"\n                    :no-data-text=\"t('VoteCodesView.noVoteCodesFound')\"\n                    :loading-text=\"t('VoteCodesView.loadingVoteCodes')\"\n                    @update:options=\"onTableOptionsUpdate\"\n                >\n                    <template #item.time=\"{ item }\">\n                        <DateTimeCell :value=\"item.time\" />\n                    </template>\n                    <template #item.associated_username=\"{ item }\">\n                        {{ item.associated_username ?? \"-\" }}\n                    </template>\n                    <template #item.ticket=\"{ item }\">\n                        {{ item.ticket ?? \"-\" }}\n                    </template>\n                </v-data-table-server>\n            </v-row>\n        </v-col>\n    </LayoutBase>\n</template>\n\n<script setup lang=\"ts\">\nimport { debounce, parseInt } from \"lodash-es\";\nimport { type Ref, computed, ref, watch } from \"vue\";\nimport { useI18n } from \"vue-i18n\";\nimport { useToast } from \"vue-toastification\";\nimport type { VDataTable } from \"vuetify/components\";\n\nimport * as api from \"@/api\";\nimport type { TicketVoteCode } from \"@/api\";\nimport DateTimeCell from \"@/components/table/DateTimeCell.vue\";\nimport LayoutBase, { type BreadcrumbItem } from \"@/components/layout/LayoutBase.vue\";\nimport { useTableState } from \"@/composables/useTableState\";\nimport { useEvents } from \"@/services/events\";\nimport { type LoadArgs, getLoadArgs } from \"@/services/utils/query_tools\";\n\ntype ReadonlyHeaders = VDataTable[\"$props\"][\"headers\"];\n\nconst props = defineProps<{ eventId: string }>();\nconst { t } = useI18n();\nconst toast = useToast();\nconst { getEventById } = useEvents();\nconst eventId = computed(() => parseInt(props.eventId, 10));\nconst loading = ref(false);\n\nconst breadcrumbs = computed<BreadcrumbItem[]>(() => [\n    {\n        title: getEventById(eventId.value)?.name ?? \"...\",\n        to: { name: \"dashboard\", params: { eventId: props.eventId } },\n    },\n    { title: t(\"VoteCodesView.title\"), disabled: true },\n]);\n\nconst tableState = useTableState();\nconst totalItems = ref(0);\nconst voteCodes: Ref<TicketVoteCode[]> = ref([]);\nconst lastLoadArgs: Ref<LoadArgs | null> = ref(null);\nconst headers: ReadonlyHeaders = [\n    {\n        title: t(\"VoteCodesView.headers.id\"),\n        sortable: true,\n        key: \"id\",\n    },\n    {\n        title: t(\"VoteCodesView.headers.associatedTo\"),\n        sortable: false,\n        key: \"associated_username\",\n    },\n    {\n        title: t(\"VoteCodesView.headers.ticket\"),\n        sortable: false,\n        key: \"ticket\",\n    },\n    {\n        title: t(\"VoteCodesView.headers.time\"),\n        sortable: true,\n        key: \"time\",\n    },\n];\n\nasync function load(args: LoadArgs) {\n    loading.value = true;\n    lastLoadArgs.value = args;\n    try {\n        const response = await api.adminEventKompomaattiTicketVoteCodesList({\n            path: { event_pk: eventId.value },\n            query: {\n                ...getLoadArgs(args),\n            },\n        });\n        voteCodes.value = response.data!.results;\n        totalItems.value = response.data!.count;\n    } catch (e) {\n        toast.error(t(\"VoteCodesView.loadFailure\"));\n        console.error(e);\n    } finally {\n        loading.value = false;\n    }\n}\n\nconst debouncedLoad = debounce(load, 250);\n\nfunction onTableOptionsUpdate(args: LoadArgs) {\n    tableState.onOptionsUpdate(args);\n    debouncedLoad(args);\n}\n\nfunction refresh() {\n    tableState.page.value = 1;\n    debouncedLoad({\n        page: 1,\n        itemsPerPage: tableState.perPage.value ?? 25,\n        sortBy: [],\n        groupBy: [] as never,\n        search: \"\",\n    });\n}\n\n// Reload when event changes\nwatch(eventId, refresh);\n</script>\n"],"names":["props","__props","t","useI18n","toast","useToast","getEventById","useEvents","eventId","computed","parseInt","loading","ref","breadcrumbs","tableState","useTableState","totalItems","voteCodes","lastLoadArgs","headers","load","args","response","api.adminEventKompomaattiTicketVoteCodesList","getLoadArgs","e","debouncedLoad","debounce","onTableOptionsUpdate","refresh","watch","_createBlock","LayoutBase","_createVNode","_component_v_col","_component_v_row","_component_v_data_table_server","_unref","$event","_withCtx","item","DateTimeCell","_createTextVNode","_toDisplayString"],"mappings":"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"}