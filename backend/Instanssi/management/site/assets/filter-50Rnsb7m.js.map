{"version":3,"file":"filter-50Rnsb7m.js","sources":["../../../../../admin/node_modules/vuetify/lib/composables/filter.js"],"sourcesContent":["/* eslint-disable max-statements */\n/* eslint-disable no-labels */\n\n// Utilities\nimport { computed, shallowRef, unref, watchEffect, normalizeClass as _normalizeClass, createElementVNode as _createElementVNode, Fragment as _Fragment } from 'vue';\nimport { getPropertyFromItem, propsFactory, wrapInArray } from \"../util/index.js\"; // Types\n/**\n * - boolean: match without highlight\n * - number: single match (index), length already known\n * - []: single match (start, end)\n * - [][]: multiple matches (start, end), shouldn't overlap\n */\n// Composables\nexport const defaultFilter = (value, query, item) => {\n  if (value == null || query == null) return -1;\n  if (!query.length) return 0;\n  value = value.toString().toLocaleLowerCase();\n  query = query.toString().toLocaleLowerCase();\n  const result = [];\n  let idx = value.indexOf(query);\n  while (~idx) {\n    result.push([idx, idx + query.length]);\n    idx = value.indexOf(query, idx + query.length);\n  }\n  return result.length ? result : -1;\n};\nfunction normaliseMatch(match, query) {\n  if (match == null || typeof match === 'boolean' || match === -1) return;\n  if (typeof match === 'number') return [[match, match + query.length]];\n  if (Array.isArray(match[0])) return match;\n  return [match];\n}\nexport const makeFilterProps = propsFactory({\n  customFilter: Function,\n  customKeyFilter: Object,\n  filterKeys: [Array, String],\n  filterMode: {\n    type: String,\n    default: 'intersection'\n  },\n  noFilter: Boolean\n}, 'filter');\n\n// eslint-disable-next-line complexity\nexport function filterItems(items, query, options) {\n  const array = [];\n  // always ensure we fall back to a functioning filter\n  const filter = options?.default ?? defaultFilter;\n  const keys = options?.filterKeys ? wrapInArray(options.filterKeys) : false;\n  const customFiltersLength = Object.keys(options?.customKeyFilter ?? {}).length;\n  if (!items?.length) return array;\n  let lookAheadItem = null;\n  loop: for (let i = 0; i < items.length; i++) {\n    const [item, transformed = item] = wrapInArray(items[i]);\n    const customMatches = {};\n    const defaultMatches = {};\n    let match = -1;\n    if ((query || customFiltersLength > 0) && !options?.noFilter) {\n      let hasOnlyCustomFilters = false;\n      if (typeof item === 'object') {\n        if (item.type === 'divider' || item.type === 'subheader') {\n          if (lookAheadItem?.type === 'divider' && item.type === 'subheader') {\n            array.push(lookAheadItem); // divider before subheader\n          }\n          lookAheadItem = {\n            index: i,\n            matches: {},\n            type: item.type\n          };\n          continue;\n        }\n        const filterKeys = keys || Object.keys(transformed);\n        hasOnlyCustomFilters = filterKeys.length === customFiltersLength;\n        for (const key of filterKeys) {\n          const value = getPropertyFromItem(transformed, key);\n          const keyFilter = options?.customKeyFilter?.[key];\n          match = keyFilter ? keyFilter(value, query, item) : filter(value, query, item);\n          if (match !== -1 && match !== false) {\n            if (keyFilter) customMatches[key] = normaliseMatch(match, query);else defaultMatches[key] = normaliseMatch(match, query);\n          } else if (options?.filterMode === 'every') {\n            continue loop;\n          }\n        }\n      } else {\n        match = filter(item, query, item);\n        if (match !== -1 && match !== false) {\n          defaultMatches.title = normaliseMatch(match, query);\n        }\n      }\n      const defaultMatchesLength = Object.keys(defaultMatches).length;\n      const customMatchesLength = Object.keys(customMatches).length;\n      if (!defaultMatchesLength && !customMatchesLength) continue;\n      if (options?.filterMode === 'union' && customMatchesLength !== customFiltersLength && !defaultMatchesLength) continue;\n      if (options?.filterMode === 'intersection' && (customMatchesLength !== customFiltersLength || !defaultMatchesLength && customFiltersLength > 0 && !hasOnlyCustomFilters)) continue;\n    }\n    if (lookAheadItem) {\n      array.push(lookAheadItem);\n      lookAheadItem = null;\n    }\n    array.push({\n      index: i,\n      matches: {\n        ...defaultMatches,\n        ...customMatches\n      }\n    });\n  }\n  return array;\n}\nexport function useFilter(props, items, query, options) {\n  const filteredItems = shallowRef([]);\n  const filteredMatches = shallowRef(new Map());\n  const transformedItems = computed(() => options?.transform ? unref(items).map(item => [item, options.transform(item)]) : unref(items));\n  watchEffect(() => {\n    const _query = typeof query === 'function' ? query() : unref(query);\n    const strQuery = typeof _query !== 'string' && typeof _query !== 'number' ? '' : String(_query);\n    const results = filterItems(transformedItems.value, strQuery, {\n      customKeyFilter: {\n        ...props.customKeyFilter,\n        ...unref(options?.customKeyFilter)\n      },\n      default: props.customFilter,\n      filterKeys: props.filterKeys,\n      filterMode: props.filterMode,\n      noFilter: props.noFilter\n    });\n    const originalItems = unref(items);\n    const _filteredItems = [];\n    const _filteredMatches = new Map();\n    results.forEach(_ref => {\n      let {\n        index,\n        matches\n      } = _ref;\n      const item = originalItems[index];\n      _filteredItems.push(item);\n      _filteredMatches.set(item.value, matches);\n    });\n    filteredItems.value = _filteredItems;\n    filteredMatches.value = _filteredMatches;\n  });\n  function getMatches(item) {\n    return filteredMatches.value.get(item.value);\n  }\n  return {\n    filteredItems,\n    filteredMatches,\n    getMatches\n  };\n}\nexport function highlightResult(name, text, matches) {\n  if (matches == null || !matches.length) return text;\n  return matches.map((match, i) => {\n    const start = i === 0 ? 0 : matches[i - 1][1];\n    const result = [_createElementVNode(\"span\", {\n      \"class\": _normalizeClass(`${name}__unmask`)\n    }, [text.slice(start, match[0])]), _createElementVNode(\"span\", {\n      \"class\": _normalizeClass(`${name}__mask`)\n    }, [text.slice(match[0], match[1])])];\n    if (i === matches.length - 1) {\n      result.push(_createElementVNode(\"span\", {\n        \"class\": _normalizeClass(`${name}__unmask`)\n      }, [text.slice(match[1])]));\n    }\n    return _createElementVNode(_Fragment, null, [result]);\n  });\n}\n//# sourceMappingURL=filter.js.map"],"names":["defaultFilter","value","query","item","result","idx","normaliseMatch","match","makeFilterProps","propsFactory","filterItems","items","options","array","filter","keys","wrapInArray","customFiltersLength","lookAheadItem","loop","i","transformed","customMatches","defaultMatches","hasOnlyCustomFilters","filterKeys","key","getPropertyFromItem","keyFilter","defaultMatchesLength","customMatchesLength","useFilter","props","filteredItems","shallowRef","filteredMatches","transformedItems","computed","unref","watchEffect","_query","strQuery","results","originalItems","_filteredItems","_filteredMatches","_ref","index","matches","getMatches","highlightResult","name","text","start","_createElementVNode","_normalizeClass","_Fragment"],"mappings":"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","x_google_ignoreList":[0]}