{"version":3,"file":"http-Cqy_sGiB.js","sources":["../../../../../admin/src/utils/http.ts"],"sourcesContent":["import { HttpStatus } from \"@/utils/http_status\";\n\ntype FieldErrors = Record<string, string>;\ntype SetErrorsFn = (errors: FieldErrors) => void;\ntype ToastInterface = { error: (message: string) => void };\n\n/** Maps API field names (snake_case) to form field names (camelCase) */\nexport type FieldMapping = Record<string, string>;\n\ninterface ErrorResponse {\n    status: number;\n    data: unknown;\n}\n\nfunction getErrorResponse(error: unknown): ErrorResponse | null {\n    const err = error as { response?: ErrorResponse };\n    return err?.response ?? null;\n}\n\nfunction getResponseData(response: ErrorResponse): Record<string, unknown> | null {\n    const { data } = response;\n    return typeof data === \"object\" && data !== null ? (data as Record<string, unknown>) : null;\n}\n\n/**\n * Extract error message from API error response.\n * Returns the detail message if available, otherwise the fallback.\n */\nexport function getApiErrorMessage(error: unknown, fallbackMessage: string): string {\n    const response = getErrorResponse(error);\n    const data = response && getResponseData(response);\n    if (data && typeof data.detail === \"string\") {\n        return data.detail;\n    }\n    return fallbackMessage;\n}\n\n/**\n * Handle API errors by mapping field-level validation errors to form fields\n * and showing appropriate toast messages.\n *\n * @param error - The caught error (typically AxiosError)\n * @param setErrors - vee-validate's setErrors function\n * @param toast - Toast interface with error() method\n * @param fallbackMessage - Message to show if no specific error can be extracted\n * @param fieldMapping - Mapping from API field names to form field names.\n *        Only explicitly mapped fields will show errors on form fields.\n *        Unmapped field errors are shown in a toast.\n */\nexport function handleApiError(\n    error: unknown,\n    setErrors: SetErrorsFn,\n    toast: ToastInterface,\n    fallbackMessage: string,\n    fieldMapping: FieldMapping = {}\n): void {\n    const response = getErrorResponse(error);\n    if (!response) {\n        toast.error(fallbackMessage);\n        console.error(error);\n        return;\n    }\n\n    const data = getResponseData(response);\n\n    // Handle field-level validation errors (400 Bad Request)\n    if (response.status === HttpStatus.BAD_REQUEST && data) {\n        const fieldErrors: FieldErrors = {};\n        const toastMessages: string[] = [];\n\n        for (const [key, value] of Object.entries(data)) {\n            if (key === \"detail\" || !Array.isArray(value)) continue;\n\n            const message = value.join(\", \");\n            const mappedField = fieldMapping[key];\n\n            if (mappedField) {\n                fieldErrors[mappedField] = message;\n            } else {\n                toastMessages.push(`${key}: ${message}`);\n            }\n        }\n\n        const hasFieldErrors = Object.keys(fieldErrors).length > 0;\n        const hasToastMessages = toastMessages.length > 0;\n\n        if (hasFieldErrors || hasToastMessages) {\n            if (hasFieldErrors) setErrors(fieldErrors);\n            if (hasToastMessages) toast.error(toastMessages.join(\"\\n\"));\n            return;\n        }\n    }\n\n    // Check for detail message\n    if (data && typeof data.detail === \"string\") {\n        toast.error(data.detail);\n        return;\n    }\n\n    toast.error(fallbackMessage);\n    console.error(error);\n}\n"],"names":["getErrorResponse","error","getResponseData","response","data","getApiErrorMessage","fallbackMessage","handleApiError","setErrors","toast","fieldMapping","HttpStatus","fieldErrors","toastMessages","key","value","message","mappedField","hasFieldErrors","hasToastMessages"],"mappings":"yCAcA,SAASA,EAAiBC,EAAsC,CAE5D,OADYA,GACA,UAAY,IAC5B,CAEA,SAASC,EAAgBC,EAAyD,CAC9E,KAAM,CAAE,KAAAC,GAASD,EACjB,OAAO,OAAOC,GAAS,UAAYA,IAAS,KAAQA,EAAmC,IAC3F,CAMO,SAASC,EAAmBJ,EAAgBK,EAAiC,CAChF,MAAMH,EAAWH,EAAiBC,CAAK,EACjCG,EAAOD,GAAYD,EAAgBC,CAAQ,EACjD,OAAIC,GAAQ,OAAOA,EAAK,QAAW,SACxBA,EAAK,OAETE,CACX,CAcO,SAASC,EACZN,EACAO,EACAC,EACAH,EACAI,EAA6B,GACzB,CACJ,MAAMP,EAAWH,EAAiBC,CAAK,EACvC,GAAI,CAACE,EAAU,CACXM,EAAM,MAAMH,CAAe,EAC3B,QAAQ,MAAML,CAAK,EACnB,MACJ,CAEA,MAAMG,EAAOF,EAAgBC,CAAQ,EAGrC,GAAIA,EAAS,SAAWQ,EAAW,aAAeP,EAAM,CACpD,MAAMQ,EAA2B,CAAA,EAC3BC,EAA0B,CAAA,EAEhC,SAAW,CAACC,EAAKC,CAAK,IAAK,OAAO,QAAQX,CAAI,EAAG,CAC7C,GAAIU,IAAQ,UAAY,CAAC,MAAM,QAAQC,CAAK,EAAG,SAE/C,MAAMC,EAAUD,EAAM,KAAK,IAAI,EACzBE,EAAcP,EAAaI,CAAG,EAEhCG,EACAL,EAAYK,CAAW,EAAID,EAE3BH,EAAc,KAAK,GAAGC,CAAG,KAAKE,CAAO,EAAE,CAE/C,CAEA,MAAME,EAAiB,OAAO,KAAKN,CAAW,EAAE,OAAS,EACnDO,EAAmBN,EAAc,OAAS,EAEhD,GAAIK,GAAkBC,EAAkB,CAChCD,KAA0BN,CAAW,EACrCO,GAAkBV,EAAM,MAAMI,EAAc,KAAK;AAAA,CAAI,CAAC,EAC1D,MACJ,CACJ,CAGA,GAAIT,GAAQ,OAAOA,EAAK,QAAW,SAAU,CACzCK,EAAM,MAAML,EAAK,MAAM,EACvB,MACJ,CAEAK,EAAM,MAAMH,CAAe,EAC3B,QAAQ,MAAML,CAAK,CACvB"}